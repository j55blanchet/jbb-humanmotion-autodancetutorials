{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/screens/CreateLessonScreen.vue?feef","webpack:///./src/components/elements/WebcamBox.vue?beab","webpack:///./src/components/elements/SheetMotion.vue?3248","webpack:///./src/components/elements/VideoPlayer.vue?8563","webpack:///./src/components/elements/MiniLessonPlayer.vue?fe78","webpack:///./src/components/elements/ActivityVideoPlayer.vue?2cf0","webpack:///./src/components/elements/InstructionCarousel.vue?bc11","webpack:///./src/components/screens/FeedbackUploadScreen.vue?6f8a","webpack:///./src/components/elements/UploadCard.vue?2e55","webpack:///./src/App.vue?c667","webpack:///./src/components/elements/LessonCard.vue?1cb3","webpack:///./src/App.vue","webpack:///./src/components/screens/WorkflowMenu.vue","webpack:///./src/components/elements/MiniLessonPlayer.vue","webpack:///./src/components/elements/ActivityVideoPlayer.vue","webpack:///./src/components/elements/InstructionCarousel.vue","webpack:///./src/components/elements/InstructionCarousel.vue?eae7","webpack:///./src/components/elements/InstructionCarousel.vue?3dde","webpack:///./src/components/elements/PausingVideoPlayer.vue","webpack:///./src/services/Constants.ts","webpack:///./src/components/elements/VideoPlayer.vue","webpack:///./src/services/MediaPipeTypes.ts","webpack:///./src/services/EventHub.ts","webpack:///./src/services/Utils.ts","webpack:///./src/services/MediaPipe.ts","webpack:///./src/services/PoseProvider.ts","webpack:///./src/components/elements/VideoPlayer.vue?e7d3","webpack:///./src/components/elements/VideoPlayer.vue?b67d","webpack:///./src/components/elements/PausingVideoPlayer.vue?fe03","webpack:///./src/components/elements/PausingVideoPlayer.vue?8e8a","webpack:///./src/components/elements/KeyframeTimeline.vue","webpack:///./src/components/elements/KeyframeTimeline.vue?2297","webpack:///./src/components/elements/KeyframeTimeline.vue?4e3e","webpack:///./src/components/elements/WebcamBox.vue","webpack:///./src/services/EventLogger.ts","webpack:///./src/services/WebcamProvider.ts","webpack:///./src/components/elements/WebcamSourceSelectionMenu.vue","webpack:///./src/components/elements/WebcamSourceSelectionMenu.vue?1138","webpack:///./src/components/elements/WebcamSourceSelectionMenu.vue?e9dc","webpack:///./src/components/elements/WebcamBox.vue?0a4a","webpack:///./src/components/elements/WebcamBox.vue?e390","webpack:///./src/components/elements/SheetMotion.vue","webpack:///./src/components/elements/SheetMotion.vue?5570","webpack:///./src/components/elements/SheetMotion.vue?5e8d","webpack:///./src/components/elements/ActivityVideoPlayer.vue?e80c","webpack:///./src/components/elements/ActivityVideoPlayer.vue?f161","webpack:///./src/components/elements/SegmentedProgressBar.vue","webpack:///./src/components/elements/SegmentedProgressBar.vue?1c88","webpack:///./src/components/elements/SegmentedProgressBar.vue?1b9d","webpack:///./src/components/elements/MiniLessonPlayer.vue?9016","webpack:///./src/components/elements/MiniLessonPlayer.vue?97b4","webpack:///./src/components/elements/WorkflowStepCard.vue","webpack:///./src/components/elements/WorkflowStepCard.vue?4c1f","webpack:///./src/components/elements/WorkflowStepCard.vue?f726","webpack:///./src/services/VideoDatabase.ts","webpack:///./src/services/MiniLessonManager.ts","webpack:///./src/services/WorkflowManager.ts","webpack:///./src/components/screens/FeedbackUploadScreen.vue","webpack:///./src/services/AzureUploader.ts","webpack:///./src/components/screens/FeedbackUploadScreen.vue?3036","webpack:///./src/components/screens/FeedbackUploadScreen.vue?209b","webpack:///./src/services/OptionsManager.ts","webpack:///./src/model/Workflow.ts","webpack:///./src/components/screens/WorkflowMenu.vue?8157","webpack:///./src/components/screens/WorkflowMenu.vue?71fa","webpack:///./src/components/screens/CreateWorkflowScreen.vue","webpack:///./src/components/screens/CreateLessonScreen.vue","webpack:///./src/components/tools/KeyframeSelectorTool.vue","webpack:///./src/components/tools/KeyframeSelectorTool.vue?f994","webpack:///./src/components/tools/KeyframeSelectorTool.vue?3151","webpack:///./src/components/screens/CreateLessonScreen.vue?a8e9","webpack:///./src/components/screens/CreateLessonScreen.vue?8b77","webpack:///./src/components/screens/CreateWorkflowScreen.vue?a634","webpack:///./src/components/screens/CreateWorkflowScreen.vue?638d","webpack:///./src/components/screens/MainMenu.vue","webpack:///./src/components/elements/MainMenuWorkflowCard.vue","webpack:///./src/components/elements/MainMenuWorkflowCard.vue?b70b","webpack:///./src/components/elements/MainMenuWorkflowCard.vue?2619","webpack:///./src/components/elements/LessonCard.vue","webpack:///./src/components/elements/LessonCard.vue?090b","webpack:///./src/components/elements/LessonCard.vue?8b6b","webpack:///./src/components/elements/UploadCard.vue","webpack:///./src/components/elements/UploadCard.vue?311e","webpack:///./src/components/elements/UploadCard.vue?f397","webpack:///./src/components/screens/MainMenu.vue?7063","webpack:///./src/components/screens/MainMenu.vue?0a41","webpack:///./src/App.vue?3acc","webpack:///./src/App.vue?eabf","webpack:///./src/registerServiceWorker.ts","webpack:///./src/services/GestureDetection.ts","webpack:///./src/main.ts","webpack:///./src/components/tools/KeyframeSelectorTool.vue?4694","webpack:///./src/components/elements/KeyframeTimeline.vue?2076","webpack:///./src/components/screens/MainMenu.vue?9f28","webpack:///./src/components/elements/SegmentedProgressBar.vue?4152"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","class","id","style","participantId","isDebug","lessonSelected","createLessonSelected","startWorkflow","state","State","CreateWorkflow","startKeyframeSelection","MainMenu","CreateLesson","motion","currentVideo","goHome","WorkflowActive","showBackButton","startedWithWorkflow","KeyframeSelectorTool","modelValue","keyframes","videoEntry","LessonActive","miniLesson","currentLesson","maxVideoHeight","enableCompleteLesson","aria-label","optionsManager","to","workflow","type","enableExperimentMode","Math","round","workflowSecsElapsed","workflowSecondsRemainingString","stageSecsElapsed","stageSecondsRemainingString","showHeader","userTitle","title","$emit","filteredStages","stage","isStageCompleted","beforeStartSteps","stepInfo","startWorkflowStep","step","activeStageIndex","startStage","timeLimitString","stageSecondsRemaining","Infinity","mainSteps","afterExpiredSteps","nextStepInStage","instructionsActive","currentStep","instructions","heading","text","instructionsFinished","lessonActive","currentVideoEntry","lessonCompleted","timeRemaining","uploadActive","prompt","upload","subtitle","uploadFilename","followAlong","activityLogUploadFilename","uploadComplete","maxAttempts","maxAllowedAttempts","timingNotStarted","startTiming","segments","progressSegments","progress","activityProgress","ref","activity","activeActivity","onProgress","nearbyActivityIndices","index","activeActivityIndex","activityVideoPlayer","activityFinished","gotoActivity","activities","disabled","needsStartWebcam","awaitingStart","play","repeat","hasNextActivity","completeLesson","showStartWebcamButton","showingWebcam","videoSrc","drawPoseLandmarks","demoVisual","videoOpacity","emphasizedJoints","onPlaybackCompleted","onPauseHit","onPauseEnded","showControls","showVideoControls","motionTrails","drawMotionTrailsInTime","needsToStartWebcam","showSheetMusic","dbEntry","drawMode","sheetMotionVisual","currentTime","videoTime","sheetMotion","isReviewing","src","recordingObjectUrl","undefined","controls","sizeClass","tagClass","startInstructions","shouldShowStartInstructions","startInstruction","pauseInstructs","timedInstructions","staticInstruction","keyframeVisual","videoDeviceId","audioDeviceId","startWebcam","tag","inst","props","Array","default","String","render","videoBaseUrl","onSegmentPlaybackCompleted","setDrawStyle","emphasizedJointStyle","Constants","freeze","DefaultPauseDuration","videoUrl","scheduleCanvasResizing","onTimeUpdated","endReported","playsinline","PoseLandmarks","nose","leftEyeInner","leftEye","leftEyeOuter","rightEyeInner","rightEye","rightEyeOuter","leftEar","rightEar","mouthLeft","mouthRight","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftPinky","rightPinky","leftIndex","rightIndex","leftThumb","rightThumb","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle","leftHeel","rightHeel","leftFootIndex","rightFootIndex","midShouder","midHip","midEye","EventNames","gesture","trackingProcessingStarted","trackingResults","trackingRequested","trackingRequestFinished","GestureNames","none","pointLeft","pointRight","namaste","eventHub","requestTracking","emit","endTrackingRequest","size","startAt","keys","map","secs","Promise","res","setTimeout","filename","element","document","createElement","setAttribute","encodeURIComponent","display","body","appendChild","click","removeChild","onFrame","shouldRun","requestAnimationFrame","then","Utils","DoEveryFrame","replace","crypto","getRandomValues","Uint8Array","toString","obj","Date","copy","setTime","getTime","isArray","len","deepCopy","typedObj","attrs","attr","val","Error","array","fromIndex","toIndex","sliceStart","sliceEnd","floor","random","usingHolistic","HAND","THUMB_FINGER","INDEX_FINGER","MIDDLE_FINGER","RING_FINGER","PINKY_FINGER","CONNECTIONS_TO_DRAW","v0","v1","MidLandmark","lm1","lm2","x","y","visibility","GetLandmark","lm","lms","DrawSkeleton","canvasCtx","width","height","poseLandmarks","enableSizeVariation","emphasisStroke","w","h","forEach","connection","p1","p2","emphasized","indexOf","save","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","restore","DrawPose","options","jointsWithEmphasis","canvas","sourceAR","sourceAspectRatio","canvasAR","adjustedHeight","pixelsTaller","translate","adjustedWidth","pixelsWider","outlineColor","outlineWidth","max","VIDEO_EXTENSIONS","Map","videoName","poseFilename","extension","cached","this","poseFiles","stored","localStorage","getItem","JSON","parse","set","PoseProvider","getPoseFile","poseFile","poses","convertToPoseList","url","fetch","response","ok","statusText","csv","temp","row","convertRow","filter","startsWith","Number","parseFloat","poseProvider","motionTrailColors","onResize","canvasE","videoE","modified","offsetWidth","offsetHeight","setupCanvasResizing","videoElement","canvasElement","resizeCanvas","addEventListener","removeEventListener","setupVideoPlaying","startTime","endTime","startProgressUpdating","playVideo","from","speed","pause","playbackRate","console","error","pauseVideo","required","Boolean","fps","Function","emits","setup","ctx","getContext","canvasModified","currentFrame","currentPose","frame","pose","prevTime","timerId","ignoreEnd","vidElement","time","log","clearInterval","setInterval","clearDrawing","drawCtx","clearRect","drawPose","videoHeight","videoWidth","retieveClearPoseFile","GetPose","drawArrow","fromX","fromY","toX","toY","atEnd","arrowLength","arrowWidth","dx","dy","angle","atan2","rotate","lineCap","ellipse","PI","drawMotionTrail","trail","color","strokeWidth","motionTrailsInTime","lastTrailItem","findIndex","effectiveTrailLength","globalAlpha","xScale","yScale","scale","startx","starty","nx","ny","xc","yc","quadraticCurveTo","x2","y2","lastx","lasty","secondlastx","secondlasty","motionTrailsCurrentTime","drawingInTime","resizeTimerId","getVideoDimensions","methods","keepPlaying","getVideoTime","DEFAULT_PAUSE_DURATION","computePlaySegments","pauses","segs","nextPauseIndex","prevIndex","pTime","pauseIndex","pi","segStartTime","components","VideoPlayer","videoPlayer","playTimeoutId","vidPlayer","clearTimeout","playSegment","seg","delaySecs","emitResume","onPlayStart","playingSegments","playingSegmentIndex","playDelaySecs","nextSeg","manualResume","pauseDuration","$refs","allKeyframes","kfitem","kf","setKFSkeletonDrawStyle","showTimestamps","toFixed","timelineActiveItemsLimit","maxActiveTimelineSecs","minStackItems","keyframesTyped","currentKeyframe","find","futureKeyframes","item","separatedKeyframes","separationIndex","active","future","timelineTime","lastKfTime","nextKfTime","timeTONextKf","min","lastScrollingKf","activeKeyframes","left","opacity","stackTimeline","current","timeline","reverse","stack","muted","disablePictureInPicture","webcamStatus","selfStartWebcam","logString","logEntries","timestamp","desc","toISOString","logFile","entry","join","eventLogger","WEBCAM_DIMENSIONS","Set","mediaStream","isWebcamLoading","readPermissionStatus","navigator","permissions","query","permissionState","audioDevice","cachedAudioDeviceId","videoDevice","cachedVideoDeviceId","constraints","video","aspectRatio","frameRate","deviceId","audio","mediaDevices","getUserMedia","activeConnections","add","srcObject","onloadedmetadata","delete","ongoingRecordings","stopWebcam","recorderId","abortRecording","getTracks","stop","recordingId","has","warn","rtc","startRecording","recorder","end","stopRecording","resolve","cachedRecordings","getBlob","defaultProvider","loadDevices","videoDevices","device","selectVideoDevice","label","audioDevices","selectAudioDevice","enumerateDevices","devices","kind","WebcamSourceSelectionMenu","maxHeight","webcamStartError","connectVideoElement","status","disconnectVideoElement","webcamProvider","computed","webcamStarted","phrases","phase","frames","setNoteRef","data-phase","data-frame","setPoseDrawStyle","constrain","remap","newMin","newMax","variableLength","fadeInDurationSecs","fadeOutDurationSecs","noteRefs","activeNoteElement","typedData","activePhase","activeFrame","phrase","noteRef","phaseI","frameJ","el","watch","immediate","handler","scrollIntoView","behavior","block","dataset","parseInt","isActive","nextkf","getPhraseFlexGrow","phraseIndex","nPhrase","phraseStartTime","nPhraseStartTime","getFrameFlexGrow","kfIndex","curFrame","nextKf","getFrameBackground","curr","next","timeUntil","timePassed","fadePercent","brightness","saturation","ActivityPlayState","AwaitingStart","PendingStart","Playing","ActivityEnded","defaultPauseDuration","PausingVideoPlayer","InstructionCarousel","WebcamBox","KeyframeTimeline","SheetMotion","typedActivity","shouldReview","reviewing","shouldRecord","recording","isPlaying","isPendingStart","webcamBox","identifier","isRecording","blob","URL","createObjectURL","instruction","reset","newTime","trailBreakEndIndex","trailBreaks","motionTrailBreaks","trailStartTime","trailEndTime","trailsRaw","startIndex","endIndex","hideForReview","userVisual","mActivity","instructs","playingInstruction","endInstruction","activeTimedInstructions","ti","start","needsUserVisual","needsWebcam","delay","vidActivity","practiceSpeed","segmentsData","enableAll","enabled","cssClass","calculateProgressSegments","lesson","allLabels","segmentLabels","last","segmentBreaks","segData","doesOverlap","focusedSegments","cssClassOptions","SegmentedProgressBar","ActivityVideoPlayer","margin","minIndex","maxActivityIndex","maxIndex","count","indices","concat","range","$props","activityIndex","hasPreviousActivity","autoPlay","playActivity","nextActivity","newVal","isClickable","thumbnailSrc","alt","waitingForTimeExpiration","isComplete","entriesByClipName","values","entries","clipName","clipPath","tags","allTags","db","createBlankActivity","duration","createBlankLesson","_id","uuidv4","source","header","lessonTitle","customLessonCount","loadCustomLessons","lessonList","lessonsByVideo","lessonIndex","updatedLesson","MiniLessonManager","updateLessonFormat","existingIndex","les","lessonsById","lessons","customLessonIds","getCustomLessonIdsList","countLoaded","custLesson","upsertLesson","setItem","stringify","custLessonIds","saveCustomLessonsIdsList","removeLesson","lessonIdIndex","removeItem","miniLessonManager","thumbnailRootDir","defaultWorkflows","customWorkflows","additionalWorkflows","workflows","sort","a","b","localeCompare","bakedInWorkflows","loadWorkflows","created","addSessionWorkflow","customWorkflowIds","WorkflowManager","getCustomWorkflowIdsList","tryLoadCustomWorkflow","isCustomWorkflow","hasSavedCustomLesson","updatedWorkflow","updateToLatestWorkflowFormat","workflowRaw","e","custWorkflowIds","saveCustomWorkflowIdsList","workflowId","matchingWorkflow","flow","trackingFlow","stages","steps","shuffleInfo","shuffle","shuffleArray","activeFlow","stageIndex","stepIndex","stepAny","newStep","newStepAny","videoLessonReference","miniLessonReference","videoLessonEmbedded","miniLessonEmbedded","validateWorkflowStage","validateWorkflowStep","lessonId","validateLesson","workflowManager","followAlongProgress","onVideoPlayBackCompleted","visualMode","toggleRecording","countdownTimerRemaining","recordedObjectUrl","isUploading","maxAttemptsIsReached","rerecord","uploadVideo","uploadError","successfullyUploaded","blobServiceClient","BlobServiceClient","blobName","client","getContainerClient","blockBlobClient","getBlockBlobClient","uploadData","sleep","ms","followAlongRef","attempts","lastRecordedBlob","followData","clearRecording","doCountdown","clipSpeed","logText","retrieveLog","logBlob","Blob","logBlobName","parsePath","urlParams","URLSearchParams","location","search","isExperimentActive","participantIdWasSet","CreateBlankWorkflow","creationMethod","learningScheme","IsMiniLessonStep","GetWorkflowStepVideoClipName","GetVideoEntryForWorkflowStep","getDurationString","seconds","isNaN","secsRemainingConstrained","substr","enableTiming","MiniLessonPlayer","FeedbackUploadScreen","WorkflowStepCard","uploadId","activityLogUploadIdentifier","isExperimentMode","activeStage","filteredSteps","experiment","showInExperimentOnly","isTestMode","isInActiveStage","isTimeExpiredTask","stageTimeExpired","isValidAfterExpiredTask","isValidUnexpired","isBeforeTime","isBeforeTimeStartTask","isRepeatable","disableRepitition","isExpired","isNextStep","maxStageTimeSecs","filteredStep","workflowStartTime","workflowStageStartTime","isTiming","stageTimer","workflowSecondsRemaining","experimentMaxTimeSecs","now","isInCurrentStage","continueWorkflowStep","completeStep","reduce","wasTrue","thisStep","aria-hidden","activeWorkflow","goBack","workflowInDatabase","deleteWorkflow","exportWorkflow","isDirty","saveWorkflow","selectedStageIndex","selectStage","duplicateStage","addStage","canReorderStage","reorderStage","selectedStepIndex","selectStep","activeStep","duplicateStep","addStep","deleteStage","canReorderStep","reorderStep","isMoveStepDropdownActive","stageI","moveStep","isInstructionStep","isLessonEmbeddedStep","activeStepLesson","removeEmbeddedLesson","convertEmbeddedLessonToReference","editWorkflowStepLesson","newEmbeddedLessonClipName","availableClips","canCreateEmbeddedLesson","startCreateEmbeddedLesson","isLessonReferenceStep","availableReferenceLessons","canEditActiveStepLessonReference","createReferencedLesson","isVideoUploadStep","durationOfClip","event","target","deleteStep","selectingWorkflowIndex","availableWorkflows","canEditWorkflow","selectingWorkflowId","startCreation","exportCustomWorkflows","customWorkflowCount","editLessonActive","embeddedLessonMotion","lessonToEdit","updateWorkflowStepLesson","saveToDatabase","showCloseButton","showExportButton","disableEditingExisting","LessonCreationState","SelectOpenLesson","lessonUnderConstruction","ModifyLesson","canDeleteLesson","deleteLesson","exportLesson","saveLesson","lessonInDatabase","activeLessonSelectionIndex","canEditActiveLesson","segBreak","setSegmentBreak","$event","canDeleteSegment","removeSegmentBreak","newSegmentVal","addSegmentBreak","selectActivity","duplicateActivity","addActivity","canReorderActivity","reorderActivity","activeActivityFocusedSegments","segInfo","checked","isFocused","setFocusedSegment","activeActivityKeyframes","keyframeSelectorToolActive","activePauseIndex","selectPause","addPause","sortPauses","activeTimedInstructionIndex","selectTimedInstruction","addTimedInstruction","sortTimedInstructions","canDeleteActivity","deleteActivity","activePause","activeTimedInstruction","deletePause","deleteTimedInstruction","paused","updateCurrentTime","addKeyframe","effectiveStartTime","deleteKeyframe","effectiveEndTime","updateIntervalId","prevKeyframe","nextKeyframe","modelCopy","nearestKf","confirm","saveReference","newPauseTime","displayMode","segBreaks","segsSet","boolArray","activeLessonSelection","hasLesson","lessonStartTime","lessonEndTime","getLessons","acLes","mounted","passedInLesson","typedMotion","miniLessonPlayer","deep","sortSegmentBreaks","segmentIndex","asTemplate","sourceLesson","existingLesson","targetIndex","newActivity","indexDelta","curActivity","swapActivity","swapIndex","indexToDelete","dupActivity","newPause","selectedPause","newIndex","pauseObj","newInstruction","timedInstructs","selectedTimedInstruc","timedInstruction","tiIndex","breakTime","newList","curIndex","saveCustomLesson","deleteCustomLesson","PromptDownloadFile","WorkflowMenu","CreateLessonScreen","selectingWorkflow","workflowsArray","newEmbeddedLessonMotion","setActiveFlow","completeActivitesPriorToStageAndStep","json","clipNames","skipPrompt","reloadCustomWorkflow","deleteCustomWorkflow","upsertCustomWorkflow","newActiveWorkflow","existingWorkflow","increment","curStage","swapStage","curSelected","toSwap","curStep","swapStep","ogSteps","targetStageIndex","stepToMove","targetPhase","exportLessonData","TabList","tab","currentTab","setTab","whitelistedWorkflows","Tabs","Workflows","isWorkflowListExpanded","nonwhitelistedWorkflows","Videos","availableTags","activeTags","toggleTag","filteredVideos","hovering","clicked","True","selectedVideo","uploadLessonUIActive","uploadWorkflowUIActive","Tools","onLessonSelected","onKeyframeSelectorToolSelected","uploadAccept","onFilesSelected","uploadLessons","savingText","successText","uploadWorkflows","toLocaleDateString","toLocaleTimeString","copyLink","protocol","host","clipboard","writeText","classList","originalText","innerText","remove","autoplay","canCreateLesson","keyframeOptions","kfopt","option","enctype","novalidate","isInitial","isSaving","isFailed","uploadFieldName","accept","uploadInstructions","isSuccess","Status","Initial","Saving","Success","Failed","currentStatus","fileList","workflowWhitelist","TabSet","LessonCard","UploadCard","MainMenuWorkflowCard","videos","tagMatchingMotions","allTagsMatch","someTagMatches","currTag","thisTagMatches","includes","files","file","validateWorkflow","hasBakedInWorkflow","hasWorkflow","CreateWorkflowScreen","cameraSurface","kfs","dance","ready","registered","updatefound","updated","offline","minDetectionVisibility","getAngle","lm0","dist","sqrt","getSum","input","midPoint","averageAngle","angles","arr","pop","sin","cos","isLine","angleTolerance","tolerance","lastAngle","thisAngle","abs","detectHandPointingGestures","handLandmarks","FINGERS","FINGER_LANDMARKS","areLines","finger","avgAngle","avgAngleDeg","detectPosePointingGestures","TOLERANCE","TOLERANCE_RADS","lelb","lwrist","ang","right","relb","rwrist","isNamasteGesture","results","IDs","poseLMs","areArmLandmarksVisible","downwards","leftForearmTargetAngle","rightForearmTargetAngle","elbowAngleTolerance","leftForearmAngle","rightForearmAngle","handNeckMinRelativeDist","shoulderDist","neckCenter","leftWristNeckDist","rightWristNeckDist","areHandsNearNeckBase","detectGesture","mpResults","image","detectedGesture","rightHandLandmarks","leftHandLandmarks","startGestureDetection","on","app","App","mount"],"mappings":"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","file":"js/app.f87e4f15.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([1,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CreateLessonScreen.vue?vue&type=style&index=0&id=741d684d&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./WebcamBox.vue?vue&type=style&index=0&id=10319176&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./SheetMotion.vue?vue&type=style&index=0&id=dc7a45f0&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./VideoPlayer.vue?vue&type=style&index=0&id=d3c5c3ee&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./MiniLessonPlayer.vue?vue&type=style&index=0&id=2cb36924&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./ActivityVideoPlayer.vue?vue&type=style&index=0&id=1d829410&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./InstructionCarousel.vue?vue&type=style&index=0&id=39bd31b2&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./FeedbackUploadScreen.vue?vue&type=style&index=0&id=21bd46b7&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./UploadCard.vue?vue&type=style&index=0&id=542a134c&lang=scss\"","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&id=eacb1f9a&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./LessonCard.vue?vue&type=style&index=0&id=28bed797&lang=scss\"","<template>\n<div class=\"app\">\n\n  <div id=\"debugData\" v-show=\"isDebug\" class=\"tags p-2 mb-0 has-background-dark has-text-grey-lighter\">\n    <span class=\"tag\">ParticipantId: {{participantId ?? 'null'}}</span>\n  </div>\n\n  <MainMenu\n        v-show=\"state === State.MainMenu\"\n        @lesson-selected=\"lessonSelected\"\n        @create-lesson-selected=\"createLessonSelected\"\n        @workflow-selected=\"startWorkflow\"\n        @create-workflow-selected=\"state = State.CreateWorkflow\"\n        @keyframeselectortool-selected=\"startKeyframeSelection\"\n      />\n\n  <CreateLessonScreen\n        v-if=\"state === State.CreateLesson\"\n          :motion=\"currentVideo\"\n          @back-selected=\"goHome\"\n          @lesson-created=\"goHome\" />\n\n  <CreateWorkflowScreen\n    v-if=\"state === State.CreateWorkflow\"\n    @back-selected=\"goHome\"\n    @workflow-created=\"goHome\"\n    />\n\n  <WorkflowMenu\n        v-if=\"state === State.WorkflowActive\"\n        @back-selected=\"goHome\"\n        :showBackButton=\"!startedWithWorkflow\"/>\n\n  <KeyframeSelectorTool\n        v-if=\"state === State.KeyframeSelectorTool\"\n        @back-selected=\"goHome\"\n        v-model:modelValue=\"keyframes\"\n        :videoEntry=\"currentVideo\"/>\n\n  <div v-bind:class=\"{ 'is-active': state == State.LessonActive }\" class=\"modal\">\n    <div class=\"modal-background\"></div>\n    <div class=\"container\" style=\"max-height=100vh; max-width=100vw;\">\n      <div class=\"vcenter-parent\">\n        <div class=\"box\" >\n          <MiniLessonPlayer\n            v-if=\"state == State.LessonActive\"\n            :videoEntry=\"currentVideo\"\n            :miniLesson=\"currentLesson\"\n            @lesson-completed=\"goHome\"\n            :maxVideoHeight=\"'calc(100vh - 152px - 3.75rem)'\"\n            :enableCompleteLesson=\"true\"/>\n        </div>\n      </div>\n    </div>\n    <button class=\"modal-close is-large\" aria-label=\"close\" @click=\"goHome\"></button>\n  </div>\n</div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed, defineComponent, nextTick, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport CreateWorkflowScreen from '@/components/screens/CreateWorkflowScreen.vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport KeyframeSelectorTool from '@/components/tools/KeyframeSelectorTool.vue';\nimport CameraSurface from './components/CameraSurface.vue';\nimport OnboardingUI from './components/OnboardingUI.vue';\nimport MainMenu from './components/screens/MainMenu.vue';\n// import LearningScreen from './components/screens/LearningScreen.vue';\nimport MiniLesson from './model/MiniLesson';\n\nimport CreateLessonScreen from './components/screens/CreateLessonScreen.vue';\nimport workflowManager from './services/WorkflowManager';\nimport optionsManager from './services/OptionsManager';\n\nconst State = {\n  MainMenu: 'MainMenu',\n  LessonActive: 'LessonActive',\n  WorkflowActive: 'WorkflowActive',\n  CreateLesson: 'CreateLesson',\n  CreateWorkflow: 'CreateWorkflow',\n  KeyframeSelectorTool: 'KeyframeSelectorTool',\n};\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    MainMenu,\n    WorkflowMenu,\n    KeyframeSelectorTool,\n    CreateLessonScreen,\n    CreateWorkflowScreen,\n    MiniLessonPlayer,\n  },\n  setup() {\n    const state = ref(State.MainMenu);\n    const cameraSurface = ref(null as typeof CameraSurface | null);\n    const hasCompletedOnboarding = ref(false);\n\n    const currentVideo = ref(null as VideoDatabaseEntry | null);\n    const currentLesson = ref(null as MiniLesson | null);\n    const keyframes = ref([] as number[]);\n\n    function lessonSelected(videoEntry: VideoDatabaseEntry, lesson: MiniLesson) {\n      currentVideo.value = videoEntry;\n      currentLesson.value = lesson;\n\n      state.value = State.LessonActive;\n      // if (webcamProvider.webcamStatus.value === 'running') state.value = State.LessonActive;\n      // else state.value = State.PromptStartWebcam;\n    }\n\n    function startKeyframeSelection(videoEntry: VideoDatabaseEntry, kfs: number[]) {\n      console.log('startKeyframeSelection', videoEntry, kfs);\n      keyframes.value = kfs;\n      currentVideo.value = videoEntry;\n      state.value = State.KeyframeSelectorTool;\n    }\n\n    function goHome() {\n      state.value = State.MainMenu;\n      currentVideo.value = null;\n      currentLesson.value = null;\n    }\n\n    return {\n      currentVideo,\n      currentLesson,\n      lessonSelected,\n      goHome,\n      keyframes,\n      state,\n      cameraSurface,\n      State,\n      startKeyframeSelection,\n      startedWithWorkflow: ref(false),\n      isDebug: optionsManager.isDebug,\n      participantId: optionsManager.participantId,\n    };\n  },\n  mounted() {\n    // If app was launched with a workflowId, skip straight\n    // to that workflow\n    if (optionsManager.workflowId.value) {\n      if (this.startWorkflow(optionsManager.workflowId.value)) {\n        this.startedWithWorkflow = true;\n      }\n    }\n  },\n  methods: {\n    createLessonSelected(dance: VideoDatabaseEntry) {\n      this.currentVideo = dance;\n      this.state = State.CreateLesson;\n    },\n    startWorkflow(workflowId: string) {\n      console.log('Starting workflow', workflowId);\n      if (workflowManager.setActiveFlow(workflowId)) {\n        this.state = State.WorkflowActive;\n        return true;\n      }\n      return false;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\nbody, html {\n  margin: 0;\n  padding: 0;\n  width: 100%;\n  background-color: #00d1b2;\n  // background-image: linear-gradient(45deg, #00d1b2 0%, #3475da 100%);\n\n  // background-color: #FF9A8B;\n  // background-image: linear-gradient(135deg, #B721FF 0%, #145eb3 100%);\n\n  background-image: linear-gradient(120deg, #daece1 0%, #d1d1d1 100%);\n\n  background-size: 100vw 100vh;\n  background-attachment: fixed;\n}\n\n.loader-progress {\n  width: 100px;\n  height: 100px;\n  margin: auto;\n}\n\n#aboveSurface {\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n\n  span {\n    flex: 0 0 auto;\n  }\n  .spacer {\n    flex: 1 1 0;\n  }\n\n  width: 1280px;\n  margin: auto;\n}\n\n#belowSurface {\n  width: 1280px;\n  margin: auto;\n}\n\n#topbarLeft, #topbarRight, #topbarCenter {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n.background-blur {\n  backdrop-filter: blur(4px);\n  background: rgba(0, 0, 0, 0.75);\n}\n\n.translucent-text {\n  backdrop-filter: blur(4px);\n  color: white;\n  padding: 10px 20px;\n  background: rgba(0, 0, 0, 0.55);\n}\n\n.translucent-text.is-rounded {\n  border-radius: 0.25rem;\n}\n\n.is-slightly-rounded {\n  border-radius: 0.25rem;\n}\n\n</style>\n","<template>\n\n  <teleport to=\"#debugData\" v-if=\"optionsManager.isDebug\">\n    <span class=\"tag\">Workflow Id: {{workflow?.id ?? 'null'}}</span>\n    <span class=\"tag\">Experiment Mode: <input type=\"checkbox\" v-model=\"enableExperimentMode\"></span>\n\n    <span class=\"tag\">\n      Workflow: {{Math.round(workflowSecsElapsed)}}s elapsed, {{workflowSecondsRemainingString}} remaining\n    </span>\n    <span class=\"tag\">\n      Stage: {{Math.round(stageSecsElapsed)}}s, {{stageSecondsRemainingString}} remaining\n    </span>\n  </teleport>\n\n  <section class=\"section workflow-menu\">\n\n    <div class=\"hero is-primary block\" v-if=\"showHeader\">\n      <div class=\"hero-body\">\n        <div class=\"container\">\n          <p class=\"title\">\n            {{ workflow?.userTitle ?? workflow?.title }}\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"container block\" v-if=\"showBackButton\">\n      <button class=\"button\" @click=\"$emit('back-selected')\">&lt; Back</button>\n    </div>\n\n    <div class=\"block\" v-for=\"(stage, i) in filteredStages\" :key=\"i\">\n\n      <p class=\"subtitle has-text-centered\">\n        <span class=\"icon-text\">\n          <span v-text=\"stage.title\"></span>\n          <span class=\"icon\" v-if=\"isStageCompleted(stage)\"><i class=\"fa fa-check\"></i></span>\n        </span>\n      </p>\n      <div class=\"grid-menu container\" v-if=\"stage.beforeStartSteps.length > 0\">\n        <WorkflowStepCard\n          v-for=\"(stepInfo, j) in stage.beforeStartSteps\"\n          :stageSecondsRemainingString=\"stageSecondsRemainingString\"\n          :stepInfo=\"stepInfo\"\n          :key=\"j\"\n          @card-selected=\"startWorkflowStep(stepInfo.step)\"/>\n      </div>\n      <div class=\"grid-menu container\">\n        <div\n          class=\"box m-4 is-clickable hover-expand has-border-info vcenter-parent\"\n          v-if=\"activeStageIndex === i-1 && isStageCompleted(filteredStages[i-1])\"\n          @click=\"startStage(i)\"\n        >\n          <div>\n            <span class=\"icon-text\">\n              <span>Click to Begin </span>\n              <span class=\"icon\">\n                <i class=\"far fa-circle-right\"></i>\n              </span>\n            </span>\n          </div>\n          <div class=\"is-size-7\" v-if=\"stage.timeLimitString\">\n            <span >Time limit: {{stage.timeLimitString}}</span>\n            <!-- <span v-else>No time limit</span> -->\n          </div>\n        </div>\n        <div\n          class=\"m-4 p-4\"\n          v-if=\"(activeStageIndex === i && stageSecondsRemaining !== Infinity) ||\n                (!(activeStageIndex === i-1 && isStageCompleted(filteredStages[i-1])) && stage.timeLimitString)\">\n            <span v-if=\"activeStageIndex === i\">\n              <span v-if=\"stageSecondsRemaining !== Infinity\">{{stageSecondsRemainingString}}<br />remaining</span>\n              <!-- <span v-else>No time limit</span> -->\n            </span>\n            <span v-else>\n              <span v-if=\"stage.timeLimitString\">Time limit:<br />{{stage.timeLimitString}}</span>\n              <!-- <span v-else>No time limit</span> -->\n            </span>\n        </div>\n\n        <WorkflowStepCard\n          v-for=\"(stepInfo, j) in stage.mainSteps\"\n          :stageSecondsRemainingString=\"stageSecondsRemainingString\"\n          :stepInfo=\"stepInfo\"\n          :key=\"j\"\n          @card-selected=\"startWorkflowStep(stepInfo.step)\"/>\n\n      </div>\n      <div class=\"grid-menu container\" v-if=\"stage.afterExpiredSteps.length > 0\">\n        <!-- <div class=\"m-4 p-4\">Available in {{stageSecondsRemainingString}}</div> -->\n        <WorkflowStepCard\n          v-for=\"(stepInfo, j) in stage.afterExpiredSteps\"\n          :stageSecondsRemainingString=\"stageSecondsRemainingString\"\n          :stepInfo=\"stepInfo\"\n          :nextStepInStage=\"nextStepInStage\"\n          :key=\"j\"\n          @card-selected=\"startWorkflowStep(stepInfo.step)\"/>\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': instructionsActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <div class=\"box content\">\n          <h3>{{currentStep?.instructions?.heading}}</h3>\n          <p style=\"white-space: pre-wrap;\">{{currentStep?.instructions?.text}}</p>\n          <div class=\"buttons is-right\">\n            <button class=\"button is-primary\" @click=\"instructionsFinished\">OK</button>\n          </div>\n        </div>\n      </div>\n      <button class=\"modal-close\" @click=\"instructionsActive = false\" aria-label=\"close\"></button>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': lessonActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"container\" style=\"max-width: 100vw; max-height: 100vh;\">\n        <div class=\"box\" style=\"height:min(90vh);max-width:calc(100vw-2rem);margin-top:calc((10vh) / 2)\" >\n          <MiniLessonPlayer\n            v-if=\"lessonActive\"\n            :videoEntry=\"currentVideoEntry\"\n            :miniLesson=\"currentLesson\"\n            @lesson-completed=\"lessonCompleted\"\n            :maxVideoHeight=\"'calc(100vh - 152px - 3.75rem)'\"\n            :timeRemaining=\"stageSecondsRemaining !== Infinity ? stageSecondsRemainingString : null\"\n            :enableCompleteLesson=\"true\"/>\n        </div>\n      </div>\n      <button class=\"modal-close is-large\" aria-label=\"close\" @click=\"lessonActive=false\"></button>\n    </div>\n\n    <div :class=\"{'is-active': uploadActive}\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <!-- <div class=\"modal-content\"> -->\n        <div class=\"container\">\n          <div class=\"box\" style=\"max-height:90vh;max-width:calc(100vw-2rem);margin-top:calc((10vh) / 2);overflow:scroll;\">\n            <FeedbackUploadScreen\n              v-if=\"uploadActive\"\n              :prompt=\"currentStep?.upload?.prompt\"\n              :title=\"workflow?.userTitle ?? workflow?.title ?? 'Video Upload'\"\n              :subtitle=\"currentStep?.title\"\n              :uploadFilename=\"uploadFilename\"\n              :followAlong=\"currentStep?.upload?.followAlong ?? null\"\n              :activityLogUploadFilename=\"activityLogUploadFilename\"\n              @upload-canceled=\"uploadActive = false\"\n              @upload-completed=\"uploadComplete\"\n              :maxAttempts=\"currentStep?.upload?.maxAllowedAttempts ?? null\"\n            />\n          </div>\n        <!-- </div> -->\n      </div>\n    </div>\n\n    <div :class=\"{'is-active': timingNotStarted}\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <div class=\"container\">\n          <div class=\"box\">\n            <div class=\"content\">\n              <h3>Start Timing</h3>\n              <button class=\"button\" @click=\"startTiming\">Start</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed, defineComponent, nextTick, onBeforeUnmount, onMounted, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport WorkflowStepCard, { WorkflowStepCardInfo } from '@/components/elements/WorkflowStepCard.vue';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport db from '@/services/VideoDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport miniLessonManager from '@/services/MiniLessonManager';\nimport workflowManager, { TrackingWorkflow, TrackingWorkflowStage, TrackingWorkflowStep } from '@/services/WorkflowManager';\nimport FeedbackUploadScreen from '@/components/screens/FeedbackUploadScreen.vue';\nimport optionsManager from '@/services/OptionsManager';\nimport {\n  GetVideoEntryForWorkflowStep, IsMiniLessonStep, Workflow, WorkflowStage,\n} from '@/model/Workflow';\nimport eventLogger from '@/services/EventLogger';\n\nfunction getDurationString(seconds: number) {\n  if (seconds === Infinity) return 'Untimed';\n  if (Number.isNaN(seconds)) return 'Unknown';\n\n  const secsRemainingConstrained = Math.max(0, seconds);\n\n  if (secsRemainingConstrained < 3600) {\n    return new Date(secsRemainingConstrained * 1000).toISOString().substr(14, 5);\n  }\n  return new Date(secsRemainingConstrained * 1000).toISOString().substr(11, 8);\n}\n\nexport default defineComponent({\n  name: 'WorkflowMenu',\n  props: {\n    showHeader: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    enableTiming: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\n    'back-selected',\n  ],\n  components: {\n    MiniLessonPlayer,\n    FeedbackUploadScreen,\n    WorkflowStepCard,\n  },\n  computed: {\n    stages() { return ((this as any).workflow?.stages ?? []) as TrackingWorkflowStage[]; },\n    currentVideoEntry(): VideoDatabaseEntry | null {\n      if (this.currentStep?.type === 'MiniLessonReference' && this.currentStep?.miniLessonReference) {\n        return db.entriesByClipName.get(this.currentStep.miniLessonReference.clipName) ?? null;\n      }\n      if (this.currentStep?.type === 'MiniLessonEmbedded' && this.currentStep?.miniLessonEmbedded?.header.clipName) {\n        return db.entriesByClipName.get(this.currentStep.miniLessonEmbedded.header.clipName) ?? null;\n      }\n      return null;\n    },\n    currentLesson(): MiniLesson | null {\n      if (this.currentStep?.type === 'MiniLessonReference' && this.currentStep?.miniLessonReference) {\n        return miniLessonManager.lessonsById.get(this.currentStep.miniLessonReference.lessonId) ?? null;\n      }\n      if (this.currentStep?.type === 'MiniLessonEmbedded' && this.currentStep?.miniLessonEmbedded) {\n        return this.currentStep.miniLessonEmbedded;\n      }\n      return null;\n    },\n    uploadFilename(): string {\n      const uploadId = this.currentStep?.upload?.identifier ?? 'NoIdentifier';\n      const participantId = optionsManager.participantId.value ?? 'Anonomous';\n      const workflowId = this.workflow?.id ?? 'NullWorkflow';\n\n      return `user${participantId}-upload${uploadId}-workflow${workflowId}`;\n    },\n    activityLogUploadFilename(): string | null {\n      const uploadId = this.currentStep?.upload?.activityLogUploadIdentifier ?? null;\n      const participantId = optionsManager.participantId.value ?? 'Anonomous';\n      const workflowId = this.workflow?.id ?? 'NullWorkflow';\n\n      return uploadId === null ? null : `user${participantId}-upload${uploadId}-workflow${workflowId}`;\n    },\n    filteredStages() {\n      const workflow = (this as any).workflow as TrackingWorkflow;\n      const stages = workflow?.stages ?? [];\n      const isExperimentMode = (this as any).enableExperimentMode as boolean;\n      const activeStage = (this as any).activeStage as WorkflowStage;\n      const stageSecondsRemaining = (this as any).stageSecondsRemaining as number;\n\n      return stages.map((stage, stageIndex) => {\n        const filteredSteps = stage.steps\n          .filter((step) => isExperimentMode || !(step.experiment?.showInExperimentOnly ?? false))\n          .map((step, stepIndex) => {\n\n            const isTestMode = !isExperimentMode;\n            const isInActiveStage = activeStage === stage;\n            const isTimeExpiredTask = step.experiment?.isTimeExpiredTask ?? false;\n            const stageTimeExpired = stageSecondsRemaining <= 0;\n            const isValidAfterExpiredTask = isInActiveStage && isTimeExpiredTask && stageTimeExpired;\n            const isValidUnexpired = !isInActiveStage || (!isTimeExpiredTask && !stageTimeExpired);\n            // const isNewlyOnThisStage = this.activeStageIndex === stageIndex-1 && this.isStageCompleted(filteredStages[i-1])\n            const isBeforeTime = (step.experiment?.isBeforeTimeStartTask ?? false);\n            const isRepeatable = !(step.experiment?.disableRepitition ?? false);\n\n            return {\n              step,\n              isComplete: step.status === 'completed',\n              dbEntry: GetVideoEntryForWorkflowStep(db, step),\n              isExpired: !isTimeExpiredTask && stageTimeExpired,\n              isClickable: (isTestMode || isInActiveStage || isBeforeTime)\n                          && (isValidUnexpired || isValidAfterExpiredTask)\n                          && (isRepeatable || step.status !== 'completed'),\n              isNextStep: step === (this as any).nextStepInStage,\n              isValidAfterExpiredTask,\n              waitingForTimeExpiration: isInActiveStage && isTimeExpiredTask && !stageTimeExpired,\n              stageIndex,\n              stepIndex,\n            } as WorkflowStepCardInfo;\n          });\n\n        const beforeStartSteps = filteredSteps.filter((step) => step.step.experiment?.isBeforeTimeStartTask);\n        const mainSteps = filteredSteps.filter((step) => !step.step.experiment?.isBeforeTimeStartTask && !step.step.experiment?.isTimeExpiredTask);\n        const afterExpiredSteps = filteredSteps.filter((step) => step.step.experiment?.isTimeExpiredTask);\n        return {\n          ...stage,\n          beforeStartSteps,\n          mainSteps,\n          afterExpiredSteps,\n          filteredSteps,\n          timeLimitString: stage.maxStageTimeSecs ? getDurationString(stage.maxStageTimeSecs) : null,\n        };\n      });\n    },\n    nextStepInStage() {\n      // for (let i = 0; i < this.stages.length; i += 1) {\n      if (!this.filteredStages) return null;\n\n      const stage = (this as any).filteredStages[(this as any).activeStageIndex];\n      if (!stage) return null;\n\n      for (let j = 0; j < stage.filteredSteps.length; j += 1) {\n        const filteredStep = stage.filteredSteps[j];\n        if (filteredStep.step.status !== 'completed' && filteredStep.isClickable) return filteredStep.step as TrackingWorkflowStep;\n      }\n      // }\n      return null;\n    },\n  },\n  setup(props, ctx) {\n\n    const currentStep = ref(null as null | TrackingWorkflowStep);\n    const instructionsActive = ref(false);\n    const lessonActive = ref(false);\n    const uploadActive = ref(false);\n    const workflow = workflowManager.activeFlow;\n\n    onMounted(() => {\n      eventLogger.log(`Starting workflow ${workflow.value?.title} - ${workflow.value?.id}`);\n    });\n\n    const workflowStartTime = ref(new Date());\n    const workflowStageStartTime = ref(new Date());\n    const enableExperimentMode = ref(optionsManager.isExperimentActive.value);\n    const isTiming = ref(!optionsManager.isExperimentActive.value);\n    const timingNotStarted = computed(() => isTiming.value && !workflowStartTime.value);\n\n    const activeStageIndex = ref(-1);\n    const activeStage = computed(() => workflow.value?.stages[activeStageIndex.value] ?? null);\n    onMounted(() => {\n      workflowStartTime.value = new Date();\n      workflowStageStartTime.value = new Date();\n    });\n    let stageTimer = -1;\n    const workflowSecsElapsed = ref(Infinity);\n    const workflowSecondsRemaining = computed(() => {\n      if (!workflow.value?.experimentMaxTimeSecs) return Infinity;\n      return workflow.value.experimentMaxTimeSecs - workflowSecsElapsed.value;\n    });\n    const workflowSecondsRemainingString = computed(() => getDurationString(workflowSecondsRemaining.value));\n    const stageSecsElapsed = ref(Infinity);\n    const stageSecondsRemaining = computed(() => {\n      if (!activeStage.value?.maxStageTimeSecs) return Infinity;\n      return activeStage.value.maxStageTimeSecs - stageSecsElapsed.value;\n    });\n    const stageSecondsRemainingString = computed(() => getDurationString(stageSecondsRemaining.value));\n    onMounted(() => {\n      stageTimer = window.setInterval(() => {\n\n        const now = Date.now();\n        workflowSecsElapsed.value = (now - workflowStartTime.value.getTime()) / 1000;\n        stageSecsElapsed.value = (now - workflowStageStartTime.value.getTime()) / 1000;\n\n      }, 1000);\n    });\n\n    onMounted(() => {\n      if (workflow.value\n        && workflow.value.stages.length > 0\n        && (workflow.value.stages[0].maxStageTimeSecs ?? null) === null) {\n        // Auto-start the first stage if it isn't timed\n        activeStageIndex.value = 0;\n      }\n    });\n\n    onBeforeUnmount(() => {\n      clearInterval(stageTimer);\n      eventLogger.log(`Exited workflow '${workflow.value?.id}'`);\n    });\n\n    watch(workflow, () => {\n      currentStep.value = null;\n    });\n    watchEffect(() => {\n      const isInCurrentStage = (activeStage.value?.steps ?? []).indexOf(currentStep.value as any) !== -1;\n\n      if (isInCurrentStage && stageSecondsRemaining.value <= 0 && !currentStep.value?.experiment?.isTimeExpiredTask) {\n        eventLogger.log(`Stage time expired '${activeStage.value?.title}'`);\n        lessonActive.value = false;\n        currentStep.value = null;\n      }\n    });\n\n    return {\n      activeStage,\n      activeStageIndex,\n      currentStep,\n      instructionsActive,\n      lessonActive,\n      uploadActive,\n      workflow,\n      optionsManager,\n\n      workflowStartTime,\n      timingNotStarted,\n      isTiming,\n      workflowStageStartTime,\n      enableExperimentMode,\n      workflowSecsElapsed,\n      workflowSecondsRemaining,\n      workflowSecondsRemainingString,\n      stageSecsElapsed,\n      stageSecondsRemaining,\n      stageSecondsRemainingString,\n    };\n  },\n  methods: {\n    startTiming() {\n      this.workflowStartTime = new Date();\n      eventLogger.log(`Started workflow ${(this.workflow as any)?.id}`);\n    },\n    // getStepInfo(stage: TrackingWorkflowStage, stageIndex: number) {\n\n    //   return stage.steps\n    //     .filter((step) => this.enableExperimentMode || !(step.experiment?.showInExperimentOnly ?? false))\n    //     .map((step, stepIndex) => {\n\n    //       const isTestMode = !this.enableExperimentMode;\n    //       const isInActiveStage = this.activeStage === stage;\n    //       const isTimeExpiredTask = step.experiment?.isTimeExpiredTask ?? false;\n    //       const stageTimeExpired = this.stageSecondsRemaining <= 0;\n    //       const waitingForTimeExpiration = isTimeExpiredTask && !stageTimeExpired;\n\n    //       return {\n    //         step,\n    //         isComplete: step.status === 'completed',\n    //         isNextStep: step === this.nextStepInStage,\n    //         dbEntry: GetVideoEntryForWorkflowStep(db, step),\n    //         isClickable: (isTestMode || isInActiveStage)\n    //                     && (!isTimeExpiredTask || !stageTimeExpired)\n    //                     && !waitingForTimeExpiration,\n    //         waitingForTimeExpiration,\n    //         stageIndex,\n    //         stepIndex,\n    //       };\n    //     });\n    // },\n    instructionsFinished() {\n      this.instructionsActive = false;\n      const step = this.currentStep;\n      if (!step) return;\n      step.status = 'inprogress';\n      eventLogger.log(`Closed instructions '${step.title}'`);\n      this.continueWorkflowStep(step);\n    },\n    startWorkflowStep(item: TrackingWorkflowStep) {\n      // if (!this.isClickable(item)) return;\n      this.currentStep = item;\n      if (item.type === 'InstructionOnly') {\n        this.instructionsActive = true;\n        eventLogger.log(`Opened instructions '${item.title}'`);\n        return;\n      }\n      this.continueWorkflowStep(item);\n    },\n    continueWorkflowStep(item: TrackingWorkflowStep) {\n      if (item.type === 'InstructionOnly') {\n        // Instructions only - there's nothing else to do. Move to next activity!\n        this.completeStep(item);\n      } else if (item.type === 'MiniLessonReference' || item.type === 'MiniLessonEmbedded') {\n        eventLogger.log(`Started mini lesson '${item.title}'`);\n        this.lessonActive = true;\n      } else if (item.type === 'UploadTask') {\n        eventLogger.log(`Started upload task '${item.title}'`);\n        this.uploadActive = true;\n      } else {\n        console.error(`Item type ${item.type} not supported`);\n      }\n    },\n    lessonCompleted() {\n      this.lessonActive = false;\n      eventLogger.log(`Finished mini lesson '${this.currentStep?.title}'`);\n      this.completeStep(this.currentStep);\n    },\n    uploadComplete() {\n      this.uploadActive = false;\n      eventLogger.log(`Finished upload task '${this.currentStep?.title}'`);\n      this.completeStep(this.currentStep);\n    },\n    completeStep(step: TrackingWorkflowStep | null) {\n      if (!step) return;\n      step.status = 'completed';\n    },\n    isStageCompleted(stage: TrackingWorkflowStage) {\n      if (!stage) return true;\n\n      const steps = (stage as any).filteredSteps ?? [];\n      return steps.reduce((wasTrue: boolean, thisStep: any) => wasTrue && (thisStep.isComplete || thisStep.isExpired), true);\n    },\n    startStage(stageIndex: number) {\n      this.workflowStageStartTime = new Date();\n      eventLogger.log(`Started stage #${stageIndex} timed portion `);\n      nextTick(() => {\n        this.activeStageIndex = stageIndex;\n      });\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n</style>\n","<template>\n  <div class=\"mini-lesson-player\">\n    <div class=\"block is-flex-grow-0 is-flex-shrink-0 is-relative is-flex\">\n      <SegmentedProgressBar\n        :segments=\"progressSegments\"\n        :progress=\"activityProgress\"\n        class=\"is-flex-grow-1 is-flex-shrink-1\"\n      />\n      <div class=\"is-flex-grow-0 is-flex-grow-0 ml-2 has-text-grey\" v-if=\"timeRemaining !== null\">\n        {{timeRemaining}}\n      </div>\n    </div>\n    <div class=\"video-container\">\n      <ActivityVideoPlayer\n        ref=\"activityVideoPlayer\"\n        :motion=\"videoEntry\"\n        :activity=\"activeActivity\"\n        @progress=\"onProgress\"\n      />\n    </div>\n    <div class=\"is-flex-grow-0 is-flex-shrink-0\">\n      <div class=\"block\"></div>\n      <!-- <SegmentedProgressBar\n        class=\"block\"\n        :segments=\"progressSegments\"\n        :progress=\"activityProgress\"\n      /> -->\n      <nav class=\"pagination is-centered\" v-if=\"miniLesson\">\n        <div class=\"pagination-list\" style=\"max-width:calc(100vw - 2.5rem);\">\n          <li  v-for=\"(i, index) in nearbyActivityIndices\" :key=\"index\">\n            <span class=\"pagination-ellipses\">\n              <button\n                class=\"button\"\n                :class=\"{'is-primary': activityVideoPlayer?.activityFinished && activeActivityIndex + 1 === i}\"\n                @click=\"gotoActivity(i)\"\n                v-if=\"i >= 0 && i !== activeActivityIndex\">\n                <span class=\"icon\" v-if=\"activityVideoPlayer?.activityFinished && activeActivityIndex + 1 === i\"><i class=\"fas fa-step-forward\"></i></span>\n                <span><strong>{{i+1}}</strong>&nbsp;|&nbsp;<span>{{activities[i]?.title}}</span></span>\n              </button>\n            </span>\n            <span class=\"pagination-ellipses\" v-if=\"i<0\">\n              &hellip;\n            </span>\n            <span class=\"pagination-ellipses buttons has-addons\" v-if=\"i===activeActivityIndex\">\n              <button\n                v-if=\"!activityVideoPlayer?.activityFinished\"\n                class=\"button\"\n                :class=\"{\n                  'is-primary': (activityVideoPlayer?.awaitingStart ?? false) || (activityVideoPlayer?.isPendingStart ?? false),\n                  'is-loading': (!activityVideoPlayer) || (activityVideoPlayer?.isPlaying ?? false) || (activityVideoPlayer?.isPendingStart ?? false),\n                }\"\n                :disabled=\"needsStartWebcam || !(activityVideoPlayer?.awaitingStart ?? false)\"\n                @click=\"activityVideoPlayer.play()\"\n              >\n                <strong>{{i+1}}</strong>&nbsp;|&nbsp;\n                <span>{{activeActivity?.title}}</span>\n                <span class=\"icon\"><i class=\"fas fa-play\"></i></span>\n              </button>\n              <button\n                class=\"button is-warning\"\n                v-if=\"activityVideoPlayer?.activityFinished\"\n                @click=\"repeat()\"\n              >\n                <strong>{{i+1}}</strong>&nbsp;|&nbsp;\n                <span>{{activeActivity?.title}}</span>\n                <span class=\"icon\"><i class=\"fas fa-redo fa-flip-horizontal\"></i></span>\n                <!-- <span>Repeat</span> -->\n              </button>\n              <!-- <button\n                class=\"button is-primary\"\n                v-if=\"activityVideoPlayer?.activityFinished && hasNextActivity\"\n                @click=\"nextActivity\"\n              >\n                <span>Next </span>\n                <span class=\"icon\"><i class=\"fas fa-step-forward\"></i></span>\n              </button> -->\n            </span>\n          </li>\n          <li>\n            <span class=\"pagination-ellipses\" v-if=\"enableCompleteLesson\">\n              <button class=\"button\"\n                :class=\"{ 'is-primary': activityVideoPlayer?.activityFinished && !hasNextActivity}\"\n                @click=\"completeLesson\">\n                <span class=\"icon\"><i class=\"fas fa-check\"></i></span>\n                <span>Done</span>\n              </button>\n            </span>\n          </li>\n        </div>\n      </nav>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, nextTick } from 'vue';\nimport MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\nimport ActivityVideoPlayer from '@/components/elements/ActivityVideoPlayer.vue';\nimport SegmentedProgressBar, { calculateProgressSegments, ProgressSegmentData } from '@/components/elements/SegmentedProgressBar.vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport Utils from '@/services/Utils';\nimport eventLogger from '@/services/EventLogger';\n\nexport default defineComponent({\n  name: 'MiniLessonPlayer',\n  components: {\n    SegmentedProgressBar,\n    ActivityVideoPlayer,\n  },\n  props: {\n    videoEntry: { type: Object },\n    miniLesson: { type: Object },\n    // maxVideoHeight: { type: String, default: 'none' },\n    enableCompleteLesson: { type: Boolean, default: false },\n    timeRemaining: { type: String, default: null },\n  },\n  setup() {\n    const activityVideoPlayer = ref(null as null | typeof ActivityVideoPlayer);\n    return {\n      activityVideoPlayer,\n    };\n  },\n  emits: ['lesson-completed', 'activity-changed'],\n  computed: {\n    nearbyActivityIndices(): number[] {\n      const margin = 1;\n      const minIndex = Math.max(0, this.activeActivityIndex - margin);\n      const maxActivityIndex = (this.lesson?.activities.length ?? 0) - 1;\n      const maxIndex = Math.min(maxActivityIndex, this.activeActivityIndex + margin);\n      const count = (maxIndex + 1) - minIndex;\n      let indices: number[] = [];\n      if (minIndex > 0) {\n        if (minIndex === 1) {\n          indices.push(0);\n        } else {\n          indices.push(0, -1);\n        }\n        // indices = indices.concat([0, -1]);\n      }\n      indices = indices.concat(Utils.range(count, minIndex));\n      if (maxIndex < maxActivityIndex) {\n        if (maxIndex === maxActivityIndex - 1) {\n          indices.push(maxActivityIndex);\n        } else {\n          indices.push(-1, maxActivityIndex);\n        }\n      }\n      return indices;\n    },\n    lesson() {\n      const lesson = (this.$props.miniLesson ?? null) as null | MiniLesson;\n      return lesson;\n    },\n    activities(): MiniLessonActivity[] {\n      return (this.lesson as any)?.activities ?? [];\n    },\n    activeActivity() {\n      const lesson = (this.$props.miniLesson ?? null) as null | MiniLesson;\n      const activityIndex = this.activeActivityIndex as number;\n      const activity = lesson?.activities[activityIndex] ?? null as null | MiniLessonActivity;\n      return activity;\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lesson) return calculateProgressSegments(this.lesson, this.activeActivity);\n      return [];\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < (this.lesson?.activities.length ?? 0);\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    needsStartWebcam(): boolean {\n      return this.activeActivity !== null && (this.activityVideoPlayer as typeof ActivityVideoPlayer)?.needsToStartWebcam;\n    },\n  },\n  data() {\n    return {\n      activeActivityIndex: 0,\n      activityProgress: 0,\n      webcamStatus: webcamProvider.webcamStatus,\n    };\n  },\n  methods: {\n    onProgress(val: number) { this.activityProgress = val; },\n    autoPlay() {\n      nextTick(() => {\n        if (!this.needsStartWebcam) {\n          this.playActivity();\n        }\n      });\n    },\n    playActivity() {\n      (this.$refs.activityVideoPlayer as any).play();\n    },\n    nextActivity() {\n      if (this.hasNextActivity) this.activeActivityIndex += 1;\n      nextTick(() => {\n        if (!this.needsStartWebcam) this.playActivity();\n      });\n    },\n    completeLesson() {\n      this.$emit('lesson-completed');\n    },\n    gotoActivity(i: number) {\n      this.activeActivityIndex = i;\n      this.autoPlay();\n    },\n    async startWebcam() {\n      return (this.$refs.activityVideoPlayer as any)?.startWebcam();\n    },\n    repeat() {\n      const vidPlayer = (this.$refs.activityVideoPlayer as any);\n      eventLogger.log(`Repeating lesson activity ${this.activeActivity?.title}`);\n      vidPlayer.reset();\n      vidPlayer.play();\n    },\n  },\n  watch: {\n    activeActivityIndex(newVal: number) {\n      this.$emit('activity-changed', newVal);\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.mini-lesson-player {\n  display: flex;\n  flex-flow: column;\n  height: 100%;\n  width: 100%;\n\n  .video-container {\n    flex: 1 1 0;\n    // background: lightblue;\n\n    display: flex;\n    flex-flow: column nowrap;\n    justify-content: center;\n    align-items: center;\n    height: 0px;\n  }\n}\n</style>\n","<template>\n  <div class=\"activity-video-player\">\n\n    <WebcamBox\n      ref=\"webcamBox\"\n      class=\"is-flex-grow-1 is-flex-shrink-1\" style=\"height:0\"\n      :showStartWebcamButton=\"false\"\n      v-show=\"showingWebcam\"/>\n\n    <div\n        :class=\"{\n          'is-overlay': showingWebcam || showSheetMusic,\n        }\"\n        class=\"is-flex-grow-1 is-flex-shrink-1\"\n        :style=\"{\n          height: showingWebcam ? '100%' : 0,\n        }\"\n\n        v-show=\"!needsToStartWebcam\">\n      <PausingVideoPlayer\n        :videoSrc=\"motion?.videoSrc\"\n        ref=\"videoPlayer\"\n        :drawPoseLandmarks=\"activity?.demoVisual === 'skeleton'\"\n        :videoOpacity=\"activity?.demoVisual === 'video' ? 1 : 0\"\n        :emphasizedJoints=\"emphasizedJoints\"\n        @progress=\"onProgress\"\n        @playback-completed=\"onPlaybackCompleted\"\n        @pause-hit=\"onPauseHit\"\n        @pause-end=\"onPauseEnded\"\n        :showControls=\"activity?.showVideoControls ?? false\"\n        :motionTrails=\"motionTrails\"\n        :drawMotionTrailsInTime=\"true\"\n      />\n    </div>\n\n    <div v-if=\"showSheetMusic\" style=\"max-height:100%\">\n      <SheetMotion\n        :dbEntry=\"motion\"\n        :drawMode=\"activity?.sheetMotionVisual\"\n        :currentTime=\"videoTime\"\n        :data=\"activity?.sheetMotion\"\n      />\n    </div>\n\n    <video v-if=\"isReviewing\"  style=\"height:100%\" class=\"flipped\" :src=\"recordingObjectUrl ?? undefined\" controls></video>\n\n    <div class=\"is-overlay\" v-show=\"shouldShowStartInstructions && activity?.startInstruction\">\n      <div class=\"vcenter-parent\">\n        <InstructionCarousel :sizeClass=\"'is-large'\" :tagClass=\"'is-white'\" :instructions=\"startInstructions\"/>\n      </div>\n    </div>\n\n    <div class=\"is-overlay instructions-overlay mb-4\">\n      <InstructionCarousel v-show=\"pauseInstructs.length > 0\" :sizeClass=\"'is-medium'\" :tagClass=\"'is-white'\" :instructions=\"pauseInstructs\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"instructions.length > 0\" :sizeClass=\"'is-medium'\" :tagClass=\"'is-white'\" :instructions=\"instructions\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"!activityFinished && timedInstructions.length > 0\" :sizeClass=\"'is-large'\" :instructions=\"timedInstructions\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"activity?.staticInstruction\" :sizeClass=\"'is-medium'\" :tagClass=\"''\"  :instructions=\"[{id:0, text:activity?.staticInstruction}]\" class=\"m-2\"/>\n      <KeyframeTimeline\n        :dbEntry=\"motion\"\n        :drawMode=\"keyframeVisual\"\n        :keyframes=\"activity?.keyframes ?? []\"\n        :currentTime=\"videoTime\"\n        v-if=\"keyframeVisual !== 'none'\"\n        />\n    </div>\n\n    <div class=\"is-overlay p-4 has-background-white\" style=\"overflow: scroll;\" v-if=\"needsToStartWebcam\">\n      <WebcamSourceSelectionMenu\n        v-model:videoDeviceId=\"videoDeviceId\"\n        v-model:audioDeviceId=\"audioDeviceId\"\n        @startWebcamClicked=\"startWebcam\" />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed, defineComponent, onBeforeUnmount, Ref, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport InstructionCarousel, { Instruction } from '@/components/elements/InstructionCarousel.vue';\nimport PausingVideoPlayer from '@/components/elements/PausingVideoPlayer.vue';\nimport KeyframeTimeline from '@/components/elements/KeyframeTimeline.vue';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\nimport SheetMotion from '@/components/elements/SheetMotion.vue';\nimport WebcamSourceSelectionMenu from '@/components/elements/WebcamSourceSelectionMenu.vue';\nimport { MiniLessonActivity, MotionTrail, PauseInfo } from '@/model/MiniLesson';\nimport Constants from '@/services/Constants';\nimport webcamProvider from '@/services/WebcamProvider';\nimport eventLogger from '@/services/EventLogger';\n\nconst ActivityPlayState = Object.freeze({\n  AwaitingStart: 'AwaitingStart',\n  PendingStart: 'PendingStart',\n  Playing: 'Playing',\n  ActivityEnded: 'ActivityEnded',\n});\n\nexport default defineComponent({\n  name: 'ActivityVideoPlayer',\n  emits: ['progress', 'activityEnded'],\n  props: {\n    motion: { type: Object },\n    activity: { type: Object },\n    defaultPauseDuration: { type: Number, default: 1.5 },\n    maxHeight: { type: String, default: '400px' },\n  },\n  components: {\n    PausingVideoPlayer,\n    InstructionCarousel,\n    WebcamBox,\n    KeyframeTimeline,\n    SheetMotion,\n    WebcamSourceSelectionMenu,\n  },\n  setup(props) {\n    const { activity } = toRefs(props);\n    const typedActivity = computed(() => (activity.value as MiniLessonActivity) ?? null);\n    const state = ref(ActivityPlayState.AwaitingStart as string);\n\n    const shouldReview = computed(() => (typedActivity?.value?.reviewing) !== undefined);\n    const shouldRecord = computed(() => ((typedActivity?.value?.recording) !== undefined) || shouldReview.value);\n\n    const activityFinished = computed(() => state.value === ActivityPlayState.ActivityEnded);\n    const awaitingStart = computed(() => state.value === ActivityPlayState.AwaitingStart);\n    const isPlaying = computed(() => state.value === ActivityPlayState.Playing);\n    const isPendingStart = computed(() => state.value === ActivityPlayState.PendingStart);\n    const isReviewing = computed(() => state.value === ActivityPlayState.ActivityEnded && shouldReview.value);\n    const videoPlayer = ref(null as null | typeof PausingVideoPlayer);\n    const webcamBox = ref(null as null | typeof WebcamBox);\n    const videoTime = ref(0);\n\n    const shouldShowStartInstructions = computed(() => isPendingStart.value || awaitingStart.value);\n\n    const recordingId = computed(() => {\n      if (!shouldRecord.value) return '';\n      return typedActivity?.value?.recording?.identifier ?? 'unknown-or-temp-identifier';\n    });\n\n    const recordingObjectUrl = ref(null as null | string);\n\n    onBeforeUnmount(() => {\n      webcamProvider.abortRecording(recordingId.value);\n    });\n\n    const pauseInstructs = ref([] as Instruction[]);\n    const onPlaybackCompleted = async () => {\n\n      if (shouldRecord.value && webcamProvider.isRecording(recordingId.value)) {\n        await webcamProvider.stopRecording(recordingId.value);\n        const blob = await webcamProvider.getBlob(recordingId.value);\n        recordingObjectUrl.value = URL.createObjectURL(blob);\n      }\n\n      eventLogger.log(`Playback completed for activity ${activity.value?.title}`);\n\n      state.value = ActivityPlayState.ActivityEnded;\n    };\n    const onPauseHit = (pause: PauseInfo) => {\n      console.log(`Hit pause${pause}`);\n      if (pause.instruction) pauseInstructs.value.push({ id: pause.time, text: pause.instruction });\n    };\n    const onPauseEnded = () => pauseInstructs.value.splice(0);\n\n    const startTime = computed(() => activity?.value?.startTime ?? 0);\n\n    function reset(newTime?: number) {\n      pauseInstructs.value.splice(0);\n      state.value = ActivityPlayState.AwaitingStart;\n      const time = newTime ?? startTime.value ?? 0;\n\n      if (videoPlayer.value) videoPlayer.value.setTime(time);\n      webcamProvider.abortRecording(recordingId.value);\n    }\n\n    watchEffect(() => reset(startTime.value));\n\n    const trailBreakEndIndex = computed(() => {\n      const trailBreaks = activity?.value?.motionTrailBreaks as number[];\n      if (!trailBreaks) return -1;\n      const time = videoTime.value;\n      for (let i = 0; i < trailBreaks.length; i += 1) {\n        if (trailBreaks[i] > time) return i;\n      }\n      return trailBreaks.length;\n    });\n    const trailStartTime = computed(() => {\n      const trailBreaks = activity?.value?.motionTrailBreaks as number[];\n      if (trailBreakEndIndex.value < 1 || !trailBreaks) return -Infinity;\n      return trailBreaks[trailBreakEndIndex.value - 1];\n    });\n    const trailEndTime = computed(() => {\n      const trailBreaks = activity?.value?.motionTrailBreaks as number[];\n      if (trailBreakEndIndex.value < 1 || !trailBreaks) return Infinity;\n      return trailBreaks[trailBreakEndIndex.value];\n    });\n\n    const motionTrails = computed(() => {\n      const trailsRaw = activity?.value?.motionTrails as MotionTrail[] ?? [];\n      const trailBreaks = activity?.value?.motionTrailBreaks as number[];\n      if (trailBreaks) {\n        return trailsRaw.map((trail) => {\n          let startIndex = trail.findIndex(([t, x, y]) => t >= trailStartTime.value);\n          let endIndex = trail.findIndex(([t, x, y]) => t > trailEndTime.value);\n          if (startIndex === -1) startIndex = 0;\n          if (endIndex === -1) endIndex = trail.length;\n          return trail.slice(startIndex, endIndex);\n        });\n      }\n      return trailsRaw;\n    });\n\n    return {\n      typedActivity,\n      webcamBox,\n      videoPlayer,\n      videoTime,\n      state,\n      ActivityPlayState,\n      awaitingStart,\n      activityFinished,\n      pauseInstructs,\n      isPlaying,\n      isPendingStart,\n      isReviewing,\n      shouldShowStartInstructions,\n\n      shouldReview,\n      shouldRecord,\n      recordingId,\n      recordingObjectUrl,\n      isRecording: () => webcamProvider.isRecording(recordingId.value),\n\n      reset,\n      startTime,\n\n      onPlaybackCompleted,\n      onPauseHit,\n      onPauseEnded,\n\n      motionTrails,\n      trailStartTime,\n      trailEndTime,\n\n      audioDeviceId: ref(''),\n      videoDeviceId: ref(''),\n    };\n  },\n  computed: {\n    keyframeVisual(): 'none' | 'skeleton' | 'video' {\n      return (this as any)?.activity?.keyframeVisual ?? 'none';\n    },\n    showingWebcam() {\n      const hideForReview = (this as any)?.isReviewing ?? false;\n      return !hideForReview && (((this as any)?.activity?.userVisual ?? 'none') !== 'none');\n    },\n    showSheetMusic() {\n      return ((this as any)?.activity?.sheetMotionVisual ?? 'none') !== 'none';\n    },\n    emphasizedJoints(): number[] { return this.activity?.emphasizedJoints ?? []; },\n    instructions(): Instruction[] {\n      const mActivity = this.activity;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if (this.state === ActivityPlayState.Playing && mActivity.playingInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.playingInstruction,\n        });\n      } else if (this.state === ActivityPlayState.ActivityEnded && mActivity.endInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.endInstruction,\n        });\n      }\n\n      return instructs;\n    },\n    startInstructions(): Instruction[] {\n      const mActivity = this.activity;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if (mActivity.startInstruction) {\n        let text = mActivity.startInstruction;\n        if (this.state === ActivityPlayState.PendingStart) { text += '...'; }\n        instructs.push({\n          id: 1,\n          text,\n        });\n      }\n      return instructs;\n    },\n    timedInstructions(): Instruction[] {\n      const mActivity = this.activity as unknown as MiniLessonActivity | null;\n      const time = this.videoTime;\n\n      if (!mActivity) return [];\n\n      const activeTimedInstructions = mActivity.timedInstructions?.map(\n        (ti, i) => ({\n          id: i,\n          text: ti.text,\n          start: ti.startTime,\n          end: ti.endTime,\n        }),\n      ).filter((ti) => ti.start <= time && time < ti.end) ?? [];\n\n      // console.log(`TimedI updated for time ${time}, count=${activeTimedInstructions.length}`, mActivity.timedInstructions);\n\n      return activeTimedInstructions;\n    },\n    needsToStartWebcam() {\n      const needsUserVisual = ((this as any).activity?.userVisual ?? 'none') !== 'none';\n      const needsWebcam = this.shouldRecord || needsUserVisual;\n      return needsWebcam && webcamProvider.webcamStatus.value !== 'running';\n    },\n  },\n  methods: {\n    async startWebcam() {\n      if (this.webcamBox) {\n        await this.webcamBox.startWebcam(this.videoDeviceId, this.audioDeviceId);\n        this.play();\n      }\n      return new Error('WebcamBox is null');\n    },\n    async play(delay?: number | undefined) {\n      this.reset();\n      const vidPlayer = this.videoPlayer;\n      const vidActivity = this.activity as MiniLessonActivity | null;\n      if (!vidActivity) return;\n      if (!vidPlayer) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer is null');\n        return;\n      }\n\n      this.state = ActivityPlayState.PendingStart;\n\n      if (this.shouldRecord && !this.isRecording()) {\n        console.log('Gonna do some muthafucking recording!');\n        await webcamProvider.startRecording(this.recordingId);\n      }\n\n      eventLogger.log(`Starting playback of activity ${this.activity?.title} at ${vidActivity.startTime.toFixed(2)}`);\n\n      vidPlayer.play(\n        vidActivity.startTime,\n        vidActivity.endTime,\n        vidActivity.practiceSpeed ?? 1,\n        vidActivity.pauses ?? [],\n        delay ?? Constants.DefaultPauseDuration,\n        () => {\n          this.state = ActivityPlayState.Playing;\n        },\n      );\n    },\n    onProgress(val: number) {\n      this.videoTime = val;\n      this.$emit('progress', val);\n    },\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n\n.activity-video-player {\n  position: relative;\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: stretch;\n  align-items: stretch;\n  height: 100%;\n  width: 100%;\n\n  .keyframe-video {\n    max-height: 33%;\n    // max-width: 33%;\n  }\n}\n\n.instructions-overlay {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: flex-end;\n  pointer-events: none;\n}\n\n.keyframe-container {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n  align-content: right;\n}\n\n</style>\n","<template>\n  <transition-group name=\"slide-fade\" mode=\"out-in\" tag=\"div\" class=\"instructionCarousel\">\n    <p\n      class=\"flextag\"\n      :class=\"[sizeClass, tagClass]\"\n      v-for=\"inst in instructions\"\n      :key=\"inst.id\">{{inst.text}}</p>\n  </transition-group>\n</template>\n\n<script lang=\"ts\">\n\nimport { defineComponent } from 'vue';\n\nexport type Instruction = {\n  id: number;\n  text: string;\n}\n\nexport default defineComponent({\n  props: {\n    instructions: {\n      type: Array,\n      default: Array,\n    },\n    sizeClass: {\n      type: String,\n      default: 'is-normal',\n    },\n    tagClass: {\n      type: String,\n      default: 'is-dark',\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.instructionCarousel {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-flow: row wrap;\n  width: 100%;\n\n  .flextag {\n    border-radius: 0.25rem;\n    text-align: center;\n    border: 1px solid black;\n    background: #EFEFEF;\n    padding: 0.25rem 0.5rem;\n    margin: 2px;\n  }\n\n  .flextag.is-large {\n    font-size: 2rem;\n    border: 2px solid black;\n    border-radius: 0.5rem;\n  }\n\n  .flextag.is-white {\n    background: #fff;\n  }\n}\n\n/* Enter and leave animations can use different */\n/* durations and timing functions.              */\n.slide-fade-enter-active {\n  transition: all .15s ease;\n  overflow: hidden;\n  // transform: translateX(-100%);\n}\n.slide-fade-leave-active {\n  transition: all .15s ease;\n  overflow: clip;\n  // transform: translateX(-100%);\n}\n.slide-fade-enter, .slide-fade-leave-to\n/* .slide-fade-leave-active below version 2.1.8 */ {\n  transform: translateX(10px) scaleX(0);\n  opacity: 0;\n}\n\n</style>\n","\n\nimport { defineComponent } from 'vue';\n\nexport type Instruction = {\n  id: number;\n  text: string;\n}\n\nexport default defineComponent({\n  props: {\n    instructions: {\n      type: Array,\n      default: Array,\n    },\n    sizeClass: {\n      type: String,\n      default: 'is-normal',\n    },\n    tagClass: {\n      type: String,\n      default: 'is-dark',\n    },\n  },\n});\n","import { render } from \"./InstructionCarousel.vue?vue&type=template&id=39bd31b2\"\nimport script from \"./InstructionCarousel.vue?vue&type=script&lang=ts\"\nexport * from \"./InstructionCarousel.vue?vue&type=script&lang=ts\"\n\nimport \"./InstructionCarousel.vue?vue&type=style&index=0&id=39bd31b2&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <VideoPlayer\n        ref=\"videoPlayer\"\n        :videoBaseUrl=\"videoSrc\"\n        @progress=\"onProgress\"\n        @playback-completed=\"onSegmentPlaybackCompleted\"\n        :videoOpacity=\"videoOpacity\"\n        :drawPoseLandmarks=\"drawPoseLandmarks\"\n        :setDrawStyle=\"setDrawStyle\"\n        :emphasizedJoints=\"emphasizedJoints\"\n        :emphasizedJointStyle=\"emphasizedJointStyle\"\n        :showControls=\"showControls\"\n        :motionTrails=\"motionTrails\"\n        :drawMotionTrailsInTime=\"drawMotionTrailsInTime\"\n        />\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed, defineComponent, onBeforeUnmount, ref,\n} from 'vue';\nimport Constants from '@/services/Constants';\nimport { PauseInfo } from '@/model/MiniLesson';\nimport VideoPlayer from './VideoPlayer.vue';\n\nconst DEFAULT_PAUSE_DURATION = Constants.DefaultPauseDuration;\n\ntype PlaySegment = {\n  from: number;\n  to: number;\n  speed: number;\n  pause: PauseInfo | null;\n}\nfunction computePlaySegments(from: number, to: number, speed: number, pauses: PauseInfo[]) {\n  const segs: PlaySegment[] = [];\n\n  function nextPauseIndex(prevIndex: number): number {\n    const pTime = Math.max((pauses[prevIndex]?.time ?? 0), from);\n    let pauseIndex = prevIndex + 1;\n    for (; pauseIndex < pauses.length; pauseIndex += 1) {\n      const pi = pauses[pauseIndex];\n      if (pi.time > pTime) break;\n    }\n    return pauseIndex;\n  }\n\n  let segStartTime = from;\n  let pauseIndex = nextPauseIndex(-1);\n  while (pauseIndex < pauses.length) {\n    segs.push({\n      from: segStartTime,\n      to: pauses[pauseIndex].time,\n      speed,\n      pause: pauses[pauseIndex],\n    });\n    segStartTime = pauses[pauseIndex].time;\n    pauseIndex = nextPauseIndex(pauseIndex);\n  }\n  segs.push({\n    from: segStartTime,\n    to,\n    speed,\n    pause: null,\n  });\n\n  return segs;\n}\n\nexport default defineComponent({\n  name: 'PausingVideoPlayer',\n  components: { VideoPlayer },\n  props: {\n    motionTrails: {\n      type: Array,\n      default: Array,\n    },\n    drawMotionTrailsInTime: {\n      type: Boolean,\n      default: false,\n    },\n    videoSrc: {\n      default: '',\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: (canvasCtx: CanvasRenderingContext2D) => {\n        if (!canvasCtx) return;\n\n        /* eslint-disable no-param-reassign */\n        canvasCtx.strokeStyle = 'rgba(250, 200, 250, 0.95)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n        /* eslint-enable no-param-reassign */\n      },\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    showControls: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['playback-completed', 'progress', 'pause-hit', 'pause-end'],\n  setup(props, { emit }) {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n\n    let playTimeoutId = undefined as undefined | number;\n\n    function setTime(time: number) {\n      const vidPlayer = videoPlayer.value;\n      clearTimeout(playTimeoutId);\n      if (vidPlayer) vidPlayer.setTime(time);\n      emit('progress', time);\n    }\n\n    function onProgress(time: number) {\n      emit('progress', time);\n    }\n\n    function playSegment(seg: PlaySegment, delaySecs: number, emitResume?: boolean, onPlayStart?: () => void) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n\n      clearTimeout(playTimeoutId);\n      playTimeoutId = window.setTimeout(() => {\n        if (emitResume ?? false) {\n          emit('pause-end');\n        }\n        vidPlayer.playVideo(seg.from, seg.to, seg.speed);\n        if (onPlayStart) onPlayStart();\n      }, 1000 * delaySecs);\n    }\n    onBeforeUnmount(() => {\n      clearTimeout(playTimeoutId);\n    });\n\n    let playingSegments: PlaySegment[] = [];\n    let playingSegmentIndex = 0;\n\n    function play(\n      from: number,\n      to: number,\n      speed: number,\n      pauses: Array<PauseInfo>,\n      playDelaySecs: number,\n      onPlayStart?: () => void,\n    ) {\n      clearTimeout(playTimeoutId);\n      setTime(from);\n      playingSegments = computePlaySegments(from, to, speed, pauses);\n      playingSegmentIndex = 0;\n\n      playSegment(playingSegments[playingSegmentIndex], playDelaySecs, false, onPlayStart);\n    }\n    function onSegmentPlaybackCompleted() {\n      const { pause, to } = playingSegments[playingSegmentIndex];\n      playingSegmentIndex += 1;\n      if (playingSegmentIndex >= playingSegments.length) {\n        setTime(to);\n        emit('playback-completed');\n        return;\n      }\n\n      if (!pause) throw new Error('Expected there to be a pause obj');\n      const nextSeg = playingSegments[playingSegmentIndex];\n\n      emit('pause-hit', pause);\n      const manualResume = pause.manualResume ?? false;\n      if (!manualResume) {\n        playSegment(nextSeg, pause.pauseDuration ?? DEFAULT_PAUSE_DURATION, true);\n      }\n    }\n\n    const currentPose = computed(() => videoPlayer.value?.currentPose ?? null);\n\n    return {\n      videoPlayer,\n      setTime,\n      onProgress,\n      onSegmentPlaybackCompleted,\n      play,\n      currentPose,\n    };\n  },\n  methods: {\n    getVideoDimensions() {\n      return (this.$refs.videoPlayer as typeof VideoPlayer)?.getVideoDimensions();\n    },\n    getVideoTime(): number {\n      return (this.videoPlayer as any)?.getVideoTime() ?? 0;\n    },\n  },\n});\n</script>\n\n<style>\n\n</style>\n","const Constants = Object.freeze({\n  DefaultPauseDuration: 1.5,\n});\nexport default Constants;\n","<template>\n  <div\n    class=\"video-player-container\"\n  >\n    <video\n      :src=\"videoUrl\"\n      :style=\"{\n        opacity: '' + videoOpacity,\n      }\"\n      ref=\"videoElement\"\n      @loadedmetadata=\"scheduleCanvasResizing\"\n      @seeked=\"onTimeUpdated(true)\"\n      @timeupdate=\"onTimeUpdated(true)\"\n      @ended=\"endReported = true\"\n      playsinline\n      :controls=\"showControls\"\n    ></video>\n    <canvas class=\"is-overlay\" ref=\"canvasElement\" v-show=\"drawPoseLandmarks || motionTrails\"></canvas>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed,\n  defineComponent,\n  toRefs,\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  nextTick,\n  Ref,\n  watch,\n} from 'vue';\nimport MotionTrail from '@/model/MotionTrail';\nimport { DrawPose } from '@/services/MediaPipe';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport poseProvider from '@/services/PoseProvider';\n\nconst motionTrailColors = [\n  '#59eb59',\n  '#6666ff',\n];\n\nfunction onResize(canvasE: HTMLCanvasElement, videoE: HTMLVideoElement, modified: Ref<boolean>) {\n  nextTick(() => {\n    if (!canvasE || !videoE) return;\n\n    if (canvasE.width !== videoE.offsetWidth) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.width = videoE.offsetWidth;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    if (canvasE.height !== videoE.offsetHeight) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.height = videoE.offsetHeight;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    modified.value = true;\n  });\n}\n\nfunction setupCanvasResizing(\n  videoElement: Ref<null | HTMLVideoElement>,\n  canvasElement: Ref<null | HTMLCanvasElement>,\n  modified: Ref<boolean>,\n) {\n  function resizeCanvas() {\n    const videoE = videoElement.value;\n    const canvasE = canvasElement.value;\n    if (videoE && canvasE) onResize(canvasE, videoE, modified);\n  }\n  onMounted(() => {\n    window.addEventListener('resize', resizeCanvas);\n    nextTick(resizeCanvas);\n  });\n  onBeforeUnmount(() => {\n    window.removeEventListener('resize', resizeCanvas);\n  });\n  return resizeCanvas;\n}\n\nfunction setupVideoPlaying(\n  videoElement: Ref<HTMLVideoElement | null>,\n  startTime: Ref<number>,\n  endTime: Ref<number>,\n  startProgressUpdating: () => void,\n  endReported: Ref<boolean>,\n) {\n  function playVideo(\n    from: number,\n    to: number,\n    speed: number,\n  ) {\n    // console.log(`VideoPlayer :: Starting playback from ${from} to ${to} @ ${speed.toPrecision(2)}`);\n\n    // eslint-disable-next-line no-param-reassign\n    endReported.value = false;\n    // eslint-disable-next-line no-param-reassign\n    startTime.value = from;\n    // eslint-disable-next-line no-param-reassign\n    endTime.value = to;\n\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n\n    videoE.pause();\n    videoE.playbackRate = speed;\n    videoE.currentTime = from;\n\n    nextTick(() => {\n      startProgressUpdating();\n      videoE.play();\n    });\n  }\n\n  function pauseVideo() {\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n    videoE.pause();\n  }\n\n  return { playVideo, pauseVideo };\n}\n\nexport default defineComponent({\n  name: 'VideoPlayer',\n  props: {\n    videoBaseUrl: {\n      type: String,\n      required: true,\n    },\n    motionTrails: {\n      type: Array,\n      required: false,\n    },\n    drawMotionTrailsInTime: {\n      type: Boolean,\n      default: false,\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    fps: {\n      type: Number,\n      default: 30,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: () => {},\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    showControls: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\n    'playback-completed',\n    'progress',\n  ],\n  setup(props, ctx) {\n    const {\n      videoBaseUrl, motionTrails, drawMotionTrailsInTime, drawPoseLandmarks, fps, setDrawStyle, emphasizedJoints, emphasizedJointStyle,\n    } = toRefs(props);\n\n    const videoElement = ref(null as null | HTMLVideoElement);\n    const canvasElement = ref(null as null | HTMLCanvasElement);\n    const canvasCtx = computed(() => canvasElement.value?.getContext('2d') as CanvasRenderingContext2D | null);\n\n    const startTime = ref(0);\n    const endTime = ref(0);\n    const videoUrl = computed(() => videoBaseUrl?.value ?? '');\n    const currentTime = ref(0);\n    const canvasModified = ref(false);\n\n    const resizeCanvas = setupCanvasResizing(videoElement, canvasElement, canvasModified);\n    const endReported = ref(false);\n\n    const poses = ref([] as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>);\n    const currentFrame = computed(() => Math.floor(currentTime.value * fps.value));\n    const currentPose = computed(() => {\n      const frame = currentFrame.value;\n      const pose = poses.value[frame] ?? [];\n      return pose;\n    });\n\n    let prevTime = -1;\n    let timerId = -1;\n    function onTimeUpdated(ignoreEnd?: boolean) {\n      const vidElement = videoElement.value;\n      if (!vidElement) return;\n\n      const time = vidElement.currentTime;\n      if (time === prevTime) return;\n      prevTime = time;\n\n      currentTime.value = time;\n\n      if (!ignoreEnd && ((time + 1 / 60 >= endTime.value) || endReported.value)) {\n        vidElement.pause();\n        vidElement.currentTime = endTime.value; // pin to end time\n        ctx.emit('progress', endTime.value);\n        console.log('VideoPlayer :: playback-completed');\n        ctx.emit('playback-completed');\n        clearInterval(timerId);\n        timerId = -1;\n      } else {\n        ctx.emit('progress', time);\n      }\n    }\n\n    const startProgressUpdating = () => {\n      if (timerId !== -1) clearInterval(timerId);\n      timerId = window.setInterval(() => { onTimeUpdated(); }, 1000 / 30);\n    };\n\n    const { playVideo, pauseVideo } = setupVideoPlaying(\n      videoElement,\n      startTime,\n      endTime,\n      startProgressUpdating,\n      endReported,\n    );\n\n    function scheduleCanvasResizing() {\n      setTimeout(() => {\n        nextTick(resizeCanvas);\n      }, 100);\n    }\n\n    // Update pose drawing\n    function clearDrawing() {\n      const canvasE = canvasElement.value;\n      const drawCtx = canvasCtx.value;\n      if (!canvasE || !drawCtx) return;\n      drawCtx.clearRect(0, 0, canvasE.width, canvasE.height);\n    }\n    function drawPose(lms: Landmark[]) {\n      const videoE = videoElement.value;\n      const sourceAR = (videoE?.videoHeight && videoE.videoHeight) ? videoE.videoWidth / videoE.videoHeight : 1;\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n      setDrawStyle.value(drawCtx);\n      DrawPose(drawCtx, lms, {\n        emphasizedJoints: emphasizedJoints.value as number[],\n        emphasisStroke: emphasizedJointStyle.value,\n        sourceAspectRatio: sourceAR,\n        outlineColor: 'black',\n      });\n    }\n\n    const retieveClearPoseFile = async () => {\n      if (!drawPoseLandmarks.value) {\n        poses.value = [];\n        return;\n      }\n\n      // try {\n      poses.value = await poseProvider.GetPose(videoBaseUrl?.value ?? '');\n      // } catch (e) {\n      // console.error(\"Couldn't get poses: \", e);\n      // }\n    };\n\n    function drawArrow(drawCtx: CanvasRenderingContext2D, fromX: number, fromY: number, toX: number, toY: number, atEnd: boolean, arrowLength: number) {\n\n      const arrowWidth = arrowLength / 3;\n\n      const dx = toX - fromX;\n      const dy = toY - fromY;\n      const angle = Math.atan2(dy, dx);\n\n      drawCtx.save();\n      if (atEnd) drawCtx.translate(toX, toY);\n      else drawCtx.translate(fromX, fromY);\n\n      drawCtx.rotate(angle);\n      drawCtx.lineCap = 'square';\n      drawCtx.beginPath();\n      drawCtx.ellipse(-arrowLength, 0, arrowLength, arrowWidth, 0, -Math.PI / 2, Math.PI / 2);\n\n      // ctx.lineTo(length - arrow\n\n      drawCtx.stroke();\n      drawCtx.restore();\n    }\n\n    function drawMotionTrail(trail: Array<[number, number, number]>, time: number, color: string, strokeWidth: number) {\n      const videoE = videoElement.value;\n      const drawCtx = canvasCtx.value;\n      const motionTrailsInTime = drawMotionTrailsInTime.value;\n      // console.log('VideoPlayer :: Drawing motion trail', trail);\n      const lastTrailItem = trail.findIndex(([t, x, y]) => t >= time);\n      // eslint-disable-next-line no-nested-ternary\n      const effectiveTrailLength = !motionTrailsInTime ? trail.length\n        : (lastTrailItem === -1 ? trail.length : lastTrailItem + 1);\n\n      if (!drawCtx || !videoE) return;\n      if (effectiveTrailLength < 2) return;\n\n      drawCtx.save();\n      drawCtx.strokeStyle = color;\n      drawCtx.globalAlpha = 1.0;\n      drawCtx.lineWidth = strokeWidth;\n\n      if (drawCtx.canvas.width <= 0 || drawCtx.canvas.height <= 0) return;\n      if (videoE.videoWidth <= 0 || videoE.videoHeight <= 0) return;\n      const [xScale, yScale] = [drawCtx.canvas.width / videoE.videoWidth, drawCtx.canvas.height / videoE.videoHeight];\n      // console.log('Motion trail scaling', xScale, yScale);\n      drawCtx.scale(xScale, yScale);\n\n      drawCtx.beginPath();\n      // https://stackoverflow.com/questions/7054272/how-to-draw-smooth-curve-through-n-points-using-javascript-html5-canvas\n\n      const [st, startx, starty] = trail[0];\n      drawCtx.moveTo(startx, starty);\n\n      if (effectiveTrailLength <= 2) {\n        const [t, x, y] = trail[1];\n        drawCtx.lineTo(x, y);\n      } else {\n        for (let i = 1; i < effectiveTrailLength - 1; i += 1) {\n          const [t, x, y] = trail[i];\n          const [nt, nx, ny] = trail[i + 1];\n          const xc = (x + nx) / 2;\n          const yc = (y + ny) / 2;\n\n          if (i === effectiveTrailLength - 2) {\n            drawCtx.quadraticCurveTo(x, y, nx, ny);\n          } else {\n            drawCtx.quadraticCurveTo(x, y, xc, yc);\n          }\n        }\n      }\n\n      drawCtx.stroke();\n\n      const [t2, x2, y2] = trail[1];\n      drawArrow(drawCtx, startx, starty, x2, y2, false, 30.0);\n\n      const [lastt, lastx, lasty] = trail[effectiveTrailLength - 1];\n      const [secondlastt, secondlastx, secondlasty] = trail[effectiveTrailLength - 2];\n      drawArrow(drawCtx, secondlastx, secondlasty, lastx, lasty, true, 30.0);\n\n      // drawCtx.beginPath();\n\n      // drawCtx.moveTo(468.0, 844.8000000000001);\n      // drawCtx.lineTo(338.4, 806.4);\n      // drawCtx.moveTo(videoE.videoWidth * 0.25, videoE.videoHeight / 2);\n      // drawCtx.lineTo(videoE.videoWidth * 0.75, videoE.videoHeight / 2);\n      // console.log('videoWH', videoE.videoWidth, videoE.videoHeight);\n      // drawCtx.moveTo(0, 0);\n      // drawCtx.lineTo(400, 400);\n      // drawCtx.stroke();\n      drawCtx.restore();\n    }\n\n    watch([videoBaseUrl, drawPoseLandmarks], retieveClearPoseFile);\n    onMounted(retieveClearPoseFile);\n\n    const motionTrailsCurrentTime = computed(() => {\n      const drawingInTime = drawMotionTrailsInTime.value;\n      if (!drawingInTime) return 0;\n      return currentTime.value;\n    });\n\n    watch([canvasModified, currentPose, drawPoseLandmarks, motionTrails, motionTrailsCurrentTime], () => {\n      canvasModified.value = false;\n      clearDrawing();\n\n      if (drawPoseLandmarks.value) {\n        drawPose(currentPose.value as any);\n      }\n\n      if (motionTrails && motionTrails.value) {\n        for (let i = 0; i < motionTrails.value.length; i += 1) {\n          const trail = motionTrails.value[i];\n          drawMotionTrail(trail as any, motionTrailsCurrentTime.value, 'black', 9.0);\n        }\n        for (let i = 0; i < motionTrails.value.length; i += 1) {\n          const trail = motionTrails.value[i];\n          const color = motionTrailColors[i % motionTrailColors.length];\n          drawMotionTrail(trail as any, motionTrailsCurrentTime.value, color, 6.0);\n        }\n      }\n    });\n\n    let resizeTimerId = -1;\n    onMounted(() => {\n      resizeTimerId = window.setInterval(resizeCanvas, 500);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(resizeTimerId);\n    });\n\n    return {\n      videoUrl,\n      resizeCanvas,\n      videoElement,\n      canvasElement,\n      playVideo,\n      pauseVideo,\n      endTime,\n      scheduleCanvasResizing,\n      poses,\n      currentTime,\n      currentPose,\n      currentFrame,\n      endReported,\n      onTimeUpdated,\n      motionTrailsCurrentTime,\n\n      getVideoDimensions: () => ({\n        height: videoElement.value?.height ?? 0,\n        width: videoElement.value?.width ?? 0,\n      }),\n    };\n  },\n  methods: {\n    setTime(time: number, keepPlaying?: boolean | undefined) {\n      const videoE = this.videoElement;\n      if (videoE) {\n        videoE.currentTime = time;\n      }\n      const pauseVideo = !(keepPlaying ?? false);\n      if (videoE && pauseVideo) videoE.pause();\n    },\n    getVideoTime() {\n      return this.videoElement?.currentTime ?? 0;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n.video-player-container, .canvas-layer {\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: center;\n  align-items: center;\n\n  canvas {\n    margin: auto;\n    pointer-events: none;\n  }\n\n  video {\n    flex: 1 1 auto;\n    border-radius: 0.25rem;\n    display: block;\n    margin: auto;\n    height: auto;\n    max-height: 100%;\n  }\n}\n</style>\n","// Inspired from https://gist.github.com/TheJLifeX/74958cc59db477a91837244ff598ef4a\n\nexport type Landmark = {\n  x: number;\n  y: number;\n  z?: number;\n  visibility?: number;\n}\n\nexport type MpHolisticResults = {\n  image?: any;\n  timestamp?: number;\n  faceLandmarks?: Array<Landmark>;\n  poseLandmarks?: Array<Landmark>;\n  rightHandLandmarks?: Array<Landmark>;\n  leftHandLandmarks?: Array<Landmark>;\n}\nexport const HandLandmarks = {\n  wrist: 0,\n  thumbCMC: 1,\n  thumbMCP: 2,\n  thumbIP: 3,\n  thumbTIP: 4,\n  indexMCP: 5,\n  indexPIP: 6,\n  indexDIP: 7,\n  indexTIP: 8,\n  middleMCP: 9,\n  middlePIP: 10,\n  middleDIP: 11,\n  middleTIP: 12,\n  ringMCP: 13,\n  ringPIP: 14,\n  ringDIP: 15,\n  ringTIP: 16,\n  pinkyMCP: 17,\n  pinkyPIP: 18,\n  pinkyDIP: 19,\n  pinkyTIP: 20,\n};\n\nexport const PoseLandmarks = {\n  nose: 0,\n  leftEyeInner: 1,\n  leftEye: 2,\n  leftEyeOuter: 3,\n  rightEyeInner: 4,\n  rightEye: 5,\n  rightEyeOuter: 6,\n  leftEar: 7,\n  rightEar: 8,\n  mouthLeft: 9,\n  mouthRight: 10,\n  leftShoulder: 11,\n  rightShoulder: 12,\n  leftElbow: 13,\n  rightElbow: 14,\n  leftWrist: 15,\n  rightWrist: 16,\n  leftPinky: 17,\n  rightPinky: 18,\n  leftIndex: 19,\n  rightIndex: 20,\n  leftThumb: 21,\n  rightThumb: 22,\n  leftHip: 23,\n  rightHip: 24,\n  leftKnee: 25,\n  rightKnee: 26,\n  leftAnkle: 27,\n  rightAnkle: 28,\n  leftHeel: 29,\n  rightHeel: 30,\n  leftFootIndex: 31,\n  rightFootIndex: 32,\n\n  // The following are not part of the MP standard, but are added for convenience\n  midShouder: -1,\n  midHip: -2,\n  midEye: -3,\n};\n","import { TinyEmitter } from 'tiny-emitter';\nimport { onMounted, onBeforeUnmount } from 'vue';\nimport { MpHolisticResults } from './MediaPipeTypes';\n\nexport const EventNames = Object.freeze({\n  gesture: 'gesture',\n  trackingProcessingStarted: 'trackingProcessingStarted',\n  trackingResults: 'trackingResults',\n  trackingRequested: 'trackingRequested',\n  trackingRequestFinished: 'trackingRequestFinished',\n});\n\nexport const GestureNames = Object.freeze({\n  none: 'none',\n  pointLeft: 'point-left',\n  pointRight: 'point-right',\n  namaste: 'namaste',\n});\n\nconst eventHub = new TinyEmitter();\n\nexport function setupGestureListening(\n  callbacks: Record<string, (trackingResults?: MpHolisticResults | undefined) => void>,\n  fallback?: undefined | ((gesture: string, trackingResults: MpHolisticResults) => void),\n) {\n  function onGesture(gesture: string, trackingResults: MpHolisticResults) {\n    const cb = callbacks[gesture];\n    if (cb) cb(trackingResults);\n\n    if (!cb && fallback) fallback(gesture, trackingResults);\n  }\n  onMounted(() => {\n    eventHub.on(EventNames.gesture, onGesture);\n  });\n  onBeforeUnmount(() => {\n    eventHub.off(EventNames.gesture, onGesture);\n  });\n}\n\nexport function setupMediaPipeListening(\n  callback: (res: MpHolisticResults, frameId?: number) => void,\n  onFrameProcessingStarted?: (frameId: number) => void,\n) {\n\n  onMounted(() => {\n    eventHub.on(EventNames.trackingResults, callback);\n    if (onFrameProcessingStarted) eventHub.on(EventNames.trackingProcessingStarted, onFrameProcessingStarted);\n  });\n  onBeforeUnmount(() => {\n    eventHub.off(EventNames.trackingResults, callback);\n    if (onFrameProcessingStarted) eventHub.off(EventNames.trackingProcessingStarted, onFrameProcessingStarted);\n  });\n}\n\nexport const TrackingActions = Object.freeze({\n  requestTracking: (id: string) => {\n    eventHub.emit(EventNames.trackingRequested, id);\n  },\n  endTrackingRequest: (id: string) => {\n    eventHub.emit(EventNames.trackingRequestFinished, id);\n  },\n});\n\nexport default eventHub;\n","//\n// Utils.ts\n//\n\nexport default class Utils {\n\n  static range(size: number, startAt = 0) {\n    return [...Array(size).keys()].map((i) => i + startAt);\n  }\n\n  static sleep(secs: number): Promise<void> {\n    return new Promise((res) => setTimeout(res, secs * 1000));\n  }\n\n  static PromptDownloadFile(filename: string, text: string) {\n    const element = document.createElement('a');\n    element.setAttribute('href', `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`);\n    element.setAttribute('download', filename);\n    element.style.display = 'none';\n\n    document.body.appendChild(element);\n    element.click();\n\n    document.body.removeChild(element);\n  }\n\n  // static CaptureVideoImage(videoE: HTMLVideoElement) {\n  //   const canvas = document.createElement('canvas');\n  //   canvas.style.display = 'none';\n  //   document.appendChild(canvas);\n  //   canvas.width = videoE.width;\n  //   canvas.height = videoE.height;\n  //   const ctx = canvas.getContext('2d')!;\n\n  //   ctx.drawImage(videoE, 0, 0, videoE.width, videoE.height);\n  // }\n\n  static DoEveryFrame(\n    onFrame: () => Promise<void>,\n    shouldRun?: () => boolean,\n  ) {\n\n    if (shouldRun !== undefined && !shouldRun()) {\n      requestAnimationFrame(() => {\n        Utils.DoEveryFrame(onFrame);\n      });\n    } else {\n      requestAnimationFrame(() => {\n        onFrame().then(() => {\n          Utils.DoEveryFrame(onFrame);\n        });\n      });\n    }\n  }\n\n  static uuidv4() {\n    // eslint-disable-next-line no-bitwise, no-mixed-operators, space-infix-ops\n    return (`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`).replace(/[018]/g, (c: any) => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));\n  }\n\n  static deepCopy<T>(obj: T): T {\n\n    // Handle the 3 simple types, and null or undefined\n    if (obj === null || undefined === obj || typeof obj !== 'object') {\n      return obj;\n    }\n\n    if (obj instanceof Date) {\n      const copy = new Date();\n      copy.setTime(obj.getTime());\n      return copy as unknown as T;\n    }\n\n    if (Array.isArray(obj)) {\n      const len = obj.length;\n      const copy = new Array(len);\n      for (let i = 0; i < len; i += 1) {\n        copy[i] = Utils.deepCopy(obj[i]);\n      }\n      return copy as unknown as T;\n    }\n\n    if (typeof obj === 'object') {\n      const typedObj = obj as any;\n      const copy = {} as any;\n      const attrs = Object.keys(typedObj);\n      for (let i = 0; i < attrs.length; i += 1) {\n        const attr = attrs[i];\n        const val = typedObj[attr];\n        // eslint-disable-next-line no-prototype-builtins\n        if (typedObj.hasOwnProperty(attr)) copy[attr] = Utils.deepCopy(val);\n      }\n      return copy;\n    }\n\n    throw new Error(`Unable to copy object ${obj}! It's type isn't supported`);\n  }\n\n  static shuffleArray<T>(array: Array<T>, fromIndex?: number, toIndex?: number) {\n    const sliceStart = fromIndex ?? 0;\n    const sliceEnd = toIndex ?? array.length - 1;\n\n    for (let i = sliceEnd; i > sliceStart; i -= 1) {\n      const j = sliceStart + Math.floor(Math.random() * (i - sliceStart + 1));\n      [array[i], array[j]] = [array[j], array[i]];\n    }\n  }\n}\n","/* eslint-disable no-multi-spaces */\n/* eslint-disable @typescript-eslint/no-var-requires */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable import/prefer-default-export */\nimport { Landmark, MpHolisticResults, PoseLandmarks } from './MediaPipeTypes';\nimport eventHub, { EventNames } from './EventHub';\nimport Utils from './Utils';\n\nexport const usingHolistic = false;\n\nlet mp: any = null;\n// eslint-disable-next-line global-require\nif (usingHolistic) mp = require('@mediapipe/holistic/holistic');\n// eslint-disable-next-line global-require\nelse mp = require('@mediapipe/pose/pose');\n\nexport const HAND_LANDMARK_CONNECTIONS = [\n  [0, 1], [1, 2], [2, 3], [3, 4], // Thumb\n  [0, 5], [5, 6], [6, 7], [7, 8], // Index\n  [5, 9], [9, 10], [10, 11], [11, 12], // Middle\n  [9, 13], [13, 14], [14, 15], [15, 16], // Ring\n  [0, 17], [13, 17], [17, 18], [18, 19], [19, 20], // Pinky\n];\n\nexport const HAND = {\n  THUMB_FINGER: [1, 2, 3, 4],\n  INDEX_FINGER: [5, 6, 7, 8],\n  MIDDLE_FINGER: [9, 10, 11, 12],\n  RING_FINGER: [13, 14, 15, 16],\n  PINKY_FINGER: [17, 18, 19, 20],\n};\n\nconst CONNECTIONS_TO_DRAW = [\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftPinky,      size: 1.0 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightPinky,     size: 1.0 },\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftThumb,      size: 1.0 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightThumb,     size: 1.0 },\n  { v0: PoseLandmarks.leftIndex,    v1: PoseLandmarks.leftWrist,      size: 1.0 },\n  { v0: PoseLandmarks.rightIndex,   v1: PoseLandmarks.rightWrist,     size: 1.0 },\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftElbow,      size: 1.1 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightElbow,     size: 1.1 },\n  { v0: PoseLandmarks.leftElbow,    v1: PoseLandmarks.leftShoulder,   size: 1.3 },\n  { v0: PoseLandmarks.rightElbow,   v1: PoseLandmarks.rightShoulder,  size: 1.3 },\n  { v0: PoseLandmarks.leftShoulder, v1: PoseLandmarks.rightShoulder,  size: 2.0 },\n  // { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.leftShoulder,   size: 1.7 },\n  // { v0: PoseLandmarks.rightHip,     v1: PoseLandmarks.rightShoulder,  size: 1.7 },\n  { v0: PoseLandmarks.midShouder,   v1: PoseLandmarks.midHip,           size: 3.0 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.rightHip,       size: 1.7 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.leftKnee,       size: 1.5 },\n  { v0: PoseLandmarks.rightHip,     v1: PoseLandmarks.rightKnee,      size: 1.5 },\n  { v0: PoseLandmarks.leftKnee,     v1: PoseLandmarks.leftAnkle,      size: 1.4 },\n  { v0: PoseLandmarks.rightKnee,    v1: PoseLandmarks.rightAnkle,     size: 1.4 },\n  { v0: PoseLandmarks.leftAnkle,    v1: PoseLandmarks.leftHeel,       size: 1.0 },\n  { v0: PoseLandmarks.rightAnkle,   v1: PoseLandmarks.rightHeel,      size: 1.0 },\n  { v0: PoseLandmarks.leftHeel,     v1: PoseLandmarks.leftFootIndex,  size: 1.0 },\n  { v0: PoseLandmarks.rightHeel,    v1: PoseLandmarks.rightFootIndex, size: 1.0 },\n  { v0: PoseLandmarks.leftAnkle,    v1: PoseLandmarks.leftFootIndex,  size: 1.0 },\n  { v0: PoseLandmarks.rightAnkle,   v1: PoseLandmarks.rightFootIndex, size: 1.0 },\n\n  // { v0: PoseLandmarks.leftEye,      v1: PoseLandmarks.rightEye,       size: 2.0 },\n  // { v0: PoseLandmarks.nose,         v1: PoseLandmarks.leftEye,        size: 1.0 },\n\n  { v0: PoseLandmarks.leftEar,       v1: PoseLandmarks.leftEyeOuter,  size: 1.0 },\n  { v0: PoseLandmarks.leftEyeOuter,  v1: PoseLandmarks.rightEyeOuter, size: 1.0 },\n  { v0: PoseLandmarks.rightEyeOuter, v1: PoseLandmarks.rightEar,      size: 1.0 },\n  { v0: PoseLandmarks.rightEar,      v1: PoseLandmarks.mouthRight,    size: 1.0 },\n  { v0: PoseLandmarks.mouthRight,    v1: PoseLandmarks.mouthLeft,     size: 1.0 },\n  { v0: PoseLandmarks.mouthLeft,     v1: PoseLandmarks.leftEar,       size: 1.0 },\n];\n\nlet trackingStarted = false;\n\nexport function DrawConnections(\n  canvasCtx: CanvasRenderingContext2D,\n  landmarks: Array<Landmark>,\n  connections: Array<Array<number>>,\n) {\n  const w = canvasCtx.canvas.width;\n  const h = canvasCtx.canvas.height;\n\n  canvasCtx.beginPath();\n  connections.forEach((connection) => {\n    const p1 = landmarks[connection[0]];\n    const p2 = landmarks[connection[1]];\n\n    if (!p1 || !p2) return;\n\n    canvasCtx.moveTo(p1.x * w, p1.y * h);\n    canvasCtx.lineTo(p2.x * w, p2.y * h);\n  });\n\n  canvasCtx.stroke();\n  canvasCtx.restore();\n}\n\nfunction MidLandmark(lm1: Landmark, lm2: Landmark): Landmark {\n  return {\n    x: (lm1.x + lm2.x) / 2,\n    y: (lm1.y + lm2.y) / 2,\n    visibility: ((lm1.visibility ?? 1) + (lm2.visibility ?? 1)) / 2,\n  };\n}\n\nfunction GetLandmark(lm: number, lms: Array<Landmark>) {\n  if (lm >= 0) return lms[lm];\n\n  if (lm === PoseLandmarks.midHip) {\n    return MidLandmark(lms[PoseLandmarks.leftHip], lms[PoseLandmarks.rightHip]);\n  }\n\n  if (lm === PoseLandmarks.midShouder) {\n    return MidLandmark(lms[PoseLandmarks.leftShoulder], lms[PoseLandmarks.rightShoulder]);\n  }\n\n  if (lm === PoseLandmarks.midEye) {\n    return MidLandmark(lms[PoseLandmarks.leftEye], lms[PoseLandmarks.rightEye]);\n  }\n\n  return undefined;\n}\n\nfunction DrawSkeleton(\n  canvasCtx: CanvasRenderingContext2D,\n  width: number,\n  height: number,\n  poseLandmarks: Landmark[],\n  enableSizeVariation: boolean,\n  emphasizedJoints: number[],\n  emphasisStroke?: string,\n) {\n  const w = width;\n  const h = height;\n\n  CONNECTIONS_TO_DRAW.forEach((connection) => {\n    const  p1 = GetLandmark(connection.v0, poseLandmarks);\n    const  p2 = GetLandmark(connection.v1, poseLandmarks);\n\n    if (!p1 || !p2) return;\n    if ((p1.visibility ?? 1) < 0.25 || (p2.visibility ?? 1) < 0.25) {\n      // console.log('skipping b/c of insufficient visibility');\n      return;\n    }\n\n    const emphasized = emphasizedJoints\n    && emphasizedJoints.indexOf(connection.v0) !== -1\n    && emphasizedJoints.indexOf(connection.v1) !== -1;\n\n    canvasCtx.save();\n    if (emphasized && emphasisStroke) {\n      canvasCtx.strokeStyle = emphasisStroke;\n    }\n    if (enableSizeVariation) {\n      canvasCtx.lineWidth *= connection.size;\n    }\n    canvasCtx.beginPath();\n    canvasCtx.moveTo(p1.x * w, p1.y * h);\n    canvasCtx.lineTo(p2.x * w, p2.y * h);\n    canvasCtx.stroke();\n    canvasCtx.restore();\n  });\n}\n\nexport function DrawPose(\n  canvasCtx: CanvasRenderingContext2D,\n  poseLandmarks: Landmark[],\n  options?: {\n    sourceAspectRatio?: number;\n    emphasizedJoints?: number[];\n    emphasisStroke? : string;\n    enableSizeVariation?: boolean;\n    outlineColor?: string;\n  },\n) {\n\n  if (poseLandmarks.length === 0) {\n    return;\n  }\n\n  const jointsWithEmphasis = options?.emphasizedJoints ?? [];\n  const enableSizeVariation = options?.enableSizeVariation ?? false;\n\n  canvasCtx.save();\n  let w = canvasCtx.canvas.width;\n  let h = canvasCtx.canvas.height;\n\n  const sourceAR = options?.sourceAspectRatio;\n  if (sourceAR) {\n    const canvasAR = canvasCtx.canvas.width / canvasCtx.canvas.height;\n\n    if (sourceAR > canvasAR) {\n      // video source is wider than canvas\n      const adjustedHeight = w / sourceAR;\n      const pixelsTaller = h - adjustedHeight;\n      canvasCtx.translate(0, pixelsTaller / 2);\n      h = adjustedHeight;\n\n    } else if (sourceAR < canvasAR) {\n      // video source is taller than canvas\n      const adjustedWidth = sourceAR * h;\n      const pixelsWider = w - adjustedWidth;\n      canvasCtx.translate(pixelsWider / 2, 0);\n      w = adjustedWidth;\n    }\n  }\n\n  if (options?.outlineColor) {\n    canvasCtx.save();\n    canvasCtx.strokeStyle = options.outlineColor;\n    const outlineWidth = Math.max(1, canvasCtx.lineWidth / 10.0);\n    canvasCtx.lineWidth += outlineWidth * 2;\n    DrawSkeleton(canvasCtx, w, h, poseLandmarks, enableSizeVariation, jointsWithEmphasis);\n    canvasCtx.restore();\n  }\n  DrawSkeleton(canvasCtx, w, h, poseLandmarks, enableSizeVariation, jointsWithEmphasis, options?.emphasisStroke);\n\n  // const p1a = poseLandmarks[PoseLandmarks.leftShoulder];\n  // const p1b = poseLandmarks[PoseLandmarks.rightShoulder];\n  // const p2 = poseLandmarks[PoseLandmarks.nose];\n  // if (!p1a || !p1b || !p2) {\n  //   canvasCtx.beginPath();\n  //   canvasCtx.moveTo(w * 0.5 * (p1a.x + p1b.x), h * 0.5 * (p1a.y + p1b.y));\n  //   canvasCtx.lineTo(w * p2.x, h * p2.y);\n  //   canvasCtx.stroke();\n  // }\n\n  canvasCtx.restore();\n}\n\nconst trackingRequests: Record<string, boolean> = {};\nconst trackingCount = () => Object\n  .keys(trackingRequests)\n  .map((id) => trackingRequests[id])\n  .filter((x) => x).length;\n\nlet latestResults: MpHolisticResults | null = null;\nexport function GetLatestResults() {\n  return Object.freeze(latestResults);\n}\n\nexport function StartTracking(videoE: HTMLVideoElement): void {\n  if (trackingStarted) { throw Error('Tracking alread started'); }\n\n  trackingStarted = true;\n  trackingRequests.initial = true;\n\n  let mpInstance: any = null;\n  if (usingHolistic) mpInstance = new mp.Holistic({ locateFile: (file: any) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic@0.5.1635989137/${file}` });\n  else mpInstance = new mp.Pose({ locateFile: (file: any) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/${file}` });\n\n  mpInstance.setOptions({\n    upperBodyOnly: false,\n    smoothLandmarks: true,\n    minDetectionConfidence: 0.5,\n    minTrackingConfidence: 0.5,\n  });\n\n  let frameId = 0;\n  let timestamp = Date.now();\n  mpInstance.onResults((res: MpHolisticResults) => {\n    trackingRequests.initial = false;\n    latestResults = res;\n    res.timestamp = timestamp;\n    eventHub.emit(EventNames.trackingResults, res, frameId);\n  });\n\n  eventHub.on(EventNames.trackingRequested, (id: string) => {\n    trackingRequests[id] = true;\n  });\n  eventHub.on(EventNames.trackingRequestFinished, (id: string) => {\n    trackingRequests[id] = false;\n  });\n\n  Utils.DoEveryFrame(\n    async () => {\n      frameId += 1;\n      eventHub.emit(EventNames.trackingProcessingStarted, frameId);\n      timestamp = Date.now();\n      if (trackingCount() > 0) await mpInstance.send({ image: videoE });\n    },\n    () => true,\n  );\n}\n\nexport function isTracking() {\n  return trackingCount() > 0;\n}\n","// import parse from 'csv-parse';\n\nimport Parser, { Row } from '@gregoranders/csv';\nimport { Landmark } from '@/services/MediaPipeTypes';\n\nconst VIDEO_EXTENSIONS = ['.mp4', '.m4v', '.mov'];\n\nexport class PoseProvider {\n\n  private poseFiles: Map<string, Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>> = new Map();\n\n  async GetPose(videoName: string) {\n    if (videoName.length < 4) return [];\n\n    let poseFilename = videoName.replace('videos', 'landmarks');\n    for (let i = 0; i < VIDEO_EXTENSIONS.length; i += 1) {\n      const extension = VIDEO_EXTENSIONS[i];\n      poseFilename = poseFilename.replace(extension, '.pose.csv');\n    }\n\n    const cached = this.poseFiles.get(poseFilename);\n    if (cached !== undefined) return cached;\n\n    const stored = localStorage.getItem(poseFilename);\n    if (stored !== null) {\n      const poses = JSON.parse(stored) as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>;\n      this.poseFiles.set(poseFilename, Object.freeze(poses));\n      return poses;\n    }\n\n    const poseFile = await PoseProvider.getPoseFile(poseFilename);\n    const poses = PoseProvider.convertToPoseList(poseFile);\n\n    this.poseFiles.set(poseFilename, poses);\n\n    // try {\n    //   localStorage.setItem(poseFilename, JSON.stringify(poses));\n    // } catch (e) {\n    //   console.warn('Failed to cache pose file', e);\n    // }\n    return poses;\n  }\n\n  private static async getPoseFile(url: string) {\n\n    const response = await fetch(url);\n    if (!response.ok) throw new Error(`Error fetching pose file: ${response.statusText}`);\n\n    const text = await response.text();\n\n    return new Parser().parse(text);\n  }\n\n  private static convertToPoseList(csv: readonly Row[]) {\n    const temp = csv.map((row) => PoseProvider.convertRow(row));\n    return Object.freeze(temp.filter((x) => x.length > 0));\n  }\n\n  private static convertRow(row: Row) {\n    if (row.length === 0) return [];\n    if (row[0].startsWith('#')) return [];\n\n    const lms = [] as Array<Readonly<Landmark>>;\n    for (let i = 1; i + 2 < row.length; i += 3) {\n      lms.push(\n        Object.freeze({\n          x: Number.parseFloat(row[i]),\n          y: Number.parseFloat(row[i + 1]),\n          visibility: Number.parseFloat(row[i + 2]),\n        }),\n      );\n    }\n\n    return Object.freeze(lms);\n  }\n}\n\nconst poseProvider = new PoseProvider();\n\nexport default poseProvider;\n","\n\nimport {\n  computed,\n  defineComponent,\n  toRefs,\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  nextTick,\n  Ref,\n  watch,\n} from 'vue';\nimport MotionTrail from '@/model/MotionTrail';\nimport { DrawPose } from '@/services/MediaPipe';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport poseProvider from '@/services/PoseProvider';\n\nconst motionTrailColors = [\n  '#59eb59',\n  '#6666ff',\n];\n\nfunction onResize(canvasE: HTMLCanvasElement, videoE: HTMLVideoElement, modified: Ref<boolean>) {\n  nextTick(() => {\n    if (!canvasE || !videoE) return;\n\n    if (canvasE.width !== videoE.offsetWidth) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.width = videoE.offsetWidth;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    if (canvasE.height !== videoE.offsetHeight) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.height = videoE.offsetHeight;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    modified.value = true;\n  });\n}\n\nfunction setupCanvasResizing(\n  videoElement: Ref<null | HTMLVideoElement>,\n  canvasElement: Ref<null | HTMLCanvasElement>,\n  modified: Ref<boolean>,\n) {\n  function resizeCanvas() {\n    const videoE = videoElement.value;\n    const canvasE = canvasElement.value;\n    if (videoE && canvasE) onResize(canvasE, videoE, modified);\n  }\n  onMounted(() => {\n    window.addEventListener('resize', resizeCanvas);\n    nextTick(resizeCanvas);\n  });\n  onBeforeUnmount(() => {\n    window.removeEventListener('resize', resizeCanvas);\n  });\n  return resizeCanvas;\n}\n\nfunction setupVideoPlaying(\n  videoElement: Ref<HTMLVideoElement | null>,\n  startTime: Ref<number>,\n  endTime: Ref<number>,\n  startProgressUpdating: () => void,\n  endReported: Ref<boolean>,\n) {\n  function playVideo(\n    from: number,\n    to: number,\n    speed: number,\n  ) {\n    // console.log(`VideoPlayer :: Starting playback from ${from} to ${to} @ ${speed.toPrecision(2)}`);\n\n    // eslint-disable-next-line no-param-reassign\n    endReported.value = false;\n    // eslint-disable-next-line no-param-reassign\n    startTime.value = from;\n    // eslint-disable-next-line no-param-reassign\n    endTime.value = to;\n\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n\n    videoE.pause();\n    videoE.playbackRate = speed;\n    videoE.currentTime = from;\n\n    nextTick(() => {\n      startProgressUpdating();\n      videoE.play();\n    });\n  }\n\n  function pauseVideo() {\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n    videoE.pause();\n  }\n\n  return { playVideo, pauseVideo };\n}\n\nexport default defineComponent({\n  name: 'VideoPlayer',\n  props: {\n    videoBaseUrl: {\n      type: String,\n      required: true,\n    },\n    motionTrails: {\n      type: Array,\n      required: false,\n    },\n    drawMotionTrailsInTime: {\n      type: Boolean,\n      default: false,\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    fps: {\n      type: Number,\n      default: 30,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: () => {},\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    showControls: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\n    'playback-completed',\n    'progress',\n  ],\n  setup(props, ctx) {\n    const {\n      videoBaseUrl, motionTrails, drawMotionTrailsInTime, drawPoseLandmarks, fps, setDrawStyle, emphasizedJoints, emphasizedJointStyle,\n    } = toRefs(props);\n\n    const videoElement = ref(null as null | HTMLVideoElement);\n    const canvasElement = ref(null as null | HTMLCanvasElement);\n    const canvasCtx = computed(() => canvasElement.value?.getContext('2d') as CanvasRenderingContext2D | null);\n\n    const startTime = ref(0);\n    const endTime = ref(0);\n    const videoUrl = computed(() => videoBaseUrl?.value ?? '');\n    const currentTime = ref(0);\n    const canvasModified = ref(false);\n\n    const resizeCanvas = setupCanvasResizing(videoElement, canvasElement, canvasModified);\n    const endReported = ref(false);\n\n    const poses = ref([] as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>);\n    const currentFrame = computed(() => Math.floor(currentTime.value * fps.value));\n    const currentPose = computed(() => {\n      const frame = currentFrame.value;\n      const pose = poses.value[frame] ?? [];\n      return pose;\n    });\n\n    let prevTime = -1;\n    let timerId = -1;\n    function onTimeUpdated(ignoreEnd?: boolean) {\n      const vidElement = videoElement.value;\n      if (!vidElement) return;\n\n      const time = vidElement.currentTime;\n      if (time === prevTime) return;\n      prevTime = time;\n\n      currentTime.value = time;\n\n      if (!ignoreEnd && ((time + 1 / 60 >= endTime.value) || endReported.value)) {\n        vidElement.pause();\n        vidElement.currentTime = endTime.value; // pin to end time\n        ctx.emit('progress', endTime.value);\n        console.log('VideoPlayer :: playback-completed');\n        ctx.emit('playback-completed');\n        clearInterval(timerId);\n        timerId = -1;\n      } else {\n        ctx.emit('progress', time);\n      }\n    }\n\n    const startProgressUpdating = () => {\n      if (timerId !== -1) clearInterval(timerId);\n      timerId = window.setInterval(() => { onTimeUpdated(); }, 1000 / 30);\n    };\n\n    const { playVideo, pauseVideo } = setupVideoPlaying(\n      videoElement,\n      startTime,\n      endTime,\n      startProgressUpdating,\n      endReported,\n    );\n\n    function scheduleCanvasResizing() {\n      setTimeout(() => {\n        nextTick(resizeCanvas);\n      }, 100);\n    }\n\n    // Update pose drawing\n    function clearDrawing() {\n      const canvasE = canvasElement.value;\n      const drawCtx = canvasCtx.value;\n      if (!canvasE || !drawCtx) return;\n      drawCtx.clearRect(0, 0, canvasE.width, canvasE.height);\n    }\n    function drawPose(lms: Landmark[]) {\n      const videoE = videoElement.value;\n      const sourceAR = (videoE?.videoHeight && videoE.videoHeight) ? videoE.videoWidth / videoE.videoHeight : 1;\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n      setDrawStyle.value(drawCtx);\n      DrawPose(drawCtx, lms, {\n        emphasizedJoints: emphasizedJoints.value as number[],\n        emphasisStroke: emphasizedJointStyle.value,\n        sourceAspectRatio: sourceAR,\n        outlineColor: 'black',\n      });\n    }\n\n    const retieveClearPoseFile = async () => {\n      if (!drawPoseLandmarks.value) {\n        poses.value = [];\n        return;\n      }\n\n      // try {\n      poses.value = await poseProvider.GetPose(videoBaseUrl?.value ?? '');\n      // } catch (e) {\n      // console.error(\"Couldn't get poses: \", e);\n      // }\n    };\n\n    function drawArrow(drawCtx: CanvasRenderingContext2D, fromX: number, fromY: number, toX: number, toY: number, atEnd: boolean, arrowLength: number) {\n\n      const arrowWidth = arrowLength / 3;\n\n      const dx = toX - fromX;\n      const dy = toY - fromY;\n      const angle = Math.atan2(dy, dx);\n\n      drawCtx.save();\n      if (atEnd) drawCtx.translate(toX, toY);\n      else drawCtx.translate(fromX, fromY);\n\n      drawCtx.rotate(angle);\n      drawCtx.lineCap = 'square';\n      drawCtx.beginPath();\n      drawCtx.ellipse(-arrowLength, 0, arrowLength, arrowWidth, 0, -Math.PI / 2, Math.PI / 2);\n\n      // ctx.lineTo(length - arrow\n\n      drawCtx.stroke();\n      drawCtx.restore();\n    }\n\n    function drawMotionTrail(trail: Array<[number, number, number]>, time: number, color: string, strokeWidth: number) {\n      const videoE = videoElement.value;\n      const drawCtx = canvasCtx.value;\n      const motionTrailsInTime = drawMotionTrailsInTime.value;\n      // console.log('VideoPlayer :: Drawing motion trail', trail);\n      const lastTrailItem = trail.findIndex(([t, x, y]) => t >= time);\n      // eslint-disable-next-line no-nested-ternary\n      const effectiveTrailLength = !motionTrailsInTime ? trail.length\n        : (lastTrailItem === -1 ? trail.length : lastTrailItem + 1);\n\n      if (!drawCtx || !videoE) return;\n      if (effectiveTrailLength < 2) return;\n\n      drawCtx.save();\n      drawCtx.strokeStyle = color;\n      drawCtx.globalAlpha = 1.0;\n      drawCtx.lineWidth = strokeWidth;\n\n      if (drawCtx.canvas.width <= 0 || drawCtx.canvas.height <= 0) return;\n      if (videoE.videoWidth <= 0 || videoE.videoHeight <= 0) return;\n      const [xScale, yScale] = [drawCtx.canvas.width / videoE.videoWidth, drawCtx.canvas.height / videoE.videoHeight];\n      // console.log('Motion trail scaling', xScale, yScale);\n      drawCtx.scale(xScale, yScale);\n\n      drawCtx.beginPath();\n      // https://stackoverflow.com/questions/7054272/how-to-draw-smooth-curve-through-n-points-using-javascript-html5-canvas\n\n      const [st, startx, starty] = trail[0];\n      drawCtx.moveTo(startx, starty);\n\n      if (effectiveTrailLength <= 2) {\n        const [t, x, y] = trail[1];\n        drawCtx.lineTo(x, y);\n      } else {\n        for (let i = 1; i < effectiveTrailLength - 1; i += 1) {\n          const [t, x, y] = trail[i];\n          const [nt, nx, ny] = trail[i + 1];\n          const xc = (x + nx) / 2;\n          const yc = (y + ny) / 2;\n\n          if (i === effectiveTrailLength - 2) {\n            drawCtx.quadraticCurveTo(x, y, nx, ny);\n          } else {\n            drawCtx.quadraticCurveTo(x, y, xc, yc);\n          }\n        }\n      }\n\n      drawCtx.stroke();\n\n      const [t2, x2, y2] = trail[1];\n      drawArrow(drawCtx, startx, starty, x2, y2, false, 30.0);\n\n      const [lastt, lastx, lasty] = trail[effectiveTrailLength - 1];\n      const [secondlastt, secondlastx, secondlasty] = trail[effectiveTrailLength - 2];\n      drawArrow(drawCtx, secondlastx, secondlasty, lastx, lasty, true, 30.0);\n\n      // drawCtx.beginPath();\n\n      // drawCtx.moveTo(468.0, 844.8000000000001);\n      // drawCtx.lineTo(338.4, 806.4);\n      // drawCtx.moveTo(videoE.videoWidth * 0.25, videoE.videoHeight / 2);\n      // drawCtx.lineTo(videoE.videoWidth * 0.75, videoE.videoHeight / 2);\n      // console.log('videoWH', videoE.videoWidth, videoE.videoHeight);\n      // drawCtx.moveTo(0, 0);\n      // drawCtx.lineTo(400, 400);\n      // drawCtx.stroke();\n      drawCtx.restore();\n    }\n\n    watch([videoBaseUrl, drawPoseLandmarks], retieveClearPoseFile);\n    onMounted(retieveClearPoseFile);\n\n    const motionTrailsCurrentTime = computed(() => {\n      const drawingInTime = drawMotionTrailsInTime.value;\n      if (!drawingInTime) return 0;\n      return currentTime.value;\n    });\n\n    watch([canvasModified, currentPose, drawPoseLandmarks, motionTrails, motionTrailsCurrentTime], () => {\n      canvasModified.value = false;\n      clearDrawing();\n\n      if (drawPoseLandmarks.value) {\n        drawPose(currentPose.value as any);\n      }\n\n      if (motionTrails && motionTrails.value) {\n        for (let i = 0; i < motionTrails.value.length; i += 1) {\n          const trail = motionTrails.value[i];\n          drawMotionTrail(trail as any, motionTrailsCurrentTime.value, 'black', 9.0);\n        }\n        for (let i = 0; i < motionTrails.value.length; i += 1) {\n          const trail = motionTrails.value[i];\n          const color = motionTrailColors[i % motionTrailColors.length];\n          drawMotionTrail(trail as any, motionTrailsCurrentTime.value, color, 6.0);\n        }\n      }\n    });\n\n    let resizeTimerId = -1;\n    onMounted(() => {\n      resizeTimerId = window.setInterval(resizeCanvas, 500);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(resizeTimerId);\n    });\n\n    return {\n      videoUrl,\n      resizeCanvas,\n      videoElement,\n      canvasElement,\n      playVideo,\n      pauseVideo,\n      endTime,\n      scheduleCanvasResizing,\n      poses,\n      currentTime,\n      currentPose,\n      currentFrame,\n      endReported,\n      onTimeUpdated,\n      motionTrailsCurrentTime,\n\n      getVideoDimensions: () => ({\n        height: videoElement.value?.height ?? 0,\n        width: videoElement.value?.width ?? 0,\n      }),\n    };\n  },\n  methods: {\n    setTime(time: number, keepPlaying?: boolean | undefined) {\n      const videoE = this.videoElement;\n      if (videoE) {\n        videoE.currentTime = time;\n      }\n      const pauseVideo = !(keepPlaying ?? false);\n      if (videoE && pauseVideo) videoE.pause();\n    },\n    getVideoTime() {\n      return this.videoElement?.currentTime ?? 0;\n    },\n  },\n});\n","import { render } from \"./VideoPlayer.vue?vue&type=template&id=d3c5c3ee\"\nimport script from \"./VideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./VideoPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./VideoPlayer.vue?vue&type=style&index=0&id=d3c5c3ee&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  computed, defineComponent, onBeforeUnmount, ref,\n} from 'vue';\nimport Constants from '@/services/Constants';\nimport { PauseInfo } from '@/model/MiniLesson';\nimport VideoPlayer from './VideoPlayer.vue';\n\nconst DEFAULT_PAUSE_DURATION = Constants.DefaultPauseDuration;\n\ntype PlaySegment = {\n  from: number;\n  to: number;\n  speed: number;\n  pause: PauseInfo | null;\n}\nfunction computePlaySegments(from: number, to: number, speed: number, pauses: PauseInfo[]) {\n  const segs: PlaySegment[] = [];\n\n  function nextPauseIndex(prevIndex: number): number {\n    const pTime = Math.max((pauses[prevIndex]?.time ?? 0), from);\n    let pauseIndex = prevIndex + 1;\n    for (; pauseIndex < pauses.length; pauseIndex += 1) {\n      const pi = pauses[pauseIndex];\n      if (pi.time > pTime) break;\n    }\n    return pauseIndex;\n  }\n\n  let segStartTime = from;\n  let pauseIndex = nextPauseIndex(-1);\n  while (pauseIndex < pauses.length) {\n    segs.push({\n      from: segStartTime,\n      to: pauses[pauseIndex].time,\n      speed,\n      pause: pauses[pauseIndex],\n    });\n    segStartTime = pauses[pauseIndex].time;\n    pauseIndex = nextPauseIndex(pauseIndex);\n  }\n  segs.push({\n    from: segStartTime,\n    to,\n    speed,\n    pause: null,\n  });\n\n  return segs;\n}\n\nexport default defineComponent({\n  name: 'PausingVideoPlayer',\n  components: { VideoPlayer },\n  props: {\n    motionTrails: {\n      type: Array,\n      default: Array,\n    },\n    drawMotionTrailsInTime: {\n      type: Boolean,\n      default: false,\n    },\n    videoSrc: {\n      default: '',\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: (canvasCtx: CanvasRenderingContext2D) => {\n        if (!canvasCtx) return;\n\n        /* eslint-disable no-param-reassign */\n        canvasCtx.strokeStyle = 'rgba(250, 200, 250, 0.95)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n        /* eslint-enable no-param-reassign */\n      },\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    showControls: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['playback-completed', 'progress', 'pause-hit', 'pause-end'],\n  setup(props, { emit }) {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n\n    let playTimeoutId = undefined as undefined | number;\n\n    function setTime(time: number) {\n      const vidPlayer = videoPlayer.value;\n      clearTimeout(playTimeoutId);\n      if (vidPlayer) vidPlayer.setTime(time);\n      emit('progress', time);\n    }\n\n    function onProgress(time: number) {\n      emit('progress', time);\n    }\n\n    function playSegment(seg: PlaySegment, delaySecs: number, emitResume?: boolean, onPlayStart?: () => void) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n\n      clearTimeout(playTimeoutId);\n      playTimeoutId = window.setTimeout(() => {\n        if (emitResume ?? false) {\n          emit('pause-end');\n        }\n        vidPlayer.playVideo(seg.from, seg.to, seg.speed);\n        if (onPlayStart) onPlayStart();\n      }, 1000 * delaySecs);\n    }\n    onBeforeUnmount(() => {\n      clearTimeout(playTimeoutId);\n    });\n\n    let playingSegments: PlaySegment[] = [];\n    let playingSegmentIndex = 0;\n\n    function play(\n      from: number,\n      to: number,\n      speed: number,\n      pauses: Array<PauseInfo>,\n      playDelaySecs: number,\n      onPlayStart?: () => void,\n    ) {\n      clearTimeout(playTimeoutId);\n      setTime(from);\n      playingSegments = computePlaySegments(from, to, speed, pauses);\n      playingSegmentIndex = 0;\n\n      playSegment(playingSegments[playingSegmentIndex], playDelaySecs, false, onPlayStart);\n    }\n    function onSegmentPlaybackCompleted() {\n      const { pause, to } = playingSegments[playingSegmentIndex];\n      playingSegmentIndex += 1;\n      if (playingSegmentIndex >= playingSegments.length) {\n        setTime(to);\n        emit('playback-completed');\n        return;\n      }\n\n      if (!pause) throw new Error('Expected there to be a pause obj');\n      const nextSeg = playingSegments[playingSegmentIndex];\n\n      emit('pause-hit', pause);\n      const manualResume = pause.manualResume ?? false;\n      if (!manualResume) {\n        playSegment(nextSeg, pause.pauseDuration ?? DEFAULT_PAUSE_DURATION, true);\n      }\n    }\n\n    const currentPose = computed(() => videoPlayer.value?.currentPose ?? null);\n\n    return {\n      videoPlayer,\n      setTime,\n      onProgress,\n      onSegmentPlaybackCompleted,\n      play,\n      currentPose,\n    };\n  },\n  methods: {\n    getVideoDimensions() {\n      return (this.$refs.videoPlayer as typeof VideoPlayer)?.getVideoDimensions();\n    },\n    getVideoTime(): number {\n      return (this.videoPlayer as any)?.getVideoTime() ?? 0;\n    },\n  },\n});\n","import { render } from \"./PausingVideoPlayer.vue?vue&type=template&id=36af1820\"\nimport script from \"./PausingVideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./PausingVideoPlayer.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"keyframe-timeline-container\">\n    <div class=\"timeline\">\n      <!-- {{dbEntry.title}} -->\n\n      <!-- <span class=\"item\">\n        <VideoPlayer :videoBaseUrl=\"dbEntry?.videoSrc + '#t=' + currentKeyframe\"\n          :videoOpacity=\"drawMode === 'video' ? 1.0 : 0\"\n          :setDrawStyle=\"setKFSkeletonDrawStyle\"\n          :fps=\"dbEntry.fps\"\n          :drawPoseLandmarks=\"drawMode === 'skeleton'\"/>\n      </span> -->\n      <span\n        class=\"item\"\n        v-for=\"(kfitem) in allKeyframes\"\n        :key=\"kfitem.kf\"\n        :style=\"{\n          'left': 'calc(-14rem + ' + 100 * kfitem.left + '%)',\n          'opacity': kfitem.opacity,\n          'width': '14rem',\n        }\">\n        <VideoPlayer\n          :videoBaseUrl=\"dbEntry?.videoSrc + '#t=' + kfitem.kf\"\n          :fps=\"dbEntry.fps\"\n          :drawPoseLandmarks=\"drawMode === 'skeleton'\"\n          :videoOpacity=\"drawMode === 'video' ? 1.0 : 0\"\n          :setDrawStyle=\"setKFSkeletonDrawStyle\"\n        />\n        <p v-if=\"showTimestamps\" class=\"has-text-centered\">\n          <span class=\"tag\">{{kfitem.kf.toFixed(2)}}s</span>\n        </p>\n        </span>\n      <!-- <span\n        class=\"item\"\n        v-for=\"(kfitem, i) in farFutureKeyframes\"\n        :key=\"i\"\n        :style=\"{\n          'right': (i*10) + 'px',\n          'z-index': -i,\n        }\"\n        >{{farFutureKeyframes.length}}</span> -->\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed,\n  defineComponent, Ref, toRefs,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'KeyframeTimeline',\n  components: {\n    VideoPlayer,\n  },\n  props: {\n    drawMode: {\n      type: String,\n      default: 'skeleton',\n    },\n    timelineActiveItemsLimit: {\n      type: Number,\n      default: 1,\n    },\n    dbEntry: {\n      type: Object,\n      required: true,\n    },\n    keyframes: {\n      type: Array,\n      default: () => [],\n    },\n    currentTime: {\n      type: Number,\n      default: 0,\n    },\n    maxActiveTimelineSecs: {\n      type: Number,\n      default: 2.5,\n    },\n    showTimestamps: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  setup(props) {\n    const minStackItems = 3;\n    const {\n      keyframes, currentTime, maxActiveTimelineSecs, timelineActiveItemsLimit,\n    } = toRefs(props);\n\n    const keyframesTyped = keyframes as Ref<number[]>;\n\n    const currentKeyframe = computed(() => keyframesTyped.value.find((kf, index) => (\n      kf < currentTime.value\n      && (keyframesTyped.value[index + 1] === undefined || keyframesTyped.value[index + 1] >= currentTime.value)\n    )) ?? null);\n\n    const futureKeyframes = computed(() => keyframesTyped.value\n      .map((kf) => ({\n        timeRemaining: kf - currentTime.value,\n        kf,\n      }))\n      .filter((item) => item.timeRemaining > 0));\n\n    const separatedKeyframes = computed(() => {\n      let separationIndex = futureKeyframes.value.findIndex(\n        (kf, i) => i >= timelineActiveItemsLimit.value || kf.timeRemaining > maxActiveTimelineSecs.value,\n      );\n      separationIndex = separationIndex === -1 ? futureKeyframes.value.length : separationIndex;\n      const active = futureKeyframes.value.slice(0, separationIndex);\n      const future = futureKeyframes.value.slice(separationIndex, separationIndex + minStackItems);\n\n      let timelineTime = maxActiveTimelineSecs.value;\n      if (timelineActiveItemsLimit.value === 1 && active.length > 0) {\n        const lastKfTime = currentKeyframe.value ?? 0;\n        const nextKfTime = active[0].kf;\n        const timeTONextKf = nextKfTime - lastKfTime;\n        timelineTime = Math.min(timelineTime, timeTONextKf);\n      }\n      const lastScrollingKf = active[active.length - 1]?.kf;\n\n      return {\n        separationIndex,\n        activeKeyframes: active.map((kfitem) => ({\n          ...kfitem,\n          left: kfitem.timeRemaining / timelineTime,\n          opacity: 1,\n        })),\n        stackTimeline: future.map((kfitem, i) => ({\n          ...kfitem,\n          left: 1.0,\n          // eslint-disable-next-line no-nested-ternary\n          opacity: i > 0 ? 0\n            : (lastScrollingKf\n              ? (kfitem.kf - lastScrollingKf) / 1.5\n              : 1),\n        })),\n      };\n    });\n\n    const allKeyframes = computed(\n      () => {\n        const current = [];\n        if (currentKeyframe.value !== null) {\n          current.push({\n            kf: currentKeyframe.value,\n            timeRemaining: 0,\n            opacity: 1,\n            left: 0,\n          });\n        }\n        const timeline = separatedKeyframes.value.activeKeyframes;\n        timeline.reverse();\n\n        const stack = separatedKeyframes.value.stackTimeline;\n        stack.reverse();\n\n        return [...stack, ...current, ...timeline];\n      },\n    );\n\n    return {\n      currentKeyframe,\n      allKeyframes,\n      separatedKeyframes,\n      futureKeyframes,\n      // currentKeyframe,\n      // futureKeyframes,\n      // activeKeyframes,\n      // stackTimeline,\n\n      setKFSkeletonDrawStyle: (canvasCtx: CanvasRenderingContext2D) => {\n        canvasCtx.strokeStyle = 'rgba(100, 250, 250, 1)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n      },\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.keyframe-timeline-container {\n  position: relative;\n  // height: 50%;\n  // margin-top: 25%;\n  width: 100%;\n\n  .timeline {\n    // padding-top: 25%;\n    height: 14rem;\n    margin-left: 14rem;\n    // background: gray;\n    position: relative;\n\n    .item {\n      display: block;\n      // background: lightgray;\n      position: absolute;\n      height: 100%;\n      min-width: 1rem;\n      border-radius: 0.25rem;\n      border: 1px sold lightgray;\n    }\n\n    .placeholder {\n      display: block;\n      position: absolute;\n      height: 100%;\n      min-width: 1rem;\n      border-radius: 0.25rem;\n      border: 1px solid gray;\n    }\n  }\n}\n</style>\n","\n\nimport {\n  computed,\n  defineComponent, Ref, toRefs,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'KeyframeTimeline',\n  components: {\n    VideoPlayer,\n  },\n  props: {\n    drawMode: {\n      type: String,\n      default: 'skeleton',\n    },\n    timelineActiveItemsLimit: {\n      type: Number,\n      default: 1,\n    },\n    dbEntry: {\n      type: Object,\n      required: true,\n    },\n    keyframes: {\n      type: Array,\n      default: () => [],\n    },\n    currentTime: {\n      type: Number,\n      default: 0,\n    },\n    maxActiveTimelineSecs: {\n      type: Number,\n      default: 2.5,\n    },\n    showTimestamps: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  setup(props) {\n    const minStackItems = 3;\n    const {\n      keyframes, currentTime, maxActiveTimelineSecs, timelineActiveItemsLimit,\n    } = toRefs(props);\n\n    const keyframesTyped = keyframes as Ref<number[]>;\n\n    const currentKeyframe = computed(() => keyframesTyped.value.find((kf, index) => (\n      kf < currentTime.value\n      && (keyframesTyped.value[index + 1] === undefined || keyframesTyped.value[index + 1] >= currentTime.value)\n    )) ?? null);\n\n    const futureKeyframes = computed(() => keyframesTyped.value\n      .map((kf) => ({\n        timeRemaining: kf - currentTime.value,\n        kf,\n      }))\n      .filter((item) => item.timeRemaining > 0));\n\n    const separatedKeyframes = computed(() => {\n      let separationIndex = futureKeyframes.value.findIndex(\n        (kf, i) => i >= timelineActiveItemsLimit.value || kf.timeRemaining > maxActiveTimelineSecs.value,\n      );\n      separationIndex = separationIndex === -1 ? futureKeyframes.value.length : separationIndex;\n      const active = futureKeyframes.value.slice(0, separationIndex);\n      const future = futureKeyframes.value.slice(separationIndex, separationIndex + minStackItems);\n\n      let timelineTime = maxActiveTimelineSecs.value;\n      if (timelineActiveItemsLimit.value === 1 && active.length > 0) {\n        const lastKfTime = currentKeyframe.value ?? 0;\n        const nextKfTime = active[0].kf;\n        const timeTONextKf = nextKfTime - lastKfTime;\n        timelineTime = Math.min(timelineTime, timeTONextKf);\n      }\n      const lastScrollingKf = active[active.length - 1]?.kf;\n\n      return {\n        separationIndex,\n        activeKeyframes: active.map((kfitem) => ({\n          ...kfitem,\n          left: kfitem.timeRemaining / timelineTime,\n          opacity: 1,\n        })),\n        stackTimeline: future.map((kfitem, i) => ({\n          ...kfitem,\n          left: 1.0,\n          // eslint-disable-next-line no-nested-ternary\n          opacity: i > 0 ? 0\n            : (lastScrollingKf\n              ? (kfitem.kf - lastScrollingKf) / 1.5\n              : 1),\n        })),\n      };\n    });\n\n    const allKeyframes = computed(\n      () => {\n        const current = [];\n        if (currentKeyframe.value !== null) {\n          current.push({\n            kf: currentKeyframe.value,\n            timeRemaining: 0,\n            opacity: 1,\n            left: 0,\n          });\n        }\n        const timeline = separatedKeyframes.value.activeKeyframes;\n        timeline.reverse();\n\n        const stack = separatedKeyframes.value.stackTimeline;\n        stack.reverse();\n\n        return [...stack, ...current, ...timeline];\n      },\n    );\n\n    return {\n      currentKeyframe,\n      allKeyframes,\n      separatedKeyframes,\n      futureKeyframes,\n      // currentKeyframe,\n      // futureKeyframes,\n      // activeKeyframes,\n      // stackTimeline,\n\n      setKFSkeletonDrawStyle: (canvasCtx: CanvasRenderingContext2D) => {\n        canvasCtx.strokeStyle = 'rgba(100, 250, 250, 1)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n      },\n    };\n  },\n});\n","import { render } from \"./KeyframeTimeline.vue?vue&type=template&id=1326a96d\"\nimport script from \"./KeyframeTimeline.vue?vue&type=script&lang=ts\"\nexport * from \"./KeyframeTimeline.vue?vue&type=script&lang=ts\"\n\nimport \"./KeyframeTimeline.vue?vue&type=style&index=0&id=1326a96d&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"webcam-box-container\">\n    <video\n      v-show=\"webcamStatus === 'running'\"\n      ref=\"videoE\" muted disablePictureInPicture\n      :style=\"{\n        'max-width': '100%',\n      }\"\n    ></video>\n    <div v-if=\"webcamStatus !== 'running' && showStartWebcamButton\" class=\"has-border-grey-lighter m-4\">\n\n      <WebcamSourceSelectionMenu\n        v-model:audioDeviceId=\"audioDeviceId\"\n        v-model:videoDeviceId=\"videoDeviceId\"\n        @startWebcamClicked=\"selfStartWebcam\"/>\n      <!-- <div class=\"vcenter-parent\">\n        <div class=\"notification\" v-if=\"this.webcamStartError !== null\">\n          {{this.webcamStartError}}\n        </div>\n        <button\n          v-if=\"showStartWebcamButton\"\n          @click=\"startWebcam\"\n          class=\"button is-primary\"\n          v-show=\"webcamStatus !== 'running'\"\n          :class=\"{'is-loading': webcamStatus==='loading'}\">\n          Start Webcam\n        </button>\n      </div> -->\n\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, ref, watch,\n} from 'vue';\n\nimport webcamProvider from '@/services/WebcamProvider';\nimport WebcamSourceSelectionMenu from '@/components/elements/WebcamSourceSelectionMenu.vue';\n\nexport default defineComponent({\n  name: 'WebcamBox',\n  components: {\n    WebcamSourceSelectionMenu,\n  },\n  props: {\n    showStartWebcamButton: {\n      type: Boolean,\n      default: true,\n    },\n    maxHeight: {\n      type: String,\n    },\n  },\n  setup() {\n    const videoE = ref(null as null | HTMLVideoElement);\n    const webcamStartError = ref(null as null | any);\n\n    onMounted(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      if (webcamProvider.webcamStatus.value === 'running') {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    watch(webcamProvider.webcamStatus, (status) => {\n      if (status === 'running' && videoE.value) {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    onBeforeUnmount(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      webcamProvider.disconnectVideoElement(videoE.value);\n    });\n\n    return {\n      videoE,\n      webcamStartError,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n\n      audioDeviceId: ref(''),\n      videoDeviceId: ref(''),\n    };\n  },\n  computed: {\n    webcamStarted() {\n      return (this as any).webcamStatus === 'stopped';\n    },\n  },\n  methods: {\n    async selfStartWebcam() {\n      await this.startWebcam(this.videoDeviceId, this.audioDeviceId);\n    },\n    async startWebcam(videoDeviceId: string, audioDeviceId: string) {\n      this.webcamStartError = null;\n\n      try {\n        await webcamProvider.startWebcam(videoDeviceId, audioDeviceId);\n      } catch (e) {\n        this.webcamStartError = e;\n        return e;\n      }\n\n      if (!this.videoE) throw new Error('videoE is null');\n      await webcamProvider.connectVideoElement(this.videoE);\n\n      return false;\n    },\n    playVideo() {\n      if (!this.videoE) throw new Error('videoE is null');\n      this.videoE.play();\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.webcam-box-container {\n\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: center;\n  align-items: center;\n\n  // max-width: 100%;\n\n  video {\n    background: rgba(128, 128, 128, 0.2);\n    flex: 1 1 auto;\n    max-height: 100%;\n    // width: 1280px;\n    // height: 720px;\n    // max-height: 100%;\n    // max-width: 100%;\n\n    transform: scaleX(-1);\n  }\n}\n</style>\n","export interface Event {\n  timestamp: Date;\n  desc: string;\n}\n\nexport class EventLogger {\n\n  public readonly logEntries = new Array<Event>();\n\n  public log(logString: string) {\n    const time = new Date();\n    this.logEntries.push({\n      timestamp: time,\n      desc: logString,\n    });\n\n    console.log(`EVENT ${time.toISOString()}: ${logString}`);\n  }\n\n  public retrieveLog() {\n    const logFile = this.logEntries.map((entry) => `${entry.timestamp.toISOString()}: ${entry.desc}`).join('\\n');\n    return logFile;\n  }\n}\n\nconst eventLogger = new EventLogger();\nexport default eventLogger;\n","import RecordRTC, { invokeSaveAsDialog } from 'recordrtc';\nimport {\n  computed, ref, Ref,\n} from 'vue';\n\nimport eventLogger from '@/services/EventLogger';\n\nexport const WEBCAM_DIMENSIONS = Object.freeze({\n  width: 640,\n  height: 480,\n});\n\nexport class WebcamProvider {\n\n  // Recorder class\n  private readonly ongoingRecordings = new Map<string, RecordRTC>();\n\n  private readonly cachedRecordings = new Map<string, RecordRTC>();\n\n  // The actual media stream\n  private mediaStream = ref(null as null | MediaStream);\n\n  // List of active connections. Used so we know when to pause the webcam\n  private activeConnections: Set<HTMLVideoElement> = new Set();\n\n  private permissionState: Ref<PermissionState> = ref('prompt');\n\n  private isWebcamLoading = ref(false);\n\n  public webcamError = ref(null as any);\n\n  public cachedVideoDeviceId: string | undefined = undefined;\n\n  public cachedAudioDeviceId: string | undefined = undefined;\n\n  constructor() {\n    this.readPermissionStatus();\n  }\n\n  private async readPermissionStatus(): Promise<void> {\n    if (navigator.permissions) {\n      try {\n\n        const result = await navigator.permissions.query({ name: 'camera' as any });\n        this.permissionState.value = result.state;\n\n        // eslint-disable-next-line no-empty\n      } catch { }\n    }\n  }\n\n  public permissionStatus(): Ref<PermissionState> {\n    return this.permissionState;\n  }\n\n  public async startWebcam(videoDeviceId?: string, audioDeviceId?: string): Promise<void> {\n    if (this.mediaStream.value || this.isWebcamLoading.value) {\n      return;\n    }\n    this.isWebcamLoading.value = true;\n\n    const audioDevice = audioDeviceId ?? this.cachedAudioDeviceId;\n    const videoDevice = videoDeviceId ?? this.cachedVideoDeviceId;\n\n    try {\n      const constraints: MediaStreamConstraints = {\n        video: {\n          // facingMode: 'user',\n          width: WEBCAM_DIMENSIONS.width,\n          height: WEBCAM_DIMENSIONS.height,\n          aspectRatio: 1.777777778,\n          frameRate: 30,\n          deviceId: videoDevice,\n        },\n        audio: {\n          deviceId: audioDevice,\n        },\n      };\n\n      if (!navigator.mediaDevices?.getUserMedia) throw new Error(\"Browser doesn't support webcam\");\n\n      this.mediaStream.value = await navigator.mediaDevices.getUserMedia(constraints);\n\n      this.cachedVideoDeviceId = videoDevice;\n      this.cachedAudioDeviceId = audioDevice;\n\n      this.permissionState.value = 'granted';\n\n      eventLogger.log('Started webcam');\n    } finally {\n      this.isWebcamLoading.value = false;\n    }\n  }\n\n  public webcamStatus = computed(() => {\n    if (this.mediaStream.value) return 'running';\n    if (this.isWebcamLoading.value) return 'loading';\n    return 'stopped';\n  });\n\n  public async connectVideoElement(videoE: HTMLVideoElement): Promise<void> {\n\n    if (this.permissionState.value !== 'granted') throw new Error(\"Doesn't have permissions yet!\");\n\n    this.activeConnections.add(videoE);\n\n    // eslint-disable-next-line no-param-reassign\n    console.log('Connecting media stream to video');\n    videoE.srcObject = this.mediaStream.value;\n    videoE.onloadedmetadata = () => {\n      videoE.play();\n      console.log('Connected media stream to video');\n    };\n  }\n\n  public disconnectVideoElement(videoE: HTMLVideoElement): void {\n    this.activeConnections.delete(videoE);\n\n    videoE.srcObject = null;\n\n    if (this.activeConnections.size === 0 && this.ongoingRecordings.size === 0) {\n      this.stopWebcam();\n    }\n  }\n\n  public async stopWebcam(): Promise<void> {\n\n    // eslint-disable-next-line no-restricted-syntax\n    for (const recorderId of this.ongoingRecordings.keys()) {\n      try {\n        // eslint-disable-next-line no-await-in-loop\n        await this.abortRecording(recorderId);\n        // eslint-disable-next-line no-empty\n      } catch { }\n    }\n\n    if (this.mediaStream.value) {\n      this.mediaStream.value.getTracks().forEach((x) => x.stop());\n    }\n    this.mediaStream.value = null;\n\n    eventLogger.log('Stopped webcam');\n  }\n\n  public async startRecording(recordingId: string): Promise<void> {\n\n    if (!this.mediaStream.value) {\n      throw new Error('Webcam must be started before recording can happen');\n    }\n    if (this.ongoingRecordings.has(recordingId)) {\n      console.warn(`Recording ${recordingId} already in progress`);\n    }\n\n    const rtc = new RecordRTC(this.mediaStream.value, {\n      type: 'video',\n    });\n    rtc.startRecording();\n\n    this.ongoingRecordings.set(recordingId, rtc);\n\n    eventLogger.log(`Starting recording '${recordingId}'`);\n\n    console.log(`WebcamProvider :: starting recording with id ${recordingId}`);\n  }\n\n  public async abortRecording(recordingId: string): Promise<void> {\n    const recorder = this.ongoingRecordings.get(recordingId);\n    return new Promise((res) => {\n      const end = () => {\n        this.ongoingRecordings.delete(recordingId);\n        res();\n      };\n\n      if (!recorder) {\n        end();\n        return;\n      }\n\n      recorder.stopRecording(() => {\n        console.log(`WebcamProvider :: aborting recording with id ${recordingId}`);\n        end();\n      });\n    });\n  }\n\n  public async stopRecording(recordingId: string): Promise<void> {\n\n    if (!this.ongoingRecordings.has(recordingId)) {\n      // console.warn(`WebcamProvider:: stopRecording -- Not currently recording for id ${recordingId}`);\n      return Promise.resolve();\n    }\n\n    return new Promise((res) => {\n      const recorder = this.ongoingRecordings.get(recordingId) as RecordRTC;\n      recorder.stopRecording(() => {\n        this.ongoingRecordings.delete(recordingId);\n        this.cachedRecordings.set(recordingId, recorder);\n        console.log(`WebcamProvider :: stopping recording with id ${recordingId}`);\n        eventLogger.log(`Stopped recording '${recordingId}'`);\n        res();\n      });\n    });\n  }\n\n  public isRecording(recordingId: string): boolean {\n    return this.ongoingRecordings.has(recordingId);\n  }\n\n  public async getBlob(recordingId: string): Promise<Blob> {\n    const recorder = this.cachedRecordings.get(recordingId);\n    if (!recorder) throw new Error(`No saved recording with id: ${recordingId}`);\n    return recorder.getBlob();\n  }\n\n  public async clearRecording(recordingId: string) {\n    this.cachedRecordings.delete(recordingId);\n  }\n\n  public getAllRecordings(): string[] {\n    return [...this.cachedRecordings.keys()];\n  }\n\n  // public async postFiles(url: string, filename: string): Promise<void> {\n  //   if (!this.recorder) throw new Error('Nothing to post');\n\n  //   const blob = this.recorder.getBlob();\n  //   invokeSaveAsDialog(blob, filename);\n\n  //   const fname = `${filename}.webm`;\n\n  //   const file = new File([blob], fname, {\n  //     type: 'video/webm',\n  //   });\n\n  // videoElement.src = '';\n  // videoElement.srcObject = null;\n\n  // if (mediaStream) { mediaStream.stop(); }\n  // }\n}\n\nexport const saveBlob = invokeSaveAsDialog;\n\nconst defaultProvider = new WebcamProvider();\n\nexport default defaultProvider;\n","<template>\n  <div>\n    <h1 class=\"title\">Webcam Access</h1>\n    <div v-if=\"state === 'unloaded'\" class=\"mt-4\" style=\"max-width:60ch\">\n      <p class=\"block mt-4\">This part of the app uses the webcam, which we need your permission to access.</p>\n      <button class=\"block button is-primary\" @click=\"loadDevices\">Grant Permission</button>\n      <div class=\"block notification is-warning\" v-if=\"error !== null\">\n        <p class=\"block\"><strong>Error:</strong> <span class=\"is-family-monospace\">{{error}}</span></p>\n        <p class=\"block\">Check that your webcam is connected, no other application is using your webcam, and that you have granted permission in your browser.</p>\n      </div>\n    </div>\n    <div class=\"menu block\" v-else>\n      <p class=\"menu-label\">Video Devices</p>\n      <ul class=\"menu-list\">\n        <li v-for=\"device in videoDevices\" :key=\"device.deviceId\">\n          <a @click=\"selectVideoDevice(device.deviceId)\"\n             :class=\"{'is-active': videoDeviceId === device.deviceId}\"\n          >\n            {{device.label}}\n          </a>\n        </li>\n        <li v-if=\"state === 'loaded' && videoDevices.length === 0\">No devices available.</li>\n        <li v-if=\"state === 'loading'\">Loading...</li>\n      </ul>\n      <p class=\"menu-label\">Audio Devices</p>\n      <ul class=\"menu-list\">\n        <li v-for=\"device in audioDevices\" :key=\"device.deviceId\">\n          <a @click=\"selectAudioDevice(device.deviceId)\"\n             :class=\"{'is-active': audioDeviceId === device.deviceId}\"\n          >\n            {{device.label}}\n          </a>\n        </li>\n        <li v-if=\"state === 'loaded' && videoDevices.length === 0\">No devices available.</li>\n        <li v-if=\"state === 'loading'\">Loading...</li>\n      </ul>\n    </div>\n    <div v-if=\"state === 'loaded'\" class=\"block \">\n      <button class=\"button is-primary\" @click=\"$emit('startWebcamClicked')\">Start Webcam</button>\n      <p class=\"notification mt-4\">\n      <span class=\"icon\"><i class=\"fas fa-info-circle\"></i></span> Click &quot;Start Webcam&quot; when you&rsquo;re ready.\n    </p>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, onMounted, ref } from 'vue';\n\nexport default defineComponent({\n  name: 'WebcamSourceSelectionMenu',\n  props: ['videoDeviceId', 'audioDeviceId'],\n  emits: ['update:videoDeviceId', 'update:audioDeviceId', 'startWebcamClicked'],\n  setup(props, { emit }) {\n    const videoDevices = ref([] as MediaDeviceInfo[]);\n    const audioDevices = ref([] as MediaDeviceInfo[]);\n    const state = ref('unloaded' as 'unloaded' | 'loading' | 'loaded');\n    const error = ref(null as any | null);\n\n    const selectVideoDevice = (id: string) => {\n      emit('update:videoDeviceId', id);\n    };\n    const selectAudioDevice = (id: string) => {\n      emit('update:audioDeviceId', id);\n    };\n\n    const loadDevices = async () => {\n      try {\n        error.value = null;\n        await navigator.mediaDevices.getUserMedia({ audio: true, video: true });\n\n        const devices = await navigator.mediaDevices.enumerateDevices();\n        videoDevices.value = devices.filter((device) => device.kind === 'videoinput');\n        audioDevices.value = devices.filter((device) => device.kind === 'audioinput');\n\n        // Autoselect the first devices\n        if (videoDevices.value.length > 0) {\n          selectVideoDevice(videoDevices.value[0].deviceId);\n        }\n        if (audioDevices.value.length > 0) {\n          selectAudioDevice(audioDevices.value[0].deviceId);\n        }\n\n        state.value = 'loaded';\n      } catch (e) {\n        state.value = 'unloaded';\n        error.value = e;\n      }\n    };\n\n    return {\n      state,\n      error,\n      videoDevices,\n      audioDevices,\n      loadDevices,\n      selectVideoDevice,\n      selectAudioDevice,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n</style>\n","\nimport { defineComponent, onMounted, ref } from 'vue';\n\nexport default defineComponent({\n  name: 'WebcamSourceSelectionMenu',\n  props: ['videoDeviceId', 'audioDeviceId'],\n  emits: ['update:videoDeviceId', 'update:audioDeviceId', 'startWebcamClicked'],\n  setup(props, { emit }) {\n    const videoDevices = ref([] as MediaDeviceInfo[]);\n    const audioDevices = ref([] as MediaDeviceInfo[]);\n    const state = ref('unloaded' as 'unloaded' | 'loading' | 'loaded');\n    const error = ref(null as any | null);\n\n    const selectVideoDevice = (id: string) => {\n      emit('update:videoDeviceId', id);\n    };\n    const selectAudioDevice = (id: string) => {\n      emit('update:audioDeviceId', id);\n    };\n\n    const loadDevices = async () => {\n      try {\n        error.value = null;\n        await navigator.mediaDevices.getUserMedia({ audio: true, video: true });\n\n        const devices = await navigator.mediaDevices.enumerateDevices();\n        videoDevices.value = devices.filter((device) => device.kind === 'videoinput');\n        audioDevices.value = devices.filter((device) => device.kind === 'audioinput');\n\n        // Autoselect the first devices\n        if (videoDevices.value.length > 0) {\n          selectVideoDevice(videoDevices.value[0].deviceId);\n        }\n        if (audioDevices.value.length > 0) {\n          selectAudioDevice(audioDevices.value[0].deviceId);\n        }\n\n        state.value = 'loaded';\n      } catch (e) {\n        state.value = 'unloaded';\n        error.value = e;\n      }\n    };\n\n    return {\n      state,\n      error,\n      videoDevices,\n      audioDevices,\n      loadDevices,\n      selectVideoDevice,\n      selectAudioDevice,\n    };\n  },\n});\n","import { render } from \"./WebcamSourceSelectionMenu.vue?vue&type=template&id=07fa7303\"\nimport script from \"./WebcamSourceSelectionMenu.vue?vue&type=script&lang=ts\"\nexport * from \"./WebcamSourceSelectionMenu.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, ref, watch,\n} from 'vue';\n\nimport webcamProvider from '@/services/WebcamProvider';\nimport WebcamSourceSelectionMenu from '@/components/elements/WebcamSourceSelectionMenu.vue';\n\nexport default defineComponent({\n  name: 'WebcamBox',\n  components: {\n    WebcamSourceSelectionMenu,\n  },\n  props: {\n    showStartWebcamButton: {\n      type: Boolean,\n      default: true,\n    },\n    maxHeight: {\n      type: String,\n    },\n  },\n  setup() {\n    const videoE = ref(null as null | HTMLVideoElement);\n    const webcamStartError = ref(null as null | any);\n\n    onMounted(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      if (webcamProvider.webcamStatus.value === 'running') {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    watch(webcamProvider.webcamStatus, (status) => {\n      if (status === 'running' && videoE.value) {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    onBeforeUnmount(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      webcamProvider.disconnectVideoElement(videoE.value);\n    });\n\n    return {\n      videoE,\n      webcamStartError,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n\n      audioDeviceId: ref(''),\n      videoDeviceId: ref(''),\n    };\n  },\n  computed: {\n    webcamStarted() {\n      return (this as any).webcamStatus === 'stopped';\n    },\n  },\n  methods: {\n    async selfStartWebcam() {\n      await this.startWebcam(this.videoDeviceId, this.audioDeviceId);\n    },\n    async startWebcam(videoDeviceId: string, audioDeviceId: string) {\n      this.webcamStartError = null;\n\n      try {\n        await webcamProvider.startWebcam(videoDeviceId, audioDeviceId);\n      } catch (e) {\n        this.webcamStartError = e;\n        return e;\n      }\n\n      if (!this.videoE) throw new Error('videoE is null');\n      await webcamProvider.connectVideoElement(this.videoE);\n\n      return false;\n    },\n    playVideo() {\n      if (!this.videoE) throw new Error('videoE is null');\n      this.videoE.play();\n    },\n  },\n});\n","import { render } from \"./WebcamBox.vue?vue&type=template&id=10319176\"\nimport script from \"./WebcamBox.vue?vue&type=script&lang=ts\"\nexport * from \"./WebcamBox.vue?vue&type=script&lang=ts\"\n\nimport \"./WebcamBox.vue?vue&type=style&index=0&id=10319176&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"sheet-motion\">\n    <div\n      class=\"motion-line has-text-centered\"\n      :style=\"{\n        'flex-grow': getPhraseFlexGrow(i),\n      }\"\n      v-for=\"(phase, i) in data.phrases\"\n      :key=\"i\">\n      <!-- <div>{{phrase}}</div> -->\n\n      <div class=\"motion-note\" v-for=\"(kf, j) in phase.frames\" :key=\"kf\"\n      :style=\"{\n        'background': getFrameBackground(i, j),\n        'flex-grow': getFrameFlexGrow(i, j),\n      }\"\n      :ref=\"setNoteRef\"\n      :data-phase=\"i\"\n      :data-frame=\"j\"\n      >\n\n        <VideoPlayer\n          :videoBaseUrl=\"dbEntry?.videoSrc + '#t=' + kf.timestamp\"\n          :fps=\"dbEntry?.fps ?? 30\"\n          :drawPoseLandmarks=\"drawMode === 'skeleton'\"\n          :videoOpacity=\"drawMode === 'video' && kf.type === 'move' ? 1.0 : 0.0\"\n          style=\"margin: 0; display:inline-block;background:lightgray;\"\n          :motionTrails=\"kf.motionTrails\"\n          :setDrawStyle=\"setPoseDrawStyle\"\n          />\n          <!-- {{kf}} -->\n\n        <div class=\"motion-hold\"></div>\n          <!-- <p class=\"tag is-selectable\">{{getFrameBackground(i, j)}}</p> -->\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\nimport { SheetMotion, SheetMotionFrame } from '@/model/MiniLesson';\n\nfunction constrain(val: number, min: number, max: number) {\n  return Math.min(Math.max(val, min), max);\n}\nfunction remap(val: number, min: number, max: number, newMin: number, newMax: number) {\n  return ((val - min) / (max - min)) * (newMax - newMin) + newMin;\n}\n\nexport default defineComponent({\n  name: 'SheetMotion',\n  components: {\n    VideoPlayer,\n  },\n  props: {\n    dbEntry: {\n      type: Object,\n      required: true,\n    },\n    currentTime: {\n      type: Number,\n      default: -1,\n    },\n    drawMode: {\n      type: String,\n      default: 'video',\n    },\n    data: {\n      type: Object,\n      default: () => ({\n        phrases: [],\n        variableLength: false,\n      }),\n    },\n    fadeInDurationSecs: {\n      type: Number,\n      default: 0.5,\n    },\n    fadeOutDurationSecs: {\n      type: Number,\n      default: 0.5,\n    },\n  },\n  data() {\n    return {\n      noteRefs: [] as {el: HTMLElement, phaseI: number, frameJ: number}[],\n    };\n  },\n  computed: {\n    activeNoteElement(): HTMLElement | null {\n      const { currentTime, data } = this;\n      const typedData = data as SheetMotion;\n      if (!typedData?.phrases || !currentTime) {\n        return null;\n      }\n\n      let pFrame = null as null | SheetMotionFrame;\n      let activePhase = -1;\n      let activeFrame = -1;\n\n      for (let i = 0; i < typedData.phrases.length && activeFrame === -1; i++) {\n        const phrase = typedData.phrases[i];\n        for (let j = 0; j < phrase.frames.length; j++) {\n          const frame = phrase.frames[j];\n          if (frame.timestamp > currentTime) {\n            activePhase = i;\n            activeFrame = j - 1;\n            if (activeFrame < 0) {\n              activeFrame = 0;\n              activePhase -= 1;\n            }\n            if (activePhase < 0) {\n              activePhase = 0;\n            }\n            break;\n          }\n          pFrame = frame;\n        }\n      }\n\n      const noteRef = this.noteRefs.find((ref) => ref.phaseI === activePhase && ref.frameJ === activeFrame);\n      if (noteRef) {\n        return noteRef.el;\n      }\n\n      return null;\n    },\n  },\n  watch: {\n    activeNoteElement: {\n      immediate: true,\n      handler(el) {\n        if (el) {\n          el.scrollIntoView({\n            behavior: 'smooth',\n            block: 'center',\n          });\n        }\n      },\n    },\n  },\n  methods: {\n    setNoteRef(el: HTMLElement) {\n      if (!el) return;\n      const { phase, frame } = el.dataset;\n      if ((phase ?? null) === null || (frame ?? null) === null) {\n        return;\n      }\n      const phaseI = parseInt(phase ?? '', 10);\n      const frameJ = parseInt(frame ?? '', 10);\n\n      this.noteRefs.push({\n        el,\n        phaseI,\n        frameJ,\n      });\n    },\n    setPoseDrawStyle(ctx: CanvasRenderingContext2D) {\n      ctx.strokeStyle = '#8080ff';\n      ctx.globalAlpha = 1.0;\n    },\n    isActive(kf: number, nextkf: number) {\n      return this.currentTime >= kf && this.currentTime < nextkf;\n    },\n    getPhraseFlexGrow(phraseIndex: number) {\n      if (!this.data.variableLength) return 0;\n\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) return 0;\n      const nPhrase = this.data.phrases[phraseIndex + 1];\n      if (!nPhrase) return 0;\n\n      const phraseStartTime = phrase.frames[0]?.timestamp ?? Infinity;\n      const nPhraseStartTime = nPhrase.frames[0]?.timestamp ?? Infinity;\n      if (phraseStartTime === Infinity || nPhraseStartTime === Infinity) return 0;\n\n      return nPhraseStartTime - phraseStartTime;\n    },\n    getFrameFlexGrow(phraseIndex: number, kfIndex: number) {\n      if (!this.data.variableLength) return 0;\n\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) {\n        console.warn(`NoteFlexGrow ${phraseIndex}-${kfIndex}: current phrase is undefined`);\n        return 0;\n      }\n      const nPhrase = this.data.phrases[phraseIndex + 1];\n\n      const curFrame = phrase.frames[kfIndex];\n      if (!curFrame) {\n        console.warn(`NoteFlexGrow ${phraseIndex}-${kfIndex}: current kf is undefined`);\n        return 0;\n      }\n      const kf = curFrame.timestamp;\n      let nextKf = phrase.frames[kfIndex + 1]?.timestamp ?? Infinity;\n      if (nextKf === Infinity && nPhrase) {\n        nextKf = nPhrase.frames[0]?.timestamp ?? Infinity;\n      }\n      if (nextKf === Infinity) {\n        // console.log(`NoteFlexGrow ${phraseIndex}-${kfIndex}: next kf is undefined`);\n        return 0;\n      }\n\n      const res = nextKf - kf;\n      if (res < 0) {\n        console.log(`NoteFlexGrow ${phraseIndex}-${kfIndex}: next kf is before this one`);\n        return 0;\n      }\n      return res * 100;\n    },\n    getFrameBackground(phraseIndex: number, kfIndex: number) {\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) return 1.0;\n\n      // const prev = phrase.frames[index - 1] ?? -Infinity;\n      const curr = phrase.frames[kfIndex]?.timestamp ?? -Infinity;\n      let next = phrase.frames[kfIndex + 1]?.timestamp ?? Infinity;\n      if (next === Infinity) {\n        const nPhrase = this.data.phrases[phraseIndex + 1];\n        if (nPhrase) {\n          next = nPhrase.frames[0]?.timestamp ?? Infinity;\n        }\n      }\n\n      // https://gist.github.com/gre/1650294\n\n      if (this.currentTime === -1) return 'none';\n      if (this.currentTime < curr) {\n        const timeUntil = curr - this.currentTime;\n        let fadePercent = constrain(timeUntil / this.fadeInDurationSecs, 0, 1);\n        fadePercent *= (2 - fadePercent);\n        const saturation = remap(fadePercent, 0, 1, 80.0, 0.0);\n        return `hsl(171, ${saturation}%, 90%)`;\n      }\n      if (this.currentTime < next) return 'hsl(171, 100%, 50%)';\n\n      const timePassed = this.currentTime - curr;\n      const fadePercent = constrain(timePassed / this.fadeOutDurationSecs, 0, 1);\n      const brightness = remap(fadePercent, 0, 1, 50.0, 90.0);\n      const saturation = remap(fadePercent, 0, 1, 100.0, 0.0);\n      return `hsl(171, ${saturation}%, ${brightness}%)`;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.sheet-motion {\n  max-height: 100%;\n  overflow-y: auto;\n  display: flex;\n  flex-flow: row wrap;\n\n  .motion-line {\n\n    display: inline-flex;\n    flex-flow: row wrap;\n\n    border-top: 0.125rem solid #333;\n    border-bottom: 0.125rem solid #333;\n    border-right: 0.125rem solid #333;\n    border-left: 0.125rem solid #333;\n    padding: 1rem 1rem;\n    flex-grow: 1;\n\n    .motion-note {\n      // width: 8rem;\n      display: flex;\n      flex-flow: row nowrap;\n      padding: 0.5rem;\n      margin: 0.25rem;\n      border-radius: 0.25rem;\n      height: 24rem;\n      text-align:left;\n      align-items: center;\n\n      transition: background-color 0.1s;\n\n      .motion-hold {\n        display: inline-block;\n        // width: 100%;\n        height: 0.25rem;\n        border-radius: 999999rem;;\n        background: #777;\n        flex-grow: 1;\n        flex-basis: 0;\n      }\n    }\n\n    &:first-child {\n      border-left: 1rem solid #333;\n    }\n\n    &:last-child {\n      border-right: 1rem solid #333;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent } from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\nimport { SheetMotion, SheetMotionFrame } from '@/model/MiniLesson';\n\nfunction constrain(val: number, min: number, max: number) {\n  return Math.min(Math.max(val, min), max);\n}\nfunction remap(val: number, min: number, max: number, newMin: number, newMax: number) {\n  return ((val - min) / (max - min)) * (newMax - newMin) + newMin;\n}\n\nexport default defineComponent({\n  name: 'SheetMotion',\n  components: {\n    VideoPlayer,\n  },\n  props: {\n    dbEntry: {\n      type: Object,\n      required: true,\n    },\n    currentTime: {\n      type: Number,\n      default: -1,\n    },\n    drawMode: {\n      type: String,\n      default: 'video',\n    },\n    data: {\n      type: Object,\n      default: () => ({\n        phrases: [],\n        variableLength: false,\n      }),\n    },\n    fadeInDurationSecs: {\n      type: Number,\n      default: 0.5,\n    },\n    fadeOutDurationSecs: {\n      type: Number,\n      default: 0.5,\n    },\n  },\n  data() {\n    return {\n      noteRefs: [] as {el: HTMLElement, phaseI: number, frameJ: number}[],\n    };\n  },\n  computed: {\n    activeNoteElement(): HTMLElement | null {\n      const { currentTime, data } = this;\n      const typedData = data as SheetMotion;\n      if (!typedData?.phrases || !currentTime) {\n        return null;\n      }\n\n      let pFrame = null as null | SheetMotionFrame;\n      let activePhase = -1;\n      let activeFrame = -1;\n\n      for (let i = 0; i < typedData.phrases.length && activeFrame === -1; i++) {\n        const phrase = typedData.phrases[i];\n        for (let j = 0; j < phrase.frames.length; j++) {\n          const frame = phrase.frames[j];\n          if (frame.timestamp > currentTime) {\n            activePhase = i;\n            activeFrame = j - 1;\n            if (activeFrame < 0) {\n              activeFrame = 0;\n              activePhase -= 1;\n            }\n            if (activePhase < 0) {\n              activePhase = 0;\n            }\n            break;\n          }\n          pFrame = frame;\n        }\n      }\n\n      const noteRef = this.noteRefs.find((ref) => ref.phaseI === activePhase && ref.frameJ === activeFrame);\n      if (noteRef) {\n        return noteRef.el;\n      }\n\n      return null;\n    },\n  },\n  watch: {\n    activeNoteElement: {\n      immediate: true,\n      handler(el) {\n        if (el) {\n          el.scrollIntoView({\n            behavior: 'smooth',\n            block: 'center',\n          });\n        }\n      },\n    },\n  },\n  methods: {\n    setNoteRef(el: HTMLElement) {\n      if (!el) return;\n      const { phase, frame } = el.dataset;\n      if ((phase ?? null) === null || (frame ?? null) === null) {\n        return;\n      }\n      const phaseI = parseInt(phase ?? '', 10);\n      const frameJ = parseInt(frame ?? '', 10);\n\n      this.noteRefs.push({\n        el,\n        phaseI,\n        frameJ,\n      });\n    },\n    setPoseDrawStyle(ctx: CanvasRenderingContext2D) {\n      ctx.strokeStyle = '#8080ff';\n      ctx.globalAlpha = 1.0;\n    },\n    isActive(kf: number, nextkf: number) {\n      return this.currentTime >= kf && this.currentTime < nextkf;\n    },\n    getPhraseFlexGrow(phraseIndex: number) {\n      if (!this.data.variableLength) return 0;\n\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) return 0;\n      const nPhrase = this.data.phrases[phraseIndex + 1];\n      if (!nPhrase) return 0;\n\n      const phraseStartTime = phrase.frames[0]?.timestamp ?? Infinity;\n      const nPhraseStartTime = nPhrase.frames[0]?.timestamp ?? Infinity;\n      if (phraseStartTime === Infinity || nPhraseStartTime === Infinity) return 0;\n\n      return nPhraseStartTime - phraseStartTime;\n    },\n    getFrameFlexGrow(phraseIndex: number, kfIndex: number) {\n      if (!this.data.variableLength) return 0;\n\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) {\n        console.warn(`NoteFlexGrow ${phraseIndex}-${kfIndex}: current phrase is undefined`);\n        return 0;\n      }\n      const nPhrase = this.data.phrases[phraseIndex + 1];\n\n      const curFrame = phrase.frames[kfIndex];\n      if (!curFrame) {\n        console.warn(`NoteFlexGrow ${phraseIndex}-${kfIndex}: current kf is undefined`);\n        return 0;\n      }\n      const kf = curFrame.timestamp;\n      let nextKf = phrase.frames[kfIndex + 1]?.timestamp ?? Infinity;\n      if (nextKf === Infinity && nPhrase) {\n        nextKf = nPhrase.frames[0]?.timestamp ?? Infinity;\n      }\n      if (nextKf === Infinity) {\n        // console.log(`NoteFlexGrow ${phraseIndex}-${kfIndex}: next kf is undefined`);\n        return 0;\n      }\n\n      const res = nextKf - kf;\n      if (res < 0) {\n        console.log(`NoteFlexGrow ${phraseIndex}-${kfIndex}: next kf is before this one`);\n        return 0;\n      }\n      return res * 100;\n    },\n    getFrameBackground(phraseIndex: number, kfIndex: number) {\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) return 1.0;\n\n      // const prev = phrase.frames[index - 1] ?? -Infinity;\n      const curr = phrase.frames[kfIndex]?.timestamp ?? -Infinity;\n      let next = phrase.frames[kfIndex + 1]?.timestamp ?? Infinity;\n      if (next === Infinity) {\n        const nPhrase = this.data.phrases[phraseIndex + 1];\n        if (nPhrase) {\n          next = nPhrase.frames[0]?.timestamp ?? Infinity;\n        }\n      }\n\n      // https://gist.github.com/gre/1650294\n\n      if (this.currentTime === -1) return 'none';\n      if (this.currentTime < curr) {\n        const timeUntil = curr - this.currentTime;\n        let fadePercent = constrain(timeUntil / this.fadeInDurationSecs, 0, 1);\n        fadePercent *= (2 - fadePercent);\n        const saturation = remap(fadePercent, 0, 1, 80.0, 0.0);\n        return `hsl(171, ${saturation}%, 90%)`;\n      }\n      if (this.currentTime < next) return 'hsl(171, 100%, 50%)';\n\n      const timePassed = this.currentTime - curr;\n      const fadePercent = constrain(timePassed / this.fadeOutDurationSecs, 0, 1);\n      const brightness = remap(fadePercent, 0, 1, 50.0, 90.0);\n      const saturation = remap(fadePercent, 0, 1, 100.0, 0.0);\n      return `hsl(171, ${saturation}%, ${brightness}%)`;\n    },\n  },\n});\n","import { render } from \"./SheetMotion.vue?vue&type=template&id=dc7a45f0\"\nimport script from \"./SheetMotion.vue?vue&type=script&lang=ts\"\nexport * from \"./SheetMotion.vue?vue&type=script&lang=ts\"\n\nimport \"./SheetMotion.vue?vue&type=style&index=0&id=dc7a45f0&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  computed, defineComponent, onBeforeUnmount, Ref, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport InstructionCarousel, { Instruction } from '@/components/elements/InstructionCarousel.vue';\nimport PausingVideoPlayer from '@/components/elements/PausingVideoPlayer.vue';\nimport KeyframeTimeline from '@/components/elements/KeyframeTimeline.vue';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\nimport SheetMotion from '@/components/elements/SheetMotion.vue';\nimport WebcamSourceSelectionMenu from '@/components/elements/WebcamSourceSelectionMenu.vue';\nimport { MiniLessonActivity, MotionTrail, PauseInfo } from '@/model/MiniLesson';\nimport Constants from '@/services/Constants';\nimport webcamProvider from '@/services/WebcamProvider';\nimport eventLogger from '@/services/EventLogger';\n\nconst ActivityPlayState = Object.freeze({\n  AwaitingStart: 'AwaitingStart',\n  PendingStart: 'PendingStart',\n  Playing: 'Playing',\n  ActivityEnded: 'ActivityEnded',\n});\n\nexport default defineComponent({\n  name: 'ActivityVideoPlayer',\n  emits: ['progress', 'activityEnded'],\n  props: {\n    motion: { type: Object },\n    activity: { type: Object },\n    defaultPauseDuration: { type: Number, default: 1.5 },\n    maxHeight: { type: String, default: '400px' },\n  },\n  components: {\n    PausingVideoPlayer,\n    InstructionCarousel,\n    WebcamBox,\n    KeyframeTimeline,\n    SheetMotion,\n    WebcamSourceSelectionMenu,\n  },\n  setup(props) {\n    const { activity } = toRefs(props);\n    const typedActivity = computed(() => (activity.value as MiniLessonActivity) ?? null);\n    const state = ref(ActivityPlayState.AwaitingStart as string);\n\n    const shouldReview = computed(() => (typedActivity?.value?.reviewing) !== undefined);\n    const shouldRecord = computed(() => ((typedActivity?.value?.recording) !== undefined) || shouldReview.value);\n\n    const activityFinished = computed(() => state.value === ActivityPlayState.ActivityEnded);\n    const awaitingStart = computed(() => state.value === ActivityPlayState.AwaitingStart);\n    const isPlaying = computed(() => state.value === ActivityPlayState.Playing);\n    const isPendingStart = computed(() => state.value === ActivityPlayState.PendingStart);\n    const isReviewing = computed(() => state.value === ActivityPlayState.ActivityEnded && shouldReview.value);\n    const videoPlayer = ref(null as null | typeof PausingVideoPlayer);\n    const webcamBox = ref(null as null | typeof WebcamBox);\n    const videoTime = ref(0);\n\n    const shouldShowStartInstructions = computed(() => isPendingStart.value || awaitingStart.value);\n\n    const recordingId = computed(() => {\n      if (!shouldRecord.value) return '';\n      return typedActivity?.value?.recording?.identifier ?? 'unknown-or-temp-identifier';\n    });\n\n    const recordingObjectUrl = ref(null as null | string);\n\n    onBeforeUnmount(() => {\n      webcamProvider.abortRecording(recordingId.value);\n    });\n\n    const pauseInstructs = ref([] as Instruction[]);\n    const onPlaybackCompleted = async () => {\n\n      if (shouldRecord.value && webcamProvider.isRecording(recordingId.value)) {\n        await webcamProvider.stopRecording(recordingId.value);\n        const blob = await webcamProvider.getBlob(recordingId.value);\n        recordingObjectUrl.value = URL.createObjectURL(blob);\n      }\n\n      eventLogger.log(`Playback completed for activity ${activity.value?.title}`);\n\n      state.value = ActivityPlayState.ActivityEnded;\n    };\n    const onPauseHit = (pause: PauseInfo) => {\n      console.log(`Hit pause${pause}`);\n      if (pause.instruction) pauseInstructs.value.push({ id: pause.time, text: pause.instruction });\n    };\n    const onPauseEnded = () => pauseInstructs.value.splice(0);\n\n    const startTime = computed(() => activity?.value?.startTime ?? 0);\n\n    function reset(newTime?: number) {\n      pauseInstructs.value.splice(0);\n      state.value = ActivityPlayState.AwaitingStart;\n      const time = newTime ?? startTime.value ?? 0;\n\n      if (videoPlayer.value) videoPlayer.value.setTime(time);\n      webcamProvider.abortRecording(recordingId.value);\n    }\n\n    watchEffect(() => reset(startTime.value));\n\n    const trailBreakEndIndex = computed(() => {\n      const trailBreaks = activity?.value?.motionTrailBreaks as number[];\n      if (!trailBreaks) return -1;\n      const time = videoTime.value;\n      for (let i = 0; i < trailBreaks.length; i += 1) {\n        if (trailBreaks[i] > time) return i;\n      }\n      return trailBreaks.length;\n    });\n    const trailStartTime = computed(() => {\n      const trailBreaks = activity?.value?.motionTrailBreaks as number[];\n      if (trailBreakEndIndex.value < 1 || !trailBreaks) return -Infinity;\n      return trailBreaks[trailBreakEndIndex.value - 1];\n    });\n    const trailEndTime = computed(() => {\n      const trailBreaks = activity?.value?.motionTrailBreaks as number[];\n      if (trailBreakEndIndex.value < 1 || !trailBreaks) return Infinity;\n      return trailBreaks[trailBreakEndIndex.value];\n    });\n\n    const motionTrails = computed(() => {\n      const trailsRaw = activity?.value?.motionTrails as MotionTrail[] ?? [];\n      const trailBreaks = activity?.value?.motionTrailBreaks as number[];\n      if (trailBreaks) {\n        return trailsRaw.map((trail) => {\n          let startIndex = trail.findIndex(([t, x, y]) => t >= trailStartTime.value);\n          let endIndex = trail.findIndex(([t, x, y]) => t > trailEndTime.value);\n          if (startIndex === -1) startIndex = 0;\n          if (endIndex === -1) endIndex = trail.length;\n          return trail.slice(startIndex, endIndex);\n        });\n      }\n      return trailsRaw;\n    });\n\n    return {\n      typedActivity,\n      webcamBox,\n      videoPlayer,\n      videoTime,\n      state,\n      ActivityPlayState,\n      awaitingStart,\n      activityFinished,\n      pauseInstructs,\n      isPlaying,\n      isPendingStart,\n      isReviewing,\n      shouldShowStartInstructions,\n\n      shouldReview,\n      shouldRecord,\n      recordingId,\n      recordingObjectUrl,\n      isRecording: () => webcamProvider.isRecording(recordingId.value),\n\n      reset,\n      startTime,\n\n      onPlaybackCompleted,\n      onPauseHit,\n      onPauseEnded,\n\n      motionTrails,\n      trailStartTime,\n      trailEndTime,\n\n      audioDeviceId: ref(''),\n      videoDeviceId: ref(''),\n    };\n  },\n  computed: {\n    keyframeVisual(): 'none' | 'skeleton' | 'video' {\n      return (this as any)?.activity?.keyframeVisual ?? 'none';\n    },\n    showingWebcam() {\n      const hideForReview = (this as any)?.isReviewing ?? false;\n      return !hideForReview && (((this as any)?.activity?.userVisual ?? 'none') !== 'none');\n    },\n    showSheetMusic() {\n      return ((this as any)?.activity?.sheetMotionVisual ?? 'none') !== 'none';\n    },\n    emphasizedJoints(): number[] { return this.activity?.emphasizedJoints ?? []; },\n    instructions(): Instruction[] {\n      const mActivity = this.activity;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if (this.state === ActivityPlayState.Playing && mActivity.playingInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.playingInstruction,\n        });\n      } else if (this.state === ActivityPlayState.ActivityEnded && mActivity.endInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.endInstruction,\n        });\n      }\n\n      return instructs;\n    },\n    startInstructions(): Instruction[] {\n      const mActivity = this.activity;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if (mActivity.startInstruction) {\n        let text = mActivity.startInstruction;\n        if (this.state === ActivityPlayState.PendingStart) { text += '...'; }\n        instructs.push({\n          id: 1,\n          text,\n        });\n      }\n      return instructs;\n    },\n    timedInstructions(): Instruction[] {\n      const mActivity = this.activity as unknown as MiniLessonActivity | null;\n      const time = this.videoTime;\n\n      if (!mActivity) return [];\n\n      const activeTimedInstructions = mActivity.timedInstructions?.map(\n        (ti, i) => ({\n          id: i,\n          text: ti.text,\n          start: ti.startTime,\n          end: ti.endTime,\n        }),\n      ).filter((ti) => ti.start <= time && time < ti.end) ?? [];\n\n      // console.log(`TimedI updated for time ${time}, count=${activeTimedInstructions.length}`, mActivity.timedInstructions);\n\n      return activeTimedInstructions;\n    },\n    needsToStartWebcam() {\n      const needsUserVisual = ((this as any).activity?.userVisual ?? 'none') !== 'none';\n      const needsWebcam = this.shouldRecord || needsUserVisual;\n      return needsWebcam && webcamProvider.webcamStatus.value !== 'running';\n    },\n  },\n  methods: {\n    async startWebcam() {\n      if (this.webcamBox) {\n        await this.webcamBox.startWebcam(this.videoDeviceId, this.audioDeviceId);\n        this.play();\n      }\n      return new Error('WebcamBox is null');\n    },\n    async play(delay?: number | undefined) {\n      this.reset();\n      const vidPlayer = this.videoPlayer;\n      const vidActivity = this.activity as MiniLessonActivity | null;\n      if (!vidActivity) return;\n      if (!vidPlayer) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer is null');\n        return;\n      }\n\n      this.state = ActivityPlayState.PendingStart;\n\n      if (this.shouldRecord && !this.isRecording()) {\n        console.log('Gonna do some muthafucking recording!');\n        await webcamProvider.startRecording(this.recordingId);\n      }\n\n      eventLogger.log(`Starting playback of activity ${this.activity?.title} at ${vidActivity.startTime.toFixed(2)}`);\n\n      vidPlayer.play(\n        vidActivity.startTime,\n        vidActivity.endTime,\n        vidActivity.practiceSpeed ?? 1,\n        vidActivity.pauses ?? [],\n        delay ?? Constants.DefaultPauseDuration,\n        () => {\n          this.state = ActivityPlayState.Playing;\n        },\n      );\n    },\n    onProgress(val: number) {\n      this.videoTime = val;\n      this.$emit('progress', val);\n    },\n  },\n});\n\n","import { render } from \"./ActivityVideoPlayer.vue?vue&type=template&id=1d829410\"\nimport script from \"./ActivityVideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./ActivityVideoPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./ActivityVideoPlayer.vue?vue&type=style&index=0&id=1d829410&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"segmented-progress-bar is-relative\">\n    <progress\n      v-for=\"seg in segmentsData\"\n      :key=\"seg.id\"\n      :class=\"[{ 'is-disabled': !enableAll && !seg.enabled, [seg.cssClass]: enableAll || seg.enabled, 'is-dark': !enableAll && !seg.enabled}, ]\"\n      class=\"progress is-large\"\n      :max=\"seg.max - seg.min\"\n      :value=\"progress - seg.min\"\n      :style=\"{ 'flex-grow': (seg.max - seg.min) }\"\n    ></progress>\n    <div class=\"is-absolute is-overlay is-flex\">\n      <div\n        v-for=\"seg in segmentsData\"\n        :key=\"seg.id\"\n        :style=\"{ 'flex-grow': (seg.max - seg.min) }\"\n        class=\"has-text-centered label-div\"\n        :class=\"{'is-active': seg.enabled}\">\n        {{seg.label}}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, toRefs } from 'vue';\nimport MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\n\nexport interface ProgressSegmentData {\n  min: number;\n  max: number;\n  enabled: boolean;\n  label: string;\n}\n\nexport function calculateProgressSegments(lesson: MiniLesson, activity: MiniLessonActivity) {\n  if (!lesson) return [];\n\n  const allLabels = lesson.segmentLabels ?? [];\n  let last = undefined as undefined | number;\n  const segs = lesson.segmentBreaks.map((timestamp, i) => {\n    let segData = undefined as undefined | ProgressSegmentData;\n    const label = allLabels[i - 1] ?? '';\n    if (last !== undefined) {\n      const doesOverlap = Math.max(last, activity.startTime) < Math.min(timestamp, activity.endTime);\n      segData = {\n        label,\n        min: last,\n        max: timestamp,\n        enabled: activity?.focusedSegments ? activity.focusedSegments.indexOf(i - 1) !== -1 : doesOverlap,\n      };\n    }\n    last = timestamp;\n    return segData;\n  }).filter((x) => x !== undefined);\n\n  return segs as ProgressSegmentData[];\n}\n\nconst cssClassOptions = [\n  // 'is-light',\n  // 'is-info',\n  // 'is-success',\n  // 'is-warning',\n  'is-primary',\n  // 'is-danger',\n  // '',\n];\n\nexport default defineComponent({\n  name: 'SegmentedProgressBar',\n  props: {\n    segments: {\n      default: Array,\n      type: Array,\n    },\n    progress: {\n      default: 0,\n      type: Number,\n    },\n    enableAll: {\n      default: false,\n      type: Boolean,\n    },\n  },\n  setup(props) {\n    const {\n      segments,\n    } = toRefs(props);\n\n    const segmentsData = computed(\n      () => segments.value.map(\n        (seg, i) => ({\n          id: i,\n          cssClass: cssClassOptions[i % cssClassOptions.length],\n          ...(seg as ProgressSegmentData),\n        }),\n      ),\n    );\n\n    return {\n      segmentsData,\n    };\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n.segmented-progress-bar {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n\n  progress.progress, .label-div {\n    border-radius: 0.5rem;\n    flex-basis: 10px;\n    margin-bottom: auto;\n  }\n\n  .label-div.is-active {\n    font-weight: 700;\n    // color: white;\n  }\n\n  progress.progress {\n    // border: 2px solid #BBB;\n\n    -webkit-appearance: none;\n    appearance: none;\n\n    &.is-disabled::-webkit-progress-bar,\n    &.is-disabled {\n      background: #888;\n    }\n\n    // border: 1px solid gray;\n\n    &.is-disabled::-moz-progress-bar,\n    &.is-disabled::-webkit-progress-value,\n    &.is-disabled::-ms-fill {\n      background: #888;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent, computed, toRefs } from 'vue';\nimport MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\n\nexport interface ProgressSegmentData {\n  min: number;\n  max: number;\n  enabled: boolean;\n  label: string;\n}\n\nexport function calculateProgressSegments(lesson: MiniLesson, activity: MiniLessonActivity) {\n  if (!lesson) return [];\n\n  const allLabels = lesson.segmentLabels ?? [];\n  let last = undefined as undefined | number;\n  const segs = lesson.segmentBreaks.map((timestamp, i) => {\n    let segData = undefined as undefined | ProgressSegmentData;\n    const label = allLabels[i - 1] ?? '';\n    if (last !== undefined) {\n      const doesOverlap = Math.max(last, activity.startTime) < Math.min(timestamp, activity.endTime);\n      segData = {\n        label,\n        min: last,\n        max: timestamp,\n        enabled: activity?.focusedSegments ? activity.focusedSegments.indexOf(i - 1) !== -1 : doesOverlap,\n      };\n    }\n    last = timestamp;\n    return segData;\n  }).filter((x) => x !== undefined);\n\n  return segs as ProgressSegmentData[];\n}\n\nconst cssClassOptions = [\n  // 'is-light',\n  // 'is-info',\n  // 'is-success',\n  // 'is-warning',\n  'is-primary',\n  // 'is-danger',\n  // '',\n];\n\nexport default defineComponent({\n  name: 'SegmentedProgressBar',\n  props: {\n    segments: {\n      default: Array,\n      type: Array,\n    },\n    progress: {\n      default: 0,\n      type: Number,\n    },\n    enableAll: {\n      default: false,\n      type: Boolean,\n    },\n  },\n  setup(props) {\n    const {\n      segments,\n    } = toRefs(props);\n\n    const segmentsData = computed(\n      () => segments.value.map(\n        (seg, i) => ({\n          id: i,\n          cssClass: cssClassOptions[i % cssClassOptions.length],\n          ...(seg as ProgressSegmentData),\n        }),\n      ),\n    );\n\n    return {\n      segmentsData,\n    };\n  },\n});\n\n","import { render } from \"./SegmentedProgressBar.vue?vue&type=template&id=03afb3ff\"\nimport script from \"./SegmentedProgressBar.vue?vue&type=script&lang=ts\"\nexport * from \"./SegmentedProgressBar.vue?vue&type=script&lang=ts\"\n\nimport \"./SegmentedProgressBar.vue?vue&type=style&index=0&id=03afb3ff&lang=scss\"\nscript.render = render\n\nexport default script","\nimport { defineComponent, ref, nextTick } from 'vue';\nimport MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\nimport ActivityVideoPlayer from '@/components/elements/ActivityVideoPlayer.vue';\nimport SegmentedProgressBar, { calculateProgressSegments, ProgressSegmentData } from '@/components/elements/SegmentedProgressBar.vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport Utils from '@/services/Utils';\nimport eventLogger from '@/services/EventLogger';\n\nexport default defineComponent({\n  name: 'MiniLessonPlayer',\n  components: {\n    SegmentedProgressBar,\n    ActivityVideoPlayer,\n  },\n  props: {\n    videoEntry: { type: Object },\n    miniLesson: { type: Object },\n    // maxVideoHeight: { type: String, default: 'none' },\n    enableCompleteLesson: { type: Boolean, default: false },\n    timeRemaining: { type: String, default: null },\n  },\n  setup() {\n    const activityVideoPlayer = ref(null as null | typeof ActivityVideoPlayer);\n    return {\n      activityVideoPlayer,\n    };\n  },\n  emits: ['lesson-completed', 'activity-changed'],\n  computed: {\n    nearbyActivityIndices(): number[] {\n      const margin = 1;\n      const minIndex = Math.max(0, this.activeActivityIndex - margin);\n      const maxActivityIndex = (this.lesson?.activities.length ?? 0) - 1;\n      const maxIndex = Math.min(maxActivityIndex, this.activeActivityIndex + margin);\n      const count = (maxIndex + 1) - minIndex;\n      let indices: number[] = [];\n      if (minIndex > 0) {\n        if (minIndex === 1) {\n          indices.push(0);\n        } else {\n          indices.push(0, -1);\n        }\n        // indices = indices.concat([0, -1]);\n      }\n      indices = indices.concat(Utils.range(count, minIndex));\n      if (maxIndex < maxActivityIndex) {\n        if (maxIndex === maxActivityIndex - 1) {\n          indices.push(maxActivityIndex);\n        } else {\n          indices.push(-1, maxActivityIndex);\n        }\n      }\n      return indices;\n    },\n    lesson() {\n      const lesson = (this.$props.miniLesson ?? null) as null | MiniLesson;\n      return lesson;\n    },\n    activities(): MiniLessonActivity[] {\n      return (this.lesson as any)?.activities ?? [];\n    },\n    activeActivity() {\n      const lesson = (this.$props.miniLesson ?? null) as null | MiniLesson;\n      const activityIndex = this.activeActivityIndex as number;\n      const activity = lesson?.activities[activityIndex] ?? null as null | MiniLessonActivity;\n      return activity;\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lesson) return calculateProgressSegments(this.lesson, this.activeActivity);\n      return [];\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < (this.lesson?.activities.length ?? 0);\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    needsStartWebcam(): boolean {\n      return this.activeActivity !== null && (this.activityVideoPlayer as typeof ActivityVideoPlayer)?.needsToStartWebcam;\n    },\n  },\n  data() {\n    return {\n      activeActivityIndex: 0,\n      activityProgress: 0,\n      webcamStatus: webcamProvider.webcamStatus,\n    };\n  },\n  methods: {\n    onProgress(val: number) { this.activityProgress = val; },\n    autoPlay() {\n      nextTick(() => {\n        if (!this.needsStartWebcam) {\n          this.playActivity();\n        }\n      });\n    },\n    playActivity() {\n      (this.$refs.activityVideoPlayer as any).play();\n    },\n    nextActivity() {\n      if (this.hasNextActivity) this.activeActivityIndex += 1;\n      nextTick(() => {\n        if (!this.needsStartWebcam) this.playActivity();\n      });\n    },\n    completeLesson() {\n      this.$emit('lesson-completed');\n    },\n    gotoActivity(i: number) {\n      this.activeActivityIndex = i;\n      this.autoPlay();\n    },\n    async startWebcam() {\n      return (this.$refs.activityVideoPlayer as any)?.startWebcam();\n    },\n    repeat() {\n      const vidPlayer = (this.$refs.activityVideoPlayer as any);\n      eventLogger.log(`Repeating lesson activity ${this.activeActivity?.title}`);\n      vidPlayer.reset();\n      vidPlayer.play();\n    },\n  },\n  watch: {\n    activeActivityIndex(newVal: number) {\n      this.$emit('activity-changed', newVal);\n    },\n  },\n});\n","import { render } from \"./MiniLessonPlayer.vue?vue&type=template&id=2cb36924\"\nimport script from \"./MiniLessonPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./MiniLessonPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./MiniLessonPlayer.vue?vue&type=style&index=0&id=2cb36924&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div\n    class=\"box m-4\"\n    :class=\"{\n      'is-clickable': stepInfo.isClickable,\n      'hover-expand': stepInfo.isClickable,\n      'has-text-grey': !stepInfo.isClickable,\n      'has-background-grey-lighter': !stepInfo.isClickable,\n      'has-background-white-ter':\n        stepInfo.isClickable && stepInfo.isNextStep,\n      'has-border-success': stepInfo.step.status === 'completed',\n      'has-border-info': stepInfo.isNextStep,\n      'has-border-grey':\n        stepInfo.isClickable &&\n        !stepInfo.isNextStep &&\n        stepInfo.step.status !== 'completed',\n    }\"\n    @click=\"stepInfo.isClickable && $emit('card-selected', stepInfo.step)\"\n  >\n    <article class=\"level\">\n      <div class=\"level-left\">\n        <div class=\"level-item\">\n          <p class=\"image is-48x48\" v-if=\"stepInfo.dbEntry?.thumbnailSrc\">\n            <img\n              class=\"is-100percent is-contain\"\n              :src=\"stepInfo.dbEntry?.thumbnailSrc\"\n              :alt=\"stepInfo.step.title\"\n            />\n          </p>\n          <p class=\"icon is-large\" v-else>\n            <i\n              class=\"fas fa-2x fa-align-center\"\n              v-if=\"stepInfo.step.type === 'InstructionOnly'\"\n            ></i>\n            <i\n              class=\"fas fa-2x fa-images\"\n              v-if=\"\n                stepInfo.step.type === 'MiniLessonEmbedded' ||\n                stepInfo.step.type === 'MiniLessonnReference'\n              \"\n            ></i>\n            <i\n              class=\"fas fa-2x fa-camera\"\n              v-if=\"stepInfo.step.type === 'UploadTask'\"\n            ></i>\n          </p>\n        </div>\n        <div class=\"level-item\">\n          <div>\n            <p v-text=\"stepInfo.step.title\"></p>\n            <p v-if=\"stepInfo.waitingForTimeExpiration\" class=\"is-size-7\">\n              &nbsp;in {{ stageSecondsRemainingString }}\n            </p>\n            <p v-if=\"stepInfo.isClickable\" class=\"is-size-7\">\n              <span v-if=\"stepInfo.isComplete\">Click to repeat</span>\n              <span v-if=\"stepInfo.step === nextStepInStage\">Up Next</span>\n            </p>\n          </div>\n        </div>\n      </div>\n      <div class=\"level-right\">\n        <div class=\"level-item\">\n          <span class=\"icon is-large\">\n            <i\n              class=\"far fa-check-circle has-text-success\"\n              v-if=\"stepInfo.step.status === 'completed'\"\n            ></i>\n            <i\n              class=\"far fa-play-circle\"\n              v-if=\"stepInfo.step === nextStepInStage\"\n            ></i>\n            <i\n              class=\"far fa-circle\"\n              v-if=\"\n                stepInfo.step !== nextStepInStage &&\n                stepInfo.step.status === 'notstarted'\n              \"\n            ></i>\n          </span>\n        </div>\n      </div>\n    </article>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport { WorkflowStep } from '@/model/Workflow';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\n\nexport interface WorkflowStepCardInfo {\n  step: WorkflowStep;\n  isComplete: boolean;\n  dbEntry: VideoDatabaseEntry | null;\n  isExpired: boolean;\n  isClickable: boolean;\n  isValidAfterExpiredTask: boolean;\n  isNextStep: boolean;\n  waitingForTimeExpiration: boolean;\n  stageIndex: number;\n  stepIndex: number;\n}\n\nexport default defineComponent({\n  name: 'WorkflowStepCard',\n  props: {\n    stepInfo: {\n      type: Object as () => WorkflowStepCardInfo,\n      required: true,\n    },\n    stageSecondsRemainingString: {\n      type: String,\n      required: true,\n    },\n    nextStepInStage: {\n      type: Object,\n      default: null,\n    },\n  },\n  emits: ['card-selected'],\n});\n</script>\n\n<style>\n</style>\n","\nimport { defineComponent } from 'vue';\nimport { WorkflowStep } from '@/model/Workflow';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\n\nexport interface WorkflowStepCardInfo {\n  step: WorkflowStep;\n  isComplete: boolean;\n  dbEntry: VideoDatabaseEntry | null;\n  isExpired: boolean;\n  isClickable: boolean;\n  isValidAfterExpiredTask: boolean;\n  isNextStep: boolean;\n  waitingForTimeExpiration: boolean;\n  stageIndex: number;\n  stepIndex: number;\n}\n\nexport default defineComponent({\n  name: 'WorkflowStepCard',\n  props: {\n    stepInfo: {\n      type: Object as () => WorkflowStepCardInfo,\n      required: true,\n    },\n    stageSecondsRemainingString: {\n      type: String,\n      required: true,\n    },\n    nextStepInStage: {\n      type: Object,\n      default: null,\n    },\n  },\n  emits: ['card-selected'],\n});\n","import { render } from \"./WorkflowStepCard.vue?vue&type=template&id=068220ca\"\nimport script from \"./WorkflowStepCard.vue?vue&type=script&lang=ts\"\nexport * from \"./WorkflowStepCard.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","import { computed, reactive } from 'vue';\nimport videoDatabase from '../../../data/database.json';\nimport VideoVideoDatabaseEntry from '@/model/VideoDatabaseEntry';\n\nexport class VideoDatabase {\n\n  readonly allTags = reactive(new Set<string>());\n\n  readonly entriesByClipName = reactive(new Map<string, VideoVideoDatabaseEntry>());\n\n  readonly entries = computed(() => Array.from(this.entriesByClipName.values()));\n\n  readonly clipNames = computed(() => this.entries.value.map((dbEntry) => dbEntry.clipName));\n\n  constructor() {\n\n    videoDatabase.forEach((videoEntry) => {\n      this.entriesByClipName.set(videoEntry.clipName, {\n        videoSrc: `videos/${videoEntry.clipPath}`,\n        ...videoEntry,\n        thumbnailSrc: `thumbs/${videoEntry.thumbnailSrc}`,\n      });\n      videoEntry.tags.forEach((tag) => this.allTags.add(tag));\n    });\n\n    console.log(`Video database: loaded ${this.entriesByClipName.size} videos`);\n  }\n}\n\nconst db = new VideoDatabase();\nexport default db;\n","import { computed, reactive } from 'vue';\nimport MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\n\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport videoDB, { VideoDatabase } from '@/services/VideoDatabase';\n\nimport Utils from './Utils';\n\nexport function updateLessonFormat(lesson: MiniLesson): MiniLesson {\n  const updatedLesson = lesson;\n  updatedLesson.activities = lesson.activities.map((activity) => ({\n    // Backwards compat - convert to new format if necessary\n    //   > currently there's nothing to change\n    ...activity,\n  }));\n  return updatedLesson;\n}\n\nexport function createBlankActivity(motion: VideoDatabaseEntry, title: string): MiniLessonActivity {\n  return {\n    title,\n    startTime: 0,\n    endTime: motion.duration,\n    demoVisual: 'video',\n    userVisual: 'none',\n    practiceSpeed: 1,\n  };\n}\n\nexport function createBlankLesson(videoEntry: VideoDatabaseEntry): MiniLesson {\n  return {\n    _id: Utils.uuidv4(),\n    source: 'custom',\n    header: {\n      clipName: videoEntry.clipName,\n      lessonTitle: 'New Lesson',\n    },\n    segmentBreaks: [0, videoEntry.duration],\n    activities: [createBlankActivity(videoEntry, 'Activity 1')],\n  };\n}\n\nexport class MiniLessonManager {\n\n  readonly lessonsByVideo = reactive(new Map<string, MiniLesson[]>());\n\n  readonly lessonsById = reactive(new Map<string, MiniLesson>());\n\n  constructor() {\n    const customLessonCount = this.loadCustomLessons();\n    console.log(`Motion database: loaded ${customLessonCount} custom lessons`);\n  }\n\n  hasLesson(lesson: MiniLesson): boolean {\n    const lessonList = this.lessonsByVideo.get(lesson.header.clipName) ?? [];\n    const lessonIndex = lessonList.findIndex((val) => val._id === lesson._id);\n    return lessonIndex !== -1;\n  }\n\n  upsertLesson(lesson: MiniLesson) {\n    const updatedLesson = MiniLessonManager.updateLessonFormat(lesson);\n    const lessonList = this.lessonsByVideo.get(lesson.header.clipName) ?? [];\n    const existingIndex = lessonList.findIndex((les) => les._id === lesson._id);\n    if (existingIndex !== -1) lessonList[existingIndex] = updatedLesson;\n    else lessonList.push(updatedLesson);\n    this.lessonsByVideo.set(lesson.header.clipName, lessonList);\n\n    this.lessonsById.set(lesson._id, lesson);\n  }\n\n  static updateLessonFormat(lesson: MiniLesson): MiniLesson {\n    const updatedLesson = lesson;\n    updatedLesson.activities = lesson.activities.map((activity) => ({\n      // Backwards compat - convert to new format if necessary\n      //   > currently there's nothing to change\n      ...activity,\n    }));\n    return updatedLesson;\n  }\n\n  removeLesson(lesson: MiniLesson) {\n    const lessonList = this.lessonsByVideo.get(lesson.header.clipName) ?? [];\n    const lessonIndex = lessonList.findIndex((val) => val._id === lesson._id);\n    if (lessonIndex !== -1) lessonList.splice(lessonIndex, 1);\n    this.lessonsByVideo.set(lesson.header.clipName, lessonList);\n\n    this.lessonsById.delete(lesson._id);\n  }\n\n  getLessons(videoEntry: VideoDatabaseEntry | string) {\n    let lessons = undefined as undefined | MiniLesson[];\n    if (typeof videoEntry === 'object' && videoEntry !== null) lessons = this.lessonsByVideo.get(videoEntry.clipName);\n    else lessons = this.lessonsByVideo.get(videoEntry);\n    return lessons;\n  }\n\n  private static getCustomLessonIdsList(): Array<string> {\n    return JSON.parse(window.localStorage.getItem('custom-lessons') ?? '[]');\n  }\n\n  private static saveCustomLessonsIdsList(customLessonIds: Array<string>) {\n    window.localStorage.setItem('custom-lessons', JSON.stringify(customLessonIds));\n  }\n\n  private loadCustomLessons(): number {\n    const customLessonIds = MiniLessonManager.getCustomLessonIdsList();\n    let countLoaded = 0;\n    for (let i = 0; i < customLessonIds.length; i += 1) {\n      const id = customLessonIds[i];\n      const custLesson = localStorage.getItem(`lesson-${id}`);\n      if (custLesson) {\n        this.upsertLesson(JSON.parse(custLesson) as MiniLesson);\n        countLoaded += 1;\n      }\n    }\n    return countLoaded;\n  }\n\n  static validateLesson(lesson: MiniLesson) {\n    if (!lesson) throw new Error('Lesson is null or undefined');\n    const clipName = lesson?.header?.clipName;\n    if (!clipName) throw new Error('Clip name missing');\n    if (!videoDB.entriesByClipName.has(clipName)) throw new Error(`Matching video clip not found for ${clipName}`);\n    if (!Array.isArray(lesson.activities) || lesson.activities.length < 1) throw new Error('Lesson contains no activities');\n  }\n\n  saveCustomLesson(lesson: MiniLesson) {\n    this.upsertLesson(lesson);\n    window.localStorage.setItem(`lesson-${lesson._id}`, JSON.stringify(lesson));\n\n    const custLessonIds = MiniLessonManager.getCustomLessonIdsList();\n    if (custLessonIds.indexOf(lesson._id) === -1) {\n      console.log(`Added custom lesson ${lesson.header.lessonTitle} id=${lesson._id} to localstorage`);\n      custLessonIds.push(lesson._id);\n    } else {\n      console.log(`Updated custom lesson ${lesson.header.lessonTitle} id=${lesson._id} in localstorage`);\n    }\n    MiniLessonManager.saveCustomLessonsIdsList(custLessonIds);\n  }\n\n  deleteCustomLesson(lesson: MiniLesson) {\n    this.removeLesson(lesson);\n\n    const custLessonIds = MiniLessonManager.getCustomLessonIdsList();\n    const lessonIdIndex = custLessonIds.indexOf(lesson._id);\n    if (lessonIdIndex !== -1) custLessonIds.splice(lessonIdIndex, 1);\n    MiniLessonManager.saveCustomLessonsIdsList(custLessonIds);\n\n    window.localStorage.removeItem(`lesson-${lesson._id}`);\n  }\n}\n\nconst miniLessonManager = new MiniLessonManager();\nexport default miniLessonManager;\n","import { computed, reactive, ref } from 'vue';\nimport workflowsJson from\n  // 'data/workflows/all_workflows.json';\n  '@/data/workflows/all_workflows.json';\nimport optionsManager from '@/services/OptionsManager';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport miniLessonManager, { MiniLessonManager } from './MiniLessonManager';\nimport videoDB, { VideoDatabase } from '@/services/VideoDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport { Workflow, WorkflowStage, WorkflowStep } from '@/model/Workflow';\n// import workflowsJson from '@/model/all_workflows.json';\nimport additionalWorkflowsJson from '@/model/additionalWorkflows.json';\nimport eventHub, { EventNames } from './EventHub';\nimport Utils from './Utils';\n\nconst thumbnailRootDir = 'thumbs/';\n\nconst defaultWorkflows = workflowsJson as Workflow[];\nconst customWorkflows = additionalWorkflowsJson as Workflow[];\n\nexport interface TrackingWorkflowStep extends WorkflowStep {\n  status: 'notstarted' | 'inprogress' | 'completed';\n}\n\nexport interface TrackingWorkflowStage extends WorkflowStage {\n  steps: TrackingWorkflowStep[];\n}\n\nexport interface TrackingWorkflow extends Workflow {\n  stages: TrackingWorkflowStage[];\n}\n\nexport class WorkflowManager {\n\n  private bakedInWorkflows = new Set<string>();\n\n  public workflows = reactive(new Map() as Map<string, Workflow>);\n\n  public workflowsArray = computed(() => {\n    const array = new Array(...this.workflows.values());\n    array.sort((a, b) => a.title.localeCompare(b.title));\n    return array;\n  });\n\n  public customWorkflowsArray = computed(() => {\n    const array = new Array(...this.workflows.values());\n    array.sort((a, b) => a.title.localeCompare(b.title));\n    return array.filter((w) => !this.bakedInWorkflows.has(w.id));\n  });\n\n  public activeFlow = ref(null as TrackingWorkflow | null);\n\n  constructor() {\n    this.loadWorkflows();\n  }\n\n  private loadWorkflows() {\n    for (let i = 0; i < defaultWorkflows.length; i += 1) {\n      const workflow = defaultWorkflows[i] as Workflow;\n      workflow.created = new Date(workflow.created);\n      if (workflow.thumbnailSrc) workflow.thumbnailSrc = thumbnailRootDir + workflow.thumbnailSrc;\n      this.addSessionWorkflow(workflow);\n      this.bakedInWorkflows.add(workflow.id);\n    }\n    for (let i = 0; i < customWorkflows.length; i += 1) {\n      const workflow = customWorkflows[i];\n      workflow.created = new Date(workflow.created);\n      if (workflow.thumbnailSrc) workflow.thumbnailSrc = thumbnailRootDir + workflow.thumbnailSrc;\n      this.addSessionWorkflow(workflow);\n      this.bakedInWorkflows.add(workflow.id);\n    }\n\n    const customWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    for (let i = 0; i < customWorkflowIds.length; i += 1) {\n      this.tryLoadCustomWorkflow(customWorkflowIds[i]);\n    }\n  }\n\n  public isCustomWorkflow(id: string) {\n    return !this.bakedInWorkflows.has(id);\n  }\n\n  public hasWorkflow(id: string) {\n    return this.workflows.has(id);\n  }\n\n  public hasBakedInWorkflow(id: string) {\n    return this.bakedInWorkflows.has(id);\n  }\n\n  public reloadCustomWorkflow(id: string) {\n    if (!this.isCustomWorkflow(id)) return;\n\n    if (!WorkflowManager.hasSavedCustomLesson(id)) {\n      this.workflows.delete(id);\n    } else {\n      this.tryLoadCustomWorkflow(id);\n    }\n  }\n\n  private static getCustomWorkflowIdsList(): Array<string> {\n    return JSON.parse(window.localStorage.getItem('custom-workflows') ?? '[]');\n  }\n\n  private static saveCustomWorkflowIdsList(customLessonIds: Array<string>) {\n    window.localStorage.setItem('custom-workflows', JSON.stringify(customLessonIds));\n  }\n\n  private static updateToLatestWorkflowFormat(workflow: Workflow) {\n    const updatedWorkflow = workflow;\n    updatedWorkflow.stages = updatedWorkflow.stages.map((stage) => ({\n      ...stage,\n      steps: stage.steps.map((step) => {\n        const stepAny = step as any;\n        const newStep = step;\n        const newStepAny = newStep as any;\n\n        // Renaming videoLesson -> miniLesson\n        if (stepAny.videoLessonReference) {\n          newStep.miniLessonReference = stepAny.videoLessonReference;\n          delete newStepAny.videoLessonReference;\n        }\n        if (stepAny.videoLessonEmbedded) {\n          newStep.miniLessonEmbedded = stepAny.videoLessonEmbedded;\n          delete newStepAny.videoLessonEmbedded;\n        }\n        if (newStepAny.type === 'VideoLessonReference') newStep.type = 'MiniLessonReference';\n        if (newStepAny.type === 'VideoLessonEmbedded') newStep.type = 'MiniLessonEmbedded';\n\n        // Refactoring any embedded mini-lessons\n        if (newStep.miniLessonEmbedded) {\n          newStep.miniLessonEmbedded = MiniLessonManager.updateLessonFormat(newStep.miniLessonEmbedded);\n        }\n\n        return newStep;\n      }),\n    }));\n\n    return updatedWorkflow;\n  }\n\n  public static hasSavedCustomLesson(id: string) {\n    const custWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    return custWorkflowIds.indexOf(id) !== -1;\n  }\n\n  public addSessionWorkflow(workflow: Workflow) {\n    const updatedWorkflow = WorkflowManager.updateToLatestWorkflowFormat(workflow);\n    this.workflows.set(updatedWorkflow.id, updatedWorkflow);\n  }\n\n  public tryLoadCustomWorkflow(id: string) {\n    try {\n      const workflowRaw = window.localStorage.getItem(`workflow-${id}`);\n      if (!workflowRaw) throw new Error(`No workflow found with id: ${id}`);\n      const workflow = JSON.parse(workflowRaw);\n      workflow.created = new Date(workflow.created);\n      this.addSessionWorkflow(workflow);\n    } catch (e) {\n      console.warn('Error loading custom lesson', id, e);\n    }\n  }\n\n  public deleteCustomWorkflow(id: string) {\n    this.workflows.delete(id);\n    window.localStorage.removeItem(`workflow-${id}`);\n    const custWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    const index = custWorkflowIds.indexOf(id);\n    if (index !== -1) {\n      custWorkflowIds.splice(index, 1);\n      WorkflowManager.saveCustomWorkflowIdsList(custWorkflowIds);\n    }\n  }\n\n  public upsertCustomWorkflow(workflow: Workflow) {\n    this.addSessionWorkflow(workflow);\n    this.workflows.set(workflow.id, workflow);\n    window.localStorage.setItem(`workflow-${workflow.id}`, JSON.stringify(workflow));\n\n    const custWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    if (!WorkflowManager.hasSavedCustomLesson(workflow.id)) {\n      console.log(`Added custom lesson ${workflow.title} id=${workflow.id} to localstorage`);\n      custWorkflowIds.push(workflow.id);\n    } else {\n      console.log(`Updated custom lesson ${workflow.title} id=${workflow.id} in localstorage`);\n    }\n    WorkflowManager.saveCustomWorkflowIdsList(custWorkflowIds);\n  }\n\n  public setActiveFlow(workflowId: string) {\n    const matchingWorkflow = this.workflows.get(workflowId);\n\n    if (!matchingWorkflow) {\n      console.error(`setActiveFlow: Couldn't find workflow with id ${workflowId}`);\n      return false;\n    }\n\n    const flow = Utils.deepCopy(matchingWorkflow);\n    const trackingFlow = {\n      ...flow,\n      stages: flow.stages.map((stage) => ({\n        ...stage,\n        steps: stage.steps.map((step) => ({\n          ...step,\n          status: 'notstarted',\n        }) as TrackingWorkflowStep),\n      } as TrackingWorkflowStage)),\n    } as TrackingWorkflow;\n\n    trackingFlow.stages.forEach((stage) => {\n      const { steps } = stage;\n      const shuffleInfo = (stage as any).shuffle;\n      if (shuffleInfo) {\n        // Shuffle the sequences of steps, as appropiate\n        Utils.shuffleArray(steps, shuffleInfo.startIndex, shuffleInfo.endIndex);\n      }\n      stage.steps = steps;\n    });\n\n    this.activeFlow.value = trackingFlow;\n    return true;\n  }\n\n  public completeActivitesPriorToStageAndStep(stageIndex: number, stepIndex: number) {\n    if (!this.activeFlow.value) return;\n    const { stages } = this.activeFlow.value;\n    for (let i = 0; i < stages.length; i += 1) {\n      const { steps } = stages[i];\n      for (let j = 0; j < steps.length; j += 1) {\n        steps[j].status = i < stageIndex ? 'completed' : 'notstarted';\n        if (i === stageIndex) {\n          steps[j].status = j < stepIndex ? 'completed' : 'notstarted';\n        }\n      }\n    }\n  }\n\n  public static validateWorkflow(workflow: Workflow) {\n    if (!workflow?.id) throw new Error('Workflow must have an id');\n    if (!workflow?.title) throw new Error('Workflow must have an title');\n    if (!Array.isArray(workflow.stages)) throw new Error('Workflow must have stages');\n    workflow.stages.forEach((stage) => {\n      WorkflowManager.validateWorkflowStage(stage);\n    });\n  }\n\n  public static validateWorkflowStage(stage: WorkflowStage) {\n    if (!stage.title) throw new Error('Stage must have a title');\n    if (!Array.isArray(stage.steps)) throw new Error('Stage must have steps');\n    stage.steps.forEach((step) => {\n      WorkflowManager.validateWorkflowStep(step);\n    });\n  }\n\n  public static validateWorkflowStep(step: WorkflowStep) {\n    if (!step.title) throw new Error('Step must have a title');\n    if (!step.type) throw new Error('Step must have a type');\n\n    if (step.type === 'InstructionOnly') {\n      if (!step.instructions) throw new Error('Step must have an instruction');\n      if (!step.instructions.text) throw new Error('Step instruction must have a text');\n      if (!step.instructions.heading) throw new Error('Step instruction must have a heading');\n\n    } else if (step.type === 'MiniLessonReference') {\n      if (!step.miniLessonReference) throw new Error('Step must have a referenced lesson');\n      if (!miniLessonManager.lessonsById.has(step.miniLessonReference.lessonId)) throw new Error(`Step's referenced lesson id ${step.miniLessonReference.lessonId} does not exist`);\n      if (!miniLessonManager.lessonsByVideo.has(step.miniLessonReference.clipName)) throw new Error(`Step's referenced lesson clipName ${step.miniLessonReference.clipName} does not exist`);\n\n    } else if (step.type === 'MiniLessonEmbedded') {\n      if (!step.miniLessonEmbedded) throw new Error('Step must have a embedded lesson');\n\n      try {\n        MiniLessonManager.validateLesson(step.miniLessonEmbedded);\n      } catch (e) {\n        throw new Error(`Step ${step.title} has an invalid embedded lesson. Error: ${e}`);\n      }\n\n    } else if (step.type === 'UploadTask') {\n      if (!step.upload) throw new Error('Step must have an upload task');\n\n    } else {\n      throw new Error(`Step type ${step.type} is not supported`);\n    }\n  }\n}\n\nconst workflowManager = new WorkflowManager();\nexport default workflowManager;\n","<template>\n  <section class=\"section\">\n    <div class=\"container\">\n      <h1 class=\"title\">{{title}}</h1>\n      <h2 class=\"subtitle\" v-show=\"subtitle\">{{subtitle}}</h2>\n\n      <p class=\"block\"><strong>Instructions:</strong> {{prompt}}</p>\n\n      <div class=\"block\" v-if=\"followAlong\">\n        <progress\n          class=\"progress is-large\"\n          :value=\"followAlongProgress - followAlong.startTime\"\n          :max=\"followAlong.endTime\"\n          ></progress>\n      </div>\n\n      <div class=\"columns\">\n        <div class=\"column\" v-show=\"followAlong && followAlong?.visualMode !== 'none'\">\n          <VideoPlayer\n            style=\"width:100%;height: 5rem;\"\n            ref=\"videoPlayer\"\n            :videoBaseUrl=\"videoBaseUrl\"\n            :videoOpacity=\"1.0\"\n            @playback-completed=\"onVideoPlayBackCompleted\"\n            @progress=\"onProgress\"\n            />\n        </div>\n\n        <div class=\"column\" v-if=\"state === 'Record'\">\n          <WebcamBox />\n\n          <div class=\"field is-grouped is-grouped-centered mt-1\" v-show=\"webcamStatus === 'running'\">\n            <p class=\"control\">\n              <span class=\"record-icon\" :class=\"{'is-recording': isRecording()}\">\n              </span>\n              <!-- <span class=\"icon is-medium\" :class=\"{'has-text-danger': isRecording}\">\n                <FAIcon icon=\"record-vinyl\" size=\"lg\" pulse />\n              </span> -->\n            </p>\n            <p class=\"control\">\n              <button class=\"button animate-width\"\n                @click=\"toggleRecording\">\n\n                <span v-if=\"isRecording()\">\n                  Stop\n                </span>\n                <span\n                   v-else\n                  :disabled=\"countdownTimerRemaining > 0\">\n\n                  <span v-if=\"countdownTimerRemaining > 0\">{{countdownTimerRemaining}}</span>\n                  <span v-else>Record</span>\n                </span>\n\n                <!-- <span v-if=\"!isRecording\">Start Recording</span> -->\n              </button>\n            </p>\n          </div>\n        </div>\n      </div>\n      <video class=\"block flipped\" v-if=\"state !== 'Record'\" controls :src=\"recordedObjectUrl\"></video>\n      <div class=\"block\" v-if=\"state === 'Review'\">\n        <div class=\"field is-grouped is-grouped-centered\">\n          <p class=\"control\">\n            <button class=\"button\" :disabled=\"isUploading || maxAttemptsIsReached\" @click=\"rerecord\">\n              Rerecord\n              <!-- <span class=\"icon is-medium\" :class=\"{'has-text-danger': isRecording}\">\n                <FAIcon icon=\"record-vinyl\" />\n              </span> -->\n              <!-- <span v-if=\"!isRecording\">Start Recording</span> -->\n            </button>\n          </p>\n          <p class=\"control\">\n            <button class=\"button is-primary\"\n              :disabled=\"isUploading\"\n              :class=\"{'is-loading': isUploading}\"\n              @click=\"uploadVideo\">\n              Upload Video\n            </button>\n          </p>\n        </div>\n        <div class=\"notification\" v-if=\"maxAttemptsIsReached\">\n          You've reached the maximum number of attempts.\n        </div>\n        <div class=\"notification\" v-if=\"uploadError\">\n          <strong>Error Uploading Video:</strong>\n          {{uploadError}}\n        </div>\n      </div>\n      <div class=\"block has-text-centered\" v-if=\"state === 'Success'\">\n        <span class=\"icon\"><i class=\"fas fa-check\"></i></span> Upload Successful\n      </div>\n\n      <div class=\"block buttons is-right\" >\n        <!-- {{successfullyUploaded}} -->\n        <button v-show=\"!successfullyUploaded\" class=\"is-outlined button is-danger\" @click=\"$emit('upload-canceled')\">Cancel</button>\n        <button :disabled=\"!successfullyUploaded\" class=\"button is-primary\" @click=\"$emit('upload-completed')\">Done</button>\n      </div>\n\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed, defineComponent, onBeforeUnmount, ref, toRefs,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport AzureUploader from '@/services/AzureUploader';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\nimport { UploadFollowAlong } from '@/model/Workflow';\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\nimport videoDB from '@/services/VideoDatabase';\nimport eventLogger from '@/services/EventLogger';\n\nfunction sleep(ms: number) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nexport default defineComponent({\n  name: 'UploadScreen',\n  components: { WebcamBox, VideoPlayer },\n  emits: ['upload-canceled', 'upload-completed'],\n  props: {\n    title: {\n      type: String,\n      default: 'Video Upload',\n    },\n    subtitle: {\n      type: String,\n      default: null,\n    },\n    prompt: {\n      type: String,\n      default: 'Upload your video here',\n    },\n    uploadFilename: {\n      type: String,\n      default: null,\n    },\n    activityLogUploadFilename: {\n      type: String,\n      default: null,\n    },\n    maxAttempts: {\n      type: Number,\n      default: null,\n    },\n    followAlong: {\n      type: Object,\n      default: null,\n    },\n  },\n  setup(props) {\n    const { followAlong: followAlongRef, maxAttempts, uploadFilename } = toRefs(props);\n\n    const state = ref('Record' as 'Record' | 'Review' | 'Success');\n\n    const videoPlayer = ref(null as typeof VideoPlayer | null);\n    const attempts = ref(0);\n    const followAlongProgress = ref(0);\n    const countdownTimerRemaining = ref(0);\n\n    const lastRecordedBlob = ref(null as Blob | null);\n    const recordedObjectUrl = ref('');\n    const isUploading = ref(false);\n    const uploadError = ref(null as null | any);\n    const successfullyUploaded = computed(() => state.value === 'Success');\n\n    const videoBaseUrl = computed(() => {\n      if (!followAlongRef.value) {\n        return '';\n      }\n      const followData = followAlongRef.value as UploadFollowAlong;\n      const dbEntry = videoDB.entriesByClipName.get(followData.clipName);\n\n      if (!dbEntry) {\n        return '';\n      }\n\n      return `${dbEntry.videoSrc}#t=${followData.startTime},${followData.endTime}`;\n    });\n\n    const maxAttemptsIsReached = computed(() => attempts.value >= (maxAttempts.value ?? Infinity));\n\n    onBeforeUnmount(async () => {\n      const filename = uploadFilename.value;\n      await webcamProvider.abortRecording(filename);\n      await webcamProvider.clearRecording(filename);\n    });\n\n    return {\n      state,\n      webcamProvider,\n      attempts,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: () => webcamProvider.isRecording(uploadFilename.value),\n      lastRecordedBlob,\n      recordedObjectUrl,\n      isUploading,\n      uploadError,\n      successfullyUploaded,\n      videoPlayer,\n      followAlongRef,\n      videoBaseUrl,\n      followAlongProgress,\n      maxAttemptsIsReached,\n      countdownTimerRemaining,\n    };\n  },\n  methods: {\n    onProgress(progress: number) {\n      this.followAlongProgress = progress;\n      if (progress >= this.followAlong?.endTime) {\n        this.onVideoPlayBackCompleted();\n      }\n    },\n    async onVideoPlayBackCompleted() {\n      if (this.isRecording()) {\n        this.toggleRecording();\n      }\n    },\n    async toggleRecording() {\n      if (this.countdownTimerRemaining > 0) return;\n\n      if (!this.isRecording()) {\n        await webcamProvider.startWebcam();\n\n        if (this.followAlong) {\n          await this.doCountdown();\n        }\n        await this.startRecording();\n\n      } else {\n        await webcamProvider.stopRecording(this.uploadFilename);\n        const blob = await webcamProvider.getBlob(this.uploadFilename);\n\n        this.lastRecordedBlob = blob;\n        this.recordedObjectUrl = URL.createObjectURL(this.lastRecordedBlob);\n        this.state = 'Review';\n        await webcamProvider.stopWebcam();\n\n        if (this.videoPlayer) {\n          this.videoPlayer.pauseVideo();\n        }\n      }\n    },\n    async doCountdown() {\n      // Perform countdown\n      this.countdownTimerRemaining = 3;\n      await sleep(1000);\n      this.countdownTimerRemaining = 2;\n      await sleep(1000);\n      this.countdownTimerRemaining = 1;\n      await sleep(1000);\n      this.countdownTimerRemaining = 0;\n    },\n    async startRecording() {\n      this.attempts += 1;\n      await webcamProvider.startRecording(this.uploadFilename);\n\n      if (this.followAlongRef && this.videoPlayer) {\n        const followData = this.followAlongRef as UploadFollowAlong;\n        this.videoPlayer.playVideo(followData.startTime, followData.endTime, followData.clipSpeed);\n      }\n    },\n    async rerecord() {\n      this.successfullyUploaded = false;\n      this.lastRecordedBlob = null;\n      this.recordedObjectUrl = '';\n      this.uploadError = null;\n      this.state = 'Record';\n      await webcamProvider.startWebcam();\n    },\n    async uploadVideo() {\n      if (!this.lastRecordedBlob) return;\n      if (this.isUploading) return;\n\n      this.isUploading = true;\n      this.uploadError = null;\n      const blobName = `${this.$props.uploadFilename}.webm`;\n\n      console.log(`Uploading recorded video: ${blobName}`);\n      try {\n        await AzureUploader.upload(this.lastRecordedBlob, blobName);\n      } catch (e) {\n        console.error('Error uploading video', e);\n        this.uploadError = e;\n      }\n\n      if (this.$props.activityLogUploadFilename) {\n\n        const logText = eventLogger.retrieveLog();\n        const logBlob = new Blob([logText], { type: 'text/plain' });\n        const logBlobName = `${this.$props.activityLogUploadFilename}.txt`;\n        console.log(`Uploading activity log: ${logBlobName}`);\n\n        try {\n          await AzureUploader.upload(logBlob, logBlobName);\n        } catch (e) {\n          console.error('Error uploading activity log', e);\n          this.uploadError = e;\n        }\n      }\n\n      if (this.uploadError === null) {\n        this.state = 'Success';\n      }\n\n      this.isUploading = false;\n    },\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n\n@import \"@/assets/main.scss\";\n\n.animate-width {\n  transition: width 0.2s ease;\n}\n\n.record-icon {\n  display: block;\n  width: 1.5rem;\n  height: 1.5rem;\n  border-radius: 1rem;\n  background-color: $dark;\n  transition: background-color 0.2s ease;\n\n  &.is-recording {\n    background-color: $red;\n  }\n}\n\n.control .record-icon {\n  margin-top: 8px;\n}\n</style>\n","// import { DefaultAzureCredential } from '@azure/identity';\nimport { BlobServiceClient } from '@azure/storage-blob';\n\n// const credential = new DefaultAzureCredential();\n\nconst blobServiceClient = new BlobServiceClient(\n  'https://dartrobotlabstorage.blob.core.windows.net/study-video-uploads?sv=2020-08-04&ss=bf&srt=co&sp=wdacitfx&se=2025-04-14T21:31:43Z&st=2022-04-14T13:31:43Z&spr=https&sig=RoRBLMKyg%2FUB48b2M1MLDLc%2FIsdNhkK66KaHvL%2BI0Y0%3D',\n  // 'https://dartrobotlabstorage.blob.core.windows.net/study-video-uploads?sp=acw&st=2021-04-07T02:19:35Z&se=2022-04-07T10:19:35Z&sv=2020-02-10&sr=c&sig=9fpKagbOjUqAjHF579%2FW7KiM4U8YcBrbI8J70tH35Y4%3D',\n  // credential,\n);\n\nexport default class AzureUploader {\n  public static async upload(data: Blob, blobName: string): Promise<void> {\n    const client = blobServiceClient.getContainerClient('study-video-uploads');\n\n    const blockBlobClient = client.getBlockBlobClient(blobName);\n\n    await blockBlobClient.uploadData(data);\n  }\n}\n","\nimport {\n  computed, defineComponent, onBeforeUnmount, ref, toRefs,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport AzureUploader from '@/services/AzureUploader';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\nimport { UploadFollowAlong } from '@/model/Workflow';\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\nimport videoDB from '@/services/VideoDatabase';\nimport eventLogger from '@/services/EventLogger';\n\nfunction sleep(ms: number) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nexport default defineComponent({\n  name: 'UploadScreen',\n  components: { WebcamBox, VideoPlayer },\n  emits: ['upload-canceled', 'upload-completed'],\n  props: {\n    title: {\n      type: String,\n      default: 'Video Upload',\n    },\n    subtitle: {\n      type: String,\n      default: null,\n    },\n    prompt: {\n      type: String,\n      default: 'Upload your video here',\n    },\n    uploadFilename: {\n      type: String,\n      default: null,\n    },\n    activityLogUploadFilename: {\n      type: String,\n      default: null,\n    },\n    maxAttempts: {\n      type: Number,\n      default: null,\n    },\n    followAlong: {\n      type: Object,\n      default: null,\n    },\n  },\n  setup(props) {\n    const { followAlong: followAlongRef, maxAttempts, uploadFilename } = toRefs(props);\n\n    const state = ref('Record' as 'Record' | 'Review' | 'Success');\n\n    const videoPlayer = ref(null as typeof VideoPlayer | null);\n    const attempts = ref(0);\n    const followAlongProgress = ref(0);\n    const countdownTimerRemaining = ref(0);\n\n    const lastRecordedBlob = ref(null as Blob | null);\n    const recordedObjectUrl = ref('');\n    const isUploading = ref(false);\n    const uploadError = ref(null as null | any);\n    const successfullyUploaded = computed(() => state.value === 'Success');\n\n    const videoBaseUrl = computed(() => {\n      if (!followAlongRef.value) {\n        return '';\n      }\n      const followData = followAlongRef.value as UploadFollowAlong;\n      const dbEntry = videoDB.entriesByClipName.get(followData.clipName);\n\n      if (!dbEntry) {\n        return '';\n      }\n\n      return `${dbEntry.videoSrc}#t=${followData.startTime},${followData.endTime}`;\n    });\n\n    const maxAttemptsIsReached = computed(() => attempts.value >= (maxAttempts.value ?? Infinity));\n\n    onBeforeUnmount(async () => {\n      const filename = uploadFilename.value;\n      await webcamProvider.abortRecording(filename);\n      await webcamProvider.clearRecording(filename);\n    });\n\n    return {\n      state,\n      webcamProvider,\n      attempts,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: () => webcamProvider.isRecording(uploadFilename.value),\n      lastRecordedBlob,\n      recordedObjectUrl,\n      isUploading,\n      uploadError,\n      successfullyUploaded,\n      videoPlayer,\n      followAlongRef,\n      videoBaseUrl,\n      followAlongProgress,\n      maxAttemptsIsReached,\n      countdownTimerRemaining,\n    };\n  },\n  methods: {\n    onProgress(progress: number) {\n      this.followAlongProgress = progress;\n      if (progress >= this.followAlong?.endTime) {\n        this.onVideoPlayBackCompleted();\n      }\n    },\n    async onVideoPlayBackCompleted() {\n      if (this.isRecording()) {\n        this.toggleRecording();\n      }\n    },\n    async toggleRecording() {\n      if (this.countdownTimerRemaining > 0) return;\n\n      if (!this.isRecording()) {\n        await webcamProvider.startWebcam();\n\n        if (this.followAlong) {\n          await this.doCountdown();\n        }\n        await this.startRecording();\n\n      } else {\n        await webcamProvider.stopRecording(this.uploadFilename);\n        const blob = await webcamProvider.getBlob(this.uploadFilename);\n\n        this.lastRecordedBlob = blob;\n        this.recordedObjectUrl = URL.createObjectURL(this.lastRecordedBlob);\n        this.state = 'Review';\n        await webcamProvider.stopWebcam();\n\n        if (this.videoPlayer) {\n          this.videoPlayer.pauseVideo();\n        }\n      }\n    },\n    async doCountdown() {\n      // Perform countdown\n      this.countdownTimerRemaining = 3;\n      await sleep(1000);\n      this.countdownTimerRemaining = 2;\n      await sleep(1000);\n      this.countdownTimerRemaining = 1;\n      await sleep(1000);\n      this.countdownTimerRemaining = 0;\n    },\n    async startRecording() {\n      this.attempts += 1;\n      await webcamProvider.startRecording(this.uploadFilename);\n\n      if (this.followAlongRef && this.videoPlayer) {\n        const followData = this.followAlongRef as UploadFollowAlong;\n        this.videoPlayer.playVideo(followData.startTime, followData.endTime, followData.clipSpeed);\n      }\n    },\n    async rerecord() {\n      this.successfullyUploaded = false;\n      this.lastRecordedBlob = null;\n      this.recordedObjectUrl = '';\n      this.uploadError = null;\n      this.state = 'Record';\n      await webcamProvider.startWebcam();\n    },\n    async uploadVideo() {\n      if (!this.lastRecordedBlob) return;\n      if (this.isUploading) return;\n\n      this.isUploading = true;\n      this.uploadError = null;\n      const blobName = `${this.$props.uploadFilename}.webm`;\n\n      console.log(`Uploading recorded video: ${blobName}`);\n      try {\n        await AzureUploader.upload(this.lastRecordedBlob, blobName);\n      } catch (e) {\n        console.error('Error uploading video', e);\n        this.uploadError = e;\n      }\n\n      if (this.$props.activityLogUploadFilename) {\n\n        const logText = eventLogger.retrieveLog();\n        const logBlob = new Blob([logText], { type: 'text/plain' });\n        const logBlobName = `${this.$props.activityLogUploadFilename}.txt`;\n        console.log(`Uploading activity log: ${logBlobName}`);\n\n        try {\n          await AzureUploader.upload(logBlob, logBlobName);\n        } catch (e) {\n          console.error('Error uploading activity log', e);\n          this.uploadError = e;\n        }\n      }\n\n      if (this.uploadError === null) {\n        this.state = 'Success';\n      }\n\n      this.isUploading = false;\n    },\n  },\n});\n\n","import { render } from \"./FeedbackUploadScreen.vue?vue&type=template&id=21bd46b7\"\nimport script from \"./FeedbackUploadScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./FeedbackUploadScreen.vue?vue&type=script&lang=ts\"\n\nimport \"./FeedbackUploadScreen.vue?vue&type=style&index=0&id=21bd46b7&lang=scss\"\nscript.render = render\n\nexport default script","import { ref } from 'vue';\n\nclass OptionsManager {\n\n  public workflowId = ref(null as string | null);\n\n  public participantId = ref(null as string | null);\n\n  public participantIdWasSet = ref(false);\n\n  public isDebug = ref(false);\n\n  public isExperimentActive = ref(false);\n\n  constructor() {\n    this.parsePath();\n    window.addEventListener('hashchange', this.parsePath);\n  }\n\n  parsePath() {\n    const urlParams = new URLSearchParams(window.location.search);\n\n    console.log('Parsing path....', urlParams);\n\n    this.workflowId.value = urlParams.get('workflowId');\n    this.participantId.value = urlParams.get('participantId');\n    this.isExperimentActive.value = this.workflowId.value !== null || this.participantId.value !== null;\n\n    if (this.participantId.value) {\n      this.participantIdWasSet.value = true;\n    }\n  }\n}\n\nconst optionsManager = new OptionsManager();\nexport default optionsManager;\n","import VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport Utils from '@/services/Utils';\nimport MiniLesson from './MiniLesson';\n\nexport interface UploadFollowAlong {\n  clipName: string;\n  clipSpeed: number;\n  startTime: number;\n  endTime: number;\n  visualMode: 'none' | 'skeleton' | 'video';\n}\n/**\n * Userflow.ts\n *\n * Data types that represent a specific workflow in the app\n */\nexport interface Instructions {\n  heading: string;\n  text: string;\n}\n\nexport interface WorkflowStep {\n  type: 'InstructionOnly' | 'MiniLessonReference' | 'MiniLessonEmbedded' | 'UploadTask';\n  title: string;\n  instructions?: Instructions;\n  miniLessonReference?: {\n    clipName: string;\n    lessonId: string;\n  };\n  miniLessonEmbedded?: MiniLesson;\n  upload?: {\n    identifier: string;\n    prompt: string;\n    maxAllowedAttempts?: number;\n    activityLogUploadIdentifier?: string;\n    followAlong? : UploadFollowAlong;\n  };\n  experiment?: {\n    showInExperimentOnly?: boolean;\n    disableRepitition?: boolean;\n    isTimeExpiredTask?: boolean;\n    isBeforeTimeStartTask?: boolean;\n  };\n}\n\nexport interface WorkflowStage {\n  title: string;\n  steps: WorkflowStep[];\n  shuffle?: {\n    startIndex: number;\n    endIndex: number;\n  };\n  maxStageTimeSecs?: number;\n}\n\nexport interface Workflow {\n  title: string;\n  userTitle?: string;\n  creationMethod: string;\n  learningScheme: string;\n  id: string;\n  stages: WorkflowStage[];\n  experimentMaxTimeSecs?: number;\n  created: Date | string;\n  thumbnailSrc?: string;\n}\n\nexport function CreateBlankWorkflow() {\n  return {\n    title: 'New Workflow',\n    id: Utils.uuidv4(),\n    creationMethod: 'User Created',\n    learningScheme: 'Custom',\n    stages: [],\n    created: new Date(),\n  } as Workflow;\n}\n\nexport function IsMiniLessonStep(step: WorkflowStep) {\n  return step.type === 'MiniLessonReference' || step.type === 'MiniLessonEmbedded';\n}\nexport function GetWorkflowStepVideoClipName(step: WorkflowStep) {\n  return IsMiniLessonStep(step)\n    ? (step.type === 'MiniLessonReference'\n      ? step.miniLessonReference?.clipName ?? null\n      : step.miniLessonEmbedded?.header.clipName) ?? null\n    : null;\n}\nexport function GetVideoEntryForWorkflowStep(db: any, step: WorkflowStep): VideoDatabaseEntry | null {\n  if (!IsMiniLessonStep(step)) return null;\n  return db.entriesByClipName.get(GetWorkflowStepVideoClipName(step));\n}\n","\nimport {\n  computed, defineComponent, nextTick, onBeforeUnmount, onMounted, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport WorkflowStepCard, { WorkflowStepCardInfo } from '@/components/elements/WorkflowStepCard.vue';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport db from '@/services/VideoDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport miniLessonManager from '@/services/MiniLessonManager';\nimport workflowManager, { TrackingWorkflow, TrackingWorkflowStage, TrackingWorkflowStep } from '@/services/WorkflowManager';\nimport FeedbackUploadScreen from '@/components/screens/FeedbackUploadScreen.vue';\nimport optionsManager from '@/services/OptionsManager';\nimport {\n  GetVideoEntryForWorkflowStep, IsMiniLessonStep, Workflow, WorkflowStage,\n} from '@/model/Workflow';\nimport eventLogger from '@/services/EventLogger';\n\nfunction getDurationString(seconds: number) {\n  if (seconds === Infinity) return 'Untimed';\n  if (Number.isNaN(seconds)) return 'Unknown';\n\n  const secsRemainingConstrained = Math.max(0, seconds);\n\n  if (secsRemainingConstrained < 3600) {\n    return new Date(secsRemainingConstrained * 1000).toISOString().substr(14, 5);\n  }\n  return new Date(secsRemainingConstrained * 1000).toISOString().substr(11, 8);\n}\n\nexport default defineComponent({\n  name: 'WorkflowMenu',\n  props: {\n    showHeader: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    enableTiming: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\n    'back-selected',\n  ],\n  components: {\n    MiniLessonPlayer,\n    FeedbackUploadScreen,\n    WorkflowStepCard,\n  },\n  computed: {\n    stages() { return ((this as any).workflow?.stages ?? []) as TrackingWorkflowStage[]; },\n    currentVideoEntry(): VideoDatabaseEntry | null {\n      if (this.currentStep?.type === 'MiniLessonReference' && this.currentStep?.miniLessonReference) {\n        return db.entriesByClipName.get(this.currentStep.miniLessonReference.clipName) ?? null;\n      }\n      if (this.currentStep?.type === 'MiniLessonEmbedded' && this.currentStep?.miniLessonEmbedded?.header.clipName) {\n        return db.entriesByClipName.get(this.currentStep.miniLessonEmbedded.header.clipName) ?? null;\n      }\n      return null;\n    },\n    currentLesson(): MiniLesson | null {\n      if (this.currentStep?.type === 'MiniLessonReference' && this.currentStep?.miniLessonReference) {\n        return miniLessonManager.lessonsById.get(this.currentStep.miniLessonReference.lessonId) ?? null;\n      }\n      if (this.currentStep?.type === 'MiniLessonEmbedded' && this.currentStep?.miniLessonEmbedded) {\n        return this.currentStep.miniLessonEmbedded;\n      }\n      return null;\n    },\n    uploadFilename(): string {\n      const uploadId = this.currentStep?.upload?.identifier ?? 'NoIdentifier';\n      const participantId = optionsManager.participantId.value ?? 'Anonomous';\n      const workflowId = this.workflow?.id ?? 'NullWorkflow';\n\n      return `user${participantId}-upload${uploadId}-workflow${workflowId}`;\n    },\n    activityLogUploadFilename(): string | null {\n      const uploadId = this.currentStep?.upload?.activityLogUploadIdentifier ?? null;\n      const participantId = optionsManager.participantId.value ?? 'Anonomous';\n      const workflowId = this.workflow?.id ?? 'NullWorkflow';\n\n      return uploadId === null ? null : `user${participantId}-upload${uploadId}-workflow${workflowId}`;\n    },\n    filteredStages() {\n      const workflow = (this as any).workflow as TrackingWorkflow;\n      const stages = workflow?.stages ?? [];\n      const isExperimentMode = (this as any).enableExperimentMode as boolean;\n      const activeStage = (this as any).activeStage as WorkflowStage;\n      const stageSecondsRemaining = (this as any).stageSecondsRemaining as number;\n\n      return stages.map((stage, stageIndex) => {\n        const filteredSteps = stage.steps\n          .filter((step) => isExperimentMode || !(step.experiment?.showInExperimentOnly ?? false))\n          .map((step, stepIndex) => {\n\n            const isTestMode = !isExperimentMode;\n            const isInActiveStage = activeStage === stage;\n            const isTimeExpiredTask = step.experiment?.isTimeExpiredTask ?? false;\n            const stageTimeExpired = stageSecondsRemaining <= 0;\n            const isValidAfterExpiredTask = isInActiveStage && isTimeExpiredTask && stageTimeExpired;\n            const isValidUnexpired = !isInActiveStage || (!isTimeExpiredTask && !stageTimeExpired);\n            // const isNewlyOnThisStage = this.activeStageIndex === stageIndex-1 && this.isStageCompleted(filteredStages[i-1])\n            const isBeforeTime = (step.experiment?.isBeforeTimeStartTask ?? false);\n            const isRepeatable = !(step.experiment?.disableRepitition ?? false);\n\n            return {\n              step,\n              isComplete: step.status === 'completed',\n              dbEntry: GetVideoEntryForWorkflowStep(db, step),\n              isExpired: !isTimeExpiredTask && stageTimeExpired,\n              isClickable: (isTestMode || isInActiveStage || isBeforeTime)\n                          && (isValidUnexpired || isValidAfterExpiredTask)\n                          && (isRepeatable || step.status !== 'completed'),\n              isNextStep: step === (this as any).nextStepInStage,\n              isValidAfterExpiredTask,\n              waitingForTimeExpiration: isInActiveStage && isTimeExpiredTask && !stageTimeExpired,\n              stageIndex,\n              stepIndex,\n            } as WorkflowStepCardInfo;\n          });\n\n        const beforeStartSteps = filteredSteps.filter((step) => step.step.experiment?.isBeforeTimeStartTask);\n        const mainSteps = filteredSteps.filter((step) => !step.step.experiment?.isBeforeTimeStartTask && !step.step.experiment?.isTimeExpiredTask);\n        const afterExpiredSteps = filteredSteps.filter((step) => step.step.experiment?.isTimeExpiredTask);\n        return {\n          ...stage,\n          beforeStartSteps,\n          mainSteps,\n          afterExpiredSteps,\n          filteredSteps,\n          timeLimitString: stage.maxStageTimeSecs ? getDurationString(stage.maxStageTimeSecs) : null,\n        };\n      });\n    },\n    nextStepInStage() {\n      // for (let i = 0; i < this.stages.length; i += 1) {\n      if (!this.filteredStages) return null;\n\n      const stage = (this as any).filteredStages[(this as any).activeStageIndex];\n      if (!stage) return null;\n\n      for (let j = 0; j < stage.filteredSteps.length; j += 1) {\n        const filteredStep = stage.filteredSteps[j];\n        if (filteredStep.step.status !== 'completed' && filteredStep.isClickable) return filteredStep.step as TrackingWorkflowStep;\n      }\n      // }\n      return null;\n    },\n  },\n  setup(props, ctx) {\n\n    const currentStep = ref(null as null | TrackingWorkflowStep);\n    const instructionsActive = ref(false);\n    const lessonActive = ref(false);\n    const uploadActive = ref(false);\n    const workflow = workflowManager.activeFlow;\n\n    onMounted(() => {\n      eventLogger.log(`Starting workflow ${workflow.value?.title} - ${workflow.value?.id}`);\n    });\n\n    const workflowStartTime = ref(new Date());\n    const workflowStageStartTime = ref(new Date());\n    const enableExperimentMode = ref(optionsManager.isExperimentActive.value);\n    const isTiming = ref(!optionsManager.isExperimentActive.value);\n    const timingNotStarted = computed(() => isTiming.value && !workflowStartTime.value);\n\n    const activeStageIndex = ref(-1);\n    const activeStage = computed(() => workflow.value?.stages[activeStageIndex.value] ?? null);\n    onMounted(() => {\n      workflowStartTime.value = new Date();\n      workflowStageStartTime.value = new Date();\n    });\n    let stageTimer = -1;\n    const workflowSecsElapsed = ref(Infinity);\n    const workflowSecondsRemaining = computed(() => {\n      if (!workflow.value?.experimentMaxTimeSecs) return Infinity;\n      return workflow.value.experimentMaxTimeSecs - workflowSecsElapsed.value;\n    });\n    const workflowSecondsRemainingString = computed(() => getDurationString(workflowSecondsRemaining.value));\n    const stageSecsElapsed = ref(Infinity);\n    const stageSecondsRemaining = computed(() => {\n      if (!activeStage.value?.maxStageTimeSecs) return Infinity;\n      return activeStage.value.maxStageTimeSecs - stageSecsElapsed.value;\n    });\n    const stageSecondsRemainingString = computed(() => getDurationString(stageSecondsRemaining.value));\n    onMounted(() => {\n      stageTimer = window.setInterval(() => {\n\n        const now = Date.now();\n        workflowSecsElapsed.value = (now - workflowStartTime.value.getTime()) / 1000;\n        stageSecsElapsed.value = (now - workflowStageStartTime.value.getTime()) / 1000;\n\n      }, 1000);\n    });\n\n    onMounted(() => {\n      if (workflow.value\n        && workflow.value.stages.length > 0\n        && (workflow.value.stages[0].maxStageTimeSecs ?? null) === null) {\n        // Auto-start the first stage if it isn't timed\n        activeStageIndex.value = 0;\n      }\n    });\n\n    onBeforeUnmount(() => {\n      clearInterval(stageTimer);\n      eventLogger.log(`Exited workflow '${workflow.value?.id}'`);\n    });\n\n    watch(workflow, () => {\n      currentStep.value = null;\n    });\n    watchEffect(() => {\n      const isInCurrentStage = (activeStage.value?.steps ?? []).indexOf(currentStep.value as any) !== -1;\n\n      if (isInCurrentStage && stageSecondsRemaining.value <= 0 && !currentStep.value?.experiment?.isTimeExpiredTask) {\n        eventLogger.log(`Stage time expired '${activeStage.value?.title}'`);\n        lessonActive.value = false;\n        currentStep.value = null;\n      }\n    });\n\n    return {\n      activeStage,\n      activeStageIndex,\n      currentStep,\n      instructionsActive,\n      lessonActive,\n      uploadActive,\n      workflow,\n      optionsManager,\n\n      workflowStartTime,\n      timingNotStarted,\n      isTiming,\n      workflowStageStartTime,\n      enableExperimentMode,\n      workflowSecsElapsed,\n      workflowSecondsRemaining,\n      workflowSecondsRemainingString,\n      stageSecsElapsed,\n      stageSecondsRemaining,\n      stageSecondsRemainingString,\n    };\n  },\n  methods: {\n    startTiming() {\n      this.workflowStartTime = new Date();\n      eventLogger.log(`Started workflow ${(this.workflow as any)?.id}`);\n    },\n    // getStepInfo(stage: TrackingWorkflowStage, stageIndex: number) {\n\n    //   return stage.steps\n    //     .filter((step) => this.enableExperimentMode || !(step.experiment?.showInExperimentOnly ?? false))\n    //     .map((step, stepIndex) => {\n\n    //       const isTestMode = !this.enableExperimentMode;\n    //       const isInActiveStage = this.activeStage === stage;\n    //       const isTimeExpiredTask = step.experiment?.isTimeExpiredTask ?? false;\n    //       const stageTimeExpired = this.stageSecondsRemaining <= 0;\n    //       const waitingForTimeExpiration = isTimeExpiredTask && !stageTimeExpired;\n\n    //       return {\n    //         step,\n    //         isComplete: step.status === 'completed',\n    //         isNextStep: step === this.nextStepInStage,\n    //         dbEntry: GetVideoEntryForWorkflowStep(db, step),\n    //         isClickable: (isTestMode || isInActiveStage)\n    //                     && (!isTimeExpiredTask || !stageTimeExpired)\n    //                     && !waitingForTimeExpiration,\n    //         waitingForTimeExpiration,\n    //         stageIndex,\n    //         stepIndex,\n    //       };\n    //     });\n    // },\n    instructionsFinished() {\n      this.instructionsActive = false;\n      const step = this.currentStep;\n      if (!step) return;\n      step.status = 'inprogress';\n      eventLogger.log(`Closed instructions '${step.title}'`);\n      this.continueWorkflowStep(step);\n    },\n    startWorkflowStep(item: TrackingWorkflowStep) {\n      // if (!this.isClickable(item)) return;\n      this.currentStep = item;\n      if (item.type === 'InstructionOnly') {\n        this.instructionsActive = true;\n        eventLogger.log(`Opened instructions '${item.title}'`);\n        return;\n      }\n      this.continueWorkflowStep(item);\n    },\n    continueWorkflowStep(item: TrackingWorkflowStep) {\n      if (item.type === 'InstructionOnly') {\n        // Instructions only - there's nothing else to do. Move to next activity!\n        this.completeStep(item);\n      } else if (item.type === 'MiniLessonReference' || item.type === 'MiniLessonEmbedded') {\n        eventLogger.log(`Started mini lesson '${item.title}'`);\n        this.lessonActive = true;\n      } else if (item.type === 'UploadTask') {\n        eventLogger.log(`Started upload task '${item.title}'`);\n        this.uploadActive = true;\n      } else {\n        console.error(`Item type ${item.type} not supported`);\n      }\n    },\n    lessonCompleted() {\n      this.lessonActive = false;\n      eventLogger.log(`Finished mini lesson '${this.currentStep?.title}'`);\n      this.completeStep(this.currentStep);\n    },\n    uploadComplete() {\n      this.uploadActive = false;\n      eventLogger.log(`Finished upload task '${this.currentStep?.title}'`);\n      this.completeStep(this.currentStep);\n    },\n    completeStep(step: TrackingWorkflowStep | null) {\n      if (!step) return;\n      step.status = 'completed';\n    },\n    isStageCompleted(stage: TrackingWorkflowStage) {\n      if (!stage) return true;\n\n      const steps = (stage as any).filteredSteps ?? [];\n      return steps.reduce((wasTrue: boolean, thisStep: any) => wasTrue && (thisStep.isComplete || thisStep.isExpired), true);\n    },\n    startStage(stageIndex: number) {\n      this.workflowStageStartTime = new Date();\n      eventLogger.log(`Started stage #${stageIndex} timed portion `);\n      nextTick(() => {\n        this.activeStageIndex = stageIndex;\n      });\n    },\n  },\n});\n","import { render } from \"./WorkflowMenu.vue?vue&type=template&id=0a2cf805\"\nimport script from \"./WorkflowMenu.vue?vue&type=script&lang=ts\"\nexport * from \"./WorkflowMenu.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <section class=\"section create-workflow-screen\" :class=\"{\n      'is-clipped': editLessonActive,\n    }\" :style=\"{\n      'max-height:100vh': editLessonActive,\n    }\">\n    <div class=\"hero is-primary block\">\n      <div class=\"hero-body\">\n        <div class=\"container\">\n          <p class=\"title\">\n            Workflow Creation\n          </p>\n          <p class=\"subtitle\">\n            <span v-if=\"activeWorkflow\">{{activeWorkflow.title}}</span>\n            <span v-else>Select a starting point...</span>\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"container block\">\n      <div class=\"buttons is-centered\">\n        <button class=\"button\" :class=\"{\n          'is-success': !isDirty && activeWorkflow,\n        }\"\n        @click=\"goBack()\">&lt; Back</button>\n        <button v-if=\"activeWorkflow && workflowInDatabase\" class=\"button is-danger\" @click=\"deleteWorkflow(undefined);\">\n          Delete\n        </button>\n        <button v-if=\"activeWorkflow\" class=\"button\" @click=\"exportWorkflow\">Export</button>\n        <button v-if=\"activeWorkflow\" class=\"button\"\n                :class=\"{\n                  'is-primary': isDirty\n                }\"\n                :disabled=\"!isDirty\"\n                @click=\"saveWorkflow\">\n          <!-- <span v-if=\"workflowInDatabase\">Update</span> -->\n          <span>Save</span>\n        </button>\n      </div>\n    </div>\n\n    <div class=\"container block has-text-centered\" v-if=\"!activeWorkflow\">\n      <div>\n      <div class=\"card block center-block has-text-left is-inline-block\">\n          <!-- <div class=\"card-header\">\n            <h4 class=\"card-header-title\">Pick a template:</h4>\n          </div> -->\n          <div class=\"card-content menu\">\n            <ul class=\"menu-list\">\n              <li>\n                <a @click=\"selectingWorkflowIndex = -1\"\n                  :class=\"{'is-active': selectingWorkflowIndex === -1}\">(start from scratch)</a>\n              </li>\n              <li v-for=\"(workflow, i) in availableWorkflows\" :key=\"workflow.id\">\n                <a @click=\"selectingWorkflowIndex = i\" :class=\"{'is-active': selectingWorkflowIndex === i}\">\n                  <strong>#{{i+1}}</strong>\n                  {{workflow.title}}\n                  <span class=\"tag\" v-if=\"isCustomWorkflow(workflow.id)\">custom</span>\n                </a>\n              </li>\n            </ul>\n          </div>\n          <div class=\"card-footer\" v-if=\"canEditWorkflow\">\n            <a class=\"card-footer-item is-danger\" @click=\"deleteWorkflow(selectingWorkflowId)\">Delete</a>\n            <a class=\"card-footer-item\" @click=\"canEditWorkflow && startCreation(false)\">Edit</a>\n          </div>\n          <div class=\"card-footer\">\n            <a class=\"card-footer-item\" @click=\"startCreation(true)\">\n              <span v-if=\"selectingWorkflowIndex === -1\">Start New</span>\n              <span v-else>Use as Template</span>\n            </a>\n          </div>\n        </div>\n        <button class=\"button\" @click=\"exportCustomWorkflows()\">\n              Export {{customWorkflowCount}} Custom Workflows\n        </button>\n      </div>\n    </div>\n    <div class=\"block columns is-multiline\" v-else>\n\n      <div class=\"column is-narrow\">\n        <div class=\"box\">\n          <p class=\"title is-5\">Workflow</p>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">ID</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" disabled type=\"text\" :value=\"activeWorkflow.id\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Created</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" disabled type=\"date\" :value=\"activeWorkflow.created\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeWorkflow.title\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Display Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeWorkflow.userTitle\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Creation Method</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeWorkflow.creationMethod\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Learning Scheme</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeWorkflow.learningScheme\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label\">\n              <label class=\"label\">Stages</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <ul class=\"menu-list\">\n                    <li v-for=\"(stage, i) in activeWorkflow.stages\" :key=\"i\">\n                      <a :class=\"{'is-active': selectedStageIndex === i}\" @click=\"selectStage(i)\"><strong>{{i+1}}&nbsp;</strong>&nbsp;{{stage.title}}</a>\n                    </li>\n                    <li v-if=\"activeStage\"><a @click=\"duplicateStage()\"><span class=\"icon\"><i class=\"far fa-copy\"></i></span><span>Duplicate</span></a></li>\n                    <li><a @click=\"addStage()\"><span class=\"icon\">&plus;</span><span>Add Stage</span></a></li>\n                    <li v-if=\"activeWorkflow.stages.length === 0\">No Stages</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"column is-narrow\" v-if=\"activeStage\">\n        <div class=\"box\">\n          <div class=\"title is-5\">Stage #{{selectedStageIndex + 1}}: <code>{{activeStage.title}}</code></div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Order</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field has-addons\">\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStage(-1)\" @click=\"reorderStage(-1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-down\"></i></div>\n                  </button>\n                </div>\n                <div class=\"control is-expanded\">\n                  <input class=\"input\" type=\"text\" disabled :value=\"selectedStageIndex + 1\">\n                </div>\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStage(1)\" @click=\"reorderStage(1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-up\"></i></div>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeStage.title\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Time (seconds)</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"number\" v-model.number=\"activeStage.maxStageTimeSecs\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label\">\n              <label class=\"label\">Steps</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <ul class=\"menu-list\">\n                    <li v-for=\"(step, i) in activeStage.steps\" :key=\"i\">\n                      <a :class=\"{'is-active': selectedStepIndex === i}\" @click=\"selectStep(i)\"><strong>{{i+1}}&nbsp;</strong>&nbsp;{{step.title}}</a>\n                    </li>\n                    <li v-if=\"activeStep\"><a @click=\"duplicateStep()\"><span class=\"icon\"><i class=\"far fa-copy\"></i></span><span>Duplicate</span></a></li>\n                    <li><a @click=\"addStep()\">&plus; Add Step</a></li>\n                    <li v-if=\"activeStage.steps.length === 0\">No Steps</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n          <hr>\n          <div class=\"buttons is-right\">\n            <button class=\"button is-danger is-outlined\" @click=\"deleteStage\">Delete</button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"column is-narrow\" v-if=\"activeStep\">\n        <div class=\"box\">\n          <div class=\"title is-5\">Step #{{selectedStepIndex + 1}}: <code>{{activeStep.title}}</code></div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Order</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field has-addons\">\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStep(-1)\" @click=\"reorderStep(-1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-down\"></i></div>\n                  </button>\n                </div>\n                <div class=\"control is-expanded\">\n                  <input class=\"input\" type=\"text\" disabled :value=\"selectedStepIndex + 1\">\n                </div>\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStep(1)\" @click=\"reorderStep(1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-up\"></i></div>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeStep.title\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label\">\n              <label class=\"label\">Type</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <div class=\"select\">\n                    <select v-model=\"activeStep.type\">\n                      <option :value=\"'InstructionOnly'\">Instruction</option>\n                      <option :value=\"'MiniLessonReference'\">Mini Lesson (Reference)</option>\n                      <option :value=\"'MiniLessonEmbedded'\">Mini Lesson (Embedded)</option>\n                      <option :value=\"'UploadTask'\">Video Upload</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-grouped is-grouped-right\" v-if=\"(activeWorkflow?.stages ?? []).length > 1\">\n            <div class=\"control\">\n              <div class=\"dropdown is-right\" :class=\"{'is-active': isMoveStepDropdownActive}\">\n                <div class=\"dropdown-trigger\">\n                  <button class=\"button\" @click=\"isMoveStepDropdownActive = !isMoveStepDropdownActive\">\n                    <span>Move to stage&hellip;</span>\n                    <span class=\"icon is-small\" v-if=\"!isMoveStepDropdownActive\"><i class=\"fas fa-angle-down\" aria-hidden=\"true\"></i></span>\n                    <span class=\"icon is-small\" v-if=\"isMoveStepDropdownActive\"><i class=\"fas fa-angle-up\" aria-hidden=\"true\"></i></span>\n                  </button>\n                </div>\n                <div class=\"dropdown-menu\">\n                  <div class=\"box has-background-white\">\n                    <div class=\"menu\">\n                      <p class=\"menu-label\">Move to stage:</p>\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(stage, stageI) in this.activeWorkflow?.stages ?? []\" :key=\"stageI\">\n                          <a @click=\"moveStep(stageI)\" :class=\"{'is-active': selectedStageIndex === stageI }\">\n                            <strong>{{stageI + 1}}</strong>&nbsp;&nbsp;{{stage.title}}\n                          </a>\n                        </li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <hr>\n\n          <div v-if=\"isInstructionStep\" class=\"block\">\n            <div class=\"field is-horizontal\">\n              <div class=\"field-label is-normal\">\n                <label class=\"label\">Heading</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <input class=\"input\" type=\"text\" v-model=\"activeStep.instructions.heading\">\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div v-if=\"isLessonEmbeddedStep\" class=\"block\">\n            <div v-if=\"activeStep.miniLessonEmbedded\" class=\"card\">\n              <header class=\"card-header\">\n                <p class=\"card-header-title\">{{activeStep.miniLessonEmbedded.header.lessonTitle}}</p>\n              </header>\n              <div class=\"card-content\">\n                <div class=\"content\" v-if=\"activeStepLesson.activities\">\n                  <p>Activities</p>\n                  <ol v-if=\"activeStepLesson.activities.length <= 6\">\n                    <li v-for=\"(activity, i) in activeStepLesson.activities\" :key=\"i\">\n                      {{activity.title}}\n                    </li>\n                  </ol>\n                  <ol v-else>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(0, 3)\" :key=\"i\">{{activity.title}}</li>\n                      <li style=\"list-style:none;\">&hellip;</li>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(-3)\" :key=\"i\" :value=\"activeStepLesson.activities.length - 2 + i\">{{activity.title}}</li>\n                  </ol>\n                </div>\n              </div>\n              <div class=\"card-footer\">\n                <a class=\"card-footer-item has-text-danger\" @click=\"removeEmbeddedLesson\">Remove</a>\n                <a class=\"card-footer-item\" @click=\"convertEmbeddedLessonToReference\">Make Reference</a>\n                <a class=\"card-footer-item\" @click=\"editWorkflowStepLesson\">Edit</a>\n              </div>\n            </div>\n            <div v-else class=\"has-text-centered\">\n              <p>No Embedded Lesson</p>\n\n              <div class=\"field has-addons\">\n                <div class=\"control is-expanded\">\n                  <div class=\"select is-fullwidth\">\n                    <select class=\"select\" v-model=\"newEmbeddedLessonClipName\">\n                      <option disabled value=\"\">Select a clip</option>\n                      <option v-for=\"clipName in availableClips\" :key=\"clipName\">{{clipName}}</option>\n                    </select>\n                  </div>\n                </div>\n                <div class=\"control\">\n                  <button class=\"button is-primary\" :disabled=\"!canCreateEmbeddedLesson\" @click=\"startCreateEmbeddedLesson\">Create</button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div v-if=\"isLessonReferenceStep\" class=\"block\">\n            <div class=\"field is-horizontal\">\n              <div class=\"field-label\">\n                <label class=\"label\">Clip</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <div class=\"select\" v-if=\"activeStep.miniLessonReference\">\n                      <select v-model=\"activeStep.miniLessonReference.clipName\">\n                        <option disabled value=\"\">Select a clip</option>\n                        <option v-for=\"clipName in availableClips\" :key=\"clipName\">{{clipName}}</option>\n                      </select>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\"field is-horizontal\">\n              <div class=\"field-label\">\n                <label class=\"label\">Lesson</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <div class=\"select\">\n                      <select v-model=\"activeStep.miniLessonReference.lessonId\">\n                        <option value=\"\">&plus; Create New</option>\n                        <option disabled></option>\n                        <option v-for=\"lesson in availableReferenceLessons\" :key=\"lesson._id\" :value=\"lesson._id\">{{lesson.header.lessonTitle}}</option>\n                      </select>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <hr>\n            <div v-if=\"activeStepLesson\" class=\"card\">\n              <header class=\"card-header\">\n                <p class=\"card-header-title\">{{activeStepLesson.header.lessonTitle}}</p>\n              </header>\n              <div class=\"card-content\">\n                <div class=\"content\">\n                  <p>Activities</p>\n                  <ol v-if=\"activeStepLesson.activities.length <= 6\">\n                    <li v-for=\"(activity, i) in activeStepLesson.activities\" :key=\"i\">\n                      {{activity.title}}\n                    </li>\n                  </ol>\n                  <ol v-else>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(0, 3)\" :key=\"i\">{{activity.title}}</li>\n                      <li style=\"list-style:none;\">&hellip;</li>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(-3)\" :key=\"i\" :value=\"activeStepLesson.activities.length - 2 + i\">{{activity.title}}</li>\n                  </ol>\n                </div>\n              </div>\n              <div class=\"card-footer\">\n                <a v-if=\"canEditActiveStepLessonReference\" class=\"card-footer-item\" @click=\"editWorkflowStepLesson\">Edit Referenced Lesson</a>\n                <p v-else class=\"card-footer-item\">Unable to edit a built-in lesson</p>\n              </div>\n            </div>\n            <div v-else class=\"buttons is-centered\">\n              <button class=\"button is-outlined is-primary\" @click=\"createReferencedLesson\"><span class=\"icon is-small\"><i class=\"fa fa-plus\"></i></span><span>Create Referenced Lesson</span></button>\n            </div>\n          </div>\n\n          <div v-if=\"isVideoUploadStep\" class=\"block\">\n            <h3 class=\"is-size-5 block\">Upload Settings</h3>\n            <button v-if=\"!activeStep.upload\" class=\"button\" @click=\"activeStep.upload = {}\">&plus; Add</button>\n            <div v-else>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">File Identifier</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" type=\"text\" v-model=\"activeStep.upload.identifier\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Log Identifier</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" type=\"text\" v-model=\"activeStep.upload.activityLogUploadIdentifier\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Prompt</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" type=\"text\" v-model=\"activeStep.upload.prompt\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Max Attempts</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" type=\"number\" min=\"0\" max=\"10\" v-model.number=\"activeStep.upload.maxAllowedAttempts\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Follow Along</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <button class=\"button\" v-if=\"!activeStep.upload.followAlong\" @click=\"activeStep.upload.followAlong = {}\">&plus; Add</button>\n                    <div class=\"box\" v-else>\n\n                      <div class=\"field is-horizontal\">\n                        <div class=\"field-label is-normal\">\n                          <label class=\"label\">Clip</label>\n                        </div>\n                        <div class=\"field-body\">\n                          <div class=\"field\">\n                            <div class=\"control\">\n                              <div class=\"select\">\n                                <select class=\"select\" v-model=\"activeStep.upload.followAlong.clipName\">\n                                  <option disabled value=\"\">Select a clip</option>\n                                  <option v-for=\"clipName in availableClips\" :key=\"clipName\">{{clipName}}</option>\n                                </select>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div class=\"field is-horizontal\">\n                        <div class=\"field-label is-normal\">\n                          <label class=\"label\">Visual Mode</label>\n                        </div>\n                        <div class=\"field-body\">\n                          <div class=\"field\">\n                            <div class=\"control\">\n                              <div class=\"select\">\n                                <select class=\"select\" v-model=\"activeStep.upload.followAlong.visualMode\">\n                                  <option disabled value=\"\">Select a mode</option>\n                                  <option value=\"none\">Audio Only</option>\n                                  <option value=\"skeleton\">Skeleton Visual</option>\n                                  <option value=\"video\">Video</option>\n                                </select>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div class=\"pl-4\">Duration: {{durationOfClip(activeStep.upload.followAlong.clipName)}}</div>\n\n                      <div class=\"field is-horizontal\">\n                        <div class=\"field-label is-normal\">\n                          <label class=\"label\">Speed</label>\n                        </div>\n                        <div class=\"field-body\">\n                          <div class=\"field\">\n                            <div class=\"control\">\n                              <input type=\"number\" class=\"input\" min=\"0.1\" max=\"4.0\" step=\"0.1\" v-model.number=\"activeStep.upload.followAlong.clipSpeed\" @change=\"(event) => activeStep.upload.followAlong.endTime = durationOfClip(event.target.value)\"/>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div class=\"field is-horizontal\">\n                        <div class=\"field-label is-normal\">\n                          <label class=\"label\">Start</label>\n                        </div>\n                        <div class=\"field-body\">\n                          <div class=\"field\">\n                            <div class=\"control\">\n                              <input type=\"number\" class=\"input\" min=\"0\" :max=\"durationOfClip(activeStep.upload.followAlong.clipName)\" step=\"0.01\" v-model.number=\"activeStep.upload.followAlong.startTime\"/>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div class=\"field is-horizontal\">\n                        <div class=\"field-label is-normal\">\n                          <label class=\"label\">End</label>\n                        </div>\n                        <div class=\"field-body\">\n                          <div class=\"field\">\n                            <div class=\"control\">\n                              <input type=\"number\" class=\"input\" min=\"0\" :max=\"durationOfClip(activeStep.upload.followAlong.clipName)\" step=\"0.01\" v-model.number=\"activeStep.upload.followAlong.endTime\"/>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <hr>\n\n          <div class=\"block\">\n            <h3 class=\"is-size-5 block\">Experiment</h3>\n             <button v-if=\"!activeStep.experiment\" class=\"button\" @click=\"activeStep.experiment = {}\">&plus; Add</button>\n             <div v-else>\n\n              <div class=\"field\">\n                <div class=\"control\">\n                  <label class=\"checkbox\">\n                    <input class=\"\" type=\"checkbox\" v-model=\"activeStep.experiment.showInExperimentOnly\">\n                    Show in Experiment Only\n                  </label>\n                </div>\n              </div>\n\n              <div class=\"field\">\n                <div class=\"control\">\n                  <label class=\"checkbox\">\n                    <input class=\"\" type=\"checkbox\" v-model=\"activeStep.experiment.disableRepitition\">\n                    Disable Repitition\n                  </label>\n                </div>\n              </div>\n\n              <div class=\"field\">\n                <div class=\"control\">\n                  <label class=\"checkbox\">\n                    <input class=\"\" type=\"checkbox\" v-model=\"activeStep.experiment.isTimeExpiredTask\">\n                    Is Time Expired Task\n                  </label>\n                </div>\n              </div>\n\n              <div class=\"field\">\n                <div class=\"control\">\n                  <label class=\"checkbox\">\n                    <input class=\"\" type=\"checkbox\" v-model=\"activeStep.experiment.isBeforeTimeStartTask\">\n                    Is Before Time Start Task\n                  </label>\n                </div>\n              </div>\n\n             </div>\n          </div>\n\n          <div class=\"buttons is-right\">\n            <button class=\"button is-danger is-outlined\" @click=\"deleteStep\">Delete</button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"column\">\n        <div class=\"box\">\n          <div class=\"title is-5\">Demo</div>\n        </div>\n        <WorkflowMenu :showHeader=\"true\" :showBackButton=\"false\"/>\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': editLessonActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\" style=\"width: 96%; height: 100vh;\">\n        <div class=\"box\">\n          <CreateLessonScreen v-if=\"editLessonActive\"\n            :motion=\"embeddedLessonMotion\"\n            :lessonToEdit=\"activeStepLesson\"\n            @back-selected=\"editLessonActive = false\"\n            @lesson-saved=\"updateWorkflowStepLesson\"\n            :saveToDatabase=\"isLessonReferenceStep\"\n            :showBackButton=\"false\"\n            :showCloseButton=\"true\"\n            :showExportButton=\"isLessonReferenceStep\"\n            :disableEditingExisting=\"true\"\n          />\n        </div>\n        <!-- <UploadCard\n          v-if=\"uploadUIActive\"\n          @cancelled=\"uploadUIActive = false\"\n          :uploadAccept=\"'*.json'\"\n          :onFilesSelected=\"uploadFiles\"\n          :savingText=\"'Loading lessons...'\"\n          :successText=\"'Lessons loaded successfully'\"\n        /> -->\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed, defineComponent, nextTick, ref, watchEffect,\n} from 'vue';\nimport {\n  CreateBlankWorkflow, GetVideoEntryForWorkflowStep, Instructions, Workflow, WorkflowStage, WorkflowStep,\n} from '@/model/Workflow';\nimport Utils from '@/services/Utils';\nimport miniLessonManager, { MiniLessonManager } from '@/services/MiniLessonManager';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport videoDB from '@/services/VideoDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport CreateLessonScreen from '@/components/screens/CreateLessonScreen.vue';\n\nexport default defineComponent({\n  name: 'CreateWorkflowScreen',\n  emits: ['back-selected', 'workflow-created'],\n  components: {\n    WorkflowMenu,\n    CreateLessonScreen,\n  },\n  setup() {\n\n    const isDirty = ref(false);\n\n    const activeWorkflow = ref(null as null | Workflow);\n    const selectingWorkflowIndex = ref(-1);\n    const selectingWorkflowId = computed(() => {\n      const selectingWorkflow = workflowManager.workflowsArray.value[selectingWorkflowIndex.value];\n      return selectingWorkflow?.id ?? null;\n    });\n    const canEditWorkflow = computed(() => {\n      const id = selectingWorkflowId.value;\n      return id && workflowManager.isCustomWorkflow(id);\n    });\n    const workflowInDatabase = computed(() => activeWorkflow.value?.id && WorkflowManager.hasSavedCustomLesson(activeWorkflow.value.id));\n    const selectedStageIndex = ref(0);\n    const activeStage = computed(() => activeWorkflow.value?.stages[selectedStageIndex.value] ?? null);\n    const selectedStepIndex = ref(0);\n    const activeStep = computed(() => activeStage.value?.steps[selectedStepIndex.value] ?? null);\n    const isVideoUploadStep = computed(() => activeStep.value?.type === 'UploadTask');\n    const isLessonReferenceStep = computed(() => activeStep.value?.type === 'MiniLessonReference');\n    const isLessonEmbeddedStep = computed(() => activeStep.value?.type === 'MiniLessonEmbedded');\n    const isInstructionStep = computed(() => activeStep.value?.type === 'InstructionOnly');\n    const availableReferenceLessons = computed(() => {\n      if (!activeStep.value) return [] as MiniLesson[];\n      if (!activeStep.value.miniLessonReference?.clipName) return [] as MiniLesson[];\n      return miniLessonManager.lessonsByVideo.get(activeStep.value.miniLessonReference.clipName) ?? [];\n    });\n    const activeStepLesson = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonReferenceStep.value && activeStep.value.miniLessonReference?.lessonId) return miniLessonManager.lessonsById.get(activeStep.value.miniLessonReference.lessonId) ?? null;\n      if (isLessonEmbeddedStep.value) return activeStep.value.miniLessonEmbedded ?? null;\n      return null;\n    });\n    const canEditActiveStepLessonReference = computed(() => activeStepLesson.value?.source === 'custom');\n    const newEmbeddedLessonClipName = ref('');\n    const newEmbeddedLessonMotion = computed(() => videoDB.entriesByClipName.get(newEmbeddedLessonClipName.value) ?? null);\n    const canCreateEmbeddedLesson = computed(() => newEmbeddedLessonMotion.value !== null);\n    const editLessonActive = ref(false);\n    const embeddedLessonMotion = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonEmbeddedStep.value && activeStep.value.miniLessonEmbedded) return GetVideoEntryForWorkflowStep(videoDB, activeStep.value);\n      if (isLessonEmbeddedStep.value) return newEmbeddedLessonMotion.value;\n      if (isLessonReferenceStep.value) return GetVideoEntryForWorkflowStep(videoDB, activeStep.value);\n      return null;\n    });\n\n    watchEffect(() => {\n      if (activeWorkflow.value) {\n        workflowManager.setActiveFlow(activeWorkflow.value.id);\n        workflowManager.completeActivitesPriorToStageAndStep(selectedStageIndex.value, selectedStepIndex.value);\n        // TODO: improve logic to keep status of intra-stage workflow steps.\n      }\n    });\n\n    watchEffect(() => {\n      if (!activeStep.value) return;\n      if (isInstructionStep.value) {\n        activeStep.value.instructions = activeStep.value.instructions ?? {\n          heading: 'Instructions Heading',\n          text: '',\n        } as Instructions;\n      } else if (isLessonReferenceStep.value) {\n        activeStep.value.miniLessonReference = activeStep.value.miniLessonReference ?? {} as any;\n        //  ?? {\n\n        // };\n      } else if (isLessonEmbeddedStep.value) {\n        // activeStep.value.miniLessonEmbedded = activeStep.value.miniLessonEmbedded;\n        //  ?? {\n\n        // };\n      } else if (isVideoUploadStep.value) {\n        activeStep.value.upload = activeStep.value.upload ?? {\n          identifier: activeStep.value.title,\n          prompt: 'Upload your video here',\n        };\n      }\n    });\n\n    const customWorkflowCount = computed(() => workflowManager.workflowsArray.value.filter((w) => workflowManager.isCustomWorkflow(w.id)).length);\n\n    function exportCustomWorkflows() {\n      const workflows = workflowManager.workflowsArray.value.filter((w) => workflowManager.isCustomWorkflow(w.id));\n      const json = JSON.stringify(workflows, null, 2);\n      Utils.PromptDownloadFile('custom-workflows.json', json);\n    }\n    return {\n      selectingWorkflowIndex,\n      selectingWorkflowId,\n      activeWorkflow,\n      canEditWorkflow,\n      workflowInDatabase,\n      customWorkflowCount,\n      exportCustomWorkflows,\n      availableWorkflows: workflowManager.workflowsArray,\n      selectedStageIndex,\n      activeStage,\n\n      selectedStepIndex,\n      activeStep,\n      isVideoUploadStep,\n      isLessonReferenceStep,\n      isLessonEmbeddedStep,\n      isInstructionStep,\n      availableClips: videoDB.clipNames,\n      availableReferenceLessons,\n      newEmbeddedLessonClipName,\n      newEmbeddedLessonMotion,\n      embeddedLessonMotion,\n      canCreateEmbeddedLesson,\n      editLessonActive,\n      activeStepLesson,\n      canEditActiveStepLessonReference,\n      isMoveStepDropdownActive: ref(false),\n\n      isDirty,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  watch: {\n    activeWorkflow: {\n      handler(newVal) {\n        console.log('Workflow now dirty');\n        this.isDirty = ((newVal ?? null) !== null);\n      },\n      deep: true,\n    },\n  },\n  computed: {\n  },\n  methods: {\n    isCustomWorkflow(id: string) {\n      return workflowManager.isCustomWorkflow(id);\n    },\n    durationOfClip(clipName: string) {\n      const entry = videoDB.entriesByClipName.get(clipName);\n      if (!entry) return 0;\n      return entry.duration;\n    },\n    goBack(skipPrompt?: boolean) {\n      if (!this.activeWorkflow) {\n        this.$emit('back-selected');\n        return;\n      }\n\n      if (skipPrompt || !this.isDirty) {\n        this.activeWorkflow = null;\n        return;\n      }\n\n      // eslint-disable-next-line no-alert\n      if (window.confirm('Go back without saving changes?')) {\n        workflowManager.reloadCustomWorkflow(this.activeWorkflow.id);\n        this.activeWorkflow = null;\n      }\n    },\n    deleteWorkflow(id: string | undefined) {\n      if (!id && !this.activeWorkflow) return;\n      if (!id) id = this.activeWorkflow?.id ?? '';\n\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this workflow?')) {\n        return;\n      }\n\n      workflowManager.deleteCustomWorkflow(id);\n      this.goBack(true);\n    },\n    exportWorkflow() {\n      if (!this.activeWorkflow) return;\n      Utils.PromptDownloadFile(`${this.activeWorkflow.title}.workflow.json`, JSON.stringify(this.activeWorkflow));\n    },\n    saveWorkflow() {\n      if (!this.activeWorkflow) return;\n      console.log('Saving workflow');\n      workflowManager.upsertCustomWorkflow(this.activeWorkflow);\n      nextTick(() => {\n        this.isDirty = false;\n        console.log('Workflow saved; not dirty now');\n      });\n      // window.setTimeout(() => {\n      // }, 200);\n    },\n    startCreation(asTemplate: boolean) {\n      const existingWorkflow = this.availableWorkflows[this.selectingWorkflowIndex];\n      let newActiveWorkflow;\n      if (existingWorkflow && asTemplate) {\n        newActiveWorkflow = Utils.deepCopy(existingWorkflow);\n        newActiveWorkflow.id = Utils.uuidv4();\n        this.activeWorkflow = newActiveWorkflow;\n\n      } else if (existingWorkflow && !asTemplate) {\n        newActiveWorkflow = existingWorkflow;\n        this.activeWorkflow = newActiveWorkflow;\n        nextTick(() => {\n          this.isDirty = false;\n        });\n\n      } else {\n        newActiveWorkflow = CreateBlankWorkflow();\n        this.activeWorkflow = newActiveWorkflow;\n      }\n\n      workflowManager.addSessionWorkflow(newActiveWorkflow);\n      workflowManager.setActiveFlow(newActiveWorkflow.id);\n    },\n    selectStage(stageIndex: number) {\n\n      // Clear selection if this stage was already selected\n      if (stageIndex === this.selectedStageIndex) {\n        this.selectedStageIndex = -1;\n        this.selectedStepIndex = -1;\n        return;\n      }\n\n      this.selectedStageIndex = stageIndex;\n      this.selectedStepIndex = -1;\n      workflowManager.completeActivitesPriorToStageAndStep(stageIndex, this.selectedStepIndex);\n    },\n    canReorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      const swapStage = stages[this.selectedStageIndex + increment];\n      return (curStage !== undefined) && (swapStage !== undefined);\n    },\n    reorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const swapIndex = this.selectedStageIndex + increment;\n      const curSelected = stages[this.selectedStageIndex];\n      const toSwap = stages[swapIndex];\n      if ((curSelected === undefined) || (toSwap === undefined)) {\n        console.warn(`Unable to swap stages ${this.selectedStageIndex} and ${swapIndex}`);\n        return;\n      }\n      stages[this.selectedStageIndex] = toSwap;\n      stages[swapIndex] = curSelected;\n      this.selectedStageIndex = swapIndex;\n      workflow.stages = stages;\n    },\n    addStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n\n      workflow.stages.push({\n        title: `New-Stage-${workflow.stages.length + 1}`,\n        steps: [],\n      } as WorkflowStage);\n      this.selectStage(workflow.stages.length - 1);\n    },\n    duplicateStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      if (!curStage) return;\n      stages.splice(this.selectedStageIndex, 0, Utils.deepCopy(curStage));\n      workflow.stages = stages;\n      this.selectedStageIndex += 1;\n    },\n    deleteStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Stage #${this.selectedStageIndex + 1}?`)) return;\n\n      const { stages } = workflow;\n      stages.splice(this.selectedStageIndex, 1);\n      workflow.stages = stages;\n      this.selectedStageIndex = Math.min(this.selectedStageIndex, stages.length - 1);\n    },\n    selectStep(stepIndex: number) {\n\n      // Clear selectedStep if already selected\n      if (this.selectedStepIndex === stepIndex) {\n        this.selectedStepIndex = -1;\n        return;\n      }\n      this.selectedStepIndex = stepIndex;\n\n      workflowManager.completeActivitesPriorToStageAndStep(this.selectedStageIndex, this.selectedStepIndex);\n    },\n    canReorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return false;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[this.selectedStepIndex + increment];\n      return (curStep !== undefined) && (swapStep !== undefined);\n    },\n    reorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const ogSteps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!ogSteps) return;\n      const steps = [...ogSteps];\n      const swapIndex = this.selectedStepIndex + increment;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[swapIndex];\n      if ((curStep === undefined) || (swapStep === undefined)) {\n        console.warn(`Unable to swap steps ${this.selectedStepIndex} and ${swapIndex}`);\n        return;\n      }\n      steps[this.selectedStepIndex] = swapStep;\n      steps[swapIndex] = curStep;\n      this.selectedStepIndex = swapIndex;\n      workflow.stages[this.selectedStageIndex].steps = steps;\n    },\n    addStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n\n      stage.steps.push({\n        title: `New-Step-${stage.steps.length + 1}`,\n        type: 'InstructionOnly',\n      } as WorkflowStep);\n      this.selectStep(stage.steps.length - 1);\n    },\n    duplicateStep() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const curStep = this.activeWorkflow?.stages[this.selectedStageIndex]?.steps[this.selectedStepIndex];\n      if (!curStep) return;\n      const { steps } = workflow.stages[this.selectedStageIndex];\n      steps.splice(this.selectedStepIndex, 0, Utils.deepCopy(curStep));\n      workflow.stages[this.selectedStageIndex].steps = steps;\n      this.selectedStepIndex += 1;\n    },\n    moveStep(targetStageIndex: number) {\n      if (targetStageIndex === this.selectedStageIndex) return;\n      const stage = this.activeStage;\n      const stepToMove = this.activeStep;\n      const targetPhase = this.activeWorkflow?.stages[targetStageIndex];\n      if (!stage || !stepToMove || !targetPhase) return;\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      targetPhase.steps.push(stepToMove);\n      this.selectedStageIndex = targetStageIndex;\n      this.selectedStepIndex = this.activeStage?.steps.length ?? 0;\n      this.isMoveStepDropdownActive = false;\n    },\n    deleteStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Step #${this.selectedStepIndex + 1}?`)) return;\n\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      this.selectedStepIndex = Math.min(this.selectedStepIndex, steps.length - 1);\n    },\n    updateWorkflowStepLesson(lesson: MiniLesson) {\n      if (!this.activeStep) return;\n      if (this.isLessonEmbeddedStep) {\n        this.activeStep.miniLessonEmbedded = lesson;\n        console.log('Updated embedded lesson', lesson.header.lessonTitle);\n      }\n      if (this.isLessonReferenceStep && this.activeStep.miniLessonReference) {\n        this.activeStep.miniLessonReference.lessonId = lesson._id;\n        console.log('Updated reference lesson', lesson);\n      }\n    },\n    startCreateEmbeddedLesson() {\n      if (!this.activeStep) return;\n      if (!this.newEmbeddedLessonMotion) return;\n      // this.activeStep.miniLessonEmbedded = createBlankLesson(this.newEmbeddedLessonMotion);\n      // this.activeStep.miniLessonEmbedded.header.lessonTitle = this.activeStep.title;\n      this.editLessonActive = true;\n    },\n    createReferencedLesson() {\n      if (!this.isLessonReferenceStep) return;\n      if (this.activeStep?.miniLessonReference?.lessonId === '') {\n        this.editLessonActive = true;\n      }\n    },\n    editWorkflowStepLesson() {\n      if (!this.activeStepLesson) return;\n      this.editLessonActive = true;\n    },\n    removeEmbeddedLesson() {\n      if (!this.activeStep?.miniLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (window.confirm(`Are you sure you want to delete the embedded lesson ${this.activeStep.miniLessonEmbedded.header.lessonTitle}?`)) {\n        this.activeStep.miniLessonEmbedded = undefined;\n      }\n    },\n    convertEmbeddedLessonToReference() {\n      if (!this.activeStep?.miniLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to save this lesson into a new file and convert this to a reference?'\n                         + '\\n\\nNote: be sure to save the lesson.json!')\n      ) return;\n\n      miniLessonManager.saveCustomLesson(this.activeStep.miniLessonEmbedded);\n      this.activeStep.miniLessonReference = {\n        clipName: this.activeStep.miniLessonEmbedded.header.clipName,\n        lessonId: this.activeStep.miniLessonEmbedded._id,\n      };\n      const exportLessonData = this.activeStep.miniLessonEmbedded;\n      this.activeStep.type = 'MiniLessonReference';\n      this.activeStep.miniLessonEmbedded = undefined;\n      Utils.PromptDownloadFile(`${exportLessonData.header.lessonTitle}.lesson.json`, JSON.stringify(exportLessonData));\n    },\n  },\n});\n</script>\n\n<style lang=\"sass\">\n\n</style>\n","<template>\n    <section class=\"section create-lesson-screen\">\n      <div class=\"hero is-primary block\">\n        <div class=\"hero-body\">\n          <div class=\"container\">\n            <p class=\"title\">\n              Lesson Creation\n            </p>\n            <p class=\"subtitle\">\n              <span v-if=\"state === LessonCreationState.SelectOpenLesson\">Template Selection</span>\n              <span v-else>Editing &quot;{{lessonUnderConstruction.header.lessonTitle}}&quot;</span>\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"container block\">\n        <div class=\"buttons is-centered has-addons\">\n          <button v-if=\"showBackButton\" class=\"button\" :class=\"{'is-danger': isDirty, 'is-outlined': isDirty, 'is-primary': !isDirty}\" @click=\"goBack\">&lt; Back</button>\n          <button v-if=\"showCloseButton\" class=\"button\" :class=\"{'is-danger': isDirty, 'is-outlined': isDirty, 'is-primary': !isDirty}\" @click=\"goBack\"><i class=\"fa fa-close\"></i> Close</button>\n          <button v-if=\"state === LessonCreationState.ModifyLesson && canDeleteLesson\" class=\"button is-danger is-outlined\" @click=\"deleteLesson\">\n            Delete\n          </button>\n          <button v-if=\"state === LessonCreationState.ModifyLesson && showExportButton\" class=\"button\" @click=\"exportLesson\">Export</button>\n          <button v-if=\"state === LessonCreationState.ModifyLesson\" class=\"button\" :class=\"{'is-primary': isDirty}\" :disabled=\"!isDirty\" @click=\"saveLesson\">\n            <span v-if=\"lessonInDatabase\">Update</span>\n            <span v-else>Save</span>\n          </button>\n        </div>\n      </div>\n\n      <div v-if=\"state === LessonCreationState.SelectOpenLesson\" class=\"container has-text-centered\">\n        <div class=\"card block center-block has-text-left\">\n          <div class=\"card-header\">\n            <h4 class=\"card-header-title\">Pick a template:</h4>\n          </div>\n          <div class=\"card-content menu\">\n            <ul class=\"menu-list\">\n              <li>\n                <a @click=\"activeLessonSelectionIndex = -1\"\n                  :class=\"{'is-active': activeLessonSelectionIndex === -1}\">(start from scratch)</a>\n              </li>\n              <li v-for=\"(lesson, i) in lessons\" :key=\"lesson._id\">\n                <a @click=\"activeLessonSelectionIndex = i\" :class=\"{'is-active': activeLessonSelectionIndex === i}\">\n                  <strong>#{{i+1}}</strong>&nbsp;{{lesson.header.lessonTitle}}\n                </a>\n              </li>\n            </ul>\n          </div>\n          <div class=\"card-footer\" v-if=\"canEditActiveLesson && !disableEditingExisting\">\n            <p v-if=\"disableEditingExisting\" class=\"card-footer-item\">Editing disabled</p>\n            <a v-else class=\"card-footer-item\" @click=\"startCreation(false)\">Edit</a>\n          </div><div class=\"card-footer\">\n            <a class=\"card-footer-item\" @click=\"startCreation(true)\">\n              <span v-if=\"activeLessonSelectionIndex === -1\">Start New</span>\n              <span v-else>Use as Template</span>\n            </a>\n          </div>\n        </div>\n      </div>\n\n      <div v-if=\"state === LessonCreationState.ModifyLesson\" class=\"block\">\n        <div class=\"columns is-multiline is-centered\">\n          <div class=\"column is-half is-one-third-widescreen is-one-quarter-fullhd\">\n            <div class=\"box\">\n              <h5 class=\"title is-5\">Lesson</h5>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Id</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" disabled type=\"text\" :value=\"lessonUnderConstruction._id\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Clip</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" disabled type=\"text\" :value=\"motion.title\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Title</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" type=\"text\" v-model=\"lessonUnderConstruction.header.lessonTitle\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field\">\n                <label class=\"label\">Segments</label>\n                <div class=\"control block\">\n                  <SegmentedProgressBar\n                  :segments=\"progressSegments\"\n                    :progress=\"motion.duration\"\n                    :enableAll=\"true\"/>\n                  </div>\n                  <div class=\"control block\">\n                    <div class=\"block\">\n                      <div class=\"field has-addons is-inline-block m-1\" v-for=\"(segBreak, i) in lessonUnderConstruction.segmentBreaks\" :key=\"i\">\n                        <span class=\"control\">\n                          <input\n                              class=\"input narrow-number-input is-small\"\n                              :key=\"i\"\n                              type=\"number\"\n                              :value=\"lessonUnderConstruction.segmentBreaks[i].toFixed(2)\"\n                              @input=\"setSegmentBreak(i, $event)\"\n                              :min=\"0\"\n                              :step=\"0.01\"\n                              :max=\"motion.duration\" />\n                          </span>\n                          <span class=\"control\">\n                            <button class=\"button is-danger is-small is-light\" :disabled=\"!canDeleteSegment(i)\" @click=\"removeSegmentBreak(i)\">\n                              <span class=\"icon\">\n                                <i class=\"fas fa-times\"></i>\n                              </span>\n                            </button>\n                          </span>\n                      </div>\n                    </div>\n                    <div class=\"block has-text-right\">\n                      <!-- <span>Add New</span> -->\n                      <input\n                          class=\"input narrow-number-input is-info\"\n                          type=\"number\"\n                          v-model.number=\"newSegmentVal\"\n                          :min=\"0\"\n                          :step=\"0.01\"\n                          :max=\"motion.duration\" />\n                      <button class=\"ml-1 button is-info is-light\" @click=\"addSegmentBreak(newSegmentVal)\">Add Segment</button>\n                    </div>\n                  </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Activities</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(activity, i) in lessonUnderConstruction.activities\" :key=\"i\">\n                          <a :class=\"{'is-active': activeActivityIndex === i}\" @click=\"selectActivity(i)\"><strong>{{i+1}}&nbsp;</strong>&nbsp;{{activity.title}}</a>\n                        </li>\n                        <li v-if=\"activeActivity\"><a @click=\"duplicateActivity()\"><span class=\"icon\"><i class=\"far fa-copy\"></i></span><span>Duplicate</span></a></li>\n                        <li><a @click=\"addActivity()\">&plus; Add Activity</a></li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Activities</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"column is-half is-one-third-widescreen is-one-quarter-fullhd\">\n            <div class=\"box\">\n              <h5 class=\"title is-5\">Activity</h5>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Order</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field has-addons\">\n                    <div class=\"control\">\n                      <button class=\"button\" :disabled=\"!canReorderActivity(activeActivityIndex, -1)\" @click=\"reorderActivity(activeActivityIndex, -1)\">\n                        <div class=\"icon\"><i class=\"fas fa-chevron-down\"></i></div>\n                      </button>\n                    </div>\n                    <div class=\"control is-expanded\">\n                      <input class=\"input\" type=\"text\" disabled :value=\"activeActivityIndex + 1\">\n                    </div>\n                    <div class=\"control\">\n                      <button class=\"button\" :disabled=\"!canReorderActivity(activeActivityIndex, 1)\" @click=\"reorderActivity(activeActivityIndex, 1)\">\n                        <div class=\"icon\"><i class=\"fas fa-chevron-up\"></i></div>\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Title</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.title\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Playback Speed</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeActivity.practiceSpeed\" min=\"0\" step=\"0.01\" :max=\"2\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Focused Segments</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div v-for=\"(segInfo, i) in activeActivityFocusedSegments\" :key=\"i\">\n                      <label class=\"checkbox\">\n                        <input type=\"checkbox\" :checked=\"activeActivityFocusedSegments[i].isFocused\" @input=\"setFocusedSegment(i, $event)\">&nbsp;<strong>{{i+1}}</strong>: <code>{{segInfo.startTime.toFixed(2)}}</code>-<code>{{segInfo.endTime.toFixed(2)}}</code>\n                      </label>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Start Time</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeActivity.startTime\" min=\"0\" step=\"0.01\" :max=\"motion.duration\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeActivity.startTime\" min=\"0\" step=\"0.01\" :max=\"motion.duration\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">End Time</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeActivity.endTime\" :min=\"0\" step=\"0.01\" :max=\"motion.duration\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeActivity.endTime\" :min=\"0\" step=\"0.01\" :max=\"motion.duration\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">User Visual</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <div class=\"select\">\n                        <select v-model=\"activeActivity.userVisual\">\n                          <option value=\"none\">None</option>\n                          <option value=\"skeleton\">Skeleton</option>\n                          <option value=\"viideo\">Webcam</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Demo Visual</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <div class=\"select\">\n                        <select v-model=\"activeActivity.demoVisual\">\n                          <option value=\"none\">None</option>\n                          <option value=\"skeleton\">Skeleton</option>\n                          <option value=\"video\">Video</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Keyframe Visual</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <div class=\"select\">\n                        <select v-model=\"activeActivity.keyframeVisual\">\n                          <option value=\"none\">None</option>\n                          <option value=\"skeleton\">Skeleton</option>\n                          <option value=\"video\">Video</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Keyframes</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field has-addons\">\n                    <div class=\"control\">\n                      <button class=\"button is-static\">\n                        {{activeActivityKeyframes.length}} Keyframes\n                      </button>\n                    </div>\n                    <div class=\"control\">\n                      <button class=\"button\" @click=\"keyframeSelectorToolActive = !keyframeSelectorToolActive\">\n                        Edit\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Start Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.startInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Playing Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.playingInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">End Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.endInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Static Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.staticInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Pauses</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(pause, i) in activeActivity.pauses ?? []\" :key=\"i\">\n                          <a :class=\"{'is-active': activePauseIndex === i}\" @click=\"selectPause(i)\">\n                            <strong>#{{i+1}}</strong>\n                            at <span class=\"is-underlined\">{{pause.time.toFixed(2)}}</span>\n                            for <span class=\"is-underlined\">{{(pause.pauseDuration ?? Constants.DefaultPauseDuration).toFixed(2)}}</span>s\n                            <small v-if=\"pause.instruction\">&nbsp; : &nbsp;<span>&quot;{{pause.instruction}}&quot;</span></small>\n                          </a>\n                        </li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Pauses</li>\n                        <li><a @click=\"addPause()\">&plus; Add Pause</a></li>\n                        <li v-show=\"(activeActivity.pauses?.length ?? 0) >= 2\"><a @click=\"sortPauses()\">Sort Pauses</a></li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Timed Instructions</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(ti, i) in activeActivity.timedInstructions ?? []\" :key=\"i\">\n                          <a :class=\"{'is-active': activeTimedInstructionIndex === i}\" @click=\"selectTimedInstruction(i)\">\n                            <strong>#{{i+1}}</strong>&nbsp;\n                            <small>&quot;{{ti.text}}&quot;</small>\n                            from <span class=\"is-underlined\">{{ti.startTime.toFixed(2)}}</span>s\n                            to <span class=\"is-underlined\">{{ti.endTime.toFixed(2)}}</span>s\n                          </a>\n                        </li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Timed Instructions</li>\n                        <li><a @click=\"addTimedInstruction()\">&plus; Add Timed Instruction</a></li>\n                        <li v-show=\"(activeActivity.timedInstructions?.length ?? 0) >= 2\"><a @click=\"sortTimedInstructions()\">Sort Timed Instructions</a></li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Timed Instructions</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"block buttons is-right\">\n                <button class=\"button is-outlined is-danger\" :disabled=\"!canDeleteActivity(activeActivityIndex)\" @click=\"deleteActivity(activeActivityIndex)\">Delete Activity #{{activeActivityIndex + 1}}</button>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"column is-half is-one-third-widescreen is-one-quarter-fullhd\"\n               v-if=\"activePause || activeTimedInstruction\">\n            <div v-if=\"activePause\" class=\"box\">\n              <h6 class=\"title is-5\">Pause {{activePauseIndex + 1}} Details</h6>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\"><label class=\"label\">Time</label></div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activePause.time\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activePause.time\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Duration</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activePause.pauseDuration\" min=\"0\" step=\"0.01\" :max=\"10\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activePause.instruction\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field\">\n                <div class=\"control\">\n                  <button class=\"button is-danger is-outlined\" @click=\"deletePause(activePause)\">Remove Pause {{activePauseIndex + 1}}</button>\n                </div>\n              </div>\n            </div> <!-- End pause detail section-->\n\n            <div v-if=\"activeTimedInstruction\" class=\"box\">\n              <h6 class=\"title is-5\">Timed Instruction {{activeTimedInstructionIndex + 1}} Details</h6>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\"><label class=\"label\">Start Time</label></div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeTimedInstruction.startTime\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeTimedInstruction.endTime\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeTimedInstruction.startTime\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\"><label class=\"label\">End Time</label></div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeTimedInstruction.endTime\" :min=\"activeTimedInstruction.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeTimedInstruction.endTime\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Text</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeTimedInstruction.text\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field\">\n                <div class=\"control\">\n                  <button class=\"button is-danger is-outlined\" @click=\"deleteTimedInstruction(activeTimedInstruction)\">Remove Timed Instruction {{activeTimedInstructionIndex + 1}}</button>\n                </div>\n              </div>\n            </div> <!-- End timed instruction detail section-->\n          </div>\n\n          <div class=\"column is-half-tablet is-half-desktop is-one-third-widescreen is-one-quarter-fullhd\">\n            <div class=\"box\">\n              <h5 class=\"title is-5\">Demo</h5>\n\n              <div class=\"image is-square\">\n                <!-- <div style=\"height:400px;width:100%;\"> -->\n                  <MiniLessonPlayer\n                   class=\"is-overlay\"\n                    ref=\"miniLessonPlayer\"\n                    @activity-changed=\"selectActivity\"\n                    :videoEntry=\"motion\"\n                    :miniLesson=\"lessonUnderConstruction\"\n                    :enableCompleteLesson=\"false\"\n                  />\n                <!-- </div> -->\n              </div>\n            <!--\n              <ActivityVideoPlayer\n                class=\"block\"\n                ref=\"activityVideoPlayer\"\n                :motion=\"motion\"\n                :lesson=\"lessonUnderConstruction\"\n                :activity=\"activeActivity\"\n                :maxHeight=\"'400px'\"\n                @progress=\"onProgress\" />\n\n              <SegmentedProgressBar\n                class=\"block\"\n                :segments=\"progressSegments\"\n                :progress=\"activityProgress\"/>\n\n              <div class=\"buttons is-centered has-addons\">\n                <button class=\"button\" :disabled=\"!hasPreviousActivity\" @click=\"activeActivityIndex -= 1\">&lt;</button>\n                <button class=\"button is-primary\" :disabled=\"!($refs.activityVideoPlayer?.awaitingStart ?? false)\" @click=\"playDemo\">Play Activity</button>\n                <button class=\"button\" :disabled=\"!($refs.activityVideoPlayer?.activityFinished ?? false)\" @click=\"$refs.activityVideoPlayer?.reset()\">Reset</button>\n                <button class=\"button\" :disabled=\"!hasNextActivity\" @click=\"activeActivityIndex += 1\">&gt;</button>\n              </div> -->\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div v-bind:class=\"{ 'is-active': keyframeSelectorToolActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\" style=\"width: 96%; height: 100vh;\">\n        <KeyframeSelectorTool\n          v-if=\"keyframeSelectorToolActive\"\n          v-model=\"activeActivityKeyframes\"\n          :videoEntry=\"motion\"\n          @back-selected=\"keyframeSelectorToolActive=false\"\n          :startTime=\"activeActivity.startTime\"\n          :endTime=\"activeActivity.endTime\"\n        />\n      </div>\n    </div>\n    </section>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed,\n  defineComponent, nextTick, ref, toRefs, watchEffect,\n} from 'vue';\n\nimport Constants from '@/services/Constants';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport db from '@/services/VideoDatabase';\nimport miniLessonManager, { createBlankActivity, createBlankLesson } from '@/services/MiniLessonManager';\nimport MiniLesson, { MiniLessonActivity, PauseInfo, TimedInstruction } from '@/model/MiniLesson';\nimport Utils from '@/services/Utils';\nimport SegmentedProgressBar, { ProgressSegmentData, calculateProgressSegments } from '@/components/elements/SegmentedProgressBar.vue';\nimport KeyframeSelectorTool from '@/components/tools/KeyframeSelectorTool.vue';\n\nconst LessonCreationState = Object.freeze({\n  SelectOpenLesson: 'SelectOpenLesson',\n  ModifyLesson: 'ModifyLesson',\n});\n\ninterface SegmentInfo {\n  isFocused: boolean;\n  startTime: number;\n  endTime: number;\n}\n\nexport default defineComponent({\n  name: 'CreateLessonScreen',\n  components: {\n    MiniLessonPlayer,\n    SegmentedProgressBar,\n    KeyframeSelectorTool,\n  },\n  props: {\n    motion: {\n      type: Object,\n      required: true,\n    },\n    saveReference: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    showCloseButton: {\n      type: Boolean,\n      default: false,\n    },\n    showExportButton: {\n      type: Boolean,\n      default: true,\n    },\n    lessonToEdit: {\n      type: Object,\n      default: null,\n    },\n    saveToDatabase: {\n      type: Boolean,\n      default: true,\n    },\n    disableEditingExisting: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['back-selected', 'lesson-saved'],\n  data() {\n    return {\n      newPauseTime: 0,\n      newSegmentVal: 0,\n      activeLessonSelectionIndex: -1,\n      activePauseIndex: 0,\n      activeTimedInstructionIndex: 0,\n      keyframeSelectorToolActive: false,\n      // activityProgress: 0,\n    };\n  },\n  computed: {\n    activeActivityKeyframes: {\n      get(): number[] {\n        return (this as any).activeActivity?.keyframes ?? [];\n      },\n      set(newVal: number[]) {\n        this.activeActivity.keyframes = newVal;\n      },\n    },\n    displayMode: {\n      get() {\n        const demoVisual = this.activeActivity.demoVisual ?? 'video';\n        const userVisual = this.activeActivity.userVisual ?? 'none';\n        if (demoVisual === 'video' && userVisual === 'none') return 'video-demo';\n        if (demoVisual === 'skeleton' && userVisual === 'video') return 'skeleton-overlay';\n        return 'other';\n      },\n      set(newVal: 'other' | 'video-demo' | 'skeleton-overlay') {\n        if (newVal === 'video-demo') {\n          this.activeActivity.demoVisual = 'video';\n          this.activeActivity.userVisual = 'none';\n        } else if (newVal === 'skeleton-overlay') {\n          this.activeActivity.demoVisual = 'skeleton';\n          this.activeActivity.userVisual = 'video';\n        }\n      },\n    },\n    activeActivityFocusedSegments() {\n      const segBreaks = (this as any).lessonUnderConstruction.segmentBreaks as number[];\n      const segs: number[] = (this as any).activeActivity?.focusedSegments ?? [];\n      const segsSet = new Set(segs);\n      const boolArray = Utils.range((this as any).lessonUnderConstruction.segmentBreaks.length - 1)\n        .map((i) => ({\n          isFocused: segsSet.has(i),\n          startTime: segBreaks[i],\n          endTime: segBreaks[i + 1],\n        } as SegmentInfo));\n      return boolArray;\n    },\n    activeLessonSelection(): MiniLesson | null {\n      return this.lessons[this.activeLessonSelectionIndex] ?? null;\n    },\n    lessonInDatabase(): boolean {\n      return miniLessonManager.hasLesson(this.lessonUnderConstruction);\n    },\n    canDeleteLesson(): boolean {\n      return this.lessonInDatabase && this.lessonUnderConstruction.source === 'custom';\n    },\n    lessonStartTime(): number {\n      return this.lessonUnderConstruction?.segmentBreaks[0] ?? 0;\n    },\n    lessonEndTime(): number {\n      return this.lessonUnderConstruction.segmentBreaks[this.lessonUnderConstruction.segmentBreaks.length - 1] ?? this.motion?.duration ?? 1;\n    },\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as VideoDatabaseEntry;\n      const lessons = miniLessonManager.getLessons(motion);\n      return lessons ?? [];\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lessonUnderConstruction) return calculateProgressSegments(this.lessonUnderConstruction, this.activeActivity);\n      return [];\n    },\n    activePause(): null | PauseInfo {\n      return ((this as any).activeActivity.pauses ?? [])[(this as any).activePauseIndex] ?? null;\n    },\n    activeTimedInstruction(): null | TimedInstruction {\n      return ((this as any).activeActivity.timedInstructions ?? [])[(this as any).activeTimedInstructionIndex] ?? null;\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < this.lessonUnderConstruction.activities.length;\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    canEditActiveLesson() {\n      const acLes = this.activeLessonSelection as MiniLesson;\n      return acLes?.source === 'custom';\n    },\n  },\n  mounted() {\n    const passedInLesson = this.$props.lessonToEdit as MiniLesson | null;\n    if (passedInLesson) {\n      console.log('CreateLessonScreen:: using passed in lesson', passedInLesson);\n      this.startCreation(false, Utils.deepCopy(passedInLesson));\n      nextTick(() => { this.isDirty = false; });\n    } else if (this.lessons.length === 0) {\n      console.log('CreateLessonScreen:: creating blank lesson (no templates available)');\n      this.startCreation(true);\n    }\n  },\n  setup(props) {\n    const { motion } = toRefs(props);\n    const isDirty = ref(false);\n    const typedMotion = computed(() => motion.value as unknown as VideoDatabaseEntry);\n    const state = ref(LessonCreationState.SelectOpenLesson);\n    const lessonUnderConstruction = ref(createBlankLesson(typedMotion.value));\n    const activeActivityIndex = ref(0);\n    const activeActivity = computed(() => lessonUnderConstruction.value.activities[activeActivityIndex.value]);\n\n    watchEffect(() => {\n      if (activeActivity.value.startTime < 0) activeActivity.value.startTime = 0;\n      if (activeActivity.value.endTime > motion.value.duration) activeActivity.value.endTime = motion.value.duration;\n      if (+activeActivity.value.endTime < +activeActivity.value.startTime) activeActivity.value.endTime = activeActivity.value.startTime;\n    });\n\n    return {\n      isDirty,\n      state,\n      typedMotion,\n      LessonCreationState,\n      lessonUnderConstruction,\n      activeActivityIndex,\n      activeActivity,\n      Constants,\n    };\n  },\n  watch: {\n    activeActivityIndex: {\n      handler(newVal: number) {\n        (this.$refs.miniLessonPlayer as any).activeActivityIndex = newVal;\n      },\n    },\n    lessonUnderConstruction: {\n      handler() {\n        this.isDirty = true;\n      },\n      deep: true,\n    },\n    'lessonUnderConstruction.segmentBreaks': {\n      handler() {\n        this.sortSegmentBreaks();\n      },\n      deep: true,\n    },\n    'activePause.time': {\n      handler() {\n        this.sortPauses();\n      },\n    },\n    'activeTimedInstruction.startTime': {\n      handler() {\n        this.sortTimedInstructions();\n      },\n    },\n  },\n  methods: {\n    canDeleteSegment(segmentIndex: number) {\n      return this.progressSegments.length > 1;\n    },\n    goBack() {\n      // eslint-disable-next-line no-alert\n      if (!this.isDirty || window.confirm('Are you sure you want to go back without saving?')) {\n        this.$emit('back-selected');\n      }\n    },\n    startCreation(asTemplate: boolean, sourceLesson?: MiniLesson) {\n      const existingLesson = sourceLesson ?? this.activeLessonSelection;\n      if (existingLesson && asTemplate) {\n        console.log('Creating new lesson from template');\n        this.lessonUnderConstruction = Utils.deepCopy(existingLesson);\n        this.lessonUnderConstruction._id = Utils.uuidv4();\n        this.lessonUnderConstruction.source = 'custom';\n      } else if (existingLesson && !asTemplate) {\n        console.log('Editing existing lesson');\n        this.lessonUnderConstruction = existingLesson;\n        nextTick(() => { this.isDirty = false; });\n      } else {\n        console.log('Creating new lesson from scratch');\n        this.lessonUnderConstruction = createBlankLesson(this.typedMotion);\n      }\n      this.state = LessonCreationState.ModifyLesson;\n    },\n    addActivity(targetIndex?: number) {\n      const newActivity: MiniLessonActivity = createBlankActivity(this.typedMotion, `Activity ${this.lessonUnderConstruction.activities.length + 1}`);\n\n      if (targetIndex === undefined) {\n        this.lessonUnderConstruction.activities.push(newActivity);\n        this.activeActivityIndex = this.lessonUnderConstruction.activities.length - 1;\n      } else {\n        this.lessonUnderConstruction.activities.splice(targetIndex, 0, newActivity);\n        this.activeActivityIndex = targetIndex;\n      }\n    },\n    selectActivity(targetIndex: number) {\n      this.activeActivityIndex = targetIndex;\n    },\n    canDeleteActivity(targetIndex: number) {\n      return this.lessonUnderConstruction.activities.length > 1;\n    },\n    canReorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapActivity = this.lessonUnderConstruction.activities[targetIndex + indexDelta];\n      return (curActivity !== undefined && swapActivity !== undefined);\n    },\n    reorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapIndex = targetIndex + indexDelta;\n      const swapActivity = this.lessonUnderConstruction.activities[swapIndex];\n      if (curActivity === undefined || swapActivity === undefined) {\n        console.error(`Cannot reorder activities ${targetIndex} and ${swapIndex}`);\n        return;\n      }\n\n      this.lessonUnderConstruction.activities[swapIndex] = curActivity;\n      this.lessonUnderConstruction.activities[targetIndex] = swapActivity;\n      if (this.activeActivityIndex === targetIndex) {\n        this.activeActivityIndex = swapIndex;\n      }\n    },\n    deleteActivity(targetIndex: number) {\n      const indexToDelete = targetIndex ?? this.activeActivityIndex;\n      const activities = this.lessonUnderConstruction.activities ?? [];\n      if (activities.length < 2) {\n        console.error(\"Can't delete activity - no activities would be left\");\n        return;\n      }\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this activity?')) return;\n      console.log('Deleting activity at index', indexToDelete);\n      activities.splice(indexToDelete, 1);\n      this.lessonUnderConstruction.activities = activities;\n      this.activeActivityIndex = Math.max(Math.min(activities.length - 1, this.activeActivityIndex), 0);\n    },\n    duplicateActivity() {\n      const activity = this.activeActivity;\n      const lesson = this.lessonUnderConstruction;\n      if (!activity || !lesson) return;\n      const dupActivity = Utils.deepCopy(activity);\n      lesson.activities.splice(this.activeActivityIndex, 0, dupActivity);\n      this.activeActivityIndex += 1;\n    },\n    addPause(targetIndex?: number) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const newPause: PauseInfo = {\n        time: this.activeActivity.startTime,\n        pauseDuration: Constants.DefaultPauseDuration,\n      };\n      if (targetIndex === undefined) {\n        pauses.push(newPause);\n        this.activePauseIndex = pauses.length - 1;\n      } else {\n        pauses.splice(targetIndex, 0, newPause);\n        this.activePauseIndex = targetIndex;\n      }\n      this.sortPauses();\n      this.activeActivity.pauses = pauses;\n    },\n    selectPause(targetIndex: number) {\n      if (targetIndex === this.activePauseIndex) this.activePauseIndex = -1;\n      else this.activePauseIndex = targetIndex;\n    },\n    sortPauses() {\n      const pauses = this.activeActivity.pauses ?? [];\n      const selectedPause = pauses[this.activePauseIndex];\n      pauses.sort((a, b) => a.time - b.time);\n      const newIndex = pauses.indexOf(selectedPause);\n      if (newIndex >= 0) this.activePauseIndex = newIndex;\n      this.activeActivity.pauses = pauses;\n    },\n    deletePause(pauseObj: PauseInfo) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const pauseIndex = pauses.indexOf(pauseObj);\n      // eslint-disable-next-line no-alert\n      if (pauseIndex >= 0 && window.confirm('Are you sure you want to delete this pause?')) pauses.splice(pauseIndex, 1);\n      this.activeActivity.pauses = pauses;\n    },\n    addTimedInstruction(targetIndex?: number) {\n      const timedInstructions = this.activeActivity.timedInstructions ?? [];\n      const newInstruction: TimedInstruction = {\n        startTime: 0,\n        endTime: 1,\n        text: 'Do XYZ',\n      };\n      if (targetIndex === undefined) {\n        timedInstructions.push(newInstruction);\n        this.activeTimedInstructionIndex = timedInstructions.length - 1;\n      } else {\n        timedInstructions.splice(targetIndex, 0, newInstruction);\n        this.activeTimedInstructionIndex = targetIndex;\n      }\n      this.sortTimedInstructions();\n\n      this.activeActivity.timedInstructions = timedInstructions;\n    },\n    selectTimedInstruction(targetIndex: number) {\n      if (targetIndex === this.activeTimedInstructionIndex) this.activeTimedInstructionIndex = -1;\n      else this.activeTimedInstructionIndex = targetIndex;\n    },\n    sortTimedInstructions() {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const selectedTimedInstruc = timedInstructs[this.activeTimedInstructionIndex];\n      timedInstructs.sort((a, b) => a.startTime - b.startTime);\n      const newIndex = timedInstructs.indexOf(selectedTimedInstruc);\n      if (newIndex >= 0) this.activeTimedInstructionIndex = newIndex;\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    deleteTimedInstruction(timedInstruction: TimedInstruction) {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const tiIndex = timedInstructs.indexOf(timedInstruction);\n      // eslint-disable-next-line no-restricted-globals, no-alert\n      if (tiIndex >= 0 && window.confirm('Are you sure you want to delete this timed instruction?')) timedInstructs.splice(tiIndex, 1);\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    addSegmentBreak(breakTime: number) {\n      breakTime = +breakTime;\n      if (Number.isNaN(breakTime) || breakTime < 0 || breakTime > this.motion.duration) return;\n      this.lessonUnderConstruction.segmentBreaks.push(breakTime);\n      const newList = this.lessonUnderConstruction.segmentBreaks.sort((a, b) => a - b);\n      this.lessonUnderConstruction.segmentBreaks = newList;\n      this.newSegmentVal = 0;\n    },\n    setFocusedSegment(i: number, event: InputEvent) {\n      const focusedSegments = this.activeActivity.focusedSegments ?? [];\n      const curIndex = focusedSegments.indexOf(i);\n      const isFocused: boolean = (event.target as any)?.checked ?? false;\n      if (curIndex === -1 && isFocused) {\n        focusedSegments.push(i);\n        focusedSegments.sort();\n      } else if (curIndex !== -1 && !isFocused) {\n        focusedSegments.splice(curIndex, 1);\n      }\n\n      this.activeActivity.focusedSegments = focusedSegments;\n    },\n    sortSegmentBreaks() {\n      this.lessonUnderConstruction.segmentBreaks = this.lessonUnderConstruction.segmentBreaks.sort((a, b) => a - b);\n    },\n    setSegmentBreak(i: number, event: InputEvent) {\n      const val = parseFloat((event.target as any)?.value ?? '');\n      if (!Number.isNaN(val) && val >= 0 && val <= this.motion.duration) {\n        this.lessonUnderConstruction.segmentBreaks[i] = val;\n      }\n    },\n    removeSegmentBreak(i: number) {\n      this.lessonUnderConstruction.segmentBreaks.splice(i, 1);\n    },\n    // playDemo() {\n    //   (this.$refs.activityVideoPlayer as any).play();\n    // },\n    // onProgress(progress: number) {\n    //   this.activityProgress = progress;\n    // },\n    saveLesson() {\n      if (this.$props.saveToDatabase) {\n        miniLessonManager.saveCustomLesson(this.lessonUnderConstruction);\n      }\n      this.$emit('lesson-saved', this.lessonUnderConstruction);\n      this.isDirty = false;\n    },\n    deleteLesson() {\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      miniLessonManager.deleteCustomLesson(this.lessonUnderConstruction);\n      this.$emit('back-selected');\n    },\n    exportLesson() {\n      Utils.PromptDownloadFile(`${this.lessonUnderConstruction.header.lessonTitle}.lesson.json`, JSON.stringify(this.lessonUnderConstruction));\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.create-lesson-screen {\n  .center-block {\n    display: inline-block;\n    margin-left: auto;\n    margin-right: auto;\n  }\n\n  .narrow-number-input {\n    max-width: 5.5rem;\n  }\n\n  .seg-break {\n    background: white;\n  }\n}\n\n</style>\n","<template>\n  <section class=\"keyframe-selection section\">\n    <div class=\"container box\">\n      <h1 class=\"title\">Keyframe Selection Tool</h1>\n\n      <div class=\"buttons\">\n        <button class=\"button\" @click=\"$emit('back-selected')\">Done</button>\n      </div>\n\n      <div class=\"block has-text-centered\">\n        <video\n          ref=\"videoElement\"\n          @playing=\"paused = false\"\n          @pause=\"paused = true\"\n          @seeked=\"updateCurrentTime\"\n          :src=\"videoEntry.videoSrc\"\n          controls\n          style=\"max-height: 50vh; max-width: 768px;margin:auto;\"></video>\n      </div>\n\n      <div class=\"buttons is-grouped is-centered\">\n        <button class=\"button\" @click=\"videoElement.currentTime -= 0.1\">&lt;&lt;</button>\n        <button class=\"button\" @click=\"videoElement.currentTime -= 0.03\">&lt;</button>\n        <span class=\"button is-text\" disabled>\n          {{currentTime.toFixed(2)}}s\n        </span>\n        <button class=\"button\" @click=\"addKeyframe\">&plus; Add</button>\n        <button class=\"button\" @click=\"videoElement.currentTime += 0.03\">&gt;</button>\n        <button class=\"button\" @click=\"videoElement.currentTime += 0.1\">&gt;&gt;</button>\n      </div>\n      <div>\n        <input class=\"slider is-fullwidth\" type=\"range\" :value=\"currentTime\" :min=\"videoEntry.startTime\" :max=\"videoEntry.endTime\" step=\"0.03\" @input=\"this.$refs.videoElement.currentTime = $event.target.value\">\n      </div>\n      <div class=\"field is-horizontal\">\n        <div class=\"field-label\">\n          <label class=\"label\">Draw Mode</label>\n        </div>\n        <div class=\"field-body\">\n          <div class=\"field\">\n            <div class=\"control\">\n              <div class=\"select\">\n                <select v-model=\"drawMode\">\n                  <!-- <option value=\"none\">None</option> -->\n                  <option value=\"skeleton\">Skeleton</option>\n                  <option value=\"video\">Video</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n<!--\n      <div class=\"block\">\n        <pre>{{JSON.stringify(modelValue)}}</pre>\n      </div> -->\n\n      <div class=\"block\">\n        <KeyframeTimeline\n          :keyframes=\"modelValue\"\n          :currentTime=\"currentTime\"\n          :dbEntry=\"videoEntry\"\n          :showTimestamps=\"true\"\n          :drawMode=\"drawMode\"\n        />\n      </div>\n\n      <div class=\"block\">\n        <h3 class=\"subtitle\">Keyframes</h3>\n        <div class=\"is-flex is-flex-wrap-wrap\">\n          <div class=\"keyframe\">\n            <div class=\"vcenter-parent\">\n              <div class=\"p-1 has-text-centered\">\n                StartTime<br />\n                <span class=\"tag\">{{effectiveStartTime.toFixed(2)}}s</span>\n              </div>\n            </div>\n          </div>\n          <div\n              class=\"keyframe is-relative  over-expand is-clickable\"\n              v-for=\"kf in modelValue\"\n              :key=\"kf\"\n              @click=\"deleteKeyframe(kf)\">\n\n            <!-- <div class=\"has-text-right is-overlay\"><button class=\"button is-small is-danger is-light\">&times;</button></div> -->\n            <video class=\"keyframe-thumb\"\n            :src=\"videoEntry.videoSrc + '#t=' + kf\">\n            </video>\n            <div class=\"has-text-centered mb-2\"><span class=\"tag\">{{kf.toFixed(2)}}</span></div>\n          </div>\n          <div class=\"keyframe\">\n            <div class=\"vcenter-parent\">\n              <div class=\"p-1 has-text-centered\">\n                EndTime<br />\n                <span class=\"tag\">{{effectiveEndTime.toFixed(2)}}s</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref, toRefs, watchEffect,\n} from 'vue';\nimport KeyframeTimeline from '@/components/elements/KeyframeTimeline.vue';\n// import videoDBVideoDatabaseEntry } from '@/services/VideoDatabase';\n\n// [2.28,2.73,2.93,3.18,3.26,3.47,3.54,3.69,4.02,4.2,4.35,4.53,4.71,4.98,5.13,5.44,5.53]\nexport default defineComponent({\n  name: 'KeyframeSelectorTool',\n  emits: ['back-selected', 'update:modelValue'],\n  components: {\n    KeyframeTimeline,\n  },\n  props: {\n    videoEntry: {\n      type: Object,\n      required: true,\n    },\n    modelValue: {\n      type: Array,\n      default: Array,\n      required: true,\n    },\n    startTime: {\n      type: Number,\n      default: -1,\n    },\n    endTime: {\n      type: Number,\n      default: -1,\n    },\n  },\n  setup(props) {\n    const {\n      modelValue, startTime, endTime, videoEntry,\n    } = toRefs(props);\n    const paused = ref(false);\n    const currentTime = ref(0);\n    const videoElement = ref(null as HTMLVideoElement | null);\n\n    const effectiveStartTime = computed(() => {\n      if (startTime.value > 0) return startTime.value;\n      if (videoEntry.value?.startTime) return videoEntry.value.startTime;\n      return 0;\n    });\n    const effectiveEndTime = computed(() => {\n      if (endTime.value > 0) return endTime.value;\n      if (videoEntry.value?.endTime) return videoEntry.value.endTime;\n      if (videoEntry.value?.duration) return videoEntry.value.duration;\n      return -1;\n    });\n\n    onMounted(() => {\n      if (videoElement.value) videoElement.value.currentTime = effectiveStartTime.value;\n    });\n\n    const updateCurrentTime = () => { currentTime.value = videoElement.value?.currentTime ?? 0; };\n    let updateIntervalId = -1;\n    onBeforeUnmount(() => { clearInterval(updateIntervalId); });\n    watchEffect(() => {\n      if (paused.value) {\n        updateCurrentTime();\n        clearInterval(updateIntervalId);\n      } else {\n        updateIntervalId = window.setInterval(updateCurrentTime, 100);\n      }\n    });\n\n    onMounted(() => {\n      if (videoElement.value) videoElement.value.playbackRate = 0.25;\n    });\n\n    watchEffect(() => {\n\n    });\n\n    return {\n      videoElement,\n      paused,\n      currentTime,\n      updateCurrentTime,\n      drawMode: ref('skeleton'),\n\n      effectiveStartTime,\n      effectiveEndTime,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  computed: {\n    prevKeyframe() {\n      const keyframes = (this as any).modelValue as number[];\n      let i = 0;\n      for (;i < this.modelValue.length; i += 1) {\n        const kf = keyframes[i];\n        if (kf > this.currentTime) {\n          return keyframes[i - 1] ?? null;\n        }\n      }\n      return keyframes[i - 1] ?? null;\n    },\n    nextKeyframe() {\n      const keyframes = (this as any).modelValue as number[];\n      for (let i = 0; i < this.modelValue.length; i += 1) {\n        const kf = keyframes[i];\n        if (kf > this.currentTime) {\n          return keyframes[i];\n        }\n      }\n      return null;\n    },\n  },\n  methods: {\n    addKeyframe() {\n      const modelCopy = [...this.modelValue];\n      const nearestKf = Number.parseFloat(this.currentTime.toFixed(2));\n      if (modelCopy.indexOf(nearestKf) === -1) {\n        modelCopy.push(nearestKf);\n        modelCopy.sort();\n      } else {\n        console.warn('Not adding keyframe - it already exists');\n      }\n      this.$emit('update:modelValue', modelCopy);\n      console.log('update:modelValue (added kf)', modelCopy);\n    },\n    deleteKeyframe(timestamp: number) {\n      const modelCopy = [...this.modelValue];\n      const index = modelCopy.indexOf(timestamp);\n      // eslint-disable-next-line no-alert\n      if (index !== -1 && window.confirm(`Delete keyframe at ${timestamp.toFixed(2)}?`)) {\n        // const kfs = modelCopy;\n        modelCopy.splice(index, 1);\n        // this.keyframes = kfs;\n      }\n\n      this.$emit('update:modelValue', modelCopy);\n      console.log('update:modelValue (deleted kf)', modelCopy);\n    },\n  },\n});\n</script>\n\n<style lang=\"sass\">\n\n.keyframe-selection\n  display: block\n\n  .keyframe\n    margin: 0.25rem\n    // padding: 0.25rem\n    border-radius: 0.25rem\n    background: lightgray\n    overflow: clip\n\n    &.is-active\n      background: lightblue\n\n  .keyframe-thumb\n    max-width: 200px\n    max-height: 200px\n\n</style>\n","\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref, toRefs, watchEffect,\n} from 'vue';\nimport KeyframeTimeline from '@/components/elements/KeyframeTimeline.vue';\n// import videoDBVideoDatabaseEntry } from '@/services/VideoDatabase';\n\n// [2.28,2.73,2.93,3.18,3.26,3.47,3.54,3.69,4.02,4.2,4.35,4.53,4.71,4.98,5.13,5.44,5.53]\nexport default defineComponent({\n  name: 'KeyframeSelectorTool',\n  emits: ['back-selected', 'update:modelValue'],\n  components: {\n    KeyframeTimeline,\n  },\n  props: {\n    videoEntry: {\n      type: Object,\n      required: true,\n    },\n    modelValue: {\n      type: Array,\n      default: Array,\n      required: true,\n    },\n    startTime: {\n      type: Number,\n      default: -1,\n    },\n    endTime: {\n      type: Number,\n      default: -1,\n    },\n  },\n  setup(props) {\n    const {\n      modelValue, startTime, endTime, videoEntry,\n    } = toRefs(props);\n    const paused = ref(false);\n    const currentTime = ref(0);\n    const videoElement = ref(null as HTMLVideoElement | null);\n\n    const effectiveStartTime = computed(() => {\n      if (startTime.value > 0) return startTime.value;\n      if (videoEntry.value?.startTime) return videoEntry.value.startTime;\n      return 0;\n    });\n    const effectiveEndTime = computed(() => {\n      if (endTime.value > 0) return endTime.value;\n      if (videoEntry.value?.endTime) return videoEntry.value.endTime;\n      if (videoEntry.value?.duration) return videoEntry.value.duration;\n      return -1;\n    });\n\n    onMounted(() => {\n      if (videoElement.value) videoElement.value.currentTime = effectiveStartTime.value;\n    });\n\n    const updateCurrentTime = () => { currentTime.value = videoElement.value?.currentTime ?? 0; };\n    let updateIntervalId = -1;\n    onBeforeUnmount(() => { clearInterval(updateIntervalId); });\n    watchEffect(() => {\n      if (paused.value) {\n        updateCurrentTime();\n        clearInterval(updateIntervalId);\n      } else {\n        updateIntervalId = window.setInterval(updateCurrentTime, 100);\n      }\n    });\n\n    onMounted(() => {\n      if (videoElement.value) videoElement.value.playbackRate = 0.25;\n    });\n\n    watchEffect(() => {\n\n    });\n\n    return {\n      videoElement,\n      paused,\n      currentTime,\n      updateCurrentTime,\n      drawMode: ref('skeleton'),\n\n      effectiveStartTime,\n      effectiveEndTime,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  computed: {\n    prevKeyframe() {\n      const keyframes = (this as any).modelValue as number[];\n      let i = 0;\n      for (;i < this.modelValue.length; i += 1) {\n        const kf = keyframes[i];\n        if (kf > this.currentTime) {\n          return keyframes[i - 1] ?? null;\n        }\n      }\n      return keyframes[i - 1] ?? null;\n    },\n    nextKeyframe() {\n      const keyframes = (this as any).modelValue as number[];\n      for (let i = 0; i < this.modelValue.length; i += 1) {\n        const kf = keyframes[i];\n        if (kf > this.currentTime) {\n          return keyframes[i];\n        }\n      }\n      return null;\n    },\n  },\n  methods: {\n    addKeyframe() {\n      const modelCopy = [...this.modelValue];\n      const nearestKf = Number.parseFloat(this.currentTime.toFixed(2));\n      if (modelCopy.indexOf(nearestKf) === -1) {\n        modelCopy.push(nearestKf);\n        modelCopy.sort();\n      } else {\n        console.warn('Not adding keyframe - it already exists');\n      }\n      this.$emit('update:modelValue', modelCopy);\n      console.log('update:modelValue (added kf)', modelCopy);\n    },\n    deleteKeyframe(timestamp: number) {\n      const modelCopy = [...this.modelValue];\n      const index = modelCopy.indexOf(timestamp);\n      // eslint-disable-next-line no-alert\n      if (index !== -1 && window.confirm(`Delete keyframe at ${timestamp.toFixed(2)}?`)) {\n        // const kfs = modelCopy;\n        modelCopy.splice(index, 1);\n        // this.keyframes = kfs;\n      }\n\n      this.$emit('update:modelValue', modelCopy);\n      console.log('update:modelValue (deleted kf)', modelCopy);\n    },\n  },\n});\n","import { render } from \"./KeyframeSelectorTool.vue?vue&type=template&id=9e9b0c52\"\nimport script from \"./KeyframeSelectorTool.vue?vue&type=script&lang=ts\"\nexport * from \"./KeyframeSelectorTool.vue?vue&type=script&lang=ts\"\n\nimport \"./KeyframeSelectorTool.vue?vue&type=style&index=0&id=9e9b0c52&lang=sass\"\nscript.render = render\n\nexport default script","\n\nimport {\n  computed,\n  defineComponent, nextTick, ref, toRefs, watchEffect,\n} from 'vue';\n\nimport Constants from '@/services/Constants';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport db from '@/services/VideoDatabase';\nimport miniLessonManager, { createBlankActivity, createBlankLesson } from '@/services/MiniLessonManager';\nimport MiniLesson, { MiniLessonActivity, PauseInfo, TimedInstruction } from '@/model/MiniLesson';\nimport Utils from '@/services/Utils';\nimport SegmentedProgressBar, { ProgressSegmentData, calculateProgressSegments } from '@/components/elements/SegmentedProgressBar.vue';\nimport KeyframeSelectorTool from '@/components/tools/KeyframeSelectorTool.vue';\n\nconst LessonCreationState = Object.freeze({\n  SelectOpenLesson: 'SelectOpenLesson',\n  ModifyLesson: 'ModifyLesson',\n});\n\ninterface SegmentInfo {\n  isFocused: boolean;\n  startTime: number;\n  endTime: number;\n}\n\nexport default defineComponent({\n  name: 'CreateLessonScreen',\n  components: {\n    MiniLessonPlayer,\n    SegmentedProgressBar,\n    KeyframeSelectorTool,\n  },\n  props: {\n    motion: {\n      type: Object,\n      required: true,\n    },\n    saveReference: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    showCloseButton: {\n      type: Boolean,\n      default: false,\n    },\n    showExportButton: {\n      type: Boolean,\n      default: true,\n    },\n    lessonToEdit: {\n      type: Object,\n      default: null,\n    },\n    saveToDatabase: {\n      type: Boolean,\n      default: true,\n    },\n    disableEditingExisting: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['back-selected', 'lesson-saved'],\n  data() {\n    return {\n      newPauseTime: 0,\n      newSegmentVal: 0,\n      activeLessonSelectionIndex: -1,\n      activePauseIndex: 0,\n      activeTimedInstructionIndex: 0,\n      keyframeSelectorToolActive: false,\n      // activityProgress: 0,\n    };\n  },\n  computed: {\n    activeActivityKeyframes: {\n      get(): number[] {\n        return (this as any).activeActivity?.keyframes ?? [];\n      },\n      set(newVal: number[]) {\n        this.activeActivity.keyframes = newVal;\n      },\n    },\n    displayMode: {\n      get() {\n        const demoVisual = this.activeActivity.demoVisual ?? 'video';\n        const userVisual = this.activeActivity.userVisual ?? 'none';\n        if (demoVisual === 'video' && userVisual === 'none') return 'video-demo';\n        if (demoVisual === 'skeleton' && userVisual === 'video') return 'skeleton-overlay';\n        return 'other';\n      },\n      set(newVal: 'other' | 'video-demo' | 'skeleton-overlay') {\n        if (newVal === 'video-demo') {\n          this.activeActivity.demoVisual = 'video';\n          this.activeActivity.userVisual = 'none';\n        } else if (newVal === 'skeleton-overlay') {\n          this.activeActivity.demoVisual = 'skeleton';\n          this.activeActivity.userVisual = 'video';\n        }\n      },\n    },\n    activeActivityFocusedSegments() {\n      const segBreaks = (this as any).lessonUnderConstruction.segmentBreaks as number[];\n      const segs: number[] = (this as any).activeActivity?.focusedSegments ?? [];\n      const segsSet = new Set(segs);\n      const boolArray = Utils.range((this as any).lessonUnderConstruction.segmentBreaks.length - 1)\n        .map((i) => ({\n          isFocused: segsSet.has(i),\n          startTime: segBreaks[i],\n          endTime: segBreaks[i + 1],\n        } as SegmentInfo));\n      return boolArray;\n    },\n    activeLessonSelection(): MiniLesson | null {\n      return this.lessons[this.activeLessonSelectionIndex] ?? null;\n    },\n    lessonInDatabase(): boolean {\n      return miniLessonManager.hasLesson(this.lessonUnderConstruction);\n    },\n    canDeleteLesson(): boolean {\n      return this.lessonInDatabase && this.lessonUnderConstruction.source === 'custom';\n    },\n    lessonStartTime(): number {\n      return this.lessonUnderConstruction?.segmentBreaks[0] ?? 0;\n    },\n    lessonEndTime(): number {\n      return this.lessonUnderConstruction.segmentBreaks[this.lessonUnderConstruction.segmentBreaks.length - 1] ?? this.motion?.duration ?? 1;\n    },\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as VideoDatabaseEntry;\n      const lessons = miniLessonManager.getLessons(motion);\n      return lessons ?? [];\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lessonUnderConstruction) return calculateProgressSegments(this.lessonUnderConstruction, this.activeActivity);\n      return [];\n    },\n    activePause(): null | PauseInfo {\n      return ((this as any).activeActivity.pauses ?? [])[(this as any).activePauseIndex] ?? null;\n    },\n    activeTimedInstruction(): null | TimedInstruction {\n      return ((this as any).activeActivity.timedInstructions ?? [])[(this as any).activeTimedInstructionIndex] ?? null;\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < this.lessonUnderConstruction.activities.length;\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    canEditActiveLesson() {\n      const acLes = this.activeLessonSelection as MiniLesson;\n      return acLes?.source === 'custom';\n    },\n  },\n  mounted() {\n    const passedInLesson = this.$props.lessonToEdit as MiniLesson | null;\n    if (passedInLesson) {\n      console.log('CreateLessonScreen:: using passed in lesson', passedInLesson);\n      this.startCreation(false, Utils.deepCopy(passedInLesson));\n      nextTick(() => { this.isDirty = false; });\n    } else if (this.lessons.length === 0) {\n      console.log('CreateLessonScreen:: creating blank lesson (no templates available)');\n      this.startCreation(true);\n    }\n  },\n  setup(props) {\n    const { motion } = toRefs(props);\n    const isDirty = ref(false);\n    const typedMotion = computed(() => motion.value as unknown as VideoDatabaseEntry);\n    const state = ref(LessonCreationState.SelectOpenLesson);\n    const lessonUnderConstruction = ref(createBlankLesson(typedMotion.value));\n    const activeActivityIndex = ref(0);\n    const activeActivity = computed(() => lessonUnderConstruction.value.activities[activeActivityIndex.value]);\n\n    watchEffect(() => {\n      if (activeActivity.value.startTime < 0) activeActivity.value.startTime = 0;\n      if (activeActivity.value.endTime > motion.value.duration) activeActivity.value.endTime = motion.value.duration;\n      if (+activeActivity.value.endTime < +activeActivity.value.startTime) activeActivity.value.endTime = activeActivity.value.startTime;\n    });\n\n    return {\n      isDirty,\n      state,\n      typedMotion,\n      LessonCreationState,\n      lessonUnderConstruction,\n      activeActivityIndex,\n      activeActivity,\n      Constants,\n    };\n  },\n  watch: {\n    activeActivityIndex: {\n      handler(newVal: number) {\n        (this.$refs.miniLessonPlayer as any).activeActivityIndex = newVal;\n      },\n    },\n    lessonUnderConstruction: {\n      handler() {\n        this.isDirty = true;\n      },\n      deep: true,\n    },\n    'lessonUnderConstruction.segmentBreaks': {\n      handler() {\n        this.sortSegmentBreaks();\n      },\n      deep: true,\n    },\n    'activePause.time': {\n      handler() {\n        this.sortPauses();\n      },\n    },\n    'activeTimedInstruction.startTime': {\n      handler() {\n        this.sortTimedInstructions();\n      },\n    },\n  },\n  methods: {\n    canDeleteSegment(segmentIndex: number) {\n      return this.progressSegments.length > 1;\n    },\n    goBack() {\n      // eslint-disable-next-line no-alert\n      if (!this.isDirty || window.confirm('Are you sure you want to go back without saving?')) {\n        this.$emit('back-selected');\n      }\n    },\n    startCreation(asTemplate: boolean, sourceLesson?: MiniLesson) {\n      const existingLesson = sourceLesson ?? this.activeLessonSelection;\n      if (existingLesson && asTemplate) {\n        console.log('Creating new lesson from template');\n        this.lessonUnderConstruction = Utils.deepCopy(existingLesson);\n        this.lessonUnderConstruction._id = Utils.uuidv4();\n        this.lessonUnderConstruction.source = 'custom';\n      } else if (existingLesson && !asTemplate) {\n        console.log('Editing existing lesson');\n        this.lessonUnderConstruction = existingLesson;\n        nextTick(() => { this.isDirty = false; });\n      } else {\n        console.log('Creating new lesson from scratch');\n        this.lessonUnderConstruction = createBlankLesson(this.typedMotion);\n      }\n      this.state = LessonCreationState.ModifyLesson;\n    },\n    addActivity(targetIndex?: number) {\n      const newActivity: MiniLessonActivity = createBlankActivity(this.typedMotion, `Activity ${this.lessonUnderConstruction.activities.length + 1}`);\n\n      if (targetIndex === undefined) {\n        this.lessonUnderConstruction.activities.push(newActivity);\n        this.activeActivityIndex = this.lessonUnderConstruction.activities.length - 1;\n      } else {\n        this.lessonUnderConstruction.activities.splice(targetIndex, 0, newActivity);\n        this.activeActivityIndex = targetIndex;\n      }\n    },\n    selectActivity(targetIndex: number) {\n      this.activeActivityIndex = targetIndex;\n    },\n    canDeleteActivity(targetIndex: number) {\n      return this.lessonUnderConstruction.activities.length > 1;\n    },\n    canReorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapActivity = this.lessonUnderConstruction.activities[targetIndex + indexDelta];\n      return (curActivity !== undefined && swapActivity !== undefined);\n    },\n    reorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapIndex = targetIndex + indexDelta;\n      const swapActivity = this.lessonUnderConstruction.activities[swapIndex];\n      if (curActivity === undefined || swapActivity === undefined) {\n        console.error(`Cannot reorder activities ${targetIndex} and ${swapIndex}`);\n        return;\n      }\n\n      this.lessonUnderConstruction.activities[swapIndex] = curActivity;\n      this.lessonUnderConstruction.activities[targetIndex] = swapActivity;\n      if (this.activeActivityIndex === targetIndex) {\n        this.activeActivityIndex = swapIndex;\n      }\n    },\n    deleteActivity(targetIndex: number) {\n      const indexToDelete = targetIndex ?? this.activeActivityIndex;\n      const activities = this.lessonUnderConstruction.activities ?? [];\n      if (activities.length < 2) {\n        console.error(\"Can't delete activity - no activities would be left\");\n        return;\n      }\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this activity?')) return;\n      console.log('Deleting activity at index', indexToDelete);\n      activities.splice(indexToDelete, 1);\n      this.lessonUnderConstruction.activities = activities;\n      this.activeActivityIndex = Math.max(Math.min(activities.length - 1, this.activeActivityIndex), 0);\n    },\n    duplicateActivity() {\n      const activity = this.activeActivity;\n      const lesson = this.lessonUnderConstruction;\n      if (!activity || !lesson) return;\n      const dupActivity = Utils.deepCopy(activity);\n      lesson.activities.splice(this.activeActivityIndex, 0, dupActivity);\n      this.activeActivityIndex += 1;\n    },\n    addPause(targetIndex?: number) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const newPause: PauseInfo = {\n        time: this.activeActivity.startTime,\n        pauseDuration: Constants.DefaultPauseDuration,\n      };\n      if (targetIndex === undefined) {\n        pauses.push(newPause);\n        this.activePauseIndex = pauses.length - 1;\n      } else {\n        pauses.splice(targetIndex, 0, newPause);\n        this.activePauseIndex = targetIndex;\n      }\n      this.sortPauses();\n      this.activeActivity.pauses = pauses;\n    },\n    selectPause(targetIndex: number) {\n      if (targetIndex === this.activePauseIndex) this.activePauseIndex = -1;\n      else this.activePauseIndex = targetIndex;\n    },\n    sortPauses() {\n      const pauses = this.activeActivity.pauses ?? [];\n      const selectedPause = pauses[this.activePauseIndex];\n      pauses.sort((a, b) => a.time - b.time);\n      const newIndex = pauses.indexOf(selectedPause);\n      if (newIndex >= 0) this.activePauseIndex = newIndex;\n      this.activeActivity.pauses = pauses;\n    },\n    deletePause(pauseObj: PauseInfo) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const pauseIndex = pauses.indexOf(pauseObj);\n      // eslint-disable-next-line no-alert\n      if (pauseIndex >= 0 && window.confirm('Are you sure you want to delete this pause?')) pauses.splice(pauseIndex, 1);\n      this.activeActivity.pauses = pauses;\n    },\n    addTimedInstruction(targetIndex?: number) {\n      const timedInstructions = this.activeActivity.timedInstructions ?? [];\n      const newInstruction: TimedInstruction = {\n        startTime: 0,\n        endTime: 1,\n        text: 'Do XYZ',\n      };\n      if (targetIndex === undefined) {\n        timedInstructions.push(newInstruction);\n        this.activeTimedInstructionIndex = timedInstructions.length - 1;\n      } else {\n        timedInstructions.splice(targetIndex, 0, newInstruction);\n        this.activeTimedInstructionIndex = targetIndex;\n      }\n      this.sortTimedInstructions();\n\n      this.activeActivity.timedInstructions = timedInstructions;\n    },\n    selectTimedInstruction(targetIndex: number) {\n      if (targetIndex === this.activeTimedInstructionIndex) this.activeTimedInstructionIndex = -1;\n      else this.activeTimedInstructionIndex = targetIndex;\n    },\n    sortTimedInstructions() {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const selectedTimedInstruc = timedInstructs[this.activeTimedInstructionIndex];\n      timedInstructs.sort((a, b) => a.startTime - b.startTime);\n      const newIndex = timedInstructs.indexOf(selectedTimedInstruc);\n      if (newIndex >= 0) this.activeTimedInstructionIndex = newIndex;\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    deleteTimedInstruction(timedInstruction: TimedInstruction) {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const tiIndex = timedInstructs.indexOf(timedInstruction);\n      // eslint-disable-next-line no-restricted-globals, no-alert\n      if (tiIndex >= 0 && window.confirm('Are you sure you want to delete this timed instruction?')) timedInstructs.splice(tiIndex, 1);\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    addSegmentBreak(breakTime: number) {\n      breakTime = +breakTime;\n      if (Number.isNaN(breakTime) || breakTime < 0 || breakTime > this.motion.duration) return;\n      this.lessonUnderConstruction.segmentBreaks.push(breakTime);\n      const newList = this.lessonUnderConstruction.segmentBreaks.sort((a, b) => a - b);\n      this.lessonUnderConstruction.segmentBreaks = newList;\n      this.newSegmentVal = 0;\n    },\n    setFocusedSegment(i: number, event: InputEvent) {\n      const focusedSegments = this.activeActivity.focusedSegments ?? [];\n      const curIndex = focusedSegments.indexOf(i);\n      const isFocused: boolean = (event.target as any)?.checked ?? false;\n      if (curIndex === -1 && isFocused) {\n        focusedSegments.push(i);\n        focusedSegments.sort();\n      } else if (curIndex !== -1 && !isFocused) {\n        focusedSegments.splice(curIndex, 1);\n      }\n\n      this.activeActivity.focusedSegments = focusedSegments;\n    },\n    sortSegmentBreaks() {\n      this.lessonUnderConstruction.segmentBreaks = this.lessonUnderConstruction.segmentBreaks.sort((a, b) => a - b);\n    },\n    setSegmentBreak(i: number, event: InputEvent) {\n      const val = parseFloat((event.target as any)?.value ?? '');\n      if (!Number.isNaN(val) && val >= 0 && val <= this.motion.duration) {\n        this.lessonUnderConstruction.segmentBreaks[i] = val;\n      }\n    },\n    removeSegmentBreak(i: number) {\n      this.lessonUnderConstruction.segmentBreaks.splice(i, 1);\n    },\n    // playDemo() {\n    //   (this.$refs.activityVideoPlayer as any).play();\n    // },\n    // onProgress(progress: number) {\n    //   this.activityProgress = progress;\n    // },\n    saveLesson() {\n      if (this.$props.saveToDatabase) {\n        miniLessonManager.saveCustomLesson(this.lessonUnderConstruction);\n      }\n      this.$emit('lesson-saved', this.lessonUnderConstruction);\n      this.isDirty = false;\n    },\n    deleteLesson() {\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      miniLessonManager.deleteCustomLesson(this.lessonUnderConstruction);\n      this.$emit('back-selected');\n    },\n    exportLesson() {\n      Utils.PromptDownloadFile(`${this.lessonUnderConstruction.header.lessonTitle}.lesson.json`, JSON.stringify(this.lessonUnderConstruction));\n    },\n  },\n});\n","import { render } from \"./CreateLessonScreen.vue?vue&type=template&id=741d684d\"\nimport script from \"./CreateLessonScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./CreateLessonScreen.vue?vue&type=script&lang=ts\"\n\nimport \"./CreateLessonScreen.vue?vue&type=style&index=0&id=741d684d&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  computed, defineComponent, nextTick, ref, watchEffect,\n} from 'vue';\nimport {\n  CreateBlankWorkflow, GetVideoEntryForWorkflowStep, Instructions, Workflow, WorkflowStage, WorkflowStep,\n} from '@/model/Workflow';\nimport Utils from '@/services/Utils';\nimport miniLessonManager, { MiniLessonManager } from '@/services/MiniLessonManager';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport videoDB from '@/services/VideoDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport CreateLessonScreen from '@/components/screens/CreateLessonScreen.vue';\n\nexport default defineComponent({\n  name: 'CreateWorkflowScreen',\n  emits: ['back-selected', 'workflow-created'],\n  components: {\n    WorkflowMenu,\n    CreateLessonScreen,\n  },\n  setup() {\n\n    const isDirty = ref(false);\n\n    const activeWorkflow = ref(null as null | Workflow);\n    const selectingWorkflowIndex = ref(-1);\n    const selectingWorkflowId = computed(() => {\n      const selectingWorkflow = workflowManager.workflowsArray.value[selectingWorkflowIndex.value];\n      return selectingWorkflow?.id ?? null;\n    });\n    const canEditWorkflow = computed(() => {\n      const id = selectingWorkflowId.value;\n      return id && workflowManager.isCustomWorkflow(id);\n    });\n    const workflowInDatabase = computed(() => activeWorkflow.value?.id && WorkflowManager.hasSavedCustomLesson(activeWorkflow.value.id));\n    const selectedStageIndex = ref(0);\n    const activeStage = computed(() => activeWorkflow.value?.stages[selectedStageIndex.value] ?? null);\n    const selectedStepIndex = ref(0);\n    const activeStep = computed(() => activeStage.value?.steps[selectedStepIndex.value] ?? null);\n    const isVideoUploadStep = computed(() => activeStep.value?.type === 'UploadTask');\n    const isLessonReferenceStep = computed(() => activeStep.value?.type === 'MiniLessonReference');\n    const isLessonEmbeddedStep = computed(() => activeStep.value?.type === 'MiniLessonEmbedded');\n    const isInstructionStep = computed(() => activeStep.value?.type === 'InstructionOnly');\n    const availableReferenceLessons = computed(() => {\n      if (!activeStep.value) return [] as MiniLesson[];\n      if (!activeStep.value.miniLessonReference?.clipName) return [] as MiniLesson[];\n      return miniLessonManager.lessonsByVideo.get(activeStep.value.miniLessonReference.clipName) ?? [];\n    });\n    const activeStepLesson = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonReferenceStep.value && activeStep.value.miniLessonReference?.lessonId) return miniLessonManager.lessonsById.get(activeStep.value.miniLessonReference.lessonId) ?? null;\n      if (isLessonEmbeddedStep.value) return activeStep.value.miniLessonEmbedded ?? null;\n      return null;\n    });\n    const canEditActiveStepLessonReference = computed(() => activeStepLesson.value?.source === 'custom');\n    const newEmbeddedLessonClipName = ref('');\n    const newEmbeddedLessonMotion = computed(() => videoDB.entriesByClipName.get(newEmbeddedLessonClipName.value) ?? null);\n    const canCreateEmbeddedLesson = computed(() => newEmbeddedLessonMotion.value !== null);\n    const editLessonActive = ref(false);\n    const embeddedLessonMotion = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonEmbeddedStep.value && activeStep.value.miniLessonEmbedded) return GetVideoEntryForWorkflowStep(videoDB, activeStep.value);\n      if (isLessonEmbeddedStep.value) return newEmbeddedLessonMotion.value;\n      if (isLessonReferenceStep.value) return GetVideoEntryForWorkflowStep(videoDB, activeStep.value);\n      return null;\n    });\n\n    watchEffect(() => {\n      if (activeWorkflow.value) {\n        workflowManager.setActiveFlow(activeWorkflow.value.id);\n        workflowManager.completeActivitesPriorToStageAndStep(selectedStageIndex.value, selectedStepIndex.value);\n        // TODO: improve logic to keep status of intra-stage workflow steps.\n      }\n    });\n\n    watchEffect(() => {\n      if (!activeStep.value) return;\n      if (isInstructionStep.value) {\n        activeStep.value.instructions = activeStep.value.instructions ?? {\n          heading: 'Instructions Heading',\n          text: '',\n        } as Instructions;\n      } else if (isLessonReferenceStep.value) {\n        activeStep.value.miniLessonReference = activeStep.value.miniLessonReference ?? {} as any;\n        //  ?? {\n\n        // };\n      } else if (isLessonEmbeddedStep.value) {\n        // activeStep.value.miniLessonEmbedded = activeStep.value.miniLessonEmbedded;\n        //  ?? {\n\n        // };\n      } else if (isVideoUploadStep.value) {\n        activeStep.value.upload = activeStep.value.upload ?? {\n          identifier: activeStep.value.title,\n          prompt: 'Upload your video here',\n        };\n      }\n    });\n\n    const customWorkflowCount = computed(() => workflowManager.workflowsArray.value.filter((w) => workflowManager.isCustomWorkflow(w.id)).length);\n\n    function exportCustomWorkflows() {\n      const workflows = workflowManager.workflowsArray.value.filter((w) => workflowManager.isCustomWorkflow(w.id));\n      const json = JSON.stringify(workflows, null, 2);\n      Utils.PromptDownloadFile('custom-workflows.json', json);\n    }\n    return {\n      selectingWorkflowIndex,\n      selectingWorkflowId,\n      activeWorkflow,\n      canEditWorkflow,\n      workflowInDatabase,\n      customWorkflowCount,\n      exportCustomWorkflows,\n      availableWorkflows: workflowManager.workflowsArray,\n      selectedStageIndex,\n      activeStage,\n\n      selectedStepIndex,\n      activeStep,\n      isVideoUploadStep,\n      isLessonReferenceStep,\n      isLessonEmbeddedStep,\n      isInstructionStep,\n      availableClips: videoDB.clipNames,\n      availableReferenceLessons,\n      newEmbeddedLessonClipName,\n      newEmbeddedLessonMotion,\n      embeddedLessonMotion,\n      canCreateEmbeddedLesson,\n      editLessonActive,\n      activeStepLesson,\n      canEditActiveStepLessonReference,\n      isMoveStepDropdownActive: ref(false),\n\n      isDirty,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  watch: {\n    activeWorkflow: {\n      handler(newVal) {\n        console.log('Workflow now dirty');\n        this.isDirty = ((newVal ?? null) !== null);\n      },\n      deep: true,\n    },\n  },\n  computed: {\n  },\n  methods: {\n    isCustomWorkflow(id: string) {\n      return workflowManager.isCustomWorkflow(id);\n    },\n    durationOfClip(clipName: string) {\n      const entry = videoDB.entriesByClipName.get(clipName);\n      if (!entry) return 0;\n      return entry.duration;\n    },\n    goBack(skipPrompt?: boolean) {\n      if (!this.activeWorkflow) {\n        this.$emit('back-selected');\n        return;\n      }\n\n      if (skipPrompt || !this.isDirty) {\n        this.activeWorkflow = null;\n        return;\n      }\n\n      // eslint-disable-next-line no-alert\n      if (window.confirm('Go back without saving changes?')) {\n        workflowManager.reloadCustomWorkflow(this.activeWorkflow.id);\n        this.activeWorkflow = null;\n      }\n    },\n    deleteWorkflow(id: string | undefined) {\n      if (!id && !this.activeWorkflow) return;\n      if (!id) id = this.activeWorkflow?.id ?? '';\n\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this workflow?')) {\n        return;\n      }\n\n      workflowManager.deleteCustomWorkflow(id);\n      this.goBack(true);\n    },\n    exportWorkflow() {\n      if (!this.activeWorkflow) return;\n      Utils.PromptDownloadFile(`${this.activeWorkflow.title}.workflow.json`, JSON.stringify(this.activeWorkflow));\n    },\n    saveWorkflow() {\n      if (!this.activeWorkflow) return;\n      console.log('Saving workflow');\n      workflowManager.upsertCustomWorkflow(this.activeWorkflow);\n      nextTick(() => {\n        this.isDirty = false;\n        console.log('Workflow saved; not dirty now');\n      });\n      // window.setTimeout(() => {\n      // }, 200);\n    },\n    startCreation(asTemplate: boolean) {\n      const existingWorkflow = this.availableWorkflows[this.selectingWorkflowIndex];\n      let newActiveWorkflow;\n      if (existingWorkflow && asTemplate) {\n        newActiveWorkflow = Utils.deepCopy(existingWorkflow);\n        newActiveWorkflow.id = Utils.uuidv4();\n        this.activeWorkflow = newActiveWorkflow;\n\n      } else if (existingWorkflow && !asTemplate) {\n        newActiveWorkflow = existingWorkflow;\n        this.activeWorkflow = newActiveWorkflow;\n        nextTick(() => {\n          this.isDirty = false;\n        });\n\n      } else {\n        newActiveWorkflow = CreateBlankWorkflow();\n        this.activeWorkflow = newActiveWorkflow;\n      }\n\n      workflowManager.addSessionWorkflow(newActiveWorkflow);\n      workflowManager.setActiveFlow(newActiveWorkflow.id);\n    },\n    selectStage(stageIndex: number) {\n\n      // Clear selection if this stage was already selected\n      if (stageIndex === this.selectedStageIndex) {\n        this.selectedStageIndex = -1;\n        this.selectedStepIndex = -1;\n        return;\n      }\n\n      this.selectedStageIndex = stageIndex;\n      this.selectedStepIndex = -1;\n      workflowManager.completeActivitesPriorToStageAndStep(stageIndex, this.selectedStepIndex);\n    },\n    canReorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      const swapStage = stages[this.selectedStageIndex + increment];\n      return (curStage !== undefined) && (swapStage !== undefined);\n    },\n    reorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const swapIndex = this.selectedStageIndex + increment;\n      const curSelected = stages[this.selectedStageIndex];\n      const toSwap = stages[swapIndex];\n      if ((curSelected === undefined) || (toSwap === undefined)) {\n        console.warn(`Unable to swap stages ${this.selectedStageIndex} and ${swapIndex}`);\n        return;\n      }\n      stages[this.selectedStageIndex] = toSwap;\n      stages[swapIndex] = curSelected;\n      this.selectedStageIndex = swapIndex;\n      workflow.stages = stages;\n    },\n    addStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n\n      workflow.stages.push({\n        title: `New-Stage-${workflow.stages.length + 1}`,\n        steps: [],\n      } as WorkflowStage);\n      this.selectStage(workflow.stages.length - 1);\n    },\n    duplicateStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      if (!curStage) return;\n      stages.splice(this.selectedStageIndex, 0, Utils.deepCopy(curStage));\n      workflow.stages = stages;\n      this.selectedStageIndex += 1;\n    },\n    deleteStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Stage #${this.selectedStageIndex + 1}?`)) return;\n\n      const { stages } = workflow;\n      stages.splice(this.selectedStageIndex, 1);\n      workflow.stages = stages;\n      this.selectedStageIndex = Math.min(this.selectedStageIndex, stages.length - 1);\n    },\n    selectStep(stepIndex: number) {\n\n      // Clear selectedStep if already selected\n      if (this.selectedStepIndex === stepIndex) {\n        this.selectedStepIndex = -1;\n        return;\n      }\n      this.selectedStepIndex = stepIndex;\n\n      workflowManager.completeActivitesPriorToStageAndStep(this.selectedStageIndex, this.selectedStepIndex);\n    },\n    canReorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return false;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[this.selectedStepIndex + increment];\n      return (curStep !== undefined) && (swapStep !== undefined);\n    },\n    reorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const ogSteps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!ogSteps) return;\n      const steps = [...ogSteps];\n      const swapIndex = this.selectedStepIndex + increment;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[swapIndex];\n      if ((curStep === undefined) || (swapStep === undefined)) {\n        console.warn(`Unable to swap steps ${this.selectedStepIndex} and ${swapIndex}`);\n        return;\n      }\n      steps[this.selectedStepIndex] = swapStep;\n      steps[swapIndex] = curStep;\n      this.selectedStepIndex = swapIndex;\n      workflow.stages[this.selectedStageIndex].steps = steps;\n    },\n    addStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n\n      stage.steps.push({\n        title: `New-Step-${stage.steps.length + 1}`,\n        type: 'InstructionOnly',\n      } as WorkflowStep);\n      this.selectStep(stage.steps.length - 1);\n    },\n    duplicateStep() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const curStep = this.activeWorkflow?.stages[this.selectedStageIndex]?.steps[this.selectedStepIndex];\n      if (!curStep) return;\n      const { steps } = workflow.stages[this.selectedStageIndex];\n      steps.splice(this.selectedStepIndex, 0, Utils.deepCopy(curStep));\n      workflow.stages[this.selectedStageIndex].steps = steps;\n      this.selectedStepIndex += 1;\n    },\n    moveStep(targetStageIndex: number) {\n      if (targetStageIndex === this.selectedStageIndex) return;\n      const stage = this.activeStage;\n      const stepToMove = this.activeStep;\n      const targetPhase = this.activeWorkflow?.stages[targetStageIndex];\n      if (!stage || !stepToMove || !targetPhase) return;\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      targetPhase.steps.push(stepToMove);\n      this.selectedStageIndex = targetStageIndex;\n      this.selectedStepIndex = this.activeStage?.steps.length ?? 0;\n      this.isMoveStepDropdownActive = false;\n    },\n    deleteStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Step #${this.selectedStepIndex + 1}?`)) return;\n\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      this.selectedStepIndex = Math.min(this.selectedStepIndex, steps.length - 1);\n    },\n    updateWorkflowStepLesson(lesson: MiniLesson) {\n      if (!this.activeStep) return;\n      if (this.isLessonEmbeddedStep) {\n        this.activeStep.miniLessonEmbedded = lesson;\n        console.log('Updated embedded lesson', lesson.header.lessonTitle);\n      }\n      if (this.isLessonReferenceStep && this.activeStep.miniLessonReference) {\n        this.activeStep.miniLessonReference.lessonId = lesson._id;\n        console.log('Updated reference lesson', lesson);\n      }\n    },\n    startCreateEmbeddedLesson() {\n      if (!this.activeStep) return;\n      if (!this.newEmbeddedLessonMotion) return;\n      // this.activeStep.miniLessonEmbedded = createBlankLesson(this.newEmbeddedLessonMotion);\n      // this.activeStep.miniLessonEmbedded.header.lessonTitle = this.activeStep.title;\n      this.editLessonActive = true;\n    },\n    createReferencedLesson() {\n      if (!this.isLessonReferenceStep) return;\n      if (this.activeStep?.miniLessonReference?.lessonId === '') {\n        this.editLessonActive = true;\n      }\n    },\n    editWorkflowStepLesson() {\n      if (!this.activeStepLesson) return;\n      this.editLessonActive = true;\n    },\n    removeEmbeddedLesson() {\n      if (!this.activeStep?.miniLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (window.confirm(`Are you sure you want to delete the embedded lesson ${this.activeStep.miniLessonEmbedded.header.lessonTitle}?`)) {\n        this.activeStep.miniLessonEmbedded = undefined;\n      }\n    },\n    convertEmbeddedLessonToReference() {\n      if (!this.activeStep?.miniLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to save this lesson into a new file and convert this to a reference?'\n                         + '\\n\\nNote: be sure to save the lesson.json!')\n      ) return;\n\n      miniLessonManager.saveCustomLesson(this.activeStep.miniLessonEmbedded);\n      this.activeStep.miniLessonReference = {\n        clipName: this.activeStep.miniLessonEmbedded.header.clipName,\n        lessonId: this.activeStep.miniLessonEmbedded._id,\n      };\n      const exportLessonData = this.activeStep.miniLessonEmbedded;\n      this.activeStep.type = 'MiniLessonReference';\n      this.activeStep.miniLessonEmbedded = undefined;\n      Utils.PromptDownloadFile(`${exportLessonData.header.lessonTitle}.lesson.json`, JSON.stringify(exportLessonData));\n    },\n  },\n});\n","import { render } from \"./CreateWorkflowScreen.vue?vue&type=template&id=3152b045\"\nimport script from \"./CreateWorkflowScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./CreateWorkflowScreen.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <section class=\"section dance-menu\">\n\n    <div class=\"hero is-primary block\">\n      <div class=\"hero-body\">\n        <div class=\"container\">\n          <p class=\"title\">\n            Main Menu\n          </p>\n          <p class=\"subtitle mb-0\">\n            What do you want to learn?\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"tabs is-centered is-medium-desktop is-small-mobile is-toggle is-toggle-rounded\">\n      <ul>\n        <li v-for=\"(tab, i) in TabList\" :key=\"i\" :class=\"{'is-active': currentTab===tab}\">\n          <a @click=\"setTab(tab)\">{{tab}}</a>\n        </li>\n      </ul>\n    </div>\n\n    <div class=\"grid-menu container block\" v-show=\"currentTab === Tabs.Workflows\">\n      <MainMenuWorkflowCard\n        v-for=\"workflow in whitelistedWorkflows\"\n        :workflow=\"workflow\"\n        :key=\"workflow.id\"\n        @click=\"$emit('workflow-selected', workflow.id)\"\n      ></MainMenuWorkflowCard>\n    </div>\n    <div class=\"is-justify-content-center is-flex\" v-show=\"currentTab === Tabs.Workflows && nonwhitelistedWorkflows.length > 0\">\n      <button class=\"button is-ghost\" @click=\"() => isWorkflowListExpanded = !isWorkflowListExpanded\">\n        <span v-if=\"isWorkflowListExpanded\">\n          <i class=\"fas fa-minus\"></i>\n          Show Less\n        </span>\n        <span v-else>\n          <i class=\"fas fa-plus\"></i>\n          Show All\n        </span>\n      </button>\n    </div>\n    <div class=\"grid-menu container block\" v-show=\"nonwhitelistedWorkflows.length > 0 && currentTab === Tabs.Workflows && isWorkflowListExpanded\">\n      <MainMenuWorkflowCard\n        v-for=\"workflow in nonwhitelistedWorkflows\"\n        :workflow=\"workflow\"\n        :key=\"workflow.id\"\n        @click=\"$emit('workflow-selected', workflow.id)\"\n      ></MainMenuWorkflowCard>\n    </div>\n\n    <div v-if=\"currentTab === Tabs.Videos && availableTags.size > 0\" class=\"has-text-centered container\">\n      <!-- <h3 class=\"subtitle\">Tags</h3> -->\n      <strong>Filter by tag: </strong>\n      <span\n        v-for=\"tag in availableTags\"\n        :key=\"tag\"\n        class=\"tag m-1 is-size-6 is-clickable is-unselectable\"\n        :class=\"{'is-primary': activeTags.has(tag)}\"\n        @click=\"toggleTag(tag)\"\n      >{{tag}}</span>\n\n    </div>\n\n    <div class=\"grid-menu container block\"\n      v-show=\"currentTab === Tabs.Videos\"\n    >\n      <div\n        class=\"video-card card hover-expand\"\n        v-for=\"videoEntry in filteredVideos\"\n        :key=\"videoEntry.clipName\"\n        @mouseover=\"videoEntry.hovering = true\"\n        @mouseleave=\"videoEntry.hovering = false\"\n        @click = \"videoEntry.clicked = !videoEntry.clicked\"\n      >\n        <div class=\"card-image\">\n          <figure class=\"image is-2by3\" v-if=\"(!videoEntry.hovering) && (!videoEntry.clicked)\">\n            <img :src=\"videoEntry.thumbnailSrc\" class=\"is-contain\" />\n          </figure>\n          <figure class=\"image is-2by3\" v-else><video controls :src=\"videoEntry.videoSrc\" @playing=\"videoEntry.clicked=True\"></video></figure>\n        </div>\n        <div class=\"card-content\" >\n          <div class=\"level\">\n            <div class=\"level-item\">\n              {{ videoEntry.title }}\n            </div>\n            <!-- <transition name=\"expand-down\" appear> -->\n              <div class=\"level-item\">\n                <button\n                  class=\"button is-small transition-all is-primary\"\n                  :class=\"{\n                    'is-outlined': !(videoEntry.clicked || videoEntry.hovering)\n                  }\"\n                  @click=\"selectedVideo = videoEntry\">\n                  <span>Go</span>\n                  <span class=\"icon is-small\">\n                    <i class=\"fas fa-arrow-right\"></i>\n                  </span>\n                  </button>\n              </div>\n            <!-- </transition> -->\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"grid-menu container block\" v-show=\"currentTab === Tabs.Tools\">\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"uploadLessonUIActive = true\">\n        Upload Custom Lesson\n      </div>\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"uploadWorkflowUIActive = true\">\n        Upload Custom Workflow\n      </div>\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"$emit('create-workflow-selected')\">\n        Workflow Editor\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': selectedVideo }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <LessonCard\n          :motion=\"selectedVideo\"\n          @closed=\"selectedVideo = null\"\n          @lesson-selected=\"onLessonSelected\"\n          @create-lesson-selected=\"createLessonSelected\"\n          @keyframeselectortool-selected=\"onKeyframeSelectorToolSelected\"\n        />\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': uploadLessonUIActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <UploadCard\n          v-if=\"uploadLessonUIActive\"\n          @cancelled=\"uploadLessonUIActive = false\"\n          :uploadAccept=\"'*.json'\"\n          :onFilesSelected=\"uploadLessons\"\n          :savingText=\"'Loading lessons...'\"\n          :successText=\"'Lessons loaded successfully'\"\n        />\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': uploadWorkflowUIActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <UploadCard\n          v-if=\"uploadWorkflowUIActive\"\n          @cancelled=\"uploadWorkflowUIActive = false\"\n          :uploadAccept=\"'*.json'\"\n          :onFilesSelected=\"uploadWorkflows\"\n          :savingText=\"'Loading workflows...'\"\n          :successText=\"'Workflows loaded successfully'\"\n        />\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport MainMenuWorkflowCard from '@/components/elements/MainMenuWorkflowCard.vue';\nimport LessonCard from '@/components/elements/LessonCard.vue';\nimport UploadCard from '@/components/elements/UploadCard.vue';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport miniLessonManager, { MiniLessonManager } from '@/services/MiniLessonManager';\nimport db from '@/services/VideoDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\nimport optionsManager from '@/services/OptionsManager';\n\nconst workflowWhitelist = [\n  'c8829142-992b-4cda-8ef7-ff0813f6e6fb',\n  '15752163-7086-4305-a7be-39affe5c7e57',\n];\n\nconst Tabs = Object.freeze({\n  Workflows: 'Workflows',\n  Videos: 'Videos',\n  Tools: 'Tools',\n});\nconst TabSet = Object.freeze(new Set(Object.values(Tabs)));\nconst TabList = Object.freeze(new Array(...Object.values(Tabs)));\n\nexport default defineComponent({\n  name: 'MainMenu',\n  emits: [\n    'lesson-selected',\n    'create-lesson-selected',\n    'workflow-selected',\n    'create-workflow-selected',\n    'keyframeselectortool-selected',\n  ],\n  components: {\n    LessonCard,\n    UploadCard,\n    MainMenuWorkflowCard,\n  },\n  setup(props, ctx) {\n    const videos = db.entries;\n    const selectedVideo = ref(null as VideoDatabaseEntry | null);\n    const uploadLessonUIActive = ref(false);\n    const currentTab = ref(Tabs.Workflows as string);\n    const activeTags = ref(new Set());\n\n    function onLessonSelected(\n      videoEntry: VideoDatabaseEntry,\n      lesson: MiniLesson,\n    ) {\n      ctx.emit('lesson-selected', videoEntry, lesson);\n      selectedVideo.value = null;\n    }\n\n    function createLessonSelected(videoEntry: VideoDatabaseEntry) {\n      ctx.emit('create-lesson-selected', videoEntry);\n      selectedVideo.value = null;\n    }\n\n    const filteredVideos = computed(() => {\n      const tagMatchingMotions = videos.value.filter((videoEntry) => {\n\n        if (activeTags.value.size === 0) return true;\n\n        const allTagsMatch = videoEntry.tags.reduce((someTagMatches: boolean, currTag: string) => {\n          const thisTagMatches = activeTags.value.has(currTag);\n          return someTagMatches || thisTagMatches;\n        }, false);\n\n        return allTagsMatch;\n\n      });\n\n      return tagMatchingMotions;\n    });\n\n    // eslint-disable-next-line arrow-body-style\n    const whitelistedWorkflows = computed(() => {\n      // eslint-disable-next-line arrow-body-style\n      return workflowManager.workflowsArray.value.filter((workflow) => {\n        return workflowWhitelist.length === 0 || workflowWhitelist.includes(workflow.id);\n      });\n    });\n\n    // eslint-disable-next-line arrow-body-style\n    const nonwhitelistedWorkflows = computed(() => {\n      // eslint-disable-next-line arrow-body-style\n      return workflowManager.workflowsArray.value.filter((workflow) => {\n        return workflowWhitelist.length === 0 || !workflowWhitelist.includes(workflow.id);\n      });\n    });\n\n    return {\n      whitelistedWorkflows,\n      nonwhitelistedWorkflows,\n      isDebug: optionsManager.isDebug,\n      isWorkflowListExpanded: ref(false),\n      selectedVideo,\n      videos,\n      filteredVideos,\n      onLessonSelected,\n      createLessonSelected,\n      uploadLessonUIActive,\n      uploadWorkflowUIActive: ref(false),\n      workflowManager,\n      activeTags,\n      availableTags: db.allTags,\n      TabList,\n      Tabs,\n      currentTab,\n    };\n  },\n  methods: {\n    toggleTag(tag: string) {\n      if (this.activeTags.has(tag)) {\n        this.activeTags.delete(tag);\n      } else {\n        this.activeTags.add(tag);\n      }\n    },\n    setTab(tab: string) {\n      console.log('Switching to tab:', tab);\n      if (!TabSet.has(tab)) {\n        console.error(`Tab ${tab} not recognized!`);\n        return;\n      }\n      this.currentTab = tab;\n    },\n    onKeyframeSelectorToolSelected(videoEntry: VideoDatabaseEntry, keyframes: number[]) {\n      this.$emit('keyframeselectortool-selected', videoEntry, keyframes);\n    },\n    async uploadLessons(files: FileList) {\n      console.log('Uploading lessons', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const lesson = JSON.parse(text);\n        MiniLessonManager.validateLesson(lesson);\n        miniLessonManager.saveCustomLesson(lesson);\n      }\n      return true;\n    },\n    async uploadWorkflows(files: FileList) {\n      console.log('Uploading workflows', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const workflow = JSON.parse(text);\n        WorkflowManager.validateWorkflow(workflow);\n\n        if (workflowManager.hasBakedInWorkflow(workflow.id)) throw new Error(`Cannot overwrite baked in workflow ${workflowManager.workflows.get(workflow.id)?.title}`);\n\n        // eslint-disable-next-line no-alert\n        if (!workflowManager.hasWorkflow(workflow.id) || window.confirm(`Are you sure you want to overwrite workflow '${workflowManager.workflows.get(workflow.id)?.title}'?`)) {\n          workflowManager.upsertCustomWorkflow(workflow);\n        }\n      }\n      return true;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n// .dance-menu {\n// backdrop-filter: blur(4px);\n// background: rgba(0, 0, 0, 0.2);\n// }\n\n.video-card.card {\n  max-width: 300px;\n}\n\n.video-card {\n  width: 210px;\n  flex-grow: 1;\n\n  margin: 1em;\n\n  img {\n    object-fit: cover;\n  }\n\n  .subtitle {\n    margin: 2rem 1rem 2em;\n    color: white;\n  }\n\n  .section {\n    padding: 1.5rem;\n  }\n\n  .image video {\n    bottom: 0;\n    left: 0;\n    right: 0;\n    top: 0;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n}\n\n/* Enter and leave animations can use different */\n/* durations and timing functions.              */\n.expand-down-enter-active {\n  transition: all .3s ease;\n}\n.expand-down-leave-active {\n  transition: all .8s cubic-bezier(1.0, 0.5, 0.8, 1.0);\n}\n.expand-down-enter, .expand-down-leave-to\n/* .slide-fade-leave-active below version 2.1.8 */ {\n  transform: scaleY(0);\n  height: 0;\n  opacity: 0;\n}\n.collapsed {\n  transform: scaleY(0);\n  height: 0;\n}\n.animate-height {\n  transition: transform 0.15s ease;\n}\n\n.transition-all {\n  transition: all 0.15s ease;\n}\n</style>\n","<template>\n<div class=\"box m-4 hover-expand is-clickable\"\n      :key=\"workflow.id\">\n      <div class=\"level\">\n        <div class=\"level-item mr-4\" v-if=\"workflow.thumbnailSrc\">\n          <img :src=\"workflow.thumbnailSrc\" class=\"image is-96x96 is-cover\">\n        </div>\n        <div class=\"level-item has-text-left\">\n          <div>\n            <p class=\"is-uppercase\">{{workflow.title}}</p>\n            <p class=\"is-size-7 has-text-grey mt-1 mb-1\" style=\"max-width:40ch;\"><strong>Algorithm: </strong>{{workflow.creationMethod}}</p>\n            <p class=\"is-size-7 has-text-grey mt-1 mb-1\" style=\"max-width:40ch;\"><strong>Lesson: </strong>{{workflow.learningScheme}}</p>\n            <p class=\"is-size-7 has-text-grey\" v-if=\"isDebug\"><strong>Created:</strong> {{workflow.created.toLocaleDateString()}} at {{workflow.created.toLocaleTimeString()}}</p>\n          </div>\n        </div>\n      </div>\n      <div style=\"\" class=\"is-size-7\" v-if=\"isDebug\">\n        <button class=\"button is-info is-light\" @click.stop=\"copyLink(workflow.id, $event)\">Copy Link</button>\n      </div>\n    </div>\n</template>\n\n<script lang=\"ts\">\n\nimport { computed, defineComponent, ref } from 'vue';\nimport { Workflow } from '@/model/Workflow';\nimport optionsManager from '@/services/OptionsManager';\n\nfunction copyLink(id: string, event: Event) {\n  const url = `${window.location.protocol}://${window.location.host}?workflowId=${id}&participantId=PARTICIPANTID`;\n  navigator.clipboard.writeText(url);\n\n  const target = event?.target as (HTMLButtonElement | undefined);\n  if (target) {\n    target.classList.add('is-success');\n    const originalText = target.innerText;\n    target.innerText = 'Copied!';\n    target.disabled = true;\n\n    setTimeout(() => {\n      if (target) {\n        target.classList.remove('is-success');\n        target.innerText = originalText;\n        target.disabled = false;\n      }\n    }, 1000);\n  }\n}\n\nexport default defineComponent({\n  name: 'MainMenuWorkflowCard',\n  emits: ['workflow-selected'],\n  props: {\n    workflow: {\n      type: Object as () => Workflow,\n      required: true,\n    },\n  },\n  setup(props, ctx) {\n    return {\n      isDebug: optionsManager.isDebug,\n      copyLink,\n    };\n  },\n});\n\n</script>\n","\n\nimport { computed, defineComponent, ref } from 'vue';\nimport { Workflow } from '@/model/Workflow';\nimport optionsManager from '@/services/OptionsManager';\n\nfunction copyLink(id: string, event: Event) {\n  const url = `${window.location.protocol}://${window.location.host}?workflowId=${id}&participantId=PARTICIPANTID`;\n  navigator.clipboard.writeText(url);\n\n  const target = event?.target as (HTMLButtonElement | undefined);\n  if (target) {\n    target.classList.add('is-success');\n    const originalText = target.innerText;\n    target.innerText = 'Copied!';\n    target.disabled = true;\n\n    setTimeout(() => {\n      if (target) {\n        target.classList.remove('is-success');\n        target.innerText = originalText;\n        target.disabled = false;\n      }\n    }, 1000);\n  }\n}\n\nexport default defineComponent({\n  name: 'MainMenuWorkflowCard',\n  emits: ['workflow-selected'],\n  props: {\n    workflow: {\n      type: Object as () => Workflow,\n      required: true,\n    },\n  },\n  setup(props, ctx) {\n    return {\n      isDebug: optionsManager.isDebug,\n      copyLink,\n    };\n  },\n});\n\n","import { render } from \"./MainMenuWorkflowCard.vue?vue&type=template&id=3fcb1b6a\"\nimport script from \"./MainMenuWorkflowCard.vue?vue&type=script&lang=ts\"\nexport * from \"./MainMenuWorkflowCard.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"card lesson-card\" v-if=\"motion\">\n    <div class=\"card-header\">\n      <h4 class=\"card-header-title\">\n        {{ motion.title }}\n      </h4>\n\n      <a class=\"card-header-icon\" @click=\"$emit('closed')\">\n        <i class=\"fas fa-times\"></i>\n      </a>\n    </div>\n    <div class=\"card-content\">\n      <div class=\"columns\">\n        <div class=\"column is-narrow is-hidden-mobile\">\n          <video :src=\"motion.videoSrc\" autoplay=\"true\" muted=\"true\" width=\"180\" />\n        </div>\n        <div class=\"column\">\n          <div class=\"menu\">\n            <p class=\"menu-label\">\n              Pick a mini-lesson\n            </p>\n            <ul class=\"menu-list\">\n              <li v-for=\"lesson in lessons\" :key=\"lesson._id\">\n                <a @click=\"$emit('lesson-selected', motion, lesson)\">\n                  {{ lesson.header.lessonTitle }}\n                </a>\n              </li>\n              <li v-if=\"canCreateLesson\">\n                <a @click=\"$emit('create-lesson-selected', motion)\">Create Lesson</a>\n              </li>\n              <li v-for=\"(kfopt, i) in keyframeOptions\" :key=\"i\">\n                <a @click=\"$emit('keyframeselectortool-selected', motion, kfopt.keyframes)\">Keyframes - {{kfopt.title}}</a>\n              </li>\n              <li>\n                <a @click=\"$emit('keyframeselectortool-selected', motion, [])\">Select Keyframes</a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport db from '@/services/VideoDatabase';\nimport miniLessonManager from '@/services/MiniLessonManager';\nimport keyframeOptions from '@/data/keyframeOptions.json';\n\nexport default defineComponent({\n  name: 'LessonCard',\n  props: {\n    motion: {\n      type: Object,\n    },\n    canCreateLesson: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  computed: {\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as VideoDatabaseEntry;\n      const lessons = miniLessonManager.getLessons(motion);\n      return lessons ?? [];\n    },\n    keyframeOptions() {\n      if (!this.motion) return [];\n      const motion = this.motion as VideoDatabaseEntry;\n      return keyframeOptions.filter((option) => option.clipName === motion.clipName);\n    },\n  },\n  emits: ['lesson-selected', 'create-lesson-selected', 'closed', 'keyframeselectortool-selected'],\n});\n</script>\n\n<style lang=\"scss\">\n\n.lesson-card .dance-image {\n  max-height: 50vh;\n}\n\n</style>\n","\nimport { defineComponent } from 'vue';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport db from '@/services/VideoDatabase';\nimport miniLessonManager from '@/services/MiniLessonManager';\nimport keyframeOptions from '@/data/keyframeOptions.json';\n\nexport default defineComponent({\n  name: 'LessonCard',\n  props: {\n    motion: {\n      type: Object,\n    },\n    canCreateLesson: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  computed: {\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as VideoDatabaseEntry;\n      const lessons = miniLessonManager.getLessons(motion);\n      return lessons ?? [];\n    },\n    keyframeOptions() {\n      if (!this.motion) return [];\n      const motion = this.motion as VideoDatabaseEntry;\n      return keyframeOptions.filter((option) => option.clipName === motion.clipName);\n    },\n  },\n  emits: ['lesson-selected', 'create-lesson-selected', 'closed', 'keyframeselectortool-selected'],\n});\n","import { render } from \"./LessonCard.vue?vue&type=template&id=28bed797\"\nimport script from \"./LessonCard.vue?vue&type=script&lang=ts\"\nexport * from \"./LessonCard.vue?vue&type=script&lang=ts\"\n\nimport \"./LessonCard.vue?vue&type=style&index=0&id=28bed797&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"card upload-card\">\n    <div class=\"card-header\">\n      <h4 class=\"card-header-title\">Upload File</h4>\n\n      <a class=\"card-header-icon\" @click=\"$emit('cancelled')\">\n        <i class=\"fas fa-times\"></i>\n      </a>\n    </div>\n    <div class=\"card-content\">\n      <form\n        enctype=\"multipart/form-data\"\n        novalidate\n        v-if=\"isInitial || isSaving || isFailed\"\n      >\n        <div class=\"field\">\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <div class=\"dropbox is-rounded\">\n              <input\n                type=\"file\"\n                :name=\"uploadFieldName\"\n                :disabled=\"isSaving\"\n                @change=\"\n                  save($event.target.files, $event.target);\n                  fileCount = $event.target.files.length;\n                \"\n                :accept=\"uploadAccept\"\n                class=\"file-input\"\n              />\n              <p class=\"is-size-7\" v-if=\"isInitial\">\n                {{uploadInstructions}}\n              </p>\n              <p class=\"is-size-7\" v-if=\"isSaving\">\n                {{savingText}}\n              </p>\n              <div class=\"is-size-7 has-text-centered\" v-if=\"isFailed\">\n                <p>Error saving:</p>\n                <p style=\"max-width:60ch;\" class=\"has-text-danger\">{{uploadError}}</p>\n                <p><strong>Please try again.</strong></p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </form>\n      <div class=\"has-text-success\" v-if=\"isSuccess\">{{successText}}</div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nconst Status = Object.freeze({\n  Initial: 'Initial',\n  Saving: 'Saving',\n  Success: 'Success',\n  Failed: 'Failed',\n});\n\nexport default defineComponent({\n  name: 'UploadCard',\n  props: {\n    uploadAccept: {\n      type: String,\n      default: '*',\n    },\n    uploadInstructions: {\n      type: String,\n      default: 'Click here or drag your file(s) over this area',\n    },\n    savingText: {\n      type: String,\n      default: 'Processing File(s)...',\n    },\n    onFilesSelected: {\n      type: Function,\n      default: () => {},\n    },\n    successText: {\n      type: String,\n      default: 'Files uploaded successfully',\n    },\n  },\n  data() {\n    return {\n      uploadError: null,\n      currentStatus: null as null | string,\n      uploadFieldName: 'files',\n    };\n  },\n  emits: ['cancelled', 'done'],\n  computed: {\n    isInitial() { return (this as any).currentStatus === Status.Initial; },\n    isSaving() { return (this as any).currentStatus === Status.Saving; },\n    isSuccess() { return (this as any).currentStatus === Status.Success; },\n    isFailed() { return (this as any).currentStatus === Status.Failed; },\n  },\n  methods: {\n    reset() {\n      // reset form to initial state\n      this.currentStatus = Status.Initial;\n      this.uploadError = null;\n    },\n    async save(fileList: FileList) {\n      // upload data to the server\n      this.currentStatus = Status.Saving;\n\n      try {\n        const result = await this.onFilesSelected(fileList);\n        if (result) {\n          this.$emit('done');\n          this.currentStatus = Status.Success;\n        } else {\n          this.currentStatus = Status.Initial;\n        }\n      } catch (e) {\n        this.currentStatus = Status.Failed;\n        this.uploadError = e as any;\n      }\n    },\n  },\n  mounted() {\n    this.reset();\n  },\n});\n</script>\n\n<style lang=\"scss\">\n.upload-card {\n  .file-input {\n    opacity: 0;\n    width: 100%;\n    height: 160px;\n    position: absolute;\n    cursor: pointer;\n  }\n\n  .dropbox {\n    outline: 2px dashed gray;\n    outline-offset: -1rem;\n    min-height: 160px;\n    min-width: 320px;\n    color: dimgray;\n    padding: 1.5rem;\n    position: relative;\n    cursor: pointer;\n\n    &:hover {\n      background: lightblue;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent } from 'vue';\n\nconst Status = Object.freeze({\n  Initial: 'Initial',\n  Saving: 'Saving',\n  Success: 'Success',\n  Failed: 'Failed',\n});\n\nexport default defineComponent({\n  name: 'UploadCard',\n  props: {\n    uploadAccept: {\n      type: String,\n      default: '*',\n    },\n    uploadInstructions: {\n      type: String,\n      default: 'Click here or drag your file(s) over this area',\n    },\n    savingText: {\n      type: String,\n      default: 'Processing File(s)...',\n    },\n    onFilesSelected: {\n      type: Function,\n      default: () => {},\n    },\n    successText: {\n      type: String,\n      default: 'Files uploaded successfully',\n    },\n  },\n  data() {\n    return {\n      uploadError: null,\n      currentStatus: null as null | string,\n      uploadFieldName: 'files',\n    };\n  },\n  emits: ['cancelled', 'done'],\n  computed: {\n    isInitial() { return (this as any).currentStatus === Status.Initial; },\n    isSaving() { return (this as any).currentStatus === Status.Saving; },\n    isSuccess() { return (this as any).currentStatus === Status.Success; },\n    isFailed() { return (this as any).currentStatus === Status.Failed; },\n  },\n  methods: {\n    reset() {\n      // reset form to initial state\n      this.currentStatus = Status.Initial;\n      this.uploadError = null;\n    },\n    async save(fileList: FileList) {\n      // upload data to the server\n      this.currentStatus = Status.Saving;\n\n      try {\n        const result = await this.onFilesSelected(fileList);\n        if (result) {\n          this.$emit('done');\n          this.currentStatus = Status.Success;\n        } else {\n          this.currentStatus = Status.Initial;\n        }\n      } catch (e) {\n        this.currentStatus = Status.Failed;\n        this.uploadError = e as any;\n      }\n    },\n  },\n  mounted() {\n    this.reset();\n  },\n});\n","import { render } from \"./UploadCard.vue?vue&type=template&id=542a134c\"\nimport script from \"./UploadCard.vue?vue&type=script&lang=ts\"\nexport * from \"./UploadCard.vue?vue&type=script&lang=ts\"\n\nimport \"./UploadCard.vue?vue&type=style&index=0&id=542a134c&lang=scss\"\nscript.render = render\n\nexport default script","\nimport { computed, defineComponent, ref } from 'vue';\nimport MainMenuWorkflowCard from '@/components/elements/MainMenuWorkflowCard.vue';\nimport LessonCard from '@/components/elements/LessonCard.vue';\nimport UploadCard from '@/components/elements/UploadCard.vue';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport miniLessonManager, { MiniLessonManager } from '@/services/MiniLessonManager';\nimport db from '@/services/VideoDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\nimport optionsManager from '@/services/OptionsManager';\n\nconst workflowWhitelist = [\n  'c8829142-992b-4cda-8ef7-ff0813f6e6fb',\n  '15752163-7086-4305-a7be-39affe5c7e57',\n];\n\nconst Tabs = Object.freeze({\n  Workflows: 'Workflows',\n  Videos: 'Videos',\n  Tools: 'Tools',\n});\nconst TabSet = Object.freeze(new Set(Object.values(Tabs)));\nconst TabList = Object.freeze(new Array(...Object.values(Tabs)));\n\nexport default defineComponent({\n  name: 'MainMenu',\n  emits: [\n    'lesson-selected',\n    'create-lesson-selected',\n    'workflow-selected',\n    'create-workflow-selected',\n    'keyframeselectortool-selected',\n  ],\n  components: {\n    LessonCard,\n    UploadCard,\n    MainMenuWorkflowCard,\n  },\n  setup(props, ctx) {\n    const videos = db.entries;\n    const selectedVideo = ref(null as VideoDatabaseEntry | null);\n    const uploadLessonUIActive = ref(false);\n    const currentTab = ref(Tabs.Workflows as string);\n    const activeTags = ref(new Set());\n\n    function onLessonSelected(\n      videoEntry: VideoDatabaseEntry,\n      lesson: MiniLesson,\n    ) {\n      ctx.emit('lesson-selected', videoEntry, lesson);\n      selectedVideo.value = null;\n    }\n\n    function createLessonSelected(videoEntry: VideoDatabaseEntry) {\n      ctx.emit('create-lesson-selected', videoEntry);\n      selectedVideo.value = null;\n    }\n\n    const filteredVideos = computed(() => {\n      const tagMatchingMotions = videos.value.filter((videoEntry) => {\n\n        if (activeTags.value.size === 0) return true;\n\n        const allTagsMatch = videoEntry.tags.reduce((someTagMatches: boolean, currTag: string) => {\n          const thisTagMatches = activeTags.value.has(currTag);\n          return someTagMatches || thisTagMatches;\n        }, false);\n\n        return allTagsMatch;\n\n      });\n\n      return tagMatchingMotions;\n    });\n\n    // eslint-disable-next-line arrow-body-style\n    const whitelistedWorkflows = computed(() => {\n      // eslint-disable-next-line arrow-body-style\n      return workflowManager.workflowsArray.value.filter((workflow) => {\n        return workflowWhitelist.length === 0 || workflowWhitelist.includes(workflow.id);\n      });\n    });\n\n    // eslint-disable-next-line arrow-body-style\n    const nonwhitelistedWorkflows = computed(() => {\n      // eslint-disable-next-line arrow-body-style\n      return workflowManager.workflowsArray.value.filter((workflow) => {\n        return workflowWhitelist.length === 0 || !workflowWhitelist.includes(workflow.id);\n      });\n    });\n\n    return {\n      whitelistedWorkflows,\n      nonwhitelistedWorkflows,\n      isDebug: optionsManager.isDebug,\n      isWorkflowListExpanded: ref(false),\n      selectedVideo,\n      videos,\n      filteredVideos,\n      onLessonSelected,\n      createLessonSelected,\n      uploadLessonUIActive,\n      uploadWorkflowUIActive: ref(false),\n      workflowManager,\n      activeTags,\n      availableTags: db.allTags,\n      TabList,\n      Tabs,\n      currentTab,\n    };\n  },\n  methods: {\n    toggleTag(tag: string) {\n      if (this.activeTags.has(tag)) {\n        this.activeTags.delete(tag);\n      } else {\n        this.activeTags.add(tag);\n      }\n    },\n    setTab(tab: string) {\n      console.log('Switching to tab:', tab);\n      if (!TabSet.has(tab)) {\n        console.error(`Tab ${tab} not recognized!`);\n        return;\n      }\n      this.currentTab = tab;\n    },\n    onKeyframeSelectorToolSelected(videoEntry: VideoDatabaseEntry, keyframes: number[]) {\n      this.$emit('keyframeselectortool-selected', videoEntry, keyframes);\n    },\n    async uploadLessons(files: FileList) {\n      console.log('Uploading lessons', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const lesson = JSON.parse(text);\n        MiniLessonManager.validateLesson(lesson);\n        miniLessonManager.saveCustomLesson(lesson);\n      }\n      return true;\n    },\n    async uploadWorkflows(files: FileList) {\n      console.log('Uploading workflows', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const workflow = JSON.parse(text);\n        WorkflowManager.validateWorkflow(workflow);\n\n        if (workflowManager.hasBakedInWorkflow(workflow.id)) throw new Error(`Cannot overwrite baked in workflow ${workflowManager.workflows.get(workflow.id)?.title}`);\n\n        // eslint-disable-next-line no-alert\n        if (!workflowManager.hasWorkflow(workflow.id) || window.confirm(`Are you sure you want to overwrite workflow '${workflowManager.workflows.get(workflow.id)?.title}'?`)) {\n          workflowManager.upsertCustomWorkflow(workflow);\n        }\n      }\n      return true;\n    },\n  },\n});\n","import { render } from \"./MainMenu.vue?vue&type=template&id=d4a27164\"\nimport script from \"./MainMenu.vue?vue&type=script&lang=ts\"\nexport * from \"./MainMenu.vue?vue&type=script&lang=ts\"\n\nimport \"./MainMenu.vue?vue&type=style&index=0&id=d4a27164&lang=scss\"\nscript.render = render\n\nexport default script","\nimport {\n  computed, defineComponent, nextTick, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport VideoDatabaseEntry from '@/model/VideoDatabaseEntry';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport CreateWorkflowScreen from '@/components/screens/CreateWorkflowScreen.vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport KeyframeSelectorTool from '@/components/tools/KeyframeSelectorTool.vue';\nimport CameraSurface from './components/CameraSurface.vue';\nimport OnboardingUI from './components/OnboardingUI.vue';\nimport MainMenu from './components/screens/MainMenu.vue';\n// import LearningScreen from './components/screens/LearningScreen.vue';\nimport MiniLesson from './model/MiniLesson';\n\nimport CreateLessonScreen from './components/screens/CreateLessonScreen.vue';\nimport workflowManager from './services/WorkflowManager';\nimport optionsManager from './services/OptionsManager';\n\nconst State = {\n  MainMenu: 'MainMenu',\n  LessonActive: 'LessonActive',\n  WorkflowActive: 'WorkflowActive',\n  CreateLesson: 'CreateLesson',\n  CreateWorkflow: 'CreateWorkflow',\n  KeyframeSelectorTool: 'KeyframeSelectorTool',\n};\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    MainMenu,\n    WorkflowMenu,\n    KeyframeSelectorTool,\n    CreateLessonScreen,\n    CreateWorkflowScreen,\n    MiniLessonPlayer,\n  },\n  setup() {\n    const state = ref(State.MainMenu);\n    const cameraSurface = ref(null as typeof CameraSurface | null);\n    const hasCompletedOnboarding = ref(false);\n\n    const currentVideo = ref(null as VideoDatabaseEntry | null);\n    const currentLesson = ref(null as MiniLesson | null);\n    const keyframes = ref([] as number[]);\n\n    function lessonSelected(videoEntry: VideoDatabaseEntry, lesson: MiniLesson) {\n      currentVideo.value = videoEntry;\n      currentLesson.value = lesson;\n\n      state.value = State.LessonActive;\n      // if (webcamProvider.webcamStatus.value === 'running') state.value = State.LessonActive;\n      // else state.value = State.PromptStartWebcam;\n    }\n\n    function startKeyframeSelection(videoEntry: VideoDatabaseEntry, kfs: number[]) {\n      console.log('startKeyframeSelection', videoEntry, kfs);\n      keyframes.value = kfs;\n      currentVideo.value = videoEntry;\n      state.value = State.KeyframeSelectorTool;\n    }\n\n    function goHome() {\n      state.value = State.MainMenu;\n      currentVideo.value = null;\n      currentLesson.value = null;\n    }\n\n    return {\n      currentVideo,\n      currentLesson,\n      lessonSelected,\n      goHome,\n      keyframes,\n      state,\n      cameraSurface,\n      State,\n      startKeyframeSelection,\n      startedWithWorkflow: ref(false),\n      isDebug: optionsManager.isDebug,\n      participantId: optionsManager.participantId,\n    };\n  },\n  mounted() {\n    // If app was launched with a workflowId, skip straight\n    // to that workflow\n    if (optionsManager.workflowId.value) {\n      if (this.startWorkflow(optionsManager.workflowId.value)) {\n        this.startedWithWorkflow = true;\n      }\n    }\n  },\n  methods: {\n    createLessonSelected(dance: VideoDatabaseEntry) {\n      this.currentVideo = dance;\n      this.state = State.CreateLesson;\n    },\n    startWorkflow(workflowId: string) {\n      console.log('Starting workflow', workflowId);\n      if (workflowManager.setActiveFlow(workflowId)) {\n        this.state = State.WorkflowActive;\n        return true;\n      }\n      return false;\n    },\n  },\n});\n","import { render } from \"./App.vue?vue&type=template&id=eacb1f9a\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=eacb1f9a&lang=scss\"\nscript.render = render\n\nexport default script","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker';\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready() {\n      console.log(\n        'App is being served from cache by a service worker.\\n'\n        + 'For more details, visit https://goo.gl/AFskqB',\n      );\n    },\n    registered() {\n      console.log('Service worker has been registered.');\n    },\n    cached() {\n      console.log('Content has been cached for offline use.');\n    },\n    updatefound() {\n      console.log('New content is downloading.');\n    },\n    updated() {\n      console.log('New content is available; please refresh.');\n    },\n    offline() {\n      console.log('No internet connection found. App is running in offline mode.');\n    },\n    error(error) {\n      console.error('Error during service worker registration:', error);\n    },\n  });\n}\n","import { Landmark, MpHolisticResults, PoseLandmarks } from './MediaPipeTypes';\nimport eventHub, { EventNames, GestureNames } from './EventHub';\nimport {\n  HAND, usingHolistic,\n} from './MediaPipe';\n\nconst minDetectionVisibility = 0.85;\n\nfunction getAngle(lm0: Landmark, lm1: Landmark, aspectRatio: number) {\n  return Math.atan2(lm1.y - lm0.y, aspectRatio * (lm1.x - lm0.x));\n}\nfunction dist(lm0: Landmark, lm1: Landmark, aspectRatio: number) {\n  return Math.sqrt((aspectRatio * (lm1.x - lm0.x)) ** 2 + (lm1.y - lm0.y) ** 2);\n}\nconst getSum = (input: Array<number>) => input.reduce((a, b) => a + b, 0);\n\nfunction midPoint(lm0: Landmark, lm1: Landmark): Landmark {\n  return {\n    x: (0.5) * (lm0.x + lm1.x),\n    y: (0.5) * (lm0.y + lm1.y),\n  };\n}\n\nfunction averageAngle(input: Array<Landmark>, aspectRatio: number): number {\n  if (input.length < 2) return 0;\n\n  const angles = input.map(\n    (val, i, arr) => (arr[i + 1] === undefined ? 0 : getAngle(arr[i], arr[i + 1], aspectRatio)),\n  );\n  angles.pop();\n\n  const y = getSum(angles.map(Math.sin));\n  const x = getSum(angles.map(Math.cos));\n\n  return Math.atan2(y, x);\n}\n\nfunction isLine(input: Array<Landmark>, angleTolerance: number | undefined, aspectRatio: number): boolean {\n  if (input.length < 2) { return false; } // Single point: not a line\n\n  // Default the tolerance to 15 deg (on either side)\n  const tolerance = angleTolerance ?? Math.PI / 12;\n  let lastAngle = getAngle(input[0], input[1], aspectRatio);\n\n  // Make sure the angle is about correct\n  for (let i = 1; i < input.length - 1; i += 1) {\n    const thisAngle = getAngle(input[i], input[i + 1], aspectRatio);\n    if (Math.abs(thisAngle - lastAngle) >= tolerance) { return false; }\n\n    lastAngle = thisAngle;\n  }\n  return true;\n}\n\nfunction detectHandPointingGestures(handLandmarks: Landmark[] | undefined, aspectRatio: number): string {\n  if (!handLandmarks) return GestureNames.none;\n\n  const FINGERS = [\n    HAND.INDEX_FINGER,\n    HAND.MIDDLE_FINGER,\n    HAND.RING_FINGER,\n    HAND.PINKY_FINGER,\n  ];\n\n  const FINGER_LANDMARKS = FINGERS.map((indices) => indices.map((lm) => handLandmarks[lm]));\n\n  let areLines = true;\n  FINGER_LANDMARKS.forEach((finger) => {\n    if (!isLine(finger, undefined, aspectRatio)) areLines = false;\n  });\n\n  const avgAngle = averageAngle(FINGER_LANDMARKS[0], aspectRatio);\n  const avgAngleDeg = (avgAngle * 180) / Math.PI;\n\n  const tolerance = 30;\n  if (Math.abs(avgAngleDeg) < tolerance && areLines) return GestureNames.pointLeft;\n  if (Math.abs(avgAngleDeg) > 180 - tolerance && areLines) return GestureNames.pointRight;\n\n  return GestureNames.none;\n}\n\nfunction detectPosePointingGestures(poseLandmarks: Landmark[] | undefined, aspectRatio: number): string {\n  if (!poseLandmarks) return GestureNames.none;\n\n  const TOLERANCE = 20;\n  const TOLERANCE_RADS = TOLERANCE / (180 * Math.PI);\n\n  const left = [PoseLandmarks.leftElbow, PoseLandmarks.leftWrist].map((i) => poseLandmarks[i]);\n  const lelb = left[0];\n  const lwrist = left[1];\n  if (lelb.visibility && lelb.visibility > minDetectionVisibility && lwrist.visibility && lwrist.visibility > minDetectionVisibility) {\n    const ang = getAngle(lelb, lwrist, aspectRatio);\n    if (Math.abs(ang) > Math.PI - TOLERANCE_RADS) return GestureNames.pointRight;\n  }\n\n  const right = [PoseLandmarks.rightElbow, PoseLandmarks.rightWrist].map((i) => poseLandmarks[i]);\n  const relb = right[0];\n  const rwrist = right[1];\n  if (relb.visibility && relb.visibility > minDetectionVisibility && rwrist.visibility && rwrist.visibility > minDetectionVisibility) {\n    const ang = getAngle(relb, rwrist, aspectRatio);\n    if (Math.abs(ang) < TOLERANCE_RADS) return GestureNames.pointLeft;\n  }\n\n  return GestureNames.none;\n}\n\nfunction isNamasteGesture(results: MpHolisticResults, aspectRatio: number): boolean {\n  /* eslint-disable operator-linebreak, no-multi-spaces */\n  const IDs = PoseLandmarks;\n  const poseLMs = results.poseLandmarks;\n  if (!poseLMs) return false;\n\n  const areArmLandmarksVisible =\n    (poseLMs[IDs.leftShoulder].visibility  ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.leftElbow].visibility     ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.leftWrist].visibility     ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightShoulder].visibility ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightElbow].visibility    ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightWrist].visibility    ?? 0) > minDetectionVisibility;\n\n  // See if elbows are down, against the stomach\n  const downwards = -Math.PI / 2; // -90 deg\n  const leftForearmTargetAngle = downwards;\n  const rightForearmTargetAngle = downwards;\n  const elbowAngleTolerance = Math.PI / 9; // 20 deg\n\n  const leftForearmAngle = getAngle(poseLMs[IDs.leftShoulder], poseLMs[IDs.leftElbow], aspectRatio);\n  const rightForearmAngle = getAngle(poseLMs[IDs.rightShoulder], poseLMs[IDs.rightElbow], aspectRatio);\n\n  const areElbowsNearChest =\n    Math.abs(leftForearmAngle - leftForearmTargetAngle) < elbowAngleTolerance / 2 &&\n    Math.abs(rightForearmAngle - rightForearmTargetAngle) < elbowAngleTolerance / 2;\n\n  // See if hands are up and together, near base of neck\n  const handNeckMinRelativeDist = 0.8;\n  const shoulderDist = dist(poseLMs[IDs.leftShoulder], poseLMs[IDs.rightShoulder], aspectRatio);\n  const neckCenter = midPoint(poseLMs[IDs.leftShoulder], poseLMs[IDs.rightShoulder]);\n  const leftWristNeckDist = dist(neckCenter, poseLMs[IDs.leftWrist], aspectRatio) / shoulderDist;\n  const rightWristNeckDist = dist(neckCenter, poseLMs[IDs.rightWrist], aspectRatio) / shoulderDist;\n\n  const areHandsNearNeckBase =\n    leftWristNeckDist  < handNeckMinRelativeDist &&\n    rightWristNeckDist < handNeckMinRelativeDist;\n\n  // console.log('areArmLandmarksVisible', areArmLandmarksVisible);\n  // console.log('areElbowsNearChest', areElbowsNearChest);\n  // console.log('areHandsNearNeckBase', areHandsNearNeckBase);\n  // console.log('  leftWristNeckDist', leftWristNeckDist);\n  // console.log('  rightWristNeckDist', rightWristNeckDist);\n  return areArmLandmarksVisible &&\n  //  areElbowsNearChest &&\n         areHandsNearNeckBase;\n\n  /* eslint-enable operator-linebreak, no-multi-spaces */\n}\n\nexport default function detectGesture(mpResults?: MpHolisticResults): string {\n\n  const aspectRatio = (mpResults?.image?.width ?? 1) / (mpResults?.image?.height ?? 1);\n\n  if (!mpResults) return GestureNames.none;\n  let detectedGesture = GestureNames.none;\n\n  if (usingHolistic) {\n    if (detectedGesture === GestureNames.none) detectedGesture = detectHandPointingGestures(mpResults.rightHandLandmarks, aspectRatio);\n    if (detectedGesture === GestureNames.none) detectedGesture = detectHandPointingGestures(mpResults.leftHandLandmarks, aspectRatio);\n  } else detectedGesture = detectPosePointingGestures(mpResults.poseLandmarks, aspectRatio);\n\n  if (detectedGesture === GestureNames.none && isNamasteGesture(mpResults, aspectRatio)) {\n    detectedGesture = GestureNames.namaste;\n  }\n\n  return detectedGesture;\n}\n\nexport function startGestureDetection() {\n  eventHub.on(EventNames.trackingResults, (results: MpHolisticResults) => {\n    const detectedGesture = detectGesture(results);\n    eventHub.emit(EventNames.gesture, detectedGesture, results);\n  });\n}\n","import { createApp } from 'vue';\n\nimport App from './App.vue';\n\nimport './registerServiceWorker';\nimport { startGestureDetection } from './services/GestureDetection';\n\nrequire('bulma-slider');\n\nrequire('@/assets/main.scss');\n\nconst app = createApp(App);\napp.mount('#app');\n\nstartGestureDetection();\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./KeyframeSelectorTool.vue?vue&type=style&index=0&id=9e9b0c52&lang=sass\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./KeyframeTimeline.vue?vue&type=style&index=0&id=1326a96d&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./MainMenu.vue?vue&type=style&index=0&id=d4a27164&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./SegmentedProgressBar.vue?vue&type=style&index=0&id=03afb3ff&lang=scss\""],"sourceRoot":""}