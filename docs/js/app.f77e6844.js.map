{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/assets/gestures sync ^\\.\\/.*\\.svg$","webpack:///./src/components/elements/ActivityVideoPlayer.vue?fbde","webpack:///./src/components/elements/InstructionCarousel.vue?0e96","webpack:///./src/components/elements/MiniLessonPlayer.vue?0686","webpack:///./src/assets/gestures/forward.svg","webpack:///./src/components/screens/MainMenu.vue?c5da","webpack:///./src/components/elements/WebcamPromptCard.vue?02bc","webpack:///./src/components/tools/KeyframeSelectorTool.vue?3a4b","webpack:///./src/App.vue?8c43","webpack:///./src/components/elements/LessonCard.vue?d250","webpack:///./src/assets/gestures/play.svg","webpack:///./src/assets/gestures/backward.svg","webpack:///./src/components/screens/CreateLessonScreen.vue?237b","webpack:///./src/components/elements/UploadCard.vue?d451","webpack:///./src/assets/tiktokdances.jpg","webpack:///./src/components/elements/LayoutTest.vue?f4a6","webpack:///./src/components/elements/VideoPlayer.vue?accc","webpack:///./src/components/screens/FeedbackUploadScreen.vue?de9c","webpack:///./src/components/CameraSurface.vue?1759","webpack:///./src/components/screens/PoseDrawerTest.vue?514b","webpack:///./src/components/elements/WebcamBox.vue?5349","webpack:///./src/components/DrawingSurface.vue?d0d9","webpack:///./src/components/elements/SegmentedProgressBar.vue?0bbc","webpack:///./src/components/elements/SheetMotion.vue?79b1","webpack:///./src/App.vue","webpack:///./src/services/WebcamProvider.ts","webpack:///./src/components/screens/WorkflowMenu.vue","webpack:///./src/components/elements/MiniLessonPlayer.vue","webpack:///./src/components/elements/ActivityVideoPlayer.vue","webpack:///./src/components/elements/InstructionCarousel.vue","webpack:///./src/components/elements/InstructionCarousel.vue?eae7","webpack:///./src/components/elements/InstructionCarousel.vue?3dde","webpack:///./src/components/elements/PausingVideoPlayer.vue","webpack:///./src/services/Constants.ts","webpack:///./src/components/elements/VideoPlayer.vue","webpack:///./src/services/MediaPipeTypes.ts","webpack:///./src/services/EventHub.ts","webpack:///./src/services/Utils.ts","webpack:///./src/services/MediaPipe.ts","webpack:///./src/services/PoseProvider.ts","webpack:///./src/components/elements/VideoPlayer.vue?e7d3","webpack:///./src/components/elements/VideoPlayer.vue?b67d","webpack:///./src/components/elements/PausingVideoPlayer.vue?fe03","webpack:///./src/components/elements/PausingVideoPlayer.vue?8e8a","webpack:///./src/components/elements/KeyframeTimeline.vue","webpack:///./src/components/elements/KeyframeTimeline.vue?2297","webpack:///./src/components/elements/KeyframeTimeline.vue?4e3e","webpack:///./src/components/elements/WebcamBox.vue","webpack:///./src/components/elements/WebcamBox.vue?0a4a","webpack:///./src/components/elements/WebcamBox.vue?e390","webpack:///./src/components/elements/SheetMotion.vue","webpack:///./src/components/elements/SheetMotion.vue?5570","webpack:///./src/components/elements/SheetMotion.vue?5e8d","webpack:///./src/components/elements/ActivityVideoPlayer.vue?e80c","webpack:///./src/components/elements/ActivityVideoPlayer.vue?f161","webpack:///./src/components/elements/SegmentedProgressBar.vue","webpack:///./src/components/elements/SegmentedProgressBar.vue?1c88","webpack:///./src/components/elements/SegmentedProgressBar.vue?1b9d","webpack:///./src/components/elements/MiniLessonPlayer.vue?9016","webpack:///./src/components/elements/MiniLessonPlayer.vue?97b4","webpack:///./src/services/MotionDatabase.ts","webpack:///./src/services/WorkflowManager.ts","webpack:///./src/components/screens/FeedbackUploadScreen.vue","webpack:///./src/services/AzureUploader.ts","webpack:///./src/components/screens/FeedbackUploadScreen.vue?3036","webpack:///./src/components/screens/FeedbackUploadScreen.vue?209b","webpack:///./src/services/OptionsManager.ts","webpack:///./src/model/Workflow.ts","webpack:///./src/components/screens/WorkflowMenu.vue?8157","webpack:///./src/components/screens/WorkflowMenu.vue?71fa","webpack:///./src/components/screens/CreateWorkflowScreen.vue","webpack:///./src/components/screens/CreateLessonScreen.vue","webpack:///./src/components/tools/KeyframeSelectorTool.vue","webpack:///./src/components/tools/KeyframeSelectorTool.vue?f994","webpack:///./src/components/tools/KeyframeSelectorTool.vue?3151","webpack:///./src/components/screens/CreateLessonScreen.vue?a8e9","webpack:///./src/components/screens/CreateLessonScreen.vue?8b77","webpack:///./src/components/screens/CreateWorkflowScreen.vue?a634","webpack:///./src/components/screens/CreateWorkflowScreen.vue?638d","webpack:///./src/components/elements/LayoutTest.vue","webpack:///./src/components/elements/LayoutTest.vue?8dc8","webpack:///./src/components/elements/LayoutTest.vue?454d","webpack:///./src/components/CameraSurface.vue","webpack:///./src/components/DrawingSurface.vue","webpack:///./src/components/DrawingSurface.vue?0145","webpack:///./src/components/DrawingSurface.vue?3b98","webpack:///./src/components/CameraSurface.vue?7f23","webpack:///./src/components/CameraSurface.vue?8fa7","webpack:///./src/components/OnboardingUI.vue","webpack:///./src/components/elements/GestureIcon.vue","webpack:///./src/components/elements/GestureIcon.vue?548f","webpack:///./src/components/elements/GestureIcon.vue?1324","webpack:///./src/components/OnboardingUI.vue?b3c5","webpack:///./src/components/OnboardingUI.vue?fcd3","webpack:///./src/components/screens/MainMenu.vue","webpack:///./src/components/elements/LessonCard.vue","webpack:///./src/components/elements/LessonCard.vue?090b","webpack:///./src/components/elements/LessonCard.vue?8b6b","webpack:///./src/components/elements/UploadCard.vue","webpack:///./src/components/elements/UploadCard.vue?311e","webpack:///./src/components/elements/UploadCard.vue?f397","webpack:///./src/components/screens/MainMenu.vue?7063","webpack:///./src/components/screens/MainMenu.vue?0a41","webpack:///./src/components/elements/WebcamPromptCard.vue","webpack:///./src/components/elements/WebcamPromptCard.vue?a879","webpack:///./src/components/screens/PoseDrawerTest.vue","webpack:///./src/components/screens/PoseDrawerTest.vue?af42","webpack:///./src/components/screens/PoseDrawerTest.vue?bc96","webpack:///./src/App.vue?3acc","webpack:///./src/App.vue?eabf","webpack:///./src/registerServiceWorker.ts","webpack:///./src/services/GestureDetection.ts","webpack:///./src/main.ts","webpack:///./src/components/elements/KeyframeTimeline.vue?2076","webpack:///./src/components/OnboardingUI.vue?9114"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","map","webpackContext","req","id","webpackContextResolve","e","Error","code","keys","resolve","class","style","src","alt","participantId","isTest","state","State","LayoutTest","poseDrawerSelected","lessonSelected","createLessonSelected","startWorkflow","CreateWorkflow","startKeyframeSelection","MainMenu","CreateLesson","motion","currentVideo","goHome","WorkflowActive","showBackButton","startedWithWorkflow","PoseDrawingTester","KeyframeSelectorTool","modelValue","keyframes","videoEntry","LessonActive","miniLesson","currentLesson","maxVideoHeight","enableCompleteLesson","aria-label","ref","onTrackingAttained","background","OnboardingLoading","ui","PromptStartWebcam","startWebcam","StartingWebcam","LoadingTracking","Onboarding","showCameraSurface","WEBCAM_DIMENSIONS","freeze","width","height","recorder","mediaStream","activeConnections","Set","permissionState","isWebcamLoading","webcamError","isRecording","webcamStatus","this","readPermissionStatus","navigator","permissions","query","constraints","video","aspectRatio","frameRate","audio","mediaDevices","getUserMedia","videoE","add","console","log","srcObject","onloadedmetadata","play","delete","size","stopWebcam","stopRecording","getTracks","forEach","x","stop","rtc","type","startRecording","Promise","res","getBlob","defaultProvider","optionsManager","to","workflow","enableExperimentMode","Math","round","workflowSecsElapsed","workflowSecondsRemainingString","stageSecsElapsed","stageSecondsRemainingString","showHeader","title","$emit","filteredStages","stage","isStageCompleted","activeStageIndex","startStage","timeLimitString","stageSecondsRemaining","Infinity","filteredSteps","stepInfo","isClickable","startWorkflowStep","step","dbEntry","thumbnailSrc","waitingForTimeExpiration","isComplete","nextStepInStage","status","instructionsActive","currentStep","instructions","heading","text","instructionsFinished","lessonActive","currentVideoEntry","lessonCompleted","uploadActive","prompt","upload","subtitle","uploadFilename","uploadComplete","timingNotStarted","startTiming","activity","activeActivity","onProgress","segments","progressSegments","progress","activityProgress","nearbyActivityIndices","index","activeActivityIndex","activityVideoPlayer","activityFinished","gotoActivity","activities","needsStartWebcam","disabled","awaitingStart","repeat","hasNextActivity","completeLesson","showStartWebcamButton","showingWebcam","videoSrc","drawPoseLandmarks","demoVisual","videoOpacity","emphasizedJoints","onPlaybackCompleted","onPauseHit","onPauseEnded","showControls","showVideoControls","showSheetMusic","drawMode","sheetMotionVisual","currentTime","videoTime","sheetMotion","sizeClass","timedInstructions","pauseInstructs","staticInstruction","keyframeVisual","tag","inst","tagClass","props","Array","default","String","render","videoBaseUrl","onSegmentPlaybackCompleted","setDrawStyle","emphasizedJointStyle","Constants","DefaultPauseDuration","videoUrl","scheduleCanvasResizing","onTimeUpdated","endReported","playsinline","PoseLandmarks","nose","leftEyeInner","leftEye","leftEyeOuter","rightEyeInner","rightEye","rightEyeOuter","leftEar","rightEar","mouthLeft","mouthRight","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftPinky","rightPinky","leftIndex","rightIndex","leftThumb","rightThumb","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle","leftHeel","rightHeel","leftFootIndex","rightFootIndex","midShouder","midHip","midEye","EventNames","gesture","trackingProcessingStarted","trackingResults","trackingRequested","trackingRequestFinished","GestureNames","none","pointLeft","pointRight","namaste","eventHub","setupGestureListening","callbacks","fallback","onGesture","cb","on","off","setupMediaPipeListening","callback","onFrameProcessingStarted","TrackingActions","requestTracking","emit","endTrackingRequest","startAt","secs","setTimeout","filename","element","document","createElement","setAttribute","encodeURIComponent","display","body","appendChild","click","removeChild","onFrame","shouldRun","undefined","requestAnimationFrame","then","Utils","DoEveryFrame","replace","crypto","getRandomValues","Uint8Array","toString","obj","Date","copy","setTime","getTime","isArray","len","deepCopy","typedObj","attrs","attr","val","array","fromIndex","toIndex","sliceStart","sliceEnd","floor","random","usingHolistic","mp","HAND_LANDMARK_CONNECTIONS","HAND","THUMB_FINGER","INDEX_FINGER","MIDDLE_FINGER","RING_FINGER","PINKY_FINGER","CONNECTIONS_TO_DRAW","v0","v1","trackingStarted","DrawConnections","canvasCtx","landmarks","connections","w","canvas","h","beginPath","connection","p1","p2","moveTo","y","lineTo","stroke","restore","MidLandmark","lm1","lm2","visibility","GetLandmark","lm","lms","DrawSkeleton","poseLandmarks","enableSizeVariation","emphasisStroke","emphasized","indexOf","save","strokeStyle","lineWidth","DrawPose","options","jointsWithEmphasis","sourceAR","sourceAspectRatio","canvasAR","adjustedHeight","pixelsTaller","translate","adjustedWidth","pixelsWider","outlineColor","outlineWidth","max","trackingRequests","trackingCount","filter","StartTracking","initial","mpInstance","Holistic","locateFile","file","Pose","setOptions","upperBodyOnly","smoothLandmarks","minDetectionConfidence","minTrackingConfidence","frameId","timestamp","now","onResults","send","image","isTracking","VIDEO_EXTENSIONS","poseFiles","Map","videoName","poseFilename","extension","cached","stored","localStorage","getItem","JSON","parse","set","PoseProvider","getPoseFile","poseFile","poses","convertToPoseList","url","fetch","response","ok","statusText","csv","temp","row","convertRow","startsWith","Number","parseFloat","poseProvider","onResize","canvasE","modified","offsetWidth","offsetHeight","setupCanvasResizing","videoElement","canvasElement","resizeCanvas","addEventListener","removeEventListener","setupVideoPlaying","startTime","endTime","startProgressUpdating","playVideo","from","speed","pause","playbackRate","error","pauseVideo","motionTrails","required","Boolean","fps","Function","emits","setup","ctx","getContext","canvasModified","currentFrame","currentPose","frame","pose","prevTime","timerId","ignoreEnd","vidElement","time","clearInterval","setInterval","clearDrawing","drawCtx","clearRect","drawPose","videoHeight","videoWidth","retieveClearPoseFile","GetPose","drawMotionTrail","trail","resizeTimerId","getVideoDimensions","methods","keepPlaying","getVideoTime","DEFAULT_PAUSE_DURATION","computePlaySegments","pauses","segs","nextPauseIndex","prevIndex","pTime","pauseIndex","pi","segStartTime","components","VideoPlayer","lineCap","videoPlayer","playTimeoutId","vidPlayer","clearTimeout","playSegment","seg","delaySecs","emitResume","onPlayStart","playingSegments","playingSegmentIndex","playDelaySecs","nextSeg","manualResume","pauseDuration","$refs","allKeyframes","kfitem","kf","setKFSkeletonDrawStyle","showTimestamps","toFixed","timelineActiveItemsLimit","maxActiveTimelineSecs","minStackItems","keyframesTyped","currentKeyframe","find","futureKeyframes","timeRemaining","item","separatedKeyframes","separationIndex","findIndex","active","future","timelineTime","lastKfTime","nextKfTime","timeTONextKf","min","lastScrollingKf","activeKeyframes","left","opacity","stackTimeline","current","timeline","reverse","stack","muted","disablePictureInPicture","webcamStartError","enableRecordButton","maxHeight","connectVideoElement","disconnectVideoElement","webcamProvider","computed","webcamStarted","phrases","phrase","frames","constrain","remap","newMin","newMax","kfsByStage","fadeInDurationSecs","fadeOutDurationSecs","isActive","nextkf","getPhraseFlexGrow","phraseIndex","variableLength","nPhrase","phraseStartTime","nPhraseStartTime","getFrameFlexGrow","kfIndex","warn","curFrame","nextKf","getFrameBackground","curr","next","timeUntil","timePassed","fadePercent","brightness","saturation","ActivityPlayState","AwaitingStart","PendingStart","Playing","ActivityEnded","defaultPauseDuration","PausingVideoPlayer","InstructionCarousel","WebcamBox","KeyframeTimeline","SheetMotion","isPlaying","isPendingStart","webcamBox","instruction","reset","newTime","userVisual","mActivity","instructs","startInstruction","playingInstruction","endInstruction","activeTimedInstructions","ti","start","end","delay","vidActivity","practiceSpeed","segmentsData","enableAll","enabled","cssClass","calculateProgressSegments","lesson","last","segmentBreaks","segData","doesOverlap","focusedSegments","cssClassOptions","SegmentedProgressBar","ActivityVideoPlayer","margin","minIndex","maxActivityIndex","maxIndex","count","indices","concat","range","$props","activityIndex","hasPreviousActivity","playActivity","nextActivity","watch","newVal","allTags","motionsMap","motions","values","motionNames","clipName","lessonsByVideo","lessonsById","videoDatabase","clipPath","tags","customLessonCount","loadCustomLessons","lessonList","header","lessonIndex","_id","updatedLesson","MotionDatabase","updateLessonFormat","existingIndex","les","lessons","customLessonIds","getCustomLessonIdsList","countLoaded","custLesson","upsertLesson","has","setItem","stringify","custLessonIds","lessonTitle","saveCustomLessonsIdsList","removeLesson","lessonIdIndex","removeItem","createBlankActivity","duration","createBlankLesson","uuidv4","source","db","thumbnailRootDir","defaultWorkflows","workflows","customWorkflows","bakedInWorkflows","allWorkflows","activeFlow","loadWorkflows","created","addSessionWorkflow","customWorkflowIds","WorkflowManager","getCustomWorkflowIdsList","tryLoadCustomWorkflow","isCustomWorkflow","hasSavedCustomLesson","updatedWorkflow","updateToLatestWorkflowFormat","workflowRaw","custWorkflowIds","saveCustomWorkflowIdsList","workflowId","matchingWorkflow","flow","trackingFlow","stages","steps","shuffleInfo","shuffle","shuffleArray","startIndex","endIndex","stageIndex","stepIndex","stepAny","newStep","newStepAny","videoLessonReference","miniLessonReference","videoLessonEmbedded","miniLessonEmbedded","validateWorkflowStage","validateWorkflowStep","lessonId","validateLesson","workflowManager","toggleRecording","controls","recordedObjectUrl","isUploading","rerecord","uploadVideo","uploadError","successfullyUploaded","blobServiceClient","BlobServiceClient","blobName","client","getContainerClient","blockBlobClient","getBlockBlobClient","uploadData","lastRecordedBlob","URL","createObjectURL","participantIdWasSet","parsePath","urlParams","URLSearchParams","location","search","CreateBlankWorkflow","creationMethod","IsMiniLessonStep","GetWorkflowStepVideoClipName","GetVideoEntryForWorkflowStep","getDurationString","seconds","isNaN","secsRemainingConstrained","toISOString","substr","enableTiming","MiniLessonPlayer","FeedbackUploadScreen","uploadId","identifier","isExperimentMode","activeStage","experiment","showInExperimentOnly","isTestMode","isInActiveStage","isTimeExpiredTask","stageTimeExpired","isValidAfterExpiredTask","isValidUnexpired","isBeforeTime","isBeforeTimeStartTask","isExpired","maxStageTimeSecs","filteredStep","workflowStartTime","workflowStageStartTime","isTiming","stageTimer","workflowSecondsRemaining","experimentMaxTimeSecs","isInCurrentStage","continueWorkflowStep","completeStep","reduce","wasTrue","thisStep","aria-hidden","activeWorkflow","goBack","workflowInDatabase","deleteWorkflow","exportWorkflow","isDirty","saveWorkflow","selectedStageIndex","selectStage","duplicateStage","addStage","canReorderStage","reorderStage","selectedStepIndex","selectStep","activeStep","duplicateStep","addStep","deleteStage","canReorderStep","reorderStep","isMoveStepDropdownActive","stageI","moveStep","isInstructionStep","isLessonEmbeddedStep","activeStepLesson","removeEmbeddedLesson","convertEmbeddedLessonToReference","editWorkflowStepLesson","newEmbeddedLessonClipName","availableClips","canCreateEmbeddedLesson","startCreateEmbeddedLesson","isLessonReferenceStep","availableReferenceLessons","canEditActiveStepLessonReference","createReferencedLesson","isVideoUploadStep","deleteStep","selectingWorkflowIndex","availableWorkflows","canEditWorkflow","startCreation","editLessonActive","embeddedLessonMotion","lessonToEdit","updateWorkflowStepLesson","saveToDatabase","showCloseButton","showExportButton","disableEditingExisting","LessonCreationState","SelectOpenLesson","lessonUnderConstruction","ModifyLesson","canDeleteLesson","deleteLesson","exportLesson","saveLesson","lessonInDatabase","activeLessonSelectionIndex","canEditActiveLesson","segBreak","setSegmentBreak","$event","canDeleteSegment","removeSegmentBreak","newSegmentVal","addSegmentBreak","selectActivity","duplicateActivity","addActivity","canReorderActivity","reorderActivity","activeActivityFocusedSegments","segInfo","checked","isFocused","setFocusedSegment","activeActivityKeyframes","keyframeSelectorToolActive","activePauseIndex","selectPause","addPause","sortPauses","activeTimedInstructionIndex","selectTimedInstruction","addTimedInstruction","sortTimedInstructions","canDeleteActivity","deleteActivity","activePause","activeTimedInstruction","deletePause","deleteTimedInstruction","paused","updateCurrentTime","addKeyframe","target","effectiveStartTime","deleteKeyframe","effectiveEndTime","updateIntervalId","prevKeyframe","nextKeyframe","modelCopy","nearestKf","sort","confirm","saveReference","newPauseTime","displayMode","segBreaks","segsSet","boolArray","activeLessonSelection","hasLesson","lessonStartTime","lessonEndTime","getLessons","acLes","mounted","passedInLesson","typedMotion","handler","miniLessonPlayer","deep","sortSegmentBreaks","segmentIndex","asTemplate","sourceLesson","existingLesson","targetIndex","newActivity","indexDelta","curActivity","swapActivity","swapIndex","indexToDelete","dupActivity","newPause","selectedPause","a","b","newIndex","pauseObj","newInstruction","timedInstructs","selectedTimedInstruc","timedInstruction","tiIndex","breakTime","newList","event","curIndex","saveCustomLesson","deleteCustomLesson","PromptDownloadFile","WorkflowMenu","CreateLessonScreen","newEmbeddedLessonMotion","setActiveFlow","completeActivitesPriorToStageAndStep","skipPrompt","reloadCustomWorkflow","deleteCustomWorkflow","upsertCustomWorkflow","existingWorkflow","increment","curStage","swapStage","curSelected","toSwap","curStep","swapStep","targetStageIndex","stepToMove","targetPhase","exportLessonData","enableDrawing","isActivelyTracking","drawHandShape","results","rightHandLandmarks","drawTrackingResults","detectedGesture","fadeTimeMs","trackingTimestamp","globalAlpha","mpResults","ges","newVals","isEnabled","holisticResults","DrawingSurface","trackingIntervalId","hasStartedTracking","hasResults","startTracking","whenReady","readyState","gestureIcon","OnboardingStage","done","skipOnboarding","showIcon","iconClass","gestureImgSrc","GestureIcons","forward","backward","trySelectNext","trySelectPrevious","tryPerformPlay","GestureIcon","output","advanceStage","TabList","tab","currentTab","setTab","toLocaleDateString","toLocaleTimeString","Tabs","Workflows","Videos","availableTags","activeTags","toggleTag","filteredMotionList","hovering","clicked","True","selectedMotion","uploadLessonUIActive","uploadWorkflowUIActive","Tools","onLessonSelected","onKeyframeSelectorToolSelected","uploadAccept","onFilesSelected","uploadLessons","savingText","successText","uploadWorkflows","autoplay","canCreateLesson","keyframeOptions","kfopt","option","enctype","novalidate","isInitial","isSaving","isFailed","uploadFieldName","accept","uploadInstructions","isSuccess","Status","Initial","Saving","Success","Failed","currentStatus","fileList","TabSet","LessonCard","UploadCard","motionList","tagMatchingMotions","allTagsMatch","someTagMatches","currTag","thisTagMatches","files","validateWorkflow","hasBakedInWorkflow","hasWorkflow","dropdownOpen","loadMotion","activeVideoEntry","changeTime","entry","valueAsNumber","CameraSurface","OnboardingUI","WebcamPromptCard","PoseDrawerTest","CreateWorkflowScreen","cameraSurface","hasCompletedOnboarding","kfs","camSurface","alert","dance","ready","registered","updatefound","updated","offline","minDetectionVisibility","getAngle","lm0","atan2","dist","sqrt","getSum","input","midPoint","averageAngle","angles","arr","pop","sin","cos","isLine","angleTolerance","tolerance","PI","lastAngle","thisAngle","abs","detectHandPointingGestures","handLandmarks","FINGERS","FINGER_LANDMARKS","areLines","finger","avgAngle","avgAngleDeg","detectPosePointingGestures","TOLERANCE","TOLERANCE_RADS","lelb","lwrist","ang","right","relb","rwrist","isNamasteGesture","IDs","poseLMs","areArmLandmarksVisible","downwards","leftForearmTargetAngle","rightForearmTargetAngle","elbowAngleTolerance","leftForearmAngle","rightForearmAngle","handNeckMinRelativeDist","shoulderDist","neckCenter","leftWristNeckDist","rightWristNeckDist","areHandsNearNeckBase","detectGesture","leftHandLandmarks","startGestureDetection","app","App","mount"],"mappings":"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","file":"js/app.f77e6844.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([1,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var map = {\n\t\"./backward.svg\": \"6218\",\n\t\"./forward.svg\": \"3b9e\",\n\t\"./play.svg\": \"5cd5\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"1942\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./ActivityVideoPlayer.vue?vue&type=style&index=0&id=893e10ae&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./InstructionCarousel.vue?vue&type=style&index=0&id=c910331e&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./MiniLessonPlayer.vue?vue&type=style&index=0&id=72ec3fff&lang=scss\"","module.exports = __webpack_public_path__ + \"img/forward.e257a03f.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./MainMenu.vue?vue&type=style&index=0&id=1d2c3212&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./WebcamPromptCard.vue?vue&type=style&index=0&id=07a96404&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./KeyframeSelectorTool.vue?vue&type=style&index=0&id=51d13512&lang=sass\"","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&id=5caf3638&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./LessonCard.vue?vue&type=style&index=0&id=03645483&lang=scss\"","module.exports = __webpack_public_path__ + \"img/play.8c9e21c7.svg\";","module.exports = __webpack_public_path__ + \"img/backward.434f566c.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CreateLessonScreen.vue?vue&type=style&index=0&id=f2bdc050&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./UploadCard.vue?vue&type=style&index=0&id=4565a82c&lang=scss\"","module.exports = __webpack_public_path__ + \"img/tiktokdances.589b3b61.jpg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./LayoutTest.vue?vue&type=style&index=0&id=09cd6f46&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./VideoPlayer.vue?vue&type=style&index=0&id=149685e0&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./FeedbackUploadScreen.vue?vue&type=style&index=0&id=663b38c1&lang=scss\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CameraSurface.vue?vue&type=style&index=0&id=72ad0b54&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./PoseDrawerTest.vue?vue&type=style&index=0&id=2804ff56&lang=css\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./WebcamBox.vue?vue&type=style&index=0&id=3220b28b&lang=scss\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./DrawingSurface.vue?vue&type=style&index=0&id=002e5f90&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./SegmentedProgressBar.vue?vue&type=style&index=0&id=49396e06&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./SheetMotion.vue?vue&type=style&index=0&id=bcae77ce&lang=scss\"","<template>\n<div class=\"app\">\n\n  <div id=\"testData\" v-show=\"isTest\" class=\"tags p-2 mb-0 has-background-dark has-text-grey-lighter\">\n    <span class=\"tag\">ParticipantId: {{participantId ?? 'null'}}</span>\n  </div>\n\n  <LayoutTest v-if=\"state === State.LayoutTest\" />\n\n  <MainMenu\n        v-show=\"state === State.MainMenu\"\n        @pose-drawer-selected=\"poseDrawerSelected\"\n        @lesson-selected=\"lessonSelected\"\n        @create-lesson-selected=\"createLessonSelected\"\n        @workflow-selected=\"startWorkflow\"\n        @create-workflow-selected=\"state = State.CreateWorkflow\"\n        @keyframeselectortool-selected=\"startKeyframeSelection\"\n      />\n\n  <CreateLessonScreen\n        v-if=\"state === State.CreateLesson\"\n          :motion=\"currentVideo\"\n          @back-selected=\"goHome\"\n          @lesson-created=\"goHome\" />\n\n  <CreateWorkflowScreen\n    v-if=\"state === State.CreateWorkflow\"\n    @back-selected=\"goHome\"\n    @workflow-created=\"goHome\"\n    />\n\n  <WorkflowMenu\n        v-if=\"state === State.WorkflowActive\"\n        @back-selected=\"goHome\"\n        :showBackButton=\"!startedWithWorkflow\"/>\n\n  <PoseDrawerTest\n        v-if=\"state === State.PoseDrawingTester\"\n        @back-selected=\"goHome\" />\n\n  <KeyframeSelectorTool\n        v-if=\"state === State.KeyframeSelectorTool\"\n        @back-selected=\"goHome\"\n        v-model:modelValue=\"keyframes\"\n        :videoEntry=\"currentVideo\"/>\n\n  <div v-bind:class=\"{ 'is-active': state == State.LessonActive }\" class=\"modal\">\n    <div class=\"modal-background\"></div>\n    <div class=\"container\" style=\"max-height=100vh; max-width=100vw;\">\n      <div class=\"vcenter-parent\">\n        <div class=\"box\" >\n          <MiniLessonPlayer\n            v-if=\"state == State.LessonActive\"\n            :videoEntry=\"currentVideo\"\n            :miniLesson=\"currentLesson\"\n            @lesson-completed=\"goHome\"\n            :maxVideoHeight=\"'calc(100vh - 152px - 3.75rem)'\"\n            :enableCompleteLesson=\"true\"/>\n        </div>\n      </div>\n    </div>\n    <button class=\"modal-close is-large\" aria-label=\"close\" @click=\"goHome\"></button>\n  </div>\n\n  <CameraSurface\n    ref=\"cameraSurface\"\n    @tracking-attained=\"onTrackingAttained()\"\n    v-show=\"showCameraSurface\">\n\n    <template v-slot:background>\n      <img v-show=\"state == State.OnboardingLoading\"\n      src=\"./assets/tiktokdances.jpg\"\n      alt=\"Background Image\">\n    </template>\n\n    <template v-slot:ui>\n\n      <!-- <LearningScreen v-if=\"state == State.LessonActive\"\n        :target-dance=\"currentVideo\"\n        :target-lesson=\"currentLesson\"\n        @lesson-completed=\"goHome\"\n        @back-selected=\"goHome\"\n        style=\"width: 1280px\"\n        height=\"auto\"\n      /> -->\n\n     <WebcamPromptCard v-if=\"state === State.PromptStartWebcam\"\n      @cancel-selected=\"state = State.MainMenu\"\n      @startWebcamSelected=\"startWebcam\"\n     />\n\n      <div class=\"vcenter-parent\" v-if=\"state === State.StartingWebcam\">\n        <div class=\"translucent-text is-rounded has-text-centered\">\n          <div class=\"content\">\n            <h3 class=\"has-text-white m-2\">Starting Webcam...</h3>\n          </div>\n          <div class=\"loader-progress loader is-loading mt-5 mb-5\"></div>\n        </div>\n      </div>\n\n      <div class=\"vcenter-parent\" v-if=\"state === State.LoadingTracking\">\n        <div class=\"translucent-text is-rounded has-text-centered\">\n          <div class=\"content has-text-white m-2 has-text-centered\">\n            <h3 class=\"has-text-white\">Starting Gestures...</h3>\n          </div>\n          <div class=\"loader-progress loader is-loading mt-5 mb-5\"></div>\n        </div>\n      </div>\n\n      <OnboardingUI v-if=\"state == State.Onboarding\"\n        @onboarding-complete=\"state= State.LessonActive \"/>\n    </template>\n\n  </CameraSurface>\n</div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed, defineComponent, nextTick, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { DatabaseEntry } from '@/services/MotionDatabase';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport CreateWorkflowScreen from '@/components/screens/CreateWorkflowScreen.vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport LayoutTest from '@/components/elements/LayoutTest.vue';\nimport KeyframeSelectorTool from '@/components/tools/KeyframeSelectorTool.vue';\nimport CameraSurface from './components/CameraSurface.vue';\nimport OnboardingUI from './components/OnboardingUI.vue';\nimport MainMenu from './components/screens/MainMenu.vue';\n// import LearningScreen from './components/screens/LearningScreen.vue';\nimport MiniLesson from './model/MiniLesson';\nimport WebcamPromptCard from './components/elements/WebcamPromptCard.vue';\n\nimport PoseDrawerTest from './components/screens/PoseDrawerTest.vue';\nimport CreateLessonScreen from './components/screens/CreateLessonScreen.vue';\nimport workflowManager from './services/WorkflowManager';\nimport optionsManager from './services/OptionsManager';\n\nconst State = {\n  LayoutTest: 'LayoutTest',\n  MainMenu: 'MainMenu',\n  PromptStartWebcam: 'PromptStartWebcam',\n  StartingWebcam: 'StartingWebcam',\n  LoadingTracking: 'LoadingTracking',\n  Onboarding: 'Onboarding',\n  LessonActive: 'LessonActive',\n  WorkflowActive: 'WorkflowActive',\n  PoseDrawingTester: 'PoseDrawingTester',\n  CreateLesson: 'CreateLesson',\n  CreateWorkflow: 'CreateWorkflow',\n  KeyframeSelectorTool: 'KeyframeSelectorTool',\n};\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    CameraSurface,\n    OnboardingUI,\n    MainMenu,\n    LayoutTest,\n    WorkflowMenu,\n    // LearningScreen,\n    KeyframeSelectorTool,\n    WebcamPromptCard,\n    PoseDrawerTest,\n    CreateLessonScreen,\n    CreateWorkflowScreen,\n    MiniLessonPlayer,\n  },\n  setup() {\n    const state = ref(State.MainMenu);\n    const cameraSurface = ref(null as typeof CameraSurface | null);\n    const hasCompletedOnboarding = ref(false);\n\n    const currentVideo = ref(null as DatabaseEntry | null);\n    const currentLesson = ref(null as MiniLesson | null);\n    const keyframes = ref([] as number[]);\n\n    const showCameraSurface = computed(() => [\n      State.PromptStartWebcam,\n      State.StartingWebcam,\n      State.LoadingTracking,\n      State.Onboarding,\n      // State.LessonActive,\n    ].indexOf(state.value) !== -1);\n\n    function lessonSelected(videoEntry: DatabaseEntry, lesson: MiniLesson) {\n      currentVideo.value = videoEntry;\n      currentLesson.value = lesson;\n\n      state.value = State.LessonActive;\n      // if (webcamProvider.webcamStatus.value === 'running') state.value = State.LessonActive;\n      // else state.value = State.PromptStartWebcam;\n    }\n\n    function startKeyframeSelection(videoEntry: DatabaseEntry, kfs: number[]) {\n      console.log('startKeyframeSelection', videoEntry, kfs);\n      keyframes.value = kfs;\n      currentVideo.value = videoEntry;\n      state.value = State.KeyframeSelectorTool;\n    }\n\n    function goHome() {\n      state.value = State.MainMenu;\n      currentVideo.value = null;\n      currentLesson.value = null;\n    }\n\n    async function startTracking() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      nextTick(() => {\n        const camSurface: any = cameraSurface.value;\n        state.value = State.LoadingTracking;\n        camSurface.startTracking();\n      });\n    }\n\n    async function startWebcam() {\n      console.log('Starting Webcam');\n\n      if (webcamProvider.webcamStatus.value !== 'running') {\n        state.value = State.StartingWebcam;\n\n        try {\n          await webcamProvider.startWebcam();\n        } catch (e) {\n          console.error('Error starting webcam: ', e);\n          // eslint-disable-next-line no-alert\n          alert('Failed to start the webcam\\n\\nPlease ensure this is the only app using the camera and that you\\'ve allowed camera access in your browser.');\n          state.value = State.MainMenu;\n          return;\n        }\n      }\n\n      state.value = State.LoadingTracking;\n      try {\n        await startTracking();\n      } catch (e) {\n        console.error(\"Couldn't start tracking\", e);\n      }\n    }\n\n    function onTrackingAttained() {\n      console.log('Tracking attained');\n      if (hasCompletedOnboarding.value) {\n        state.value = State.LessonActive;\n      } else state.value = State.Onboarding;\n    }\n\n    return {\n      showCameraSurface,\n      currentVideo,\n      currentLesson,\n      lessonSelected,\n      goHome,\n      startWebcam,\n      onTrackingAttained,\n      startKeyframeSelection,\n      keyframes,\n      state,\n      cameraSurface,\n      State,\n      startedWithWorkflow: ref(false),\n      isTest: optionsManager.isTest,\n      participantId: optionsManager.participantId,\n    };\n  },\n  mounted() {\n    // If app was launched with a workflowId, skip straight\n    // to that workflow\n    if (optionsManager.workflowId.value) {\n      if (this.startWorkflow(optionsManager.workflowId.value)) {\n        this.startedWithWorkflow = true;\n      }\n    }\n  },\n  methods: {\n    poseDrawerSelected() {\n      this.state = State.PoseDrawingTester;\n    },\n    createLessonSelected(dance: DatabaseEntry) {\n      this.currentVideo = dance;\n      this.state = State.CreateLesson;\n    },\n    startWorkflow(workflowId: string) {\n      console.log('Starting workflow', workflowId);\n      if (workflowManager.setActiveFlow(workflowId)) {\n        this.state = State.WorkflowActive;\n        return true;\n      }\n      return false;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\nbody, html {\n  margin: 0;\n  padding: 0;\n  width: 100%;\n  background-color: #00d1b2;\n  // background-image: linear-gradient(45deg, #00d1b2 0%, #3475da 100%);\n\n  // background-color: #FF9A8B;\n  // background-image: linear-gradient(135deg, #B721FF 0%, #145eb3 100%);\n\n  background-image: linear-gradient(120deg, #daece1 0%, #d1d1d1 100%);\n\n  background-size: 100vw 100vh;\n  background-attachment: fixed;\n}\n\n.loader-progress {\n  width: 100px;\n  height: 100px;\n  margin: auto;\n}\n\n#aboveSurface {\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n\n  span {\n    flex: 0 0 auto;\n  }\n  .spacer {\n    flex: 1 1 0;\n  }\n\n  width: 1280px;\n  margin: auto;\n}\n\n#belowSurface {\n  width: 1280px;\n  margin: auto;\n}\n\n#topbarLeft, #topbarRight, #topbarCenter {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n.background-blur {\n  backdrop-filter: blur(4px);\n  background: rgba(0, 0, 0, 0.75);\n}\n\n.translucent-text {\n  backdrop-filter: blur(4px);\n  color: white;\n  padding: 10px 20px;\n  background: rgba(0, 0, 0, 0.55);\n}\n\n.translucent-text.is-rounded {\n  border-radius: 0.25rem;\n}\n\n.is-slightly-rounded {\n  border-radius: 0.25rem;\n}\n\n</style>\n","import RecordRTC, { invokeSaveAsDialog } from 'recordrtc';\n\nimport { computed, ref, Ref } from 'vue';\n\nexport const WEBCAM_DIMENSIONS = Object.freeze({\n  width: 640,\n  height: 480,\n});\n\nexport class WebcamProvider {\n\n  // Recorder class\n  private recorder = ref(null as null | RecordRTC);\n\n  // The actual media stream\n  private mediaStream = ref(null as null | MediaStream);\n\n  // List of active connections. Used so we know when to pause the webcam\n  private activeConnections: Set<HTMLVideoElement> = new Set();\n\n  private permissionState: Ref<PermissionState> = ref('prompt');\n\n  private isWebcamLoading = ref(false);\n\n  public webcamError = ref(null as any);\n\n  public isRecording = ref(false);\n\n  constructor() {\n    this.readPermissionStatus();\n  }\n\n  private async readPermissionStatus(): Promise<void> {\n    if (navigator.permissions) {\n      try {\n        const result = await navigator.permissions.query({ name: 'camera' });\n        this.permissionState.value = result.state;\n\n        // eslint-disable-next-line no-empty\n      } catch { }\n    }\n  }\n\n  public permissionStatus(): Ref<PermissionState> {\n    return this.permissionState;\n  }\n\n  public async startWebcam(): Promise<void> {\n    if (this.mediaStream.value || this.isWebcamLoading.value) {\n      return;\n    }\n    this.isWebcamLoading.value = true;\n\n    try {\n      const constraints: MediaStreamConstraints = {\n        video: {\n          // facingMode: 'user',\n          width: WEBCAM_DIMENSIONS.width,\n          height: WEBCAM_DIMENSIONS.height,\n          aspectRatio: 1.777777778,\n          frameRate: 30,\n        },\n        audio: true,\n      };\n\n      if (!navigator.mediaDevices?.getUserMedia) throw new Error(\"Browser doesn't support webcam\");\n\n      this.mediaStream.value = await navigator.mediaDevices.getUserMedia(constraints);\n\n      this.permissionState.value = 'granted';\n    } finally {\n      this.isWebcamLoading.value = false;\n    }\n  }\n\n  public webcamStatus = computed(() => {\n    if (this.mediaStream.value) return 'running';\n    if (this.isWebcamLoading.value) return 'loading';\n    return 'stopped';\n  });\n\n  public async connectVideoElement(videoE: HTMLVideoElement): Promise<void> {\n\n    if (this.permissionState.value !== 'granted') throw new Error(\"Doesn't have permissions yet!\");\n\n    this.activeConnections.add(videoE);\n\n    // eslint-disable-next-line no-param-reassign\n    console.log('Connecting media stream to video');\n    videoE.srcObject = this.mediaStream.value;\n    videoE.onloadedmetadata = () => {\n      videoE.play();\n      console.log('Connected media stream to video');\n    };\n  }\n\n  public disconnectVideoElement(videoE: HTMLVideoElement): void {\n    this.activeConnections.delete(videoE);\n\n    videoE.srcObject = null;\n\n    if (this.activeConnections.size === 0 && !this.recorder) {\n      this.stopWebcam();\n    }\n  }\n\n  public async stopWebcam(): Promise<void> {\n    if (this.recorder) {\n      try {\n        await this.stopRecording();\n        // eslint-disable-next-line no-empty\n      } catch { }\n    }\n\n    if (this.mediaStream.value) {\n      this.mediaStream.value.getTracks().forEach((x) => x.stop());\n    }\n    this.mediaStream.value = null;\n  }\n\n  public async startRecording(): Promise<void> {\n    if (this.recorder.value || this.isRecording.value) {\n      return;\n    }\n\n    if (!this.mediaStream.value) {\n      throw new Error('Webcam must be started before recording can happen');\n    }\n\n    this.isRecording.value = true;\n\n    const rtc = new RecordRTC(this.mediaStream.value, {\n      type: 'video',\n    });\n    rtc.startRecording();\n    this.recorder.value = rtc;\n  }\n\n  public async stopRecording(): Promise<Blob> {\n\n    return new Promise((res) => {\n      if (!this.recorder.value) throw new Error(\"Haven't started recording\");\n      this.isRecording.value = false;\n      const recorder = this.recorder.value;\n      this.recorder.value.stopRecording(() => {\n        res(recorder.getBlob());\n        this.recorder.value = null;\n      });\n    });\n  }\n\n  public async clearRecording(): Promise<void> {\n    // TODO: pay attention to status of recording\n    // this.recorder?.stopRecording();\n    this.recorder.value = null;\n  }\n\n  // public async postFiles(url: string, filename: string): Promise<void> {\n  //   if (!this.recorder) throw new Error('Nothing to post');\n\n  //   const blob = this.recorder.getBlob();\n  //   invokeSaveAsDialog(blob, filename);\n\n  //   const fname = `${filename}.webm`;\n\n  //   const file = new File([blob], fname, {\n  //     type: 'video/webm',\n  //   });\n\n  // videoElement.src = '';\n  // videoElement.srcObject = null;\n\n  // if (mediaStream) { mediaStream.stop(); }\n  // }\n}\n\nexport const saveBlob = invokeSaveAsDialog;\n\nconst defaultProvider = new WebcamProvider();\n\nexport default defaultProvider;\n","<template>\n\n  <teleport to=\"#testData\" v-if=\"optionsManager.isTest\">\n    <span class=\"tag\">Workflow Id: {{workflow?.id ?? 'null'}}</span>\n    <span class=\"tag\">Experiment Mode: <input type=\"checkbox\" v-model=\"enableExperimentMode\"></span>\n\n    <span class=\"tag\">\n      Workflow: {{Math.round(workflowSecsElapsed)}}s elapsed, {{workflowSecondsRemainingString}} remaining\n    </span>\n    <span class=\"tag\">\n      Stage: {{Math.round(stageSecsElapsed)}}s, {{stageSecondsRemainingString}} remaining\n    </span>\n  </teleport>\n\n  <section class=\"section workflow-menu\">\n\n    <div class=\"hero is-primary block\" v-if=\"showHeader\">\n      <div class=\"hero-body\">\n        <div class=\"container\">\n          <p class=\"title\">\n            {{workflow?.title}}\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"container block\" v-if=\"showBackButton\">\n      <button class=\"button\" @click=\"$emit('back-selected')\">&lt; Back</button>\n    </div>\n\n    <div class=\"block\" v-for=\"(stage, i) in filteredStages\" :key=\"i\">\n\n      <p class=\"subtitle has-text-centered\">\n        <span class=\"icon-text\">\n          <span v-text=\"stage.title\"></span>\n          <span class=\"icon\" v-if=\"isStageCompleted(stage)\"><i class=\"fa fa-check\"></i></span>\n        </span>\n      </p>\n\n      <div class=\"grid-menu container block\">\n        <div\n          class=\"box m-4 is-clickable hover-expand has-border-info vcenter-parent\"\n          v-if=\"activeStageIndex === i-1 && isStageCompleted(filteredStages[i-1])\"\n          @click=\"startStage(i)\"\n        >\n          <div>\n            <span class=\"icon-text\">\n              <span>Click to Begin </span>\n              <span class=\"icon\">\n                <i class=\"far fa-arrow-alt-circle-right\"></i>\n              </span>\n            </span>\n          </div>\n          <div class=\"is-size-7\" v-if=\"stage.timeLimitString\">\n            <span >Time limit: {{stage.timeLimitString}}</span>\n            <!-- <span v-else>No time limit</span> -->\n          </div>\n        </div>\n        <div\n          class=\"m-4 p-4\"\n          v-if=\"(activeStageIndex === i && stageSecondsRemaining !== Infinity) ||\n                (!(activeStageIndex === i-1 && isStageCompleted(filteredStages[i-1])) && stage.timeLimitString)\">\n            <span v-if=\"activeStageIndex === i\">\n              <span v-if=\"stageSecondsRemaining !== Infinity\">{{stageSecondsRemainingString}}<br />remaining</span>\n              <!-- <span v-else>No time limit</span> -->\n            </span>\n            <span v-else>\n              <span v-if=\"stage.timeLimitString\">Time limit:<br />{{stage.timeLimitString}}</span>\n              <!-- <span v-else>No time limit</span> -->\n            </span>\n        </div>\n\n        <div class=\"box m-4\"\n            :class=\"{\n                  'is-clickable': stepInfo.isClickable,\n                  'hover-expand': stepInfo.isClickable,\n                  'has-text-grey': !stepInfo.isClickable,\n                  'has-background-grey-lighter': !stepInfo.isClickable,\n                  'has-background-white-ter': stepInfo.isClickable && stepInfo.step !== nextStepInStage,\n                  'has-border-success': stepInfo.step.status === 'completed',\n                  'has-border-info': stepInfo.step === nextStepInStage,\n                  'has-border-grey': stepInfo.isClickable && stepInfo.step !== nextStepInStage && stepInfo.step.status !== 'completed'\n                }\"\n            @click=\"stepInfo.isClickable && startWorkflowStep(stepInfo.step)\"\n            v-for=\"(stepInfo, j) in stage.filteredSteps\" :key=\"j\">\n          <article\n            class=\"level\"\n          >\n            <div class=\"level-left\">\n              <div class=\"level-item\">\n                <p class=\"image is-48x48\" v-if=\"stepInfo.dbEntry?.thumbnailSrc\">\n                  <img class=\"is-100percent is-contain\" :src=\"stepInfo.dbEntry?.thumbnailSrc\" :alt=\"stepInfo.step.title\">\n                </p>\n                <p class=\"icon is-large\" v-else>\n                  <i class=\"fas fa-2x fa-align-center\" v-if=\"stepInfo.step.type === 'InstructionOnly'\"></i>\n                  <i class=\"fas fa-2x fa-images\" v-if=\"stepInfo.step.type === 'MiniLessonEmbedded' || stepInfo.step.type === 'MiniLessonnReference'\"></i>\n                  <i class=\"fas fa-2x fa-camera\" v-if=\"stepInfo.step.type === 'UploadTask'\"></i>\n                </p>\n              </div>\n              <div class=\"level-item\">\n                <div>\n                  <p v-text=\"stepInfo.step.title\"></p>\n                  <p v-if=\"stepInfo.waitingForTimeExpiration\" class=\"is-size-7\">&nbsp;in {{stageSecondsRemainingString}}</p>\n                  <p v-if=\"stepInfo.isClickable\" class=\"is-size-7\">\n                    <span v-if=\"stepInfo.isComplete\">Click to repeat</span>\n                    <span v-if=\"stepInfo.step === nextStepInStage\">Up Next</span>\n                  </p>\n                </div>\n              </div>\n            </div>\n            <div class=\"level-right\">\n              <div class=\"level-item\">\n                <span class=\"icon is-large\">\n                  <i class=\"far fa-check-circle has-text-success\" v-if=\"stepInfo.step.status==='completed'\"></i>\n                  <i class=\"far fa-play-circle\" v-if=\"stepInfo.step===nextStepInStage\"></i>\n                  <i class=\"far fa-circle\" v-if=\"stepInfo.step !== nextStepInStage && stepInfo.step.status==='notstarted'\"></i>\n                </span>\n              </div>\n            </div>\n          </article>\n        </div>\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': instructionsActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <div class=\"box content\">\n          <h3>{{currentStep?.instructions?.heading}}</h3>\n          <p style=\"white-space: pre-wrap;\">{{currentStep?.instructions?.text}}</p>\n          <div class=\"buttons is-right\">\n            <button class=\"button is-primary\" @click=\"instructionsFinished\">OK</button>\n          </div>\n        </div>\n      </div>\n      <button class=\"modal-close\" @click=\"instructionsActive = false\" aria-label=\"close\"></button>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': lessonActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"container\" style=\"max-width: 100vw; max-height: 100vh;\">\n        <div class=\"box\" style=\"height:min(90vh);max-width:calc(100vw-2rem);margin-top:calc((10vh) / 2)\" >\n          <MiniLessonPlayer\n            v-if=\"lessonActive\"\n            :videoEntry=\"currentVideoEntry\"\n            :miniLesson=\"currentLesson\"\n            @lesson-completed=\"lessonCompleted\"\n            :maxVideoHeight=\"'calc(100vh - 152px - 3.75rem)'\"\n            :enableCompleteLesson=\"true\"/>\n        </div>\n      </div>\n      <button class=\"modal-close is-large\" aria-label=\"close\" @click=\"lessonActive=false\"></button>\n    </div>\n\n    <div :class=\"{'is-active': uploadActive}\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <div class=\"container\">\n          <div class=\"box\">\n            <FeedbackUploadScreen\n              :prompt=\"currentStep?.upload?.prompt\"\n              :title=\"workflow?.title\"\n              :subtitle=\"currentStep?.title\"\n              :uploadFilename=\"uploadFilename\"\n              @upload-canceled=\"uploadActive = false\"\n              @upload-completed=\"uploadComplete\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div :class=\"{'is-active': timingNotStarted}\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <div class=\"container\">\n          <div class=\"box\">\n            <div class=\"content\">\n              <h3>Start Timing</h3>\n              <button class=\"button\" @click=\"startTiming\">Start</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed, defineComponent, nextTick, onBeforeUnmount, onMounted, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport workflowManager, { TrackingWorkflow, TrackingWorkflowStage, TrackingWorkflowStep } from '@/services/WorkflowManager';\nimport FeedbackUploadScreen from '@/components/screens/FeedbackUploadScreen.vue';\nimport optionsManager from '@/services/OptionsManager';\nimport {\n  GetVideoEntryForWorkflowStep, IsMiniLessonStep, Workflow, WorkflowStage,\n} from '@/model/Workflow';\n\nfunction getDurationString(seconds: number) {\n  if (seconds === Infinity) return 'Untimed';\n  if (Number.isNaN(seconds)) return 'Unknown';\n\n  const secsRemainingConstrained = Math.max(0, seconds);\n\n  if (secsRemainingConstrained < 3600) {\n    return new Date(secsRemainingConstrained * 1000).toISOString().substr(14, 5);\n  }\n  return new Date(secsRemainingConstrained * 1000).toISOString().substr(11, 8);\n}\n\nexport default defineComponent({\n  name: 'WorkflowMenu',\n  props: {\n    showHeader: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    enableTiming: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\n    'back-selected',\n  ],\n  components: {\n    MiniLessonPlayer,\n    FeedbackUploadScreen,\n  },\n  computed: {\n    stages() { return ((this as any).workflow?.stages ?? []) as TrackingWorkflowStage[]; },\n    currentVideoEntry(): DatabaseEntry | null {\n      if (this.currentStep?.type === 'MiniLessonReference' && this.currentStep?.miniLessonReference) {\n        return db.motionsMap.get(this.currentStep.miniLessonReference.clipName) ?? null;\n      }\n      if (this.currentStep?.type === 'MiniLessonEmbedded' && this.currentStep?.miniLessonEmbedded?.header.clipName) {\n        return db.motionsMap.get(this.currentStep.miniLessonEmbedded.header.clipName) ?? null;\n      }\n      return null;\n    },\n    currentLesson(): MiniLesson | null {\n      if (this.currentStep?.type === 'MiniLessonReference' && this.currentStep?.miniLessonReference) {\n        return db.lessonsById.get(this.currentStep.miniLessonReference.lessonId) ?? null;\n      }\n      if (this.currentStep?.type === 'MiniLessonEmbedded' && this.currentStep?.miniLessonEmbedded) {\n        return this.currentStep.miniLessonEmbedded;\n      }\n      return null;\n    },\n    uploadFilename(): string {\n      const uploadId = this.currentStep?.upload?.identifier ?? 'NoIdentifier';\n      const participantId = optionsManager.participantId.value ?? 'Anonomous';\n      const workflowId = this.workflow?.id ?? 'NullWorkflow';\n\n      return `${workflowId}-${participantId}-${uploadId}`;\n    },\n    filteredStages() {\n      const workflow = (this as any).workflow as TrackingWorkflow;\n      const stages = workflow?.stages ?? [];\n      const isExperimentMode = (this as any).enableExperimentMode as boolean;\n      const activeStage = (this as any).activeStage as WorkflowStage;\n      const stageSecondsRemaining = (this as any).stageSecondsRemaining as number;\n\n      return stages.map((stage, stageIndex) => {\n        const filteredSteps = stage.steps\n          .filter((step) => isExperimentMode || !(step.experiment?.showInExperimentOnly ?? false))\n          .map((step, stepIndex) => {\n\n            const isTestMode = !isExperimentMode;\n            const isInActiveStage = activeStage === stage;\n            const isTimeExpiredTask = step.experiment?.isTimeExpiredTask ?? false;\n            const stageTimeExpired = stageSecondsRemaining <= 0;\n            const isValidAfterExpiredTask = isInActiveStage && isTimeExpiredTask && stageTimeExpired;\n            const isValidUnexpired = !isInActiveStage || (!isTimeExpiredTask && !stageTimeExpired);\n            // const isNewlyOnThisStage = this.activeStageIndex === stageIndex-1 && this.isStageCompleted(filteredStages[i-1])\n            const isBeforeTime = (step.experiment?.isBeforeTimeStartTask ?? false);\n\n            return {\n              step,\n              isComplete: step.status === 'completed',\n              dbEntry: GetVideoEntryForWorkflowStep(db, step),\n              isExpired: !isTimeExpiredTask && stageTimeExpired,\n              isClickable: (isTestMode || isInActiveStage || isBeforeTime)\n                          && (isValidUnexpired || isValidAfterExpiredTask),\n              isValidAfterExpiredTask,\n              waitingForTimeExpiration: isInActiveStage && isTimeExpiredTask && !stageTimeExpired,\n              stageIndex,\n              stepIndex,\n            };\n          });\n        return {\n          ...stage,\n          filteredSteps,\n          timeLimitString: stage.maxStageTimeSecs ? getDurationString(stage.maxStageTimeSecs) : null,\n        };\n      });\n    },\n    nextStepInStage() {\n      // for (let i = 0; i < this.stages.length; i += 1) {\n      if (!this.filteredStages) return null;\n\n      const stage = (this as any).filteredStages[(this as any).activeStageIndex];\n      if (!stage) return null;\n\n      for (let j = 0; j < stage.filteredSteps.length; j += 1) {\n        const filteredStep = stage.filteredSteps[j];\n        if (filteredStep.step.status !== 'completed' && filteredStep.isClickable) return filteredStep.step as TrackingWorkflowStep;\n      }\n      // }\n      return null;\n    },\n  },\n  setup(props, ctx) {\n\n    const currentStep = ref(null as null | TrackingWorkflowStep);\n    const instructionsActive = ref(false);\n    const lessonActive = ref(false);\n    const uploadActive = ref(false);\n    const workflow = workflowManager.activeFlow;\n\n    const workflowStartTime = ref(new Date());\n    const workflowStageStartTime = ref(new Date());\n    const enableExperimentMode = ref(!optionsManager.isTest.value);\n    const isTiming = ref(!optionsManager.isTest.value);\n    const timingNotStarted = computed(() => isTiming.value && !workflowStartTime.value);\n\n    const activeStageIndex = ref(-1);\n    const activeStage = computed(() => workflow.value?.stages[activeStageIndex.value] ?? null);\n    onMounted(() => {\n      workflowStartTime.value = new Date();\n      workflowStageStartTime.value = new Date();\n    });\n    let stageTimer = -1;\n    const workflowSecsElapsed = ref(Infinity);\n    const workflowSecondsRemaining = computed(() => {\n      if (!workflow.value?.experimentMaxTimeSecs) return Infinity;\n      return workflow.value.experimentMaxTimeSecs - workflowSecsElapsed.value;\n    });\n    const workflowSecondsRemainingString = computed(() => getDurationString(workflowSecondsRemaining.value));\n    const stageSecsElapsed = ref(Infinity);\n    const stageSecondsRemaining = computed(() => {\n      if (!activeStage.value?.maxStageTimeSecs) return Infinity;\n      return activeStage.value.maxStageTimeSecs - stageSecsElapsed.value;\n    });\n    const stageSecondsRemainingString = computed(() => getDurationString(stageSecondsRemaining.value));\n    onMounted(() => {\n      stageTimer = window.setInterval(() => {\n\n        const now = Date.now();\n        workflowSecsElapsed.value = (now - workflowStartTime.value.getTime()) / 1000;\n        stageSecsElapsed.value = (now - workflowStageStartTime.value.getTime()) / 1000;\n\n      }, 1000);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(stageTimer);\n    });\n\n    watch(workflow, () => {\n      currentStep.value = null;\n    });\n    watchEffect(() => {\n      const isInCurrentStage = (activeStage.value?.steps ?? []).indexOf(currentStep.value as any) !== -1;\n      if (isInCurrentStage && stageSecondsRemaining.value <= 0 && !currentStep.value?.experiment?.isTimeExpiredTask) {\n        lessonActive.value = false;\n      }\n    });\n\n    return {\n      activeStage,\n      activeStageIndex,\n      currentStep,\n      instructionsActive,\n      lessonActive,\n      uploadActive,\n      workflow,\n      optionsManager,\n\n      workflowStartTime,\n      timingNotStarted,\n      isTiming,\n      workflowStageStartTime,\n      enableExperimentMode,\n      workflowSecsElapsed,\n      workflowSecondsRemaining,\n      workflowSecondsRemainingString,\n      stageSecsElapsed,\n      stageSecondsRemaining,\n      stageSecondsRemainingString,\n    };\n  },\n  methods: {\n    startTiming() {\n      this.workflowStartTime = new Date();\n    },\n    // getStepInfo(stage: TrackingWorkflowStage, stageIndex: number) {\n\n    //   return stage.steps\n    //     .filter((step) => this.enableExperimentMode || !(step.experiment?.showInExperimentOnly ?? false))\n    //     .map((step, stepIndex) => {\n\n    //       const isTestMode = !this.enableExperimentMode;\n    //       const isInActiveStage = this.activeStage === stage;\n    //       const isTimeExpiredTask = step.experiment?.isTimeExpiredTask ?? false;\n    //       const stageTimeExpired = this.stageSecondsRemaining <= 0;\n    //       const waitingForTimeExpiration = isTimeExpiredTask && !stageTimeExpired;\n\n    //       return {\n    //         step,\n    //         isComplete: step.status === 'completed',\n    //         isNextStep: step === this.nextStepInStage,\n    //         dbEntry: GetVideoEntryForWorkflowStep(db, step),\n    //         isClickable: (isTestMode || isInActiveStage)\n    //                     && (!isTimeExpiredTask || !stageTimeExpired)\n    //                     && !waitingForTimeExpiration,\n    //         waitingForTimeExpiration,\n    //         stageIndex,\n    //         stepIndex,\n    //       };\n    //     });\n    // },\n    instructionsFinished() {\n      this.instructionsActive = false;\n      const step = this.currentStep;\n      if (!step) return;\n      step.status = 'inprogress';\n      this.continueWorkflowStep(step);\n    },\n    startWorkflowStep(item: TrackingWorkflowStep) {\n      // if (!this.isClickable(item)) return;\n      this.currentStep = item;\n      if (item.type === 'InstructionOnly') {\n        this.instructionsActive = true;\n        return;\n      }\n      this.continueWorkflowStep(item);\n    },\n    continueWorkflowStep(item: TrackingWorkflowStep) {\n      if (item.type === 'InstructionOnly') {\n        // Instructions only - there's nothing else to do. Move to next activity!\n        this.completeStep(item);\n      } else if (item.type === 'MiniLessonReference' || item.type === 'MiniLessonEmbedded') {\n        this.lessonActive = true;\n      } else if (item.type === 'UploadTask') {\n        this.uploadActive = true;\n      } else {\n        console.error(`Item type ${item.type} not supported`);\n      }\n    },\n    lessonCompleted() {\n      this.lessonActive = false;\n      this.completeStep(this.currentStep);\n    },\n    uploadComplete() {\n      this.uploadActive = false;\n      this.completeStep(this.currentStep);\n    },\n    completeStep(step: TrackingWorkflowStep | null) {\n      if (!step) return;\n      step.status = 'completed';\n    },\n    isStageCompleted(stage: TrackingWorkflowStage) {\n      if (!stage) return true;\n\n      const steps = (stage as any).filteredSteps ?? [];\n      return steps.reduce((wasTrue: boolean, thisStep: any) => wasTrue && (thisStep.isComplete || thisStep.isExpired), true);\n    },\n    startStage(stageIndex: number) {\n      this.workflowStageStartTime = new Date();\n      nextTick(() => {\n        this.activeStageIndex = stageIndex;\n      });\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n</style>\n","<template>\n  <div class=\"mini-lesson-player\">\n    <div class=\"video-container\">\n      <ActivityVideoPlayer\n        ref=\"activityVideoPlayer\"\n        :motion=\"videoEntry\"\n        :activity=\"activeActivity\"\n        @progress=\"onProgress\"\n      />\n    </div>\n    <div class=\"is-flex-grow-0 is-flex-shrink-0\">\n      <div class=\"block\"></div>\n      <SegmentedProgressBar\n        class=\"block\"\n        :segments=\"progressSegments\"\n        :progress=\"activityProgress\"\n      />\n      <nav class=\"pagination is-centered\" v-if=\"miniLesson\">\n        <div class=\"pagination-list\" style=\"max-width:calc(100vw - 2.5rem);\">\n          <li  v-for=\"(i, index) in nearbyActivityIndices\" :key=\"index\">\n            <span class=\"pagination-ellipses\">\n              <button\n                class=\"button\"\n                :class=\"{'is-primary': activityVideoPlayer?.activityFinished && activeActivityIndex + 1 === i}\"\n                @click=\"gotoActivity(i)\"\n                v-if=\"i >= 0 && i !== activeActivityIndex\">\n                <span class=\"icon\" v-if=\"activityVideoPlayer?.activityFinished && activeActivityIndex + 1 === i\"><i class=\"fas fa-step-forward\"></i></span>\n                <span><strong>{{i+1}}</strong>&nbsp;|&nbsp;<span>{{activities[i]?.title}}</span></span>\n              </button>\n            </span>\n            <span class=\"pagination-ellipses\" v-if=\"i<0\">\n              &hellip;\n            </span>\n            <span class=\"pagination-ellipses buttons has-addons\" v-if=\"i===activeActivityIndex\">\n              <button\n                v-if=\"!needsStartWebcam && !activityVideoPlayer?.activityFinished\"\n                class=\"button\"\n                :class=\"{\n                  'is-primary': (activityVideoPlayer?.awaitingStart ?? false) || (activityVideoPlayer?.isPendingStart ?? false),\n                  'is-loading': (!activityVideoPlayer) || (activityVideoPlayer?.isPlaying ?? false) || (activityVideoPlayer?.isPendingStart ?? false),\n                }\"\n                :disabled=\"!(activityVideoPlayer?.awaitingStart ?? false)\"\n                @click=\"activityVideoPlayer.play()\"\n              >\n                <strong>{{i+1}}</strong>&nbsp;|&nbsp;\n                <span>{{activeActivity?.title}}</span>\n                <span class=\"icon\"><i class=\"fas fa-play\"></i></span>\n              </button>\n              <button\n                class=\"button is-primary\"\n                v-if=\"needsStartWebcam\"\n                :class=\"{'is-loading': webcamStatus==='loading'}\"\n                @click=\"startWebcam\">\n                Start Webcam\n              </button>\n              <button\n                class=\"button is-warning\"\n                v-if=\"activityVideoPlayer?.activityFinished\"\n                @click=\"repeat()\"\n              >\n                <strong>{{i+1}}</strong>&nbsp;|&nbsp;\n                <span>{{activeActivity?.title}}</span>\n                <span class=\"icon\"><i class=\"fas fa-redo fa-flip-horizontal\"></i></span>\n                <!-- <span>Repeat</span> -->\n              </button>\n              <!-- <button\n                class=\"button is-primary\"\n                v-if=\"activityVideoPlayer?.activityFinished && hasNextActivity\"\n                @click=\"nextActivity\"\n              >\n                <span>Next </span>\n                <span class=\"icon\"><i class=\"fas fa-step-forward\"></i></span>\n              </button> -->\n            </span>\n          </li>\n          <li>\n            <span class=\"pagination-ellipses\" v-if=\"enableCompleteLesson\">\n              <button class=\"button\"\n                :class=\"{ 'is-primary': activityVideoPlayer?.activityFinished && !hasNextActivity}\"\n                @click=\"completeLesson\">\n                <span class=\"icon\"><i class=\"fas fa-check\"></i></span>\n                <span>Done</span>\n              </button>\n            </span>\n          </li>\n        </div>\n      </nav>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\nimport { defineComponent, ref, nextTick } from 'vue';\nimport ActivityVideoPlayer from '@/components/elements/ActivityVideoPlayer.vue';\nimport SegmentedProgressBar, { calculateProgressSegments, ProgressSegmentData } from '@/components/elements/SegmentedProgressBar.vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport Utils from '@/services/Utils';\n\nexport default defineComponent({\n  name: 'MiniLessonPlayer',\n  components: {\n    SegmentedProgressBar,\n    ActivityVideoPlayer,\n  },\n  props: {\n    videoEntry: { type: Object },\n    miniLesson: { type: Object },\n    // maxVideoHeight: { type: String, default: 'none' },\n    enableCompleteLesson: { type: Boolean, default: false },\n  },\n  setup() {\n    const activityVideoPlayer = ref(null as null | typeof ActivityVideoPlayer);\n    return {\n      activityVideoPlayer,\n    };\n  },\n  emits: ['lesson-completed', 'activity-changed'],\n  computed: {\n    nearbyActivityIndices(): number[] {\n      const margin = 1;\n      const minIndex = Math.max(0, this.activeActivityIndex - margin);\n      const maxActivityIndex = (this.lesson?.activities.length ?? 0) - 1;\n      const maxIndex = Math.min(maxActivityIndex, this.activeActivityIndex + margin);\n      const count = (maxIndex + 1) - minIndex;\n      let indices: number[] = [];\n      if (minIndex > 0) indices = indices.concat([0, -1]);\n      indices = indices.concat(Utils.range(count, minIndex));\n      if (maxIndex < maxActivityIndex) indices = indices.concat([-1, maxActivityIndex]);\n      return indices;\n    },\n    lesson() {\n      const lesson = (this.$props.miniLesson ?? null) as null | MiniLesson;\n      return lesson;\n    },\n    activities(): MiniLessonActivity[] {\n      return (this.lesson as any)?.activities ?? [];\n    },\n    activeActivity() {\n      const lesson = (this.$props.miniLesson ?? null) as null | MiniLesson;\n      const activityIndex = this.activeActivityIndex as number;\n      const activity = lesson?.activities[activityIndex] ?? null as null | MiniLessonActivity;\n      return activity;\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lesson) return calculateProgressSegments(this.lesson, this.activeActivity);\n      return [];\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < (this.lesson?.activities.length ?? 0);\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    needsStartWebcam(): boolean {\n      return this.activeActivity !== null && this.activeActivity?.userVisual !== 'none' && webcamProvider.webcamStatus.value !== 'running';\n    },\n  },\n  data() {\n    return {\n      activeActivityIndex: 0,\n      activityProgress: 0,\n      webcamStatus: webcamProvider.webcamStatus,\n    };\n  },\n  methods: {\n    onProgress(val: number) { this.activityProgress = val; },\n    playActivity() { (this.$refs.activityVideoPlayer as any).play(); },\n    nextActivity() {\n      if (this.hasNextActivity) this.activeActivityIndex += 1;\n      nextTick(() => {\n        if (!this.needsStartWebcam) this.playActivity();\n      });\n    },\n    completeLesson() {\n      this.$emit('lesson-completed');\n    },\n    gotoActivity(i: number) {\n      this.activeActivityIndex = i;\n    },\n    async startWebcam() {\n      return (this.$refs.activityVideoPlayer as any)?.startWebcam();\n    },\n    repeat() {\n      const vidPlayer = (this.$refs.activityVideoPlayer as any);\n      vidPlayer.reset();\n      vidPlayer.play();\n    },\n  },\n  watch: {\n    activeActivityIndex(newVal: number) {\n      this.$emit('activity-changed', newVal);\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.mini-lesson-player {\n  display: flex;\n  flex-flow: column;\n  height: 100%;\n  width: 100%;\n\n  .video-container {\n    flex: 1 1 0;\n    // background: lightblue;\n\n    display: flex;\n    flex-flow: column nowrap;\n    justify-content: center;\n    align-items: center;\n    height: 0px;\n  }\n}\n</style>\n","<template>\n  <div class=\"activity-video-player\">\n\n    <WebcamBox\n      ref=\"webcamBox\"\n      class=\"is-flex-grow-1 is-flex-shrink-1\" style=\"height:0\"\n      :showStartWebcamButton=\"false\"\n      v-show=\"showingWebcam\"/>\n\n    <div :class=\"{\n          'is-overlay': showingWebcam || showSheetMusic,\n        }\" class=\"is-flex-grow-1 is-flex-shrink-1\" :style=\"{\n          height: showingWebcam ? '100%' : 0,\n        }\">\n      <PausingVideoPlayer\n        :videoSrc=\"motion?.videoSrc\"\n        ref=\"videoPlayer\"\n        :drawPoseLandmarks=\"activity?.demoVisual === 'skeleton'\"\n        :videoOpacity=\"activity?.demoVisual === 'video' ? 1 : 0\"\n        :emphasizedJoints=\"emphasizedJoints\"\n        @progress=\"onProgress\"\n        @playback-completed=\"onPlaybackCompleted\"\n        @pause-hit=\"onPauseHit\"\n        @pause-end=\"onPauseEnded\"\n        :showControls=\"activity?.showVideoControls ?? false\"\n      />\n    </div>\n\n    <div v-if=\"showSheetMusic\" style=\"max-height:100%\">\n      <SheetMotion\n        :dbEntry=\"motion\"\n        :drawMode=\"activity?.sheetMotionVisual\"\n        :currentTime=\"videoTime\"\n        :data=\"activity?.sheetMotion\"\n      />\n    </div>\n\n    <div class=\"is-overlay instructions-overlay mb-4\">\n      <InstructionCarousel v-show=\"!activityFinished && timedInstructions.length > 0\" :sizeClass=\"'is-medium'\" :instructions=\"timedInstructions\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"pauseInstructs.length > 0\" :sizeClass=\"'is-medium'\" :instructions=\"pauseInstructs\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"instructions.length > 0\" :sizeClass=\"'is-medium'\" :instructions=\"instructions\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"activity?.staticInstruction\" :sizeClass=\"'is-medium'\"  :instructions=\"[{id:0, text:activity?.staticInstruction}]\" class=\"m-2\"/>\n      <KeyframeTimeline\n        :dbEntry=\"motion\"\n        :drawMode=\"keyframeVisual\"\n        :keyframes=\"activity?.keyframes ?? []\"\n        :currentTime=\"videoTime\"\n        v-if=\"keyframeVisual !== 'none'\"\n        />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed, defineComponent, ref, toRefs, watchEffect,\n} from 'vue';\nimport InstructionCarousel, { Instruction } from '@/components/elements/InstructionCarousel.vue';\nimport PausingVideoPlayer from '@/components/elements/PausingVideoPlayer.vue';\nimport KeyframeTimeline from '@/components/elements/KeyframeTimeline.vue';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\nimport SheetMotion from '@/components/elements/SheetMotion.vue';\nimport { MiniLessonActivity, PauseInfo } from '@/model/MiniLesson';\nimport Constants from '@/services/Constants';\n\nconst ActivityPlayState = Object.freeze({\n  AwaitingStart: 'AwaitingStart',\n  PendingStart: 'PendingStart',\n  Playing: 'Playing',\n  ActivityEnded: 'ActivityEnded',\n});\n\nexport default defineComponent({\n  name: 'ActivityVideoPlayer',\n  emits: ['progress', 'activityEnded'],\n  props: {\n    motion: { type: Object },\n    activity: { type: Object },\n    defaultPauseDuration: { type: Number, default: 1.5 },\n    maxHeight: { type: String, default: '400px' },\n  },\n  components: {\n    PausingVideoPlayer,\n    InstructionCarousel,\n    WebcamBox,\n    KeyframeTimeline,\n    SheetMotion,\n  },\n  setup(props) {\n    const { activity } = toRefs(props);\n    const state = ref(ActivityPlayState.AwaitingStart);\n    const activityFinished = computed(() => state.value === ActivityPlayState.ActivityEnded);\n    const awaitingStart = computed(() => state.value === ActivityPlayState.AwaitingStart);\n    const isPlaying = computed(() => state.value === ActivityPlayState.Playing);\n    const isPendingStart = computed(() => state.value === ActivityPlayState.PendingStart);\n    const videoPlayer = ref(null as null | typeof PausingVideoPlayer);\n    const webcamBox = ref(null as null | typeof WebcamBox);\n    const videoTime = ref(0);\n\n    const pauseInstructs = ref([] as Instruction[]);\n    const onPlaybackCompleted = () => {\n      state.value = ActivityPlayState.ActivityEnded;\n    };\n    const onPauseHit = (pause: PauseInfo) => {\n      console.log(`Hit pause${pause}`);\n      if (pause.instruction) pauseInstructs.value.push({ id: pause.time, text: pause.instruction });\n    };\n    const onPauseEnded = () => pauseInstructs.value.splice(0);\n\n    const startTime = computed(() => activity?.value?.startTime ?? 0);\n\n    function reset(newTime?: number) {\n      pauseInstructs.value.splice(0);\n      state.value = ActivityPlayState.AwaitingStart;\n      const time = newTime ?? startTime.value ?? 0;\n\n      if (videoPlayer.value) videoPlayer.value.setTime(time);\n    }\n\n    watchEffect(() => reset(startTime.value));\n\n    return {\n      webcamBox,\n      videoPlayer,\n      videoTime,\n      state,\n      ActivityPlayState,\n      awaitingStart,\n      activityFinished,\n      pauseInstructs,\n      isPlaying,\n      isPendingStart,\n\n      reset,\n      startTime,\n\n      onPlaybackCompleted,\n      onPauseHit,\n      onPauseEnded,\n    };\n  },\n  computed: {\n    keyframeVisual(): 'none' | 'skeleton' | 'video' {\n      return (this as any)?.activity?.keyframeVisual ?? 'none';\n    },\n    showingWebcam() {\n      return ((this as any)?.activity?.userVisual ?? 'none') !== 'none';\n    },\n    showSheetMusic() {\n      return ((this as any)?.activity?.sheetMotionVisual ?? 'none') !== 'none';\n    },\n    emphasizedJoints(): number[] { return this.activity?.emphasizedJoints ?? []; },\n    instructions(): Instruction[] {\n      const mActivity = this.activity;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if ((this.state === ActivityPlayState.AwaitingStart || this.state === ActivityPlayState.PendingStart) && mActivity.startInstruction) {\n        let text = mActivity.startInstruction;\n        if (this.state === ActivityPlayState.PendingStart) { text += '...'; }\n        instructs.push({\n          id: 1,\n          text,\n        });\n      } else if (this.state === ActivityPlayState.Playing && mActivity.playingInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.playingInstruction,\n        });\n      } else if (this.state === ActivityPlayState.ActivityEnded && mActivity.endInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.endInstruction,\n        });\n      }\n\n      return instructs;\n    },\n    timedInstructions(): Instruction[] {\n      const mActivity = this.activity as unknown as MiniLessonActivity | null;\n      const time = this.videoTime;\n\n      if (!mActivity) return [];\n\n      const activeTimedInstructions = mActivity.timedInstructions?.map(\n        (ti, i) => ({\n          id: i,\n          text: ti.text,\n          start: ti.startTime,\n          end: ti.endTime,\n        })\n      ).filter((ti) => ti.start <= time && time < ti.end) ?? [];\n\n      // console.log(`TimedI updated for time ${time}, count=${activeTimedInstructions.length}`, mActivity.timedInstructions);\n\n      return activeTimedInstructions;\n    },\n  },\n  methods: {\n    async startWebcam() {\n      return this.webcamBox?.startWebcam() ?? new Error('WebcamBox is null');\n    },\n    play(delay?: number | undefined) {\n      this.reset();\n      const vidPlayer = this.videoPlayer;\n      const vidActivity = this.activity as MiniLessonActivity | null;\n      if (!vidActivity) return;\n      if (!vidPlayer) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer is null');\n        return;\n      }\n\n      this.state = ActivityPlayState.PendingStart;\n\n      vidPlayer.play(\n        vidActivity.startTime,\n        vidActivity.endTime,\n        vidActivity.practiceSpeed ?? 1,\n        vidActivity.pauses ?? [],\n        delay ?? Constants.DefaultPauseDuration,\n        () => {\n          this.state = ActivityPlayState.Playing;\n        },\n      );\n    },\n    onProgress(val: number) {\n      this.videoTime = val;\n      this.$emit('progress', val);\n    },\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n\n.activity-video-player {\n  position: relative;\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: stretch;\n  align-items: stretch;\n  height: 100%;\n  width: 100%;\n\n  .keyframe-video {\n    max-height: 33%;\n    // max-width: 33%;\n  }\n}\n\n.instructions-overlay {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: flex-end;\n  pointer-events: none;\n}\n\n.keyframe-container {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n  align-content: right;\n}\n\n</style>\n","<template>\n  <transition-group name=\"slide-fade\" mode=\"out-in\" tag=\"div\" class=\"instructionCarousel\">\n    <p\n      class=\"flextag\"\n      :class=\"[sizeClass, tagClass]\"\n      v-for=\"inst in instructions\"\n      :key=\"inst.id\">{{inst.text}}</p>\n  </transition-group>\n</template>\n\n<script lang=\"ts\">\n\nimport { defineComponent } from 'vue';\n\nexport type Instruction = {\n  id: number;\n  text: string;\n}\n\nexport default defineComponent({\n  props: {\n    instructions: {\n      type: Array,\n      default: Array,\n    },\n    sizeClass: {\n      type: String,\n      default: 'is-normal',\n    },\n    tagClass: {\n      type: String,\n      default: 'is-dark',\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.instructionCarousel {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-flow: row wrap;\n  width: 100%;\n\n  .flextag {\n    border-radius: 0.25rem;\n    text-align: center;\n    border: 1px solid black;\n    background: #CCC;\n    padding: 0.25rem 0.5rem;\n  }\n}\n\n/* Enter and leave animations can use different */\n/* durations and timing functions.              */\n.slide-fade-enter-active {\n  transition: all .15s ease;\n  overflow: hidden;\n  // transform: translateX(-100%);\n}\n.slide-fade-leave-active {\n  transition: all .15s ease;\n  overflow: clip;\n  // transform: translateX(-100%);\n}\n.slide-fade-enter, .slide-fade-leave-to\n/* .slide-fade-leave-active below version 2.1.8 */ {\n  transform: translateX(10px) scaleX(0);\n  opacity: 0;\n}\n\n</style>\n","\n\nimport { defineComponent } from 'vue';\n\nexport type Instruction = {\n  id: number;\n  text: string;\n}\n\nexport default defineComponent({\n  props: {\n    instructions: {\n      type: Array,\n      default: Array,\n    },\n    sizeClass: {\n      type: String,\n      default: 'is-normal',\n    },\n    tagClass: {\n      type: String,\n      default: 'is-dark',\n    },\n  },\n});\n","import { render } from \"./InstructionCarousel.vue?vue&type=template&id=c910331e\"\nimport script from \"./InstructionCarousel.vue?vue&type=script&lang=ts\"\nexport * from \"./InstructionCarousel.vue?vue&type=script&lang=ts\"\n\nimport \"./InstructionCarousel.vue?vue&type=style&index=0&id=c910331e&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <VideoPlayer\n        ref=\"videoPlayer\"\n        :videoBaseUrl=\"videoSrc\"\n        @progress=\"onProgress\"\n        @playback-completed=\"onSegmentPlaybackCompleted\"\n        :videoOpacity=\"videoOpacity\"\n        :drawPoseLandmarks=\"drawPoseLandmarks\"\n        :setDrawStyle=\"setDrawStyle\"\n        :emphasizedJoints=\"emphasizedJoints\"\n        :emphasizedJointStyle=\"emphasizedJointStyle\"\n        :showControls=\"showControls\"\n        />\n</template>\n\n<script lang=\"ts\">\n\nimport Constants from '@/services/Constants';\nimport { PauseInfo } from '@/model/MiniLesson';\nimport {\n  computed, defineComponent, onBeforeUnmount, ref,\n} from 'vue';\nimport VideoPlayer from './VideoPlayer.vue';\n\nconst DEFAULT_PAUSE_DURATION = Constants.DefaultPauseDuration;\n\ntype PlaySegment = {\n  from: number;\n  to: number;\n  speed: number;\n  pause: PauseInfo | null;\n}\nfunction computePlaySegments(from: number, to: number, speed: number, pauses: PauseInfo[]) {\n  const segs: PlaySegment[] = [];\n\n  function nextPauseIndex(prevIndex: number): number {\n    const pTime = Math.max((pauses[prevIndex]?.time ?? 0), from);\n    let pauseIndex = prevIndex + 1;\n    for (; pauseIndex < pauses.length; pauseIndex += 1) {\n      const pi = pauses[pauseIndex];\n      if (pi.time > pTime) break;\n    }\n    return pauseIndex;\n  }\n\n  let segStartTime = from;\n  let pauseIndex = nextPauseIndex(-1);\n  while (pauseIndex < pauses.length) {\n    segs.push({\n      from: segStartTime,\n      to: pauses[pauseIndex].time,\n      speed,\n      pause: pauses[pauseIndex],\n    });\n    segStartTime = pauses[pauseIndex].time;\n    pauseIndex = nextPauseIndex(pauseIndex);\n  }\n  segs.push({\n    from: segStartTime,\n    to,\n    speed,\n    pause: null,\n  });\n\n  return segs;\n}\n\nexport default defineComponent({\n  name: 'PausingVideoPlayer',\n  components: { VideoPlayer },\n  props: {\n    videoSrc: {\n      default: '',\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: (canvasCtx: CanvasRenderingContext2D) => {\n        if (!canvasCtx) return;\n\n        /* eslint-disable no-param-reassign */\n        canvasCtx.strokeStyle = 'rgba(250, 200, 250, 0.95)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n        /* eslint-enable no-param-reassign */\n      },\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    showControls: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['playback-completed', 'progress', 'pause-hit', 'pause-end'],\n  setup(props, { emit }) {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n\n    let playTimeoutId = undefined as undefined | number;\n\n    function setTime(time: number) {\n      const vidPlayer = videoPlayer.value;\n      clearTimeout(playTimeoutId);\n      if (vidPlayer) vidPlayer.setTime(time);\n      emit('progress', time);\n    }\n\n    function onProgress(time: number) {\n      emit('progress', time);\n    }\n\n    function playSegment(seg: PlaySegment, delaySecs: number, emitResume?: boolean, onPlayStart?: () => void) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n\n      clearTimeout(playTimeoutId);\n      playTimeoutId = window.setTimeout(() => {\n        if (emitResume ?? false) {\n          emit('pause-end');\n        }\n        vidPlayer.playVideo(seg.from, seg.to, seg.speed);\n        if (onPlayStart) onPlayStart();\n      }, 1000 * delaySecs);\n    }\n    onBeforeUnmount(() => {\n      clearTimeout(playTimeoutId);\n    });\n\n    let playingSegments: PlaySegment[] = [];\n    let playingSegmentIndex = 0;\n\n    function play(\n      from: number,\n      to: number,\n      speed: number,\n      pauses: Array<PauseInfo>,\n      playDelaySecs: number,\n      onPlayStart?: () => void,\n    ) {\n      clearTimeout(playTimeoutId);\n      setTime(from);\n      playingSegments = computePlaySegments(from, to, speed, pauses);\n      playingSegmentIndex = 0;\n\n      playSegment(playingSegments[playingSegmentIndex], playDelaySecs, false, onPlayStart);\n    }\n    function onSegmentPlaybackCompleted() {\n      const { pause, to } = playingSegments[playingSegmentIndex];\n      playingSegmentIndex += 1;\n      if (playingSegmentIndex >= playingSegments.length) {\n        setTime(to);\n        emit('playback-completed');\n        return;\n      }\n\n      if (!pause) throw new Error('Expected there to be a pause obj');\n      const nextSeg = playingSegments[playingSegmentIndex];\n\n      emit('pause-hit', pause);\n      const manualResume = pause.manualResume ?? false;\n      if (!manualResume) {\n        playSegment(nextSeg, pause.pauseDuration ?? DEFAULT_PAUSE_DURATION, true);\n      }\n    }\n\n    const currentPose = computed(() => videoPlayer.value?.currentPose ?? null);\n\n    return {\n      videoPlayer,\n      setTime,\n      onProgress,\n      onSegmentPlaybackCompleted,\n      play,\n      currentPose,\n    };\n  },\n  methods: {\n    getVideoDimensions() {\n      return (this.$refs.videoPlayer as typeof VideoPlayer)?.getVideoDimensions();\n    },\n    getVideoTime(): number {\n      return (this.videoPlayer as any)?.getVideoTime() ?? 0;\n    },\n  },\n});\n</script>\n\n<style>\n\n</style>\n","const Constants = Object.freeze({\n  DefaultPauseDuration: 1.5,\n});\nexport default Constants;\n","<template>\n  <div\n    class=\"video-player-container\"\n  >\n    <video\n      :src=\"videoUrl\"\n      :style=\"{\n        opacity: '' + videoOpacity,\n      }\"\n      ref=\"videoElement\"\n      @loadedmetadata=\"scheduleCanvasResizing\"\n      @seeked=\"onTimeUpdated(true)\"\n      @timeupdate=\"onTimeUpdated(true)\"\n      @ended=\"endReported = true\"\n      playsinline\n      :showControls=\"showControls\"\n    ></video>\n    <canvas class=\"is-overlay\" ref=\"canvasElement\" v-show=\"drawPoseLandmarks\"></canvas>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport MotionTrail from '@/model/MotionTrail';\nimport { DrawPose } from '@/services/MediaPipe';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport poseProvider from '@/services/PoseProvider';\nimport {\n  computed,\n  defineComponent,\n  toRefs,\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  nextTick,\n  Ref,\n  watch,\n} from 'vue';\n\nfunction onResize(canvasE: HTMLCanvasElement, videoE: HTMLVideoElement, modified: Ref<boolean>) {\n  nextTick(() => {\n    if (!canvasE || !videoE) return;\n\n    if (canvasE.width !== videoE.offsetWidth) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.width = videoE.offsetWidth;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    if (canvasE.height !== videoE.offsetHeight) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.height = videoE.offsetHeight;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    modified.value = true;\n  });\n}\n\nfunction setupCanvasResizing(\n  videoElement: Ref<null | HTMLVideoElement>,\n  canvasElement: Ref<null | HTMLCanvasElement>,\n  modified: Ref<boolean>,\n) {\n  function resizeCanvas() {\n    const videoE = videoElement.value;\n    const canvasE = canvasElement.value;\n    if (videoE && canvasE) onResize(canvasE, videoE, modified);\n  }\n  onMounted(() => {\n    window.addEventListener('resize', resizeCanvas);\n    nextTick(resizeCanvas);\n  });\n  onBeforeUnmount(() => {\n    window.removeEventListener('resize', resizeCanvas);\n  });\n  return resizeCanvas;\n}\n\nfunction setupVideoPlaying(\n  videoElement: Ref<HTMLVideoElement | null>,\n  startTime: Ref<number>,\n  endTime: Ref<number>,\n  startProgressUpdating: () => void,\n  endReported: Ref<boolean>,\n) {\n  function playVideo(\n    from: number,\n    to: number,\n    speed: number,\n  ) {\n    // console.log(`VideoPlayer :: Starting playback from ${from} to ${to} @ ${speed.toPrecision(2)}`);\n\n    // eslint-disable-next-line no-param-reassign\n    endReported.value = false;\n    // eslint-disable-next-line no-param-reassign\n    startTime.value = from;\n    // eslint-disable-next-line no-param-reassign\n    endTime.value = to;\n\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n\n    videoE.pause();\n    videoE.playbackRate = speed;\n    videoE.currentTime = from;\n\n    nextTick(() => {\n      startProgressUpdating();\n      videoE.play();\n    });\n  }\n\n  function pauseVideo() {\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n    videoE.pause();\n  }\n\n  return { playVideo, pauseVideo };\n}\n\nexport default defineComponent({\n  name: 'VideoPlayer',\n  props: {\n    videoBaseUrl: String,\n    motionTrails: {\n      type: Array,\n      default: Array,\n      required: false,\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    fps: {\n      type: Number,\n      default: 30,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: () => {},\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    showControls: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\n    'playback-completed',\n    'progress',\n  ],\n  setup(props, ctx) {\n    const {\n      videoBaseUrl, motionTrails, drawPoseLandmarks, fps, setDrawStyle, emphasizedJoints, emphasizedJointStyle,\n    } = toRefs(props);\n\n    const videoElement = ref(null as null | HTMLVideoElement);\n    const canvasElement = ref(null as null | HTMLCanvasElement);\n    const canvasCtx = computed(() => canvasElement.value?.getContext('2d') as CanvasRenderingContext2D | null);\n\n    const startTime = ref(0);\n    const endTime = ref(0);\n    const videoUrl = computed(() => videoBaseUrl?.value ?? '');\n    const currentTime = ref(0);\n    const canvasModified = ref(false);\n\n    const resizeCanvas = setupCanvasResizing(videoElement, canvasElement, canvasModified);\n    const endReported = ref(false);\n\n    const poses = ref([] as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>);\n    const currentFrame = computed(() => Math.floor(currentTime.value * fps.value));\n    const currentPose = computed(() => {\n      const frame = currentFrame.value;\n      const pose = poses.value[frame] ?? [];\n      return pose;\n    });\n\n    let prevTime = -1;\n    let timerId = -1;\n    function onTimeUpdated(ignoreEnd?: boolean) {\n      const vidElement = videoElement.value;\n      if (!vidElement) return;\n\n      const time = vidElement.currentTime;\n      if (time === prevTime) return;\n      prevTime = time;\n\n      currentTime.value = time;\n\n      if (!ignoreEnd && (time + 1 / 60 >= endTime.value || endReported.value)) {\n        vidElement.pause();\n        vidElement.currentTime = endTime.value; // pin to end time\n        ctx.emit('progress', endTime.value);\n        console.log('VideoPlayer :: playback-completed');\n        ctx.emit('playback-completed');\n        clearInterval(timerId);\n        timerId = -1;\n      } else {\n        ctx.emit('progress', time);\n      }\n    }\n\n    const startProgressUpdating = () => {\n      if (timerId !== -1) clearInterval(timerId);\n      timerId = window.setInterval(onTimeUpdated, 1000 / 30);\n    };\n\n    const { playVideo, pauseVideo } = setupVideoPlaying(\n      videoElement,\n      startTime,\n      endTime,\n      startProgressUpdating,\n      endReported,\n    );\n\n    function scheduleCanvasResizing() {\n      setTimeout(() => {\n        nextTick(resizeCanvas);\n      }, 100);\n    }\n\n    // Update pose drawing\n    function clearDrawing() {\n      const canvasE = canvasElement.value;\n      const drawCtx = canvasCtx.value;\n      if (!canvasE || !drawCtx) return;\n      drawCtx.clearRect(0, 0, canvasE.width, canvasE.height);\n    }\n    function drawPose(lms: Landmark[]) {\n      const videoE = videoElement.value;\n      const sourceAR = (videoE?.videoHeight && videoE.videoHeight) ? videoE.videoWidth / videoE.videoHeight : 1;\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n      setDrawStyle.value(drawCtx);\n      DrawPose(drawCtx, lms, {\n        emphasizedJoints: emphasizedJoints.value as number[],\n        emphasisStroke: emphasizedJointStyle.value,\n        sourceAspectRatio: sourceAR,\n        outlineColor: 'black',\n      });\n    }\n\n    const retieveClearPoseFile = async () => {\n      if (!drawPoseLandmarks.value) {\n        poses.value = [];\n        return;\n      }\n\n      // try {\n      poses.value = await poseProvider.GetPose(videoBaseUrl?.value ?? '');\n      // } catch (e) {\n      // console.error(\"Couldn't get poses: \", e);\n      // }\n    };\n\n    function drawMotionTrail(trail: MotionTrail) {\n      const videoE = videoElement.value;\n      const sourceAR = (videoE?.videoHeight && videoE.videoHeight) ? videoE.videoWidth / videoE.videoHeight : 1;\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n    }\n\n    watch([videoBaseUrl, drawPoseLandmarks], retieveClearPoseFile);\n    onMounted(retieveClearPoseFile);\n\n    watch([canvasModified, currentPose, drawPoseLandmarks, motionTrails], () => {\n      canvasModified.value = false;\n      clearDrawing();\n\n      if (drawPoseLandmarks.value) {\n        drawPose(currentPose.value as any);\n      }\n\n      if (motionTrails.value) {\n        for (let i = 0; i < motionTrails.value.length; i += 1) {\n          const trail = motionTrails.value[i];\n          drawMotionTrail(trail as any);\n        }\n      }\n    });\n\n    let resizeTimerId = -1;\n    onMounted(() => {\n      resizeTimerId = window.setInterval(resizeCanvas, 500);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(resizeTimerId);\n    });\n\n    return {\n      videoUrl,\n      resizeCanvas,\n      videoElement,\n      canvasElement,\n      playVideo,\n      pauseVideo,\n      endTime,\n      scheduleCanvasResizing,\n      poses,\n      currentTime,\n      currentPose,\n      currentFrame,\n      endReported,\n      onTimeUpdated,\n\n      getVideoDimensions: () => ({\n        height: videoElement.value?.height ?? 0,\n        width: videoElement.value?.width ?? 0,\n      }),\n    };\n  },\n  methods: {\n    setTime(time: number, keepPlaying?: boolean | undefined) {\n      const videoE = this.videoElement;\n      if (videoE) {\n        videoE.currentTime = time;\n      }\n      const pauseVideo = !(keepPlaying ?? false);\n      if (videoE && pauseVideo) videoE.pause();\n    },\n    getVideoTime() {\n      return this.videoElement?.currentTime ?? 0;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n.video-player-container, .canvas-layer {\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: center;\n  align-items: center;\n\n  canvas {\n    margin: auto;\n  }\n\n  video {\n    flex: 1 1 auto;\n    border-radius: 0.25rem;\n    display: block;\n    margin: auto;\n    height: auto;\n    max-height: 100%;\n  }\n}\n</style>\n","// Inspired from https://gist.github.com/TheJLifeX/74958cc59db477a91837244ff598ef4a\n\nexport type Landmark = {\n  x: number;\n  y: number;\n  z?: number;\n  visibility?: number;\n}\n\nexport type MpHolisticResults = {\n  image?: any;\n  timestamp?: number;\n  faceLandmarks?: Array<Landmark>;\n  poseLandmarks?: Array<Landmark>;\n  rightHandLandmarks?: Array<Landmark>;\n  leftHandLandmarks?: Array<Landmark>;\n}\nexport const HandLandmarks = {\n  wrist: 0,\n  thumbCMC: 1,\n  thumbMCP: 2,\n  thumbIP: 3,\n  thumbTIP: 4,\n  indexMCP: 5,\n  indexPIP: 6,\n  indexDIP: 7,\n  indexTIP: 8,\n  middleMCP: 9,\n  middlePIP: 10,\n  middleDIP: 11,\n  middleTIP: 12,\n  ringMCP: 13,\n  ringPIP: 14,\n  ringDIP: 15,\n  ringTIP: 16,\n  pinkyMCP: 17,\n  pinkyPIP: 18,\n  pinkyDIP: 19,\n  pinkyTIP: 20,\n};\n\nexport const PoseLandmarks = {\n  nose: 0,\n  leftEyeInner: 1,\n  leftEye: 2,\n  leftEyeOuter: 3,\n  rightEyeInner: 4,\n  rightEye: 5,\n  rightEyeOuter: 6,\n  leftEar: 7,\n  rightEar: 8,\n  mouthLeft: 9,\n  mouthRight: 10,\n  leftShoulder: 11,\n  rightShoulder: 12,\n  leftElbow: 13,\n  rightElbow: 14,\n  leftWrist: 15,\n  rightWrist: 16,\n  leftPinky: 17,\n  rightPinky: 18,\n  leftIndex: 19,\n  rightIndex: 20,\n  leftThumb: 21,\n  rightThumb: 22,\n  leftHip: 23,\n  rightHip: 24,\n  leftKnee: 25,\n  rightKnee: 26,\n  leftAnkle: 27,\n  rightAnkle: 28,\n  leftHeel: 29,\n  rightHeel: 30,\n  leftFootIndex: 31,\n  rightFootIndex: 32,\n\n  // The following are not part of the MP standard, but are added for convenience\n  midShouder: -1,\n  midHip: -2,\n  midEye: -3,\n};\n","import { TinyEmitter } from 'tiny-emitter';\nimport { onMounted, onBeforeUnmount } from 'vue';\nimport { MpHolisticResults } from './MediaPipeTypes';\n\nexport const EventNames = Object.freeze({\n  gesture: 'gesture',\n  trackingProcessingStarted: 'trackingProcessingStarted',\n  trackingResults: 'trackingResults',\n  trackingRequested: 'trackingRequested',\n  trackingRequestFinished: 'trackingRequestFinished',\n});\n\nexport const GestureNames = Object.freeze({\n  none: 'none',\n  pointLeft: 'point-left',\n  pointRight: 'point-right',\n  namaste: 'namaste',\n});\n\nconst eventHub = new TinyEmitter();\n\nexport function setupGestureListening(\n  callbacks: Record<string, (trackingResults?: MpHolisticResults | undefined) => void>,\n  fallback?: undefined | ((gesture: string, trackingResults: MpHolisticResults) => void),\n) {\n  function onGesture(gesture: string, trackingResults: MpHolisticResults) {\n    const cb = callbacks[gesture];\n    if (cb) cb(trackingResults);\n\n    if (!cb && fallback) fallback(gesture, trackingResults);\n  }\n  onMounted(() => {\n    eventHub.on(EventNames.gesture, onGesture);\n  });\n  onBeforeUnmount(() => {\n    eventHub.off(EventNames.gesture, onGesture);\n  });\n}\n\nexport function setupMediaPipeListening(\n  callback: (res: MpHolisticResults, frameId?: number) => void,\n  onFrameProcessingStarted?: (frameId: number) => void,\n) {\n\n  onMounted(() => {\n    eventHub.on(EventNames.trackingResults, callback);\n    if (onFrameProcessingStarted) eventHub.on(EventNames.trackingProcessingStarted, onFrameProcessingStarted);\n  });\n  onBeforeUnmount(() => {\n    eventHub.off(EventNames.trackingResults, callback);\n    if (onFrameProcessingStarted) eventHub.off(EventNames.trackingProcessingStarted, onFrameProcessingStarted);\n  });\n}\n\nexport const TrackingActions = Object.freeze({\n  requestTracking: (id: string) => {\n    eventHub.emit(EventNames.trackingRequested, id);\n  },\n  endTrackingRequest: (id: string) => {\n    eventHub.emit(EventNames.trackingRequestFinished, id);\n  },\n});\n\nexport default eventHub;\n","//\n// Utils.ts\n//\n\nexport default class Utils {\n\n  static range(size: number, startAt = 0) {\n    return [...Array(size).keys()].map((i) => i + startAt);\n  }\n\n  static sleep(secs: number): Promise<void> {\n    return new Promise((res) => setTimeout(res, secs * 1000));\n  }\n\n  static PromptDownloadFile(filename: string, text: string) {\n    const element = document.createElement('a');\n    element.setAttribute('href', `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`);\n    element.setAttribute('download', filename);\n    element.style.display = 'none';\n\n    document.body.appendChild(element);\n    element.click();\n\n    document.body.removeChild(element);\n  }\n\n  // static CaptureVideoImage(videoE: HTMLVideoElement) {\n  //   const canvas = document.createElement('canvas');\n  //   canvas.style.display = 'none';\n  //   document.appendChild(canvas);\n  //   canvas.width = videoE.width;\n  //   canvas.height = videoE.height;\n  //   const ctx = canvas.getContext('2d')!;\n\n  //   ctx.drawImage(videoE, 0, 0, videoE.width, videoE.height);\n  // }\n\n  static DoEveryFrame(\n    onFrame: () => Promise<void>,\n    shouldRun?: () => boolean,\n  ) {\n\n    if (shouldRun !== undefined && !shouldRun()) {\n      requestAnimationFrame(() => {\n        Utils.DoEveryFrame(onFrame);\n      });\n    } else {\n      requestAnimationFrame(() => {\n        onFrame().then(() => {\n          Utils.DoEveryFrame(onFrame);\n        });\n      });\n    }\n  }\n\n  static uuidv4() {\n    // eslint-disable-next-line no-bitwise, no-mixed-operators, space-infix-ops\n    return (`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`).replace(/[018]/g, (c: any) => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));\n  }\n\n  static deepCopy<T>(obj: T): T {\n\n    // Handle the 3 simple types, and null or undefined\n    if (obj === null || undefined === obj || typeof obj !== 'object') {\n      return obj;\n    }\n\n    if (obj instanceof Date) {\n      const copy = new Date();\n      copy.setTime(obj.getTime());\n      return copy as unknown as T;\n    }\n\n    if (Array.isArray(obj)) {\n      const len = obj.length;\n      const copy = new Array(len);\n      for (let i = 0; i < len; i += 1) {\n        copy[i] = Utils.deepCopy(obj[i]);\n      }\n      return copy as unknown as T;\n    }\n\n    if (typeof obj === 'object') {\n      const typedObj = obj as any;\n      const copy = {} as any;\n      const attrs = Object.keys(typedObj);\n      for (let i = 0; i < attrs.length; i += 1) {\n        const attr = attrs[i];\n        const val = typedObj[attr];\n        // eslint-disable-next-line no-prototype-builtins\n        if (typedObj.hasOwnProperty(attr)) copy[attr] = Utils.deepCopy(val);\n      }\n      return copy;\n    }\n\n    throw new Error(`Unable to copy object ${obj}! It's type isn't supported`);\n  }\n\n  static shuffleArray<T>(array: Array<T>, fromIndex?: number, toIndex?: number) {\n    const sliceStart = fromIndex ?? 0;\n    const sliceEnd = toIndex ?? array.length - 1;\n\n    for (let i = sliceEnd; i > sliceStart; i -= 1) {\n      const j = sliceStart + Math.floor(Math.random() * (i - sliceStart + 1));\n      [array[i], array[j]] = [array[j], array[i]];\n    }\n  }\n}\n","/* eslint-disable no-multi-spaces */\n/* eslint-disable @typescript-eslint/no-var-requires */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable import/prefer-default-export */\nimport { Landmark, MpHolisticResults, PoseLandmarks } from './MediaPipeTypes';\nimport eventHub, { EventNames } from './EventHub';\nimport Utils from './Utils';\nimport { Pose } from '@mediapipe/pose';\n\nexport const usingHolistic = false;\n\nlet mp: any = null;\n// eslint-disable-next-line global-require\nif (usingHolistic) mp = require('@mediapipe/holistic/holistic');\n// eslint-disable-next-line global-require\nelse mp = require('@mediapipe/pose/pose');\n\nexport const HAND_LANDMARK_CONNECTIONS = [\n  [0, 1], [1, 2], [2, 3], [3, 4], // Thumb\n  [0, 5], [5, 6], [6, 7], [7, 8], // Index\n  [5, 9], [9, 10], [10, 11], [11, 12], // Middle\n  [9, 13], [13, 14], [14, 15], [15, 16], // Ring\n  [0, 17], [13, 17], [17, 18], [18, 19], [19, 20], // Pinky\n];\n\nexport const HAND = {\n  THUMB_FINGER: [1, 2, 3, 4],\n  INDEX_FINGER: [5, 6, 7, 8],\n  MIDDLE_FINGER: [9, 10, 11, 12],\n  RING_FINGER: [13, 14, 15, 16],\n  PINKY_FINGER: [17, 18, 19, 20],\n};\n\nconst CONNECTIONS_TO_DRAW = [\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftPinky,      size: 1.0 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightPinky,     size: 1.0 },\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftThumb,      size: 1.0 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightThumb,     size: 1.0 },\n  { v0: PoseLandmarks.leftIndex,    v1: PoseLandmarks.leftWrist,      size: 1.0 },\n  { v0: PoseLandmarks.rightIndex,   v1: PoseLandmarks.rightWrist,     size: 1.0 },\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftElbow,      size: 1.1 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightElbow,     size: 1.1 },\n  { v0: PoseLandmarks.leftElbow,    v1: PoseLandmarks.leftShoulder,   size: 1.3 },\n  { v0: PoseLandmarks.rightElbow,   v1: PoseLandmarks.rightShoulder,  size: 1.3 },\n  { v0: PoseLandmarks.leftShoulder, v1: PoseLandmarks.rightShoulder,  size: 2.0 },\n  // { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.leftShoulder,   size: 1.7 },\n  // { v0: PoseLandmarks.rightHip,     v1: PoseLandmarks.rightShoulder,  size: 1.7 },\n  { v0: PoseLandmarks.midShouder,   v1: PoseLandmarks.midHip,           size: 3.0 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.rightHip,       size: 1.7 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.leftKnee,       size: 1.5 },\n  { v0: PoseLandmarks.rightHip,     v1: PoseLandmarks.rightKnee,      size: 1.5 },\n  { v0: PoseLandmarks.leftKnee,     v1: PoseLandmarks.leftAnkle,      size: 1.4 },\n  { v0: PoseLandmarks.rightKnee,    v1: PoseLandmarks.rightAnkle,     size: 1.4 },\n  { v0: PoseLandmarks.leftAnkle,    v1: PoseLandmarks.leftHeel,       size: 1.0 },\n  { v0: PoseLandmarks.rightAnkle,   v1: PoseLandmarks.rightHeel,      size: 1.0 },\n  { v0: PoseLandmarks.leftHeel,     v1: PoseLandmarks.leftFootIndex,  size: 1.0 },\n  { v0: PoseLandmarks.rightHeel,    v1: PoseLandmarks.rightFootIndex, size: 1.0 },\n  { v0: PoseLandmarks.leftAnkle,    v1: PoseLandmarks.leftFootIndex,  size: 1.0 },\n  { v0: PoseLandmarks.rightAnkle,   v1: PoseLandmarks.rightFootIndex, size: 1.0 },\n\n  // { v0: PoseLandmarks.leftEye,      v1: PoseLandmarks.rightEye,       size: 2.0 },\n  // { v0: PoseLandmarks.nose,         v1: PoseLandmarks.leftEye,        size: 1.0 },\n\n  { v0: PoseLandmarks.leftEar,       v1: PoseLandmarks.leftEyeOuter,  size: 1.0 },\n  { v0: PoseLandmarks.leftEyeOuter,  v1: PoseLandmarks.rightEyeOuter, size: 1.0 },\n  { v0: PoseLandmarks.rightEyeOuter, v1: PoseLandmarks.rightEar,      size: 1.0 },\n  { v0: PoseLandmarks.rightEar,      v1: PoseLandmarks.mouthRight,    size: 1.0 },\n  { v0: PoseLandmarks.mouthRight,    v1: PoseLandmarks.mouthLeft,     size: 1.0 },\n  { v0: PoseLandmarks.mouthLeft,     v1: PoseLandmarks.leftEar,       size: 1.0 },\n];\n\nlet trackingStarted = false;\n\nexport function DrawConnections(\n  canvasCtx: CanvasRenderingContext2D,\n  landmarks: Array<Landmark>,\n  connections: Array<Array<number>>,\n) {\n  const w = canvasCtx.canvas.width;\n  const h = canvasCtx.canvas.height;\n\n  canvasCtx.beginPath();\n  connections.forEach((connection) => {\n    const p1 = landmarks[connection[0]];\n    const p2 = landmarks[connection[1]];\n\n    if (!p1 || !p2) return;\n\n    canvasCtx.moveTo(p1.x * w, p1.y * h);\n    canvasCtx.lineTo(p2.x * w, p2.y * h);\n  });\n\n  canvasCtx.stroke();\n  canvasCtx.restore();\n}\n\nfunction MidLandmark(lm1: Landmark, lm2: Landmark): Landmark {\n  return {\n    x: (lm1.x + lm2.x) / 2,\n    y: (lm1.y + lm2.y) / 2,\n    visibility: ((lm1.visibility ?? 1) + (lm2.visibility ?? 1)) / 2,\n  };\n}\n\nfunction GetLandmark(lm: number, lms: Array<Landmark>) {\n  if (lm >= 0) return lms[lm];\n\n  if (lm === PoseLandmarks.midHip) {\n    return MidLandmark(lms[PoseLandmarks.leftHip], lms[PoseLandmarks.rightHip]);\n  }\n\n  if (lm === PoseLandmarks.midShouder) {\n    return MidLandmark(lms[PoseLandmarks.leftShoulder], lms[PoseLandmarks.rightShoulder]);\n  }\n\n  if (lm === PoseLandmarks.midEye) {\n    return MidLandmark(lms[PoseLandmarks.leftEye], lms[PoseLandmarks.rightEye]);\n  }\n\n  return undefined;\n}\n\nfunction DrawSkeleton(\n  canvasCtx: CanvasRenderingContext2D,\n  width: number,\n  height: number,\n  poseLandmarks: Landmark[],\n  enableSizeVariation: boolean,\n  emphasizedJoints: number[],\n  emphasisStroke?: string,\n) {\n  const w = width;\n  const h = height;\n\n  CONNECTIONS_TO_DRAW.forEach((connection) => {\n    const  p1 = GetLandmark(connection.v0, poseLandmarks);\n    const  p2 = GetLandmark(connection.v1, poseLandmarks);\n\n    if (!p1 || !p2) return;\n    if ((p1.visibility ?? 1) < 0.25 || (p2.visibility ?? 1) < 0.25) {\n      // console.log('skipping b/c of insufficient visibility');\n      return;\n    }\n\n    const emphasized = emphasizedJoints\n    && emphasizedJoints.indexOf(connection.v0) !== -1\n    && emphasizedJoints.indexOf(connection.v1) !== -1;\n\n    canvasCtx.save();\n    if (emphasized && emphasisStroke) {\n      canvasCtx.strokeStyle = emphasisStroke;\n    }\n    if (enableSizeVariation) {\n      canvasCtx.lineWidth *= connection.size;\n    }\n    canvasCtx.beginPath();\n    canvasCtx.moveTo(p1.x * w, p1.y * h);\n    canvasCtx.lineTo(p2.x * w, p2.y * h);\n    canvasCtx.stroke();\n    canvasCtx.restore();\n  });\n}\n\nexport function DrawPose(\n  canvasCtx: CanvasRenderingContext2D,\n  poseLandmarks: Landmark[],\n  options?: {\n    sourceAspectRatio?: number;\n    emphasizedJoints?: number[];\n    emphasisStroke? : string;\n    enableSizeVariation?: boolean;\n    outlineColor?: string;\n  },\n) {\n\n  if (poseLandmarks.length === 0) {\n    return;\n  }\n\n  const jointsWithEmphasis = options?.emphasizedJoints ?? [];\n  const enableSizeVariation = options?.enableSizeVariation ?? false;\n\n  canvasCtx.save();\n  let w = canvasCtx.canvas.width;\n  let h = canvasCtx.canvas.height;\n\n  const sourceAR = options?.sourceAspectRatio;\n  if (sourceAR) {\n    const canvasAR = canvasCtx.canvas.width / canvasCtx.canvas.height;\n\n    if (sourceAR > canvasAR) {\n      // video source is wider than canvas\n      const adjustedHeight = w / sourceAR;\n      const pixelsTaller = h - adjustedHeight;\n      canvasCtx.translate(0, pixelsTaller / 2);\n      h = adjustedHeight;\n\n    } else if (sourceAR < canvasAR) {\n      // video source is taller than canvas\n      const adjustedWidth = sourceAR * h;\n      const pixelsWider = w - adjustedWidth;\n      canvasCtx.translate(pixelsWider / 2, 0);\n      w = adjustedWidth;\n    }\n  }\n\n  if (options?.outlineColor) {\n    canvasCtx.save();\n    canvasCtx.strokeStyle = options.outlineColor;\n    const outlineWidth = Math.max(1, canvasCtx.lineWidth / 10.0);\n    canvasCtx.lineWidth += outlineWidth * 2;\n    DrawSkeleton(canvasCtx, w, h, poseLandmarks, enableSizeVariation, jointsWithEmphasis);\n    canvasCtx.restore();\n  }\n  DrawSkeleton(canvasCtx, w, h, poseLandmarks, enableSizeVariation, jointsWithEmphasis, options?.emphasisStroke);\n\n  // const p1a = poseLandmarks[PoseLandmarks.leftShoulder];\n  // const p1b = poseLandmarks[PoseLandmarks.rightShoulder];\n  // const p2 = poseLandmarks[PoseLandmarks.nose];\n  // if (!p1a || !p1b || !p2) {\n  //   canvasCtx.beginPath();\n  //   canvasCtx.moveTo(w * 0.5 * (p1a.x + p1b.x), h * 0.5 * (p1a.y + p1b.y));\n  //   canvasCtx.lineTo(w * p2.x, h * p2.y);\n  //   canvasCtx.stroke();\n  // }\n\n  canvasCtx.restore();\n}\n\nconst trackingRequests: Record<string, boolean> = {};\nconst trackingCount = () => Object\n  .keys(trackingRequests)\n  .map((id) => trackingRequests[id])\n  .filter((x) => x).length;\n\nlet latestResults: MpHolisticResults | null = null;\nexport function GetLatestResults() {\n  return Object.freeze(latestResults);\n}\n\nexport function StartTracking(videoE: HTMLVideoElement): void {\n  if (trackingStarted) { throw Error('Tracking alread started'); }\n\n  trackingStarted = true;\n  trackingRequests.initial = true;\n\n  let mpInstance: any = null;\n  if (usingHolistic) mpInstance = new mp.Holistic({ locateFile: (file: any) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic@0.1.1613603339/${file}` });\n  else mpInstance = new mp.Pose({ locateFile: (file: any) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.2.1617147663/${file}` });\n\n  mpInstance.setOptions({\n    upperBodyOnly: false,\n    smoothLandmarks: true,\n    minDetectionConfidence: 0.5,\n    minTrackingConfidence: 0.5,\n  });\n\n  let frameId = 0;\n  let timestamp = Date.now();\n  mpInstance.onResults((res: MpHolisticResults) => {\n    trackingRequests.initial = false;\n    latestResults = res;\n    res.timestamp = timestamp;\n    eventHub.emit(EventNames.trackingResults, res, frameId);\n  });\n\n  eventHub.on(EventNames.trackingRequested, (id: string) => {\n    trackingRequests[id] = true;\n  });\n  eventHub.on(EventNames.trackingRequestFinished, (id: string) => {\n    trackingRequests[id] = false;\n  });\n\n  Utils.DoEveryFrame(\n    async () => {\n      frameId += 1;\n      eventHub.emit(EventNames.trackingProcessingStarted, frameId);\n      timestamp = Date.now();\n      if (trackingCount() > 0) await mpInstance.send({ image: videoE });\n    },\n    () => true,\n  );\n}\n\nexport function isTracking() {\n  return trackingCount() > 0;\n}\n","// import parse from 'csv-parse';\n\nimport Parser, { Row } from '@gregoranders/csv';\nimport { Landmark } from '@/services/MediaPipeTypes';\n\nconst VIDEO_EXTENSIONS = ['.mp4', '.m4v', '.mov'];\n\nexport class PoseProvider {\n\n  private poseFiles: Map<string, Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>> = new Map();\n\n  async GetPose(videoName: string) {\n    if (videoName.length < 4) return [];\n\n    let poseFilename = videoName.replace('videos', 'poses');\n    for (let i = 0; i < VIDEO_EXTENSIONS.length; i += 1) {\n      const extension = VIDEO_EXTENSIONS[i];\n      poseFilename = poseFilename.replace(extension, '.pose.csv');\n    }\n\n    const cached = this.poseFiles.get(poseFilename);\n    if (cached !== undefined) return cached;\n\n    const stored = localStorage.getItem(poseFilename);\n    if (stored !== null) {\n      const poses = JSON.parse(stored) as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>;\n      this.poseFiles.set(poseFilename, Object.freeze(poses));\n      return poses;\n    }\n\n    const poseFile = await PoseProvider.getPoseFile(poseFilename);\n    const poses = PoseProvider.convertToPoseList(poseFile);\n\n    this.poseFiles.set(poseFilename, poses);\n\n    // try {\n    //   localStorage.setItem(poseFilename, JSON.stringify(poses));\n    // } catch (e) {\n    //   console.warn('Failed to cache pose file', e);\n    // }\n    return poses;\n  }\n\n  private static async getPoseFile(url: string) {\n\n    const response = await fetch(url);\n    if (!response.ok) throw new Error(`Error fetching pose file: ${response.statusText}`);\n\n    const text = await response.text();\n\n    return new Parser().parse(text);\n  }\n\n  private static convertToPoseList(csv: readonly Row[]) {\n    const temp = csv.map((row) => PoseProvider.convertRow(row));\n    return Object.freeze(temp.filter((x) => x.length > 0));\n  }\n\n  private static convertRow(row: Row) {\n    if (row.length === 0) return [];\n    if (row[0].startsWith('#')) return [];\n\n    const lms = [] as Array<Readonly<Landmark>>;\n    for (let i = 1; i + 2 < row.length; i += 3) {\n      lms.push(\n        Object.freeze({\n          x: Number.parseFloat(row[i]),\n          y: Number.parseFloat(row[i + 1]),\n          visibility: Number.parseFloat(row[i + 2]),\n        }),\n      );\n    }\n\n    return Object.freeze(lms);\n  }\n}\n\nconst poseProvider = new PoseProvider();\n\nexport default poseProvider;\n","\nimport MotionTrail from '@/model/MotionTrail';\nimport { DrawPose } from '@/services/MediaPipe';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport poseProvider from '@/services/PoseProvider';\nimport {\n  computed,\n  defineComponent,\n  toRefs,\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  nextTick,\n  Ref,\n  watch,\n} from 'vue';\n\nfunction onResize(canvasE: HTMLCanvasElement, videoE: HTMLVideoElement, modified: Ref<boolean>) {\n  nextTick(() => {\n    if (!canvasE || !videoE) return;\n\n    if (canvasE.width !== videoE.offsetWidth) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.width = videoE.offsetWidth;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    if (canvasE.height !== videoE.offsetHeight) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.height = videoE.offsetHeight;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    modified.value = true;\n  });\n}\n\nfunction setupCanvasResizing(\n  videoElement: Ref<null | HTMLVideoElement>,\n  canvasElement: Ref<null | HTMLCanvasElement>,\n  modified: Ref<boolean>,\n) {\n  function resizeCanvas() {\n    const videoE = videoElement.value;\n    const canvasE = canvasElement.value;\n    if (videoE && canvasE) onResize(canvasE, videoE, modified);\n  }\n  onMounted(() => {\n    window.addEventListener('resize', resizeCanvas);\n    nextTick(resizeCanvas);\n  });\n  onBeforeUnmount(() => {\n    window.removeEventListener('resize', resizeCanvas);\n  });\n  return resizeCanvas;\n}\n\nfunction setupVideoPlaying(\n  videoElement: Ref<HTMLVideoElement | null>,\n  startTime: Ref<number>,\n  endTime: Ref<number>,\n  startProgressUpdating: () => void,\n  endReported: Ref<boolean>,\n) {\n  function playVideo(\n    from: number,\n    to: number,\n    speed: number,\n  ) {\n    // console.log(`VideoPlayer :: Starting playback from ${from} to ${to} @ ${speed.toPrecision(2)}`);\n\n    // eslint-disable-next-line no-param-reassign\n    endReported.value = false;\n    // eslint-disable-next-line no-param-reassign\n    startTime.value = from;\n    // eslint-disable-next-line no-param-reassign\n    endTime.value = to;\n\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n\n    videoE.pause();\n    videoE.playbackRate = speed;\n    videoE.currentTime = from;\n\n    nextTick(() => {\n      startProgressUpdating();\n      videoE.play();\n    });\n  }\n\n  function pauseVideo() {\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n    videoE.pause();\n  }\n\n  return { playVideo, pauseVideo };\n}\n\nexport default defineComponent({\n  name: 'VideoPlayer',\n  props: {\n    videoBaseUrl: String,\n    motionTrails: {\n      type: Array,\n      default: Array,\n      required: false,\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    fps: {\n      type: Number,\n      default: 30,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: () => {},\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    showControls: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\n    'playback-completed',\n    'progress',\n  ],\n  setup(props, ctx) {\n    const {\n      videoBaseUrl, motionTrails, drawPoseLandmarks, fps, setDrawStyle, emphasizedJoints, emphasizedJointStyle,\n    } = toRefs(props);\n\n    const videoElement = ref(null as null | HTMLVideoElement);\n    const canvasElement = ref(null as null | HTMLCanvasElement);\n    const canvasCtx = computed(() => canvasElement.value?.getContext('2d') as CanvasRenderingContext2D | null);\n\n    const startTime = ref(0);\n    const endTime = ref(0);\n    const videoUrl = computed(() => videoBaseUrl?.value ?? '');\n    const currentTime = ref(0);\n    const canvasModified = ref(false);\n\n    const resizeCanvas = setupCanvasResizing(videoElement, canvasElement, canvasModified);\n    const endReported = ref(false);\n\n    const poses = ref([] as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>);\n    const currentFrame = computed(() => Math.floor(currentTime.value * fps.value));\n    const currentPose = computed(() => {\n      const frame = currentFrame.value;\n      const pose = poses.value[frame] ?? [];\n      return pose;\n    });\n\n    let prevTime = -1;\n    let timerId = -1;\n    function onTimeUpdated(ignoreEnd?: boolean) {\n      const vidElement = videoElement.value;\n      if (!vidElement) return;\n\n      const time = vidElement.currentTime;\n      if (time === prevTime) return;\n      prevTime = time;\n\n      currentTime.value = time;\n\n      if (!ignoreEnd && (time + 1 / 60 >= endTime.value || endReported.value)) {\n        vidElement.pause();\n        vidElement.currentTime = endTime.value; // pin to end time\n        ctx.emit('progress', endTime.value);\n        console.log('VideoPlayer :: playback-completed');\n        ctx.emit('playback-completed');\n        clearInterval(timerId);\n        timerId = -1;\n      } else {\n        ctx.emit('progress', time);\n      }\n    }\n\n    const startProgressUpdating = () => {\n      if (timerId !== -1) clearInterval(timerId);\n      timerId = window.setInterval(onTimeUpdated, 1000 / 30);\n    };\n\n    const { playVideo, pauseVideo } = setupVideoPlaying(\n      videoElement,\n      startTime,\n      endTime,\n      startProgressUpdating,\n      endReported,\n    );\n\n    function scheduleCanvasResizing() {\n      setTimeout(() => {\n        nextTick(resizeCanvas);\n      }, 100);\n    }\n\n    // Update pose drawing\n    function clearDrawing() {\n      const canvasE = canvasElement.value;\n      const drawCtx = canvasCtx.value;\n      if (!canvasE || !drawCtx) return;\n      drawCtx.clearRect(0, 0, canvasE.width, canvasE.height);\n    }\n    function drawPose(lms: Landmark[]) {\n      const videoE = videoElement.value;\n      const sourceAR = (videoE?.videoHeight && videoE.videoHeight) ? videoE.videoWidth / videoE.videoHeight : 1;\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n      setDrawStyle.value(drawCtx);\n      DrawPose(drawCtx, lms, {\n        emphasizedJoints: emphasizedJoints.value as number[],\n        emphasisStroke: emphasizedJointStyle.value,\n        sourceAspectRatio: sourceAR,\n        outlineColor: 'black',\n      });\n    }\n\n    const retieveClearPoseFile = async () => {\n      if (!drawPoseLandmarks.value) {\n        poses.value = [];\n        return;\n      }\n\n      // try {\n      poses.value = await poseProvider.GetPose(videoBaseUrl?.value ?? '');\n      // } catch (e) {\n      // console.error(\"Couldn't get poses: \", e);\n      // }\n    };\n\n    function drawMotionTrail(trail: MotionTrail) {\n      const videoE = videoElement.value;\n      const sourceAR = (videoE?.videoHeight && videoE.videoHeight) ? videoE.videoWidth / videoE.videoHeight : 1;\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n    }\n\n    watch([videoBaseUrl, drawPoseLandmarks], retieveClearPoseFile);\n    onMounted(retieveClearPoseFile);\n\n    watch([canvasModified, currentPose, drawPoseLandmarks, motionTrails], () => {\n      canvasModified.value = false;\n      clearDrawing();\n\n      if (drawPoseLandmarks.value) {\n        drawPose(currentPose.value as any);\n      }\n\n      if (motionTrails.value) {\n        for (let i = 0; i < motionTrails.value.length; i += 1) {\n          const trail = motionTrails.value[i];\n          drawMotionTrail(trail as any);\n        }\n      }\n    });\n\n    let resizeTimerId = -1;\n    onMounted(() => {\n      resizeTimerId = window.setInterval(resizeCanvas, 500);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(resizeTimerId);\n    });\n\n    return {\n      videoUrl,\n      resizeCanvas,\n      videoElement,\n      canvasElement,\n      playVideo,\n      pauseVideo,\n      endTime,\n      scheduleCanvasResizing,\n      poses,\n      currentTime,\n      currentPose,\n      currentFrame,\n      endReported,\n      onTimeUpdated,\n\n      getVideoDimensions: () => ({\n        height: videoElement.value?.height ?? 0,\n        width: videoElement.value?.width ?? 0,\n      }),\n    };\n  },\n  methods: {\n    setTime(time: number, keepPlaying?: boolean | undefined) {\n      const videoE = this.videoElement;\n      if (videoE) {\n        videoE.currentTime = time;\n      }\n      const pauseVideo = !(keepPlaying ?? false);\n      if (videoE && pauseVideo) videoE.pause();\n    },\n    getVideoTime() {\n      return this.videoElement?.currentTime ?? 0;\n    },\n  },\n});\n","import { render } from \"./VideoPlayer.vue?vue&type=template&id=149685e0\"\nimport script from \"./VideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./VideoPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./VideoPlayer.vue?vue&type=style&index=0&id=149685e0&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport Constants from '@/services/Constants';\nimport { PauseInfo } from '@/model/MiniLesson';\nimport {\n  computed, defineComponent, onBeforeUnmount, ref,\n} from 'vue';\nimport VideoPlayer from './VideoPlayer.vue';\n\nconst DEFAULT_PAUSE_DURATION = Constants.DefaultPauseDuration;\n\ntype PlaySegment = {\n  from: number;\n  to: number;\n  speed: number;\n  pause: PauseInfo | null;\n}\nfunction computePlaySegments(from: number, to: number, speed: number, pauses: PauseInfo[]) {\n  const segs: PlaySegment[] = [];\n\n  function nextPauseIndex(prevIndex: number): number {\n    const pTime = Math.max((pauses[prevIndex]?.time ?? 0), from);\n    let pauseIndex = prevIndex + 1;\n    for (; pauseIndex < pauses.length; pauseIndex += 1) {\n      const pi = pauses[pauseIndex];\n      if (pi.time > pTime) break;\n    }\n    return pauseIndex;\n  }\n\n  let segStartTime = from;\n  let pauseIndex = nextPauseIndex(-1);\n  while (pauseIndex < pauses.length) {\n    segs.push({\n      from: segStartTime,\n      to: pauses[pauseIndex].time,\n      speed,\n      pause: pauses[pauseIndex],\n    });\n    segStartTime = pauses[pauseIndex].time;\n    pauseIndex = nextPauseIndex(pauseIndex);\n  }\n  segs.push({\n    from: segStartTime,\n    to,\n    speed,\n    pause: null,\n  });\n\n  return segs;\n}\n\nexport default defineComponent({\n  name: 'PausingVideoPlayer',\n  components: { VideoPlayer },\n  props: {\n    videoSrc: {\n      default: '',\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: (canvasCtx: CanvasRenderingContext2D) => {\n        if (!canvasCtx) return;\n\n        /* eslint-disable no-param-reassign */\n        canvasCtx.strokeStyle = 'rgba(250, 200, 250, 0.95)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n        /* eslint-enable no-param-reassign */\n      },\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    showControls: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['playback-completed', 'progress', 'pause-hit', 'pause-end'],\n  setup(props, { emit }) {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n\n    let playTimeoutId = undefined as undefined | number;\n\n    function setTime(time: number) {\n      const vidPlayer = videoPlayer.value;\n      clearTimeout(playTimeoutId);\n      if (vidPlayer) vidPlayer.setTime(time);\n      emit('progress', time);\n    }\n\n    function onProgress(time: number) {\n      emit('progress', time);\n    }\n\n    function playSegment(seg: PlaySegment, delaySecs: number, emitResume?: boolean, onPlayStart?: () => void) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n\n      clearTimeout(playTimeoutId);\n      playTimeoutId = window.setTimeout(() => {\n        if (emitResume ?? false) {\n          emit('pause-end');\n        }\n        vidPlayer.playVideo(seg.from, seg.to, seg.speed);\n        if (onPlayStart) onPlayStart();\n      }, 1000 * delaySecs);\n    }\n    onBeforeUnmount(() => {\n      clearTimeout(playTimeoutId);\n    });\n\n    let playingSegments: PlaySegment[] = [];\n    let playingSegmentIndex = 0;\n\n    function play(\n      from: number,\n      to: number,\n      speed: number,\n      pauses: Array<PauseInfo>,\n      playDelaySecs: number,\n      onPlayStart?: () => void,\n    ) {\n      clearTimeout(playTimeoutId);\n      setTime(from);\n      playingSegments = computePlaySegments(from, to, speed, pauses);\n      playingSegmentIndex = 0;\n\n      playSegment(playingSegments[playingSegmentIndex], playDelaySecs, false, onPlayStart);\n    }\n    function onSegmentPlaybackCompleted() {\n      const { pause, to } = playingSegments[playingSegmentIndex];\n      playingSegmentIndex += 1;\n      if (playingSegmentIndex >= playingSegments.length) {\n        setTime(to);\n        emit('playback-completed');\n        return;\n      }\n\n      if (!pause) throw new Error('Expected there to be a pause obj');\n      const nextSeg = playingSegments[playingSegmentIndex];\n\n      emit('pause-hit', pause);\n      const manualResume = pause.manualResume ?? false;\n      if (!manualResume) {\n        playSegment(nextSeg, pause.pauseDuration ?? DEFAULT_PAUSE_DURATION, true);\n      }\n    }\n\n    const currentPose = computed(() => videoPlayer.value?.currentPose ?? null);\n\n    return {\n      videoPlayer,\n      setTime,\n      onProgress,\n      onSegmentPlaybackCompleted,\n      play,\n      currentPose,\n    };\n  },\n  methods: {\n    getVideoDimensions() {\n      return (this.$refs.videoPlayer as typeof VideoPlayer)?.getVideoDimensions();\n    },\n    getVideoTime(): number {\n      return (this.videoPlayer as any)?.getVideoTime() ?? 0;\n    },\n  },\n});\n","import { render } from \"./PausingVideoPlayer.vue?vue&type=template&id=43a8290f\"\nimport script from \"./PausingVideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./PausingVideoPlayer.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"keyframe-timeline-container\">\n    <div class=\"timeline\">\n      <!-- {{dbEntry.title}} -->\n\n      <!-- <span class=\"item\">\n        <VideoPlayer :videoBaseUrl=\"dbEntry?.videoSrc + '#t=' + currentKeyframe\"\n          :videoOpacity=\"drawMode === 'video' ? 1.0 : 0\"\n          :setDrawStyle=\"setKFSkeletonDrawStyle\"\n          :fps=\"dbEntry.fps\"\n          :drawPoseLandmarks=\"drawMode === 'skeleton'\"/>\n      </span> -->\n      <span\n        class=\"item\"\n        v-for=\"(kfitem) in allKeyframes\"\n        :key=\"kfitem.kf\"\n        :style=\"{\n          'left': 'calc(-14rem + ' + 100 * kfitem.left + '%)',\n          'opacity': kfitem.opacity,\n          'width': '14rem',\n        }\">\n        <VideoPlayer\n          :videoBaseUrl=\"dbEntry?.videoSrc + '#t=' + kfitem.kf\"\n          :fps=\"dbEntry.fps\"\n          :drawPoseLandmarks=\"drawMode === 'skeleton'\"\n          :videoOpacity=\"drawMode === 'video' ? 1.0 : 0\"\n          :setDrawStyle=\"setKFSkeletonDrawStyle\"\n        />\n        <p v-if=\"showTimestamps\" class=\"has-text-centered\">\n          <span class=\"tag\">{{kfitem.kf.toFixed(2)}}s</span>\n        </p>\n        </span>\n      <!-- <span\n        class=\"item\"\n        v-for=\"(kfitem, i) in farFutureKeyframes\"\n        :key=\"i\"\n        :style=\"{\n          'right': (i*10) + 'px',\n          'z-index': -i,\n        }\"\n        >{{farFutureKeyframes.length}}</span> -->\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed,\n  defineComponent, Ref, toRefs,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'KeyframeTimeline',\n  components: {\n    VideoPlayer,\n  },\n  props: {\n    drawMode: {\n      type: String,\n      default: 'skeleton',\n    },\n    timelineActiveItemsLimit: {\n      type: Number,\n      default: 1,\n    },\n    dbEntry: {\n      type: Object,\n      required: true,\n    },\n    keyframes: {\n      type: Array,\n      default: () => [],\n    },\n    currentTime: {\n      type: Number,\n      default: 0,\n    },\n    maxActiveTimelineSecs: {\n      type: Number,\n      default: 2.5,\n    },\n    showTimestamps: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  setup(props) {\n    const minStackItems = 3;\n    const {\n      keyframes, currentTime, maxActiveTimelineSecs, timelineActiveItemsLimit,\n    } = toRefs(props);\n\n    const keyframesTyped = keyframes as Ref<number[]>;\n\n    const currentKeyframe = computed(() => keyframesTyped.value.find((kf, index) => (\n      kf < currentTime.value\n      && (keyframesTyped.value[index + 1] === undefined || keyframesTyped.value[index + 1] >= currentTime.value)\n    )) ?? null);\n\n    const futureKeyframes = computed(() => keyframesTyped.value\n      .map((kf) => ({\n        timeRemaining: kf - currentTime.value,\n        kf,\n      }))\n      .filter((item) => item.timeRemaining > 0));\n\n    const separatedKeyframes = computed(() => {\n      let separationIndex = futureKeyframes.value.findIndex(\n        (kf, i) => i >= timelineActiveItemsLimit.value || kf.timeRemaining > maxActiveTimelineSecs.value,\n      );\n      separationIndex = separationIndex === -1 ? futureKeyframes.value.length : separationIndex;\n      const active = futureKeyframes.value.slice(0, separationIndex);\n      const future = futureKeyframes.value.slice(separationIndex, separationIndex + minStackItems);\n\n      let timelineTime = maxActiveTimelineSecs.value;\n      if (timelineActiveItemsLimit.value === 1 && active.length > 0) {\n        const lastKfTime = currentKeyframe.value ?? 0;\n        const nextKfTime = active[0].kf;\n        const timeTONextKf = nextKfTime - lastKfTime;\n        timelineTime = Math.min(timelineTime, timeTONextKf);\n      }\n      const lastScrollingKf = active[active.length - 1]?.kf;\n\n      return {\n        separationIndex,\n        activeKeyframes: active.map((kfitem) => ({\n          ...kfitem,\n          left: kfitem.timeRemaining / timelineTime,\n          opacity: 1,\n        })),\n        stackTimeline: future.map((kfitem, i) => ({\n          ...kfitem,\n          left: 1.0,\n          // eslint-disable-next-line no-nested-ternary\n          opacity: i > 0 ? 0\n            : (lastScrollingKf\n              ? (kfitem.kf - lastScrollingKf) / 1.5\n              : 1),\n        })),\n      };\n    });\n\n    const allKeyframes = computed(\n      () => {\n        const current = [];\n        if (currentKeyframe.value !== null) {\n          current.push({\n            kf: currentKeyframe.value,\n            timeRemaining: 0,\n            opacity: 1,\n            left: 0,\n          });\n        }\n        const timeline = separatedKeyframes.value.activeKeyframes;\n        timeline.reverse();\n\n        const stack = separatedKeyframes.value.stackTimeline;\n        stack.reverse();\n\n        return [...stack, ...current, ...timeline];\n      },\n    );\n\n    return {\n      currentKeyframe,\n      allKeyframes,\n      separatedKeyframes,\n      futureKeyframes,\n      // currentKeyframe,\n      // futureKeyframes,\n      // activeKeyframes,\n      // stackTimeline,\n\n      setKFSkeletonDrawStyle: (canvasCtx: CanvasRenderingContext2D) => {\n        canvasCtx.strokeStyle = 'rgba(100, 250, 250, 1)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n      },\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.keyframe-timeline-container {\n  position: relative;\n  // height: 50%;\n  // margin-top: 25%;\n  width: 100%;\n\n  .timeline {\n    // padding-top: 25%;\n    height: 14rem;\n    margin-left: 14rem;\n    // background: gray;\n    position: relative;\n\n    .item {\n      display: block;\n      // background: lightgray;\n      position: absolute;\n      height: 100%;\n      min-width: 1rem;\n      border-radius: 0.25rem;\n      border: 1px sold lightgray;\n    }\n\n    .placeholder {\n      display: block;\n      position: absolute;\n      height: 100%;\n      min-width: 1rem;\n      border-radius: 0.25rem;\n      border: 1px solid gray;\n    }\n  }\n}\n</style>\n","\n\nimport {\n  computed,\n  defineComponent, Ref, toRefs,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'KeyframeTimeline',\n  components: {\n    VideoPlayer,\n  },\n  props: {\n    drawMode: {\n      type: String,\n      default: 'skeleton',\n    },\n    timelineActiveItemsLimit: {\n      type: Number,\n      default: 1,\n    },\n    dbEntry: {\n      type: Object,\n      required: true,\n    },\n    keyframes: {\n      type: Array,\n      default: () => [],\n    },\n    currentTime: {\n      type: Number,\n      default: 0,\n    },\n    maxActiveTimelineSecs: {\n      type: Number,\n      default: 2.5,\n    },\n    showTimestamps: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  setup(props) {\n    const minStackItems = 3;\n    const {\n      keyframes, currentTime, maxActiveTimelineSecs, timelineActiveItemsLimit,\n    } = toRefs(props);\n\n    const keyframesTyped = keyframes as Ref<number[]>;\n\n    const currentKeyframe = computed(() => keyframesTyped.value.find((kf, index) => (\n      kf < currentTime.value\n      && (keyframesTyped.value[index + 1] === undefined || keyframesTyped.value[index + 1] >= currentTime.value)\n    )) ?? null);\n\n    const futureKeyframes = computed(() => keyframesTyped.value\n      .map((kf) => ({\n        timeRemaining: kf - currentTime.value,\n        kf,\n      }))\n      .filter((item) => item.timeRemaining > 0));\n\n    const separatedKeyframes = computed(() => {\n      let separationIndex = futureKeyframes.value.findIndex(\n        (kf, i) => i >= timelineActiveItemsLimit.value || kf.timeRemaining > maxActiveTimelineSecs.value,\n      );\n      separationIndex = separationIndex === -1 ? futureKeyframes.value.length : separationIndex;\n      const active = futureKeyframes.value.slice(0, separationIndex);\n      const future = futureKeyframes.value.slice(separationIndex, separationIndex + minStackItems);\n\n      let timelineTime = maxActiveTimelineSecs.value;\n      if (timelineActiveItemsLimit.value === 1 && active.length > 0) {\n        const lastKfTime = currentKeyframe.value ?? 0;\n        const nextKfTime = active[0].kf;\n        const timeTONextKf = nextKfTime - lastKfTime;\n        timelineTime = Math.min(timelineTime, timeTONextKf);\n      }\n      const lastScrollingKf = active[active.length - 1]?.kf;\n\n      return {\n        separationIndex,\n        activeKeyframes: active.map((kfitem) => ({\n          ...kfitem,\n          left: kfitem.timeRemaining / timelineTime,\n          opacity: 1,\n        })),\n        stackTimeline: future.map((kfitem, i) => ({\n          ...kfitem,\n          left: 1.0,\n          // eslint-disable-next-line no-nested-ternary\n          opacity: i > 0 ? 0\n            : (lastScrollingKf\n              ? (kfitem.kf - lastScrollingKf) / 1.5\n              : 1),\n        })),\n      };\n    });\n\n    const allKeyframes = computed(\n      () => {\n        const current = [];\n        if (currentKeyframe.value !== null) {\n          current.push({\n            kf: currentKeyframe.value,\n            timeRemaining: 0,\n            opacity: 1,\n            left: 0,\n          });\n        }\n        const timeline = separatedKeyframes.value.activeKeyframes;\n        timeline.reverse();\n\n        const stack = separatedKeyframes.value.stackTimeline;\n        stack.reverse();\n\n        return [...stack, ...current, ...timeline];\n      },\n    );\n\n    return {\n      currentKeyframe,\n      allKeyframes,\n      separatedKeyframes,\n      futureKeyframes,\n      // currentKeyframe,\n      // futureKeyframes,\n      // activeKeyframes,\n      // stackTimeline,\n\n      setKFSkeletonDrawStyle: (canvasCtx: CanvasRenderingContext2D) => {\n        canvasCtx.strokeStyle = 'rgba(100, 250, 250, 1)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n      },\n    };\n  },\n});\n","import { render } from \"./KeyframeTimeline.vue?vue&type=template&id=1326a96d\"\nimport script from \"./KeyframeTimeline.vue?vue&type=script&lang=ts\"\nexport * from \"./KeyframeTimeline.vue?vue&type=script&lang=ts\"\n\nimport \"./KeyframeTimeline.vue?vue&type=style&index=0&id=1326a96d&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"webcam-box-container\">\n    <video\n      ref=\"videoE\" muted disablePictureInPicture\n      :style=\"{\n        'max-width': '100%',\n      }\"\n    ></video>\n    <div class=\"is-overlay\" v-if=\"webcamStatus !== 'running'\">\n      <div class=\"vcenter-parent\">\n        <div class=\"notification\" v-if=\"this.webcamStartError !== null\">\n          {{this.webcamStartError}}\n        </div>\n        <button\n          v-if=\"showStartWebcamButton\"\n          @click=\"startWebcam\"\n          class=\"button is-primary\"\n          v-show=\"webcamStatus !== 'running'\"\n          :class=\"{'is-loading': webcamStatus==='loading'}\">\n          Start Webcam\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, ref, watch,\n} from 'vue';\n\nimport webcamProvider from '@/services/WebcamProvider';\n\nexport default defineComponent({\n  name: 'WebcamBox',\n  props: {\n    showStartWebcamButton: {\n      type: Boolean,\n      default: true,\n    },\n    enableRecordButton: {\n      type: Boolean,\n      default: false,\n    },\n    maxHeight: {\n      type: String,\n    },\n  },\n  setup() {\n    // const enableRecordButton = toRefs(props);\n\n    const videoE = ref(null as null | HTMLVideoElement);\n    const webcamStartError = ref(null as null | any);\n\n    onMounted(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      if (webcamProvider.webcamStatus.value === 'running') {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    watch(webcamProvider.webcamStatus, (status) => {\n      if (status === 'running' && videoE.value) {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    onBeforeUnmount(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      webcamProvider.disconnectVideoElement(videoE.value);\n    });\n\n    return {\n      videoE,\n      webcamStartError,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n    };\n  },\n  computed: {\n    webcamStarted() {\n      return (this as any).webcamStatus === 'stopped';\n    },\n  },\n  methods: {\n    async startWebcam() {\n      this.webcamStartError = null;\n\n      try {\n        await webcamProvider.startWebcam();\n      } catch (e) {\n        this.webcamStartError = e;\n        return e;\n      }\n\n      if (!this.videoE) throw new Error('videoE is null');\n      await webcamProvider.connectVideoElement(this.videoE);\n\n      return false;\n    },\n    playVideo() {\n      if (!this.videoE) throw new Error('videoE is null');\n      this.videoE.play();\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.webcam-box-container {\n\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: center;\n  align-items: center;\n\n  // max-width: 100%;\n\n  video {\n    background: rgba(128, 128, 128, 0.2);\n    flex: 1 1 auto;\n    max-height: 100%;\n    // width: 1280px;\n    // height: 720px;\n    // max-height: 100%;\n    // max-width: 100%;\n\n    transform: scaleX(-1);\n  }\n}\n</style>\n","\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, ref, watch,\n} from 'vue';\n\nimport webcamProvider from '@/services/WebcamProvider';\n\nexport default defineComponent({\n  name: 'WebcamBox',\n  props: {\n    showStartWebcamButton: {\n      type: Boolean,\n      default: true,\n    },\n    enableRecordButton: {\n      type: Boolean,\n      default: false,\n    },\n    maxHeight: {\n      type: String,\n    },\n  },\n  setup() {\n    // const enableRecordButton = toRefs(props);\n\n    const videoE = ref(null as null | HTMLVideoElement);\n    const webcamStartError = ref(null as null | any);\n\n    onMounted(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      if (webcamProvider.webcamStatus.value === 'running') {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    watch(webcamProvider.webcamStatus, (status) => {\n      if (status === 'running' && videoE.value) {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    onBeforeUnmount(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      webcamProvider.disconnectVideoElement(videoE.value);\n    });\n\n    return {\n      videoE,\n      webcamStartError,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n    };\n  },\n  computed: {\n    webcamStarted() {\n      return (this as any).webcamStatus === 'stopped';\n    },\n  },\n  methods: {\n    async startWebcam() {\n      this.webcamStartError = null;\n\n      try {\n        await webcamProvider.startWebcam();\n      } catch (e) {\n        this.webcamStartError = e;\n        return e;\n      }\n\n      if (!this.videoE) throw new Error('videoE is null');\n      await webcamProvider.connectVideoElement(this.videoE);\n\n      return false;\n    },\n    playVideo() {\n      if (!this.videoE) throw new Error('videoE is null');\n      this.videoE.play();\n    },\n  },\n});\n","import { render } from \"./WebcamBox.vue?vue&type=template&id=3220b28b\"\nimport script from \"./WebcamBox.vue?vue&type=script&lang=ts\"\nexport * from \"./WebcamBox.vue?vue&type=script&lang=ts\"\n\nimport \"./WebcamBox.vue?vue&type=style&index=0&id=3220b28b&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"sheet-motion\">\n    <div\n      class=\"motion-line has-text-centered\"\n      :style=\"{\n        'flex-grow': getPhraseFlexGrow(i),\n      }\"\n      v-for=\"(phrase, i) in data.phrases\"\n      :key=\"i\">\n      <!-- <div>{{phrase}}</div> -->\n\n      <div class=\"motion-note\" v-for=\"(kf, j) in phrase.frames\" :key=\"kf\"\n      :style=\"{\n        'background': getFrameBackground(i, j),\n        'flex-grow': getFrameFlexGrow(i, j),\n      }\">\n\n        <VideoPlayer\n          :videoBaseUrl=\"dbEntry?.videoSrc + '#t=' + kf.timestamp\"\n          :fps=\"dbEntry?.fps ?? 30\"\n          :drawPoseLandmarks=\"drawMode === 'skeleton'\"\n          :videoOpacity=\"drawMode === 'video' && kf.type === 'move' ? 1.0 : 0.0\"\n          style=\"margin: 0; display:inline-block;background:lightgray;\"/>\n          <!-- {{kf}} -->\n\n        <div class=\"motion-hold\"></div>\n          <!-- <p class=\"tag is-selectable\">{{getFrameBackground(i, j)}}</p> -->\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nfunction constrain(val: number, min: number, max: number) {\n  return Math.min(Math.max(val, min), max);\n}\nfunction remap(val: number, min: number, max: number, newMin: number, newMax: number) {\n  return ((val - min) / (max - min)) * (newMax - newMin) + newMin;\n}\n\nexport default defineComponent({\n  name: 'SheetMotion',\n  components: {\n    VideoPlayer,\n  },\n  props: {\n    dbEntry: {\n      type: Object,\n      required: true,\n    },\n    currentTime: {\n      type: Number,\n      default: -1,\n    },\n    drawMode: {\n      type: String,\n      default: 'video',\n    },\n    data: {\n      type: Object,\n      default: () => ({\n        kfsByStage: [[]],\n      }),\n    },\n    fadeInDurationSecs: {\n      type: Number,\n      default: 0.5,\n    },\n    fadeOutDurationSecs: {\n      type: Number,\n      default: 0.5,\n    },\n  },\n  methods: {\n    isActive(kf: number, nextkf: number) {\n      return this.currentTime >= kf && this.currentTime < nextkf;\n    },\n    getPhraseFlexGrow(phraseIndex: number) {\n      if (!this.data.variableLength) return 0;\n\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) return 0;\n      const nPhrase = this.data.phrases[phraseIndex + 1];\n      if (!nPhrase) return 0;\n\n      const phraseStartTime = phrase.frames[0]?.timestamp ?? Infinity;\n      const nPhraseStartTime = nPhrase.frames[0]?.timestamp ?? Infinity;\n      if (phraseStartTime === Infinity || nPhraseStartTime === Infinity) return 0;\n\n      return nPhraseStartTime - phraseStartTime;\n    },\n    getFrameFlexGrow(phraseIndex: number, kfIndex: number) {\n      if (!this.data.variableLength) return 0;\n\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) {\n        console.warn(`NoteFlexGrow ${phraseIndex}-${kfIndex}: current phrase is undefined`);\n        return 0;\n      }\n      const nPhrase = this.data.phrases[phraseIndex + 1];\n\n      const curFrame = phrase.frames[kfIndex];\n      if (!curFrame) {\n        console.warn(`NoteFlexGrow ${phraseIndex}-${kfIndex}: current kf is undefined`);\n        return 0;\n      }\n      const kf = curFrame.timestamp;\n      let nextKf = phrase.frames[kfIndex + 1]?.timestamp ?? Infinity;\n      if (nextKf === Infinity && nPhrase) {\n        nextKf = nPhrase.frames[0]?.timestamp ?? Infinity;\n      }\n      if (nextKf === Infinity) {\n        // console.log(`NoteFlexGrow ${phraseIndex}-${kfIndex}: next kf is undefined`);\n        return 0;\n      }\n\n      const res = nextKf - kf;\n      if (res < 0) {\n        console.log(`NoteFlexGrow ${phraseIndex}-${kfIndex}: next kf is before this one`);\n        return 0;\n      }\n      return res * 100;\n    },\n    getFrameBackground(phraseIndex: number, kfIndex: number) {\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) return 1.0;\n\n      // const prev = phrase.frames[index - 1] ?? -Infinity;\n      const curr = phrase.frames[kfIndex]?.timestamp ?? -Infinity;\n      let next = phrase.frames[kfIndex + 1]?.timestamp ?? Infinity;\n      if (next === Infinity) {\n        const nPhrase = this.data.phrases[phraseIndex + 1];\n        if (nPhrase) {\n          next = nPhrase.frames[0]?.timestamp ?? Infinity;\n        }\n      }\n\n      // https://gist.github.com/gre/1650294\n\n      if (this.currentTime === -1) return 'none';\n      if (this.currentTime < curr) {\n        const timeUntil = curr - this.currentTime;\n        let fadePercent = constrain(timeUntil / this.fadeInDurationSecs, 0, 1);\n        fadePercent *= (2 - fadePercent);\n        const saturation = remap(fadePercent, 0, 1, 80.0, 0.0);\n        return `hsl(171, ${saturation}%, 90%)`;\n      }\n      if (this.currentTime < next) return 'hsl(171, 100%, 50%)';\n\n      const timePassed = this.currentTime - curr;\n      const fadePercent = constrain(timePassed / this.fadeOutDurationSecs, 0, 1);\n      const brightness = remap(fadePercent, 0, 1, 50.0, 90.0);\n      const saturation = remap(fadePercent, 0, 1, 100.0, 0.0);\n      return `hsl(171, ${saturation}%, ${brightness}%)`;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.sheet-motion {\n  max-height: 100%;\n  overflow-y: auto;\n  display: flex;\n  flex-flow: row wrap;\n\n  .motion-line {\n\n    display: inline-flex;\n    flex-flow: row wrap;\n\n    border-top: 0.125rem solid #333;\n    border-bottom: 0.125rem solid #333;\n    border-right: 0.125rem solid #333;\n    border-left: 0.125rem solid #333;\n    padding: 1rem 1rem;\n    flex-grow: 1;\n\n    .motion-note {\n      // width: 8rem;\n      display: flex;\n      flex-flow: row nowrap;\n      padding: 0.5rem;\n      margin: 0.25rem;\n      border-radius: 0.25rem;\n      height: 15rem;\n      text-align:left;\n      align-items: center;\n\n      transition: background-color 0.1s;\n\n      .motion-hold {\n        display: inline-block;\n        // width: 100%;\n        height: 0.25rem;\n        border-radius: 999999rem;;\n        background: #777;\n        flex-grow: 1;\n        flex-basis: 0;\n      }\n    }\n\n    &:first-child {\n      border-left: 1rem solid #333;\n    }\n\n    &:last-child {\n      border-right: 1rem solid #333;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent } from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nfunction constrain(val: number, min: number, max: number) {\n  return Math.min(Math.max(val, min), max);\n}\nfunction remap(val: number, min: number, max: number, newMin: number, newMax: number) {\n  return ((val - min) / (max - min)) * (newMax - newMin) + newMin;\n}\n\nexport default defineComponent({\n  name: 'SheetMotion',\n  components: {\n    VideoPlayer,\n  },\n  props: {\n    dbEntry: {\n      type: Object,\n      required: true,\n    },\n    currentTime: {\n      type: Number,\n      default: -1,\n    },\n    drawMode: {\n      type: String,\n      default: 'video',\n    },\n    data: {\n      type: Object,\n      default: () => ({\n        kfsByStage: [[]],\n      }),\n    },\n    fadeInDurationSecs: {\n      type: Number,\n      default: 0.5,\n    },\n    fadeOutDurationSecs: {\n      type: Number,\n      default: 0.5,\n    },\n  },\n  methods: {\n    isActive(kf: number, nextkf: number) {\n      return this.currentTime >= kf && this.currentTime < nextkf;\n    },\n    getPhraseFlexGrow(phraseIndex: number) {\n      if (!this.data.variableLength) return 0;\n\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) return 0;\n      const nPhrase = this.data.phrases[phraseIndex + 1];\n      if (!nPhrase) return 0;\n\n      const phraseStartTime = phrase.frames[0]?.timestamp ?? Infinity;\n      const nPhraseStartTime = nPhrase.frames[0]?.timestamp ?? Infinity;\n      if (phraseStartTime === Infinity || nPhraseStartTime === Infinity) return 0;\n\n      return nPhraseStartTime - phraseStartTime;\n    },\n    getFrameFlexGrow(phraseIndex: number, kfIndex: number) {\n      if (!this.data.variableLength) return 0;\n\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) {\n        console.warn(`NoteFlexGrow ${phraseIndex}-${kfIndex}: current phrase is undefined`);\n        return 0;\n      }\n      const nPhrase = this.data.phrases[phraseIndex + 1];\n\n      const curFrame = phrase.frames[kfIndex];\n      if (!curFrame) {\n        console.warn(`NoteFlexGrow ${phraseIndex}-${kfIndex}: current kf is undefined`);\n        return 0;\n      }\n      const kf = curFrame.timestamp;\n      let nextKf = phrase.frames[kfIndex + 1]?.timestamp ?? Infinity;\n      if (nextKf === Infinity && nPhrase) {\n        nextKf = nPhrase.frames[0]?.timestamp ?? Infinity;\n      }\n      if (nextKf === Infinity) {\n        // console.log(`NoteFlexGrow ${phraseIndex}-${kfIndex}: next kf is undefined`);\n        return 0;\n      }\n\n      const res = nextKf - kf;\n      if (res < 0) {\n        console.log(`NoteFlexGrow ${phraseIndex}-${kfIndex}: next kf is before this one`);\n        return 0;\n      }\n      return res * 100;\n    },\n    getFrameBackground(phraseIndex: number, kfIndex: number) {\n      const phrase = this.data.phrases[phraseIndex];\n      if (!phrase) return 1.0;\n\n      // const prev = phrase.frames[index - 1] ?? -Infinity;\n      const curr = phrase.frames[kfIndex]?.timestamp ?? -Infinity;\n      let next = phrase.frames[kfIndex + 1]?.timestamp ?? Infinity;\n      if (next === Infinity) {\n        const nPhrase = this.data.phrases[phraseIndex + 1];\n        if (nPhrase) {\n          next = nPhrase.frames[0]?.timestamp ?? Infinity;\n        }\n      }\n\n      // https://gist.github.com/gre/1650294\n\n      if (this.currentTime === -1) return 'none';\n      if (this.currentTime < curr) {\n        const timeUntil = curr - this.currentTime;\n        let fadePercent = constrain(timeUntil / this.fadeInDurationSecs, 0, 1);\n        fadePercent *= (2 - fadePercent);\n        const saturation = remap(fadePercent, 0, 1, 80.0, 0.0);\n        return `hsl(171, ${saturation}%, 90%)`;\n      }\n      if (this.currentTime < next) return 'hsl(171, 100%, 50%)';\n\n      const timePassed = this.currentTime - curr;\n      const fadePercent = constrain(timePassed / this.fadeOutDurationSecs, 0, 1);\n      const brightness = remap(fadePercent, 0, 1, 50.0, 90.0);\n      const saturation = remap(fadePercent, 0, 1, 100.0, 0.0);\n      return `hsl(171, ${saturation}%, ${brightness}%)`;\n    },\n  },\n});\n","import { render } from \"./SheetMotion.vue?vue&type=template&id=bcae77ce\"\nimport script from \"./SheetMotion.vue?vue&type=script&lang=ts\"\nexport * from \"./SheetMotion.vue?vue&type=script&lang=ts\"\n\nimport \"./SheetMotion.vue?vue&type=style&index=0&id=bcae77ce&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  computed, defineComponent, ref, toRefs, watchEffect,\n} from 'vue';\nimport InstructionCarousel, { Instruction } from '@/components/elements/InstructionCarousel.vue';\nimport PausingVideoPlayer from '@/components/elements/PausingVideoPlayer.vue';\nimport KeyframeTimeline from '@/components/elements/KeyframeTimeline.vue';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\nimport SheetMotion from '@/components/elements/SheetMotion.vue';\nimport { MiniLessonActivity, PauseInfo } from '@/model/MiniLesson';\nimport Constants from '@/services/Constants';\n\nconst ActivityPlayState = Object.freeze({\n  AwaitingStart: 'AwaitingStart',\n  PendingStart: 'PendingStart',\n  Playing: 'Playing',\n  ActivityEnded: 'ActivityEnded',\n});\n\nexport default defineComponent({\n  name: 'ActivityVideoPlayer',\n  emits: ['progress', 'activityEnded'],\n  props: {\n    motion: { type: Object },\n    activity: { type: Object },\n    defaultPauseDuration: { type: Number, default: 1.5 },\n    maxHeight: { type: String, default: '400px' },\n  },\n  components: {\n    PausingVideoPlayer,\n    InstructionCarousel,\n    WebcamBox,\n    KeyframeTimeline,\n    SheetMotion,\n  },\n  setup(props) {\n    const { activity } = toRefs(props);\n    const state = ref(ActivityPlayState.AwaitingStart);\n    const activityFinished = computed(() => state.value === ActivityPlayState.ActivityEnded);\n    const awaitingStart = computed(() => state.value === ActivityPlayState.AwaitingStart);\n    const isPlaying = computed(() => state.value === ActivityPlayState.Playing);\n    const isPendingStart = computed(() => state.value === ActivityPlayState.PendingStart);\n    const videoPlayer = ref(null as null | typeof PausingVideoPlayer);\n    const webcamBox = ref(null as null | typeof WebcamBox);\n    const videoTime = ref(0);\n\n    const pauseInstructs = ref([] as Instruction[]);\n    const onPlaybackCompleted = () => {\n      state.value = ActivityPlayState.ActivityEnded;\n    };\n    const onPauseHit = (pause: PauseInfo) => {\n      console.log(`Hit pause${pause}`);\n      if (pause.instruction) pauseInstructs.value.push({ id: pause.time, text: pause.instruction });\n    };\n    const onPauseEnded = () => pauseInstructs.value.splice(0);\n\n    const startTime = computed(() => activity?.value?.startTime ?? 0);\n\n    function reset(newTime?: number) {\n      pauseInstructs.value.splice(0);\n      state.value = ActivityPlayState.AwaitingStart;\n      const time = newTime ?? startTime.value ?? 0;\n\n      if (videoPlayer.value) videoPlayer.value.setTime(time);\n    }\n\n    watchEffect(() => reset(startTime.value));\n\n    return {\n      webcamBox,\n      videoPlayer,\n      videoTime,\n      state,\n      ActivityPlayState,\n      awaitingStart,\n      activityFinished,\n      pauseInstructs,\n      isPlaying,\n      isPendingStart,\n\n      reset,\n      startTime,\n\n      onPlaybackCompleted,\n      onPauseHit,\n      onPauseEnded,\n    };\n  },\n  computed: {\n    keyframeVisual(): 'none' | 'skeleton' | 'video' {\n      return (this as any)?.activity?.keyframeVisual ?? 'none';\n    },\n    showingWebcam() {\n      return ((this as any)?.activity?.userVisual ?? 'none') !== 'none';\n    },\n    showSheetMusic() {\n      return ((this as any)?.activity?.sheetMotionVisual ?? 'none') !== 'none';\n    },\n    emphasizedJoints(): number[] { return this.activity?.emphasizedJoints ?? []; },\n    instructions(): Instruction[] {\n      const mActivity = this.activity;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if ((this.state === ActivityPlayState.AwaitingStart || this.state === ActivityPlayState.PendingStart) && mActivity.startInstruction) {\n        let text = mActivity.startInstruction;\n        if (this.state === ActivityPlayState.PendingStart) { text += '...'; }\n        instructs.push({\n          id: 1,\n          text,\n        });\n      } else if (this.state === ActivityPlayState.Playing && mActivity.playingInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.playingInstruction,\n        });\n      } else if (this.state === ActivityPlayState.ActivityEnded && mActivity.endInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.endInstruction,\n        });\n      }\n\n      return instructs;\n    },\n    timedInstructions(): Instruction[] {\n      const mActivity = this.activity as unknown as MiniLessonActivity | null;\n      const time = this.videoTime;\n\n      if (!mActivity) return [];\n\n      const activeTimedInstructions = mActivity.timedInstructions?.map(\n        (ti, i) => ({\n          id: i,\n          text: ti.text,\n          start: ti.startTime,\n          end: ti.endTime,\n        })\n      ).filter((ti) => ti.start <= time && time < ti.end) ?? [];\n\n      // console.log(`TimedI updated for time ${time}, count=${activeTimedInstructions.length}`, mActivity.timedInstructions);\n\n      return activeTimedInstructions;\n    },\n  },\n  methods: {\n    async startWebcam() {\n      return this.webcamBox?.startWebcam() ?? new Error('WebcamBox is null');\n    },\n    play(delay?: number | undefined) {\n      this.reset();\n      const vidPlayer = this.videoPlayer;\n      const vidActivity = this.activity as MiniLessonActivity | null;\n      if (!vidActivity) return;\n      if (!vidPlayer) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer is null');\n        return;\n      }\n\n      this.state = ActivityPlayState.PendingStart;\n\n      vidPlayer.play(\n        vidActivity.startTime,\n        vidActivity.endTime,\n        vidActivity.practiceSpeed ?? 1,\n        vidActivity.pauses ?? [],\n        delay ?? Constants.DefaultPauseDuration,\n        () => {\n          this.state = ActivityPlayState.Playing;\n        },\n      );\n    },\n    onProgress(val: number) {\n      this.videoTime = val;\n      this.$emit('progress', val);\n    },\n  },\n});\n\n","import { render } from \"./ActivityVideoPlayer.vue?vue&type=template&id=893e10ae\"\nimport script from \"./ActivityVideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./ActivityVideoPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./ActivityVideoPlayer.vue?vue&type=style&index=0&id=893e10ae&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"segmented-progress-bar\">\n    <progress\n      v-for=\"seg in segmentsData\"\n      :key=\"seg.id\"\n      :class=\"[{ 'is-disabled': !enableAll && !seg.enabled, [seg.cssClass]: enableAll || seg.enabled, 'is-dark': !enableAll && !seg.enabled}, ]\"\n      class=\"progress is-large\"\n      :max=\"seg.max - seg.min\"\n      :value=\"progress - seg.min\"\n      :style=\"{ 'flex-grow': (seg.max - seg.min) }\"\n    ></progress>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, toRefs } from 'vue';\nimport MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\n\nexport interface ProgressSegmentData {\n  min: number;\n  max: number;\n  enabled: boolean;\n}\n\nexport function calculateProgressSegments(lesson: MiniLesson, activity: MiniLessonActivity) {\n  if (!lesson) return [];\n\n  let last = undefined as undefined | number;\n  const segs = lesson.segmentBreaks.map((timestamp, i) => {\n    let segData = undefined as undefined | ProgressSegmentData;\n    if (last !== undefined) {\n      const doesOverlap = Math.max(last, activity.startTime) < Math.min(timestamp, activity.endTime);\n      segData = {\n        min: last,\n        max: timestamp,\n        enabled: activity?.focusedSegments ? activity.focusedSegments.indexOf(i - 1) !== -1 : doesOverlap,\n      };\n    }\n    last = timestamp;\n    return segData;\n  }).filter((x) => x !== undefined);\n\n  return segs as ProgressSegmentData[];\n}\n\nconst cssClassOptions = [\n  'is-info',\n  'is-success',\n  'is-warning',\n  'is-primary',\n  'is-danger',\n];\n\nexport default defineComponent({\n  name: 'SegmentedProgressBar',\n  props: {\n    segments: {\n      default: Array,\n      type: Array,\n    },\n    progress: {\n      default: 0,\n      type: Number,\n    },\n    enableAll: {\n      default: false,\n      type: Boolean,\n    },\n  },\n  setup(props) {\n    const {\n      segments,\n    } = toRefs(props);\n\n    const segmentsData = computed(\n      () => segments.value.map(\n        (seg, i) => ({\n          id: i,\n          cssClass: cssClassOptions[i % cssClassOptions.length],\n          ...(seg as ProgressSegmentData),\n        }),\n      ),\n    );\n\n    return {\n      segmentsData,\n    };\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n.segmented-progress-bar {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n\n  progress.progress {\n    border-radius: 0.5rem;\n    flex-basis: 10px;\n    margin-bottom: auto;\n    // border: 2px solid #BBB;\n\n    -webkit-appearance: none;\n    appearance: none;\n\n    &.is-disabled::-webkit-progress-bar,\n    &.is-disabled {\n      background: #888;\n    }\n\n    &.is-disabled::-moz-progress-bar,\n    &.is-disabled::-webkit-progress-value,\n    &.is-disabled::-ms-fill {\n      background: #888;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent, computed, toRefs } from 'vue';\nimport MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\n\nexport interface ProgressSegmentData {\n  min: number;\n  max: number;\n  enabled: boolean;\n}\n\nexport function calculateProgressSegments(lesson: MiniLesson, activity: MiniLessonActivity) {\n  if (!lesson) return [];\n\n  let last = undefined as undefined | number;\n  const segs = lesson.segmentBreaks.map((timestamp, i) => {\n    let segData = undefined as undefined | ProgressSegmentData;\n    if (last !== undefined) {\n      const doesOverlap = Math.max(last, activity.startTime) < Math.min(timestamp, activity.endTime);\n      segData = {\n        min: last,\n        max: timestamp,\n        enabled: activity?.focusedSegments ? activity.focusedSegments.indexOf(i - 1) !== -1 : doesOverlap,\n      };\n    }\n    last = timestamp;\n    return segData;\n  }).filter((x) => x !== undefined);\n\n  return segs as ProgressSegmentData[];\n}\n\nconst cssClassOptions = [\n  'is-info',\n  'is-success',\n  'is-warning',\n  'is-primary',\n  'is-danger',\n];\n\nexport default defineComponent({\n  name: 'SegmentedProgressBar',\n  props: {\n    segments: {\n      default: Array,\n      type: Array,\n    },\n    progress: {\n      default: 0,\n      type: Number,\n    },\n    enableAll: {\n      default: false,\n      type: Boolean,\n    },\n  },\n  setup(props) {\n    const {\n      segments,\n    } = toRefs(props);\n\n    const segmentsData = computed(\n      () => segments.value.map(\n        (seg, i) => ({\n          id: i,\n          cssClass: cssClassOptions[i % cssClassOptions.length],\n          ...(seg as ProgressSegmentData),\n        }),\n      ),\n    );\n\n    return {\n      segmentsData,\n    };\n  },\n});\n\n","import { render } from \"./SegmentedProgressBar.vue?vue&type=template&id=49396e06\"\nimport script from \"./SegmentedProgressBar.vue?vue&type=script&lang=ts\"\nexport * from \"./SegmentedProgressBar.vue?vue&type=script&lang=ts\"\n\nimport \"./SegmentedProgressBar.vue?vue&type=style&index=0&id=49396e06&lang=scss\"\nscript.render = render\n\nexport default script","\nimport MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\nimport { defineComponent, ref, nextTick } from 'vue';\nimport ActivityVideoPlayer from '@/components/elements/ActivityVideoPlayer.vue';\nimport SegmentedProgressBar, { calculateProgressSegments, ProgressSegmentData } from '@/components/elements/SegmentedProgressBar.vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport Utils from '@/services/Utils';\n\nexport default defineComponent({\n  name: 'MiniLessonPlayer',\n  components: {\n    SegmentedProgressBar,\n    ActivityVideoPlayer,\n  },\n  props: {\n    videoEntry: { type: Object },\n    miniLesson: { type: Object },\n    // maxVideoHeight: { type: String, default: 'none' },\n    enableCompleteLesson: { type: Boolean, default: false },\n  },\n  setup() {\n    const activityVideoPlayer = ref(null as null | typeof ActivityVideoPlayer);\n    return {\n      activityVideoPlayer,\n    };\n  },\n  emits: ['lesson-completed', 'activity-changed'],\n  computed: {\n    nearbyActivityIndices(): number[] {\n      const margin = 1;\n      const minIndex = Math.max(0, this.activeActivityIndex - margin);\n      const maxActivityIndex = (this.lesson?.activities.length ?? 0) - 1;\n      const maxIndex = Math.min(maxActivityIndex, this.activeActivityIndex + margin);\n      const count = (maxIndex + 1) - minIndex;\n      let indices: number[] = [];\n      if (minIndex > 0) indices = indices.concat([0, -1]);\n      indices = indices.concat(Utils.range(count, minIndex));\n      if (maxIndex < maxActivityIndex) indices = indices.concat([-1, maxActivityIndex]);\n      return indices;\n    },\n    lesson() {\n      const lesson = (this.$props.miniLesson ?? null) as null | MiniLesson;\n      return lesson;\n    },\n    activities(): MiniLessonActivity[] {\n      return (this.lesson as any)?.activities ?? [];\n    },\n    activeActivity() {\n      const lesson = (this.$props.miniLesson ?? null) as null | MiniLesson;\n      const activityIndex = this.activeActivityIndex as number;\n      const activity = lesson?.activities[activityIndex] ?? null as null | MiniLessonActivity;\n      return activity;\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lesson) return calculateProgressSegments(this.lesson, this.activeActivity);\n      return [];\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < (this.lesson?.activities.length ?? 0);\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    needsStartWebcam(): boolean {\n      return this.activeActivity !== null && this.activeActivity?.userVisual !== 'none' && webcamProvider.webcamStatus.value !== 'running';\n    },\n  },\n  data() {\n    return {\n      activeActivityIndex: 0,\n      activityProgress: 0,\n      webcamStatus: webcamProvider.webcamStatus,\n    };\n  },\n  methods: {\n    onProgress(val: number) { this.activityProgress = val; },\n    playActivity() { (this.$refs.activityVideoPlayer as any).play(); },\n    nextActivity() {\n      if (this.hasNextActivity) this.activeActivityIndex += 1;\n      nextTick(() => {\n        if (!this.needsStartWebcam) this.playActivity();\n      });\n    },\n    completeLesson() {\n      this.$emit('lesson-completed');\n    },\n    gotoActivity(i: number) {\n      this.activeActivityIndex = i;\n    },\n    async startWebcam() {\n      return (this.$refs.activityVideoPlayer as any)?.startWebcam();\n    },\n    repeat() {\n      const vidPlayer = (this.$refs.activityVideoPlayer as any);\n      vidPlayer.reset();\n      vidPlayer.play();\n    },\n  },\n  watch: {\n    activeActivityIndex(newVal: number) {\n      this.$emit('activity-changed', newVal);\n    },\n  },\n});\n","import { render } from \"./MiniLessonPlayer.vue?vue&type=template&id=72ec3fff\"\nimport script from \"./MiniLessonPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./MiniLessonPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./MiniLessonPlayer.vue?vue&type=style&index=0&id=72ec3fff&lang=scss\"\nscript.render = render\n\nexport default script","import MiniLesson, { MiniLessonActivity } from '@/model/MiniLesson';\n\nimport videoDatabase from '@/model/videoDatabase.json';\n// import defaultLessons from '@/model/bakedInLessons.json';\n\nimport { computed, reactive } from 'vue';\nimport Utils from './Utils';\n\nexport interface DatabaseEntry {\n  title: string;\n  clipName: string;\n  clipPath: string;\n  frameCount: number;\n  fps: number;\n  duration: number;\n  width: number;\n  height: number;\n  videoSrc: string;\n  thumbnailSrc: string;\n  startTime: number;\n  endTime: number;\n  tags: string[];\n}\n\nexport class MotionDatabase {\n\n  readonly allTags = reactive(new Set<string>());\n\n  readonly motionsMap = reactive(new Map<string, DatabaseEntry>());\n\n  readonly motions = computed(() => Array.from(this.motionsMap.values()));\n\n  readonly motionNames = computed(() => this.motions.value.map((dbEntry) => dbEntry.clipName));\n\n  readonly lessonsByVideo = reactive(new Map<string, MiniLesson[]>());\n\n  readonly lessonsById = reactive(new Map<string, MiniLesson>());\n\n  constructor() {\n\n    videoDatabase.forEach((videoEntry) => {\n      this.motionsMap.set(videoEntry.clipName, {\n        videoSrc: `videos/${videoEntry.clipPath}`,\n        ...videoEntry,\n        thumbnailSrc: `thumbs/${videoEntry.thumbnailSrc}`,\n      });\n      this.lessonsByVideo.set(videoEntry.clipName, []);\n      videoEntry.tags.forEach((tag) => this.allTags.add(tag));\n    });\n\n    console.log(`Motion database: loaded ${this.motionsMap.size} videos`);\n    // defaultLessons.forEach((lesson) => {\n    //   this.upsertLesson({\n    //     source: 'builtin',\n    //     ...lesson,\n    //   } as MiniLesson);\n    // });\n    // console.log(`Motion database: loaded ${defaultLessons.length} built-in lessons`);\n\n    const customLessonCount = this.loadCustomLessons();\n    console.log(`Motion database: loaded ${customLessonCount} custom lessons`);\n  }\n\n  hasLesson(lesson: MiniLesson): boolean {\n    const lessonList = this.lessonsByVideo.get(lesson.header.clipName) ?? [];\n    const lessonIndex = lessonList.findIndex((val) => val._id === lesson._id);\n    return lessonIndex !== -1;\n  }\n\n  upsertLesson(lesson: MiniLesson) {\n    const updatedLesson = MotionDatabase.updateLessonFormat(lesson);\n    const lessonList = this.lessonsByVideo.get(lesson.header.clipName) ?? [];\n    const existingIndex = lessonList.findIndex((les) => les._id === lesson._id);\n    if (existingIndex !== -1) lessonList[existingIndex] = updatedLesson;\n    else lessonList.push(updatedLesson);\n    this.lessonsByVideo.set(lesson.header.clipName, lessonList);\n\n    this.lessonsById.set(lesson._id, lesson);\n  }\n\n  static updateLessonFormat(lesson: MiniLesson): MiniLesson {\n    const updatedLesson = lesson;\n    updatedLesson.activities = lesson.activities.map((activity) => ({\n      // Backwards compat - convert to new format if necessary\n      //   > currently there's nothing to change\n      ...activity,\n    }));\n    return updatedLesson;\n  }\n\n  removeLesson(lesson: MiniLesson) {\n    const lessonList = this.lessonsByVideo.get(lesson.header.clipName) ?? [];\n    const lessonIndex = lessonList.findIndex((val) => val._id === lesson._id);\n    if (lessonIndex !== -1) lessonList.splice(lessonIndex, 1);\n    this.lessonsByVideo.set(lesson.header.clipName, lessonList);\n\n    this.lessonsById.delete(lesson._id);\n  }\n\n  getLessons(videoEntry: DatabaseEntry | string) {\n    let lessons = undefined as undefined | MiniLesson[];\n    if (typeof videoEntry === 'object' && videoEntry !== null) lessons = this.lessonsByVideo.get(videoEntry.clipName);\n    else lessons = this.lessonsByVideo.get(videoEntry);\n    return lessons;\n  }\n\n  private static getCustomLessonIdsList(): Array<string> {\n    return JSON.parse(window.localStorage.getItem('custom-lessons') ?? '[]');\n  }\n\n  private static saveCustomLessonsIdsList(customLessonIds: Array<string>) {\n    window.localStorage.setItem('custom-lessons', JSON.stringify(customLessonIds));\n  }\n\n  private loadCustomLessons(): number {\n    const customLessonIds = MotionDatabase.getCustomLessonIdsList();\n    let countLoaded = 0;\n    for (let i = 0; i < customLessonIds.length; i += 1) {\n      const id = customLessonIds[i];\n      const custLesson = localStorage.getItem(`lesson-${id}`);\n      if (custLesson) {\n        this.upsertLesson(JSON.parse(custLesson) as MiniLesson);\n        countLoaded += 1;\n      }\n    }\n    return countLoaded;\n  }\n\n  validateLesson(lesson: MiniLesson) {\n    if (!lesson) throw new Error('Lesson is null or undefined');\n    const clipName = lesson?.header?.clipName;\n    if (!clipName) throw new Error('Clip name missing');\n    if (!this.motionsMap.has(clipName)) throw new Error(`Matching video clip not found for ${clipName}`);\n    if (!Array.isArray(lesson.activities) || lesson.activities.length < 1) throw new Error('Lesson contains no activities');\n  }\n\n  saveCustomLesson(lesson: MiniLesson) {\n    this.upsertLesson(lesson);\n    window.localStorage.setItem(`lesson-${lesson._id}`, JSON.stringify(lesson));\n\n    const custLessonIds = MotionDatabase.getCustomLessonIdsList();\n    if (custLessonIds.indexOf(lesson._id) === -1) {\n      console.log(`Added custom lesson ${lesson.header.lessonTitle} id=${lesson._id} to localstorage`);\n      custLessonIds.push(lesson._id);\n    } else {\n      console.log(`Updated custom lesson ${lesson.header.lessonTitle} id=${lesson._id} in localstorage`);\n    }\n    MotionDatabase.saveCustomLessonsIdsList(custLessonIds);\n  }\n\n  deleteCustomLesson(lesson: MiniLesson) {\n    this.removeLesson(lesson);\n\n    const custLessonIds = MotionDatabase.getCustomLessonIdsList();\n    const lessonIdIndex = custLessonIds.indexOf(lesson._id);\n    if (lessonIdIndex !== -1) custLessonIds.splice(lessonIdIndex, 1);\n    MotionDatabase.saveCustomLessonsIdsList(custLessonIds);\n\n    window.localStorage.removeItem(`lesson-${lesson._id}`);\n  }\n}\n\nexport function createBlankActivity(motion: DatabaseEntry, title: string): MiniLessonActivity {\n  return {\n    title,\n    startTime: 0,\n    endTime: motion.duration,\n    demoVisual: 'video',\n    userVisual: 'none',\n    practiceSpeed: 1,\n  };\n}\n\nexport function createBlankLesson(videoEntry: DatabaseEntry): MiniLesson {\n  return {\n    _id: Utils.uuidv4(),\n    source: 'custom',\n    header: {\n      clipName: videoEntry.clipName,\n      lessonTitle: 'New Lesson',\n    },\n    segmentBreaks: [0, videoEntry.duration],\n    activities: [createBlankActivity(videoEntry, 'Activity 1')],\n  };\n}\n\nconst db = new MotionDatabase();\nexport default db;\n","import { computed, reactive, ref } from 'vue';\nimport optionsManager from '@/services/OptionsManager';\nimport motionDB, { DatabaseEntry, MotionDatabase } from '@/services/MotionDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport { Workflow, WorkflowStage, WorkflowStep } from '@/model/Workflow';\nimport workflowsJson from '@/model/workflows.json';\nimport customWorkflowsJson from '@/model/customWorkflows.json';\nimport eventHub, { EventNames } from './EventHub';\nimport Utils from './Utils';\n\nconst thumbnailRootDir = 'thumbs/';\n\nconst defaultWorkflows = workflowsJson as Workflow[];\nconst customWorkflows = customWorkflowsJson as Workflow[];\n\nexport interface TrackingWorkflowStep extends WorkflowStep {\n  status: 'notstarted' | 'inprogress' | 'completed';\n}\n\nexport interface TrackingWorkflowStage extends WorkflowStage {\n  steps: TrackingWorkflowStep[];\n}\n\nexport interface TrackingWorkflow extends Workflow {\n  stages: TrackingWorkflowStage[];\n}\n\nexport class WorkflowManager {\n\n  private bakedInWorkflows = new Set<string>();\n\n  public workflows = reactive(new Map() as Map<string, Workflow>);\n\n  public allWorkflows = computed(() => new Array(...this.workflows.values()))\n\n  public activeFlow = ref(null as TrackingWorkflow | null);\n\n  constructor() {\n    this.loadWorkflows();\n  }\n\n  private loadWorkflows() {\n    for (let i = 0; i < defaultWorkflows.length; i += 1) {\n      const workflow = defaultWorkflows[i] as Workflow;\n      workflow.created = new Date(workflow.created);\n      if (workflow.thumbnailSrc) workflow.thumbnailSrc = thumbnailRootDir + workflow.thumbnailSrc;\n      this.addSessionWorkflow(workflow);\n      this.bakedInWorkflows.add(workflow.id);\n    }\n    for (let i = 0; i < customWorkflows.length; i += 1) {\n      const workflow = customWorkflows[i];\n      workflow.created = new Date(workflow.created);\n      if (workflow.thumbnailSrc) workflow.thumbnailSrc = thumbnailRootDir + workflow.thumbnailSrc;\n      this.addSessionWorkflow(workflow);\n      this.bakedInWorkflows.add(workflow.id);\n    }\n\n    const customWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    for (let i = 0; i < customWorkflowIds.length; i += 1) {\n      this.tryLoadCustomWorkflow(customWorkflowIds[i]);\n    }\n  }\n\n  public isCustomWorkflow(id: string) {\n    return !this.bakedInWorkflows.has(id);\n  }\n\n  public hasWorkflow(id: string) {\n    return this.workflows.has(id);\n  }\n\n  public hasBakedInWorkflow(id: string) {\n    return this.bakedInWorkflows.has(id);\n  }\n\n  public reloadCustomWorkflow(id: string) {\n    if (!this.isCustomWorkflow(id)) return;\n\n    if (!WorkflowManager.hasSavedCustomLesson(id)) {\n      this.workflows.delete(id);\n    } else {\n      this.tryLoadCustomWorkflow(id);\n    }\n  }\n\n  private static getCustomWorkflowIdsList(): Array<string> {\n    return JSON.parse(window.localStorage.getItem('custom-workflows') ?? '[]');\n  }\n\n  private static saveCustomWorkflowIdsList(customLessonIds: Array<string>) {\n    window.localStorage.setItem('custom-workflows', JSON.stringify(customLessonIds));\n  }\n\n  private static updateToLatestWorkflowFormat(workflow: Workflow) {\n    const updatedWorkflow = workflow;\n    updatedWorkflow.stages = updatedWorkflow.stages.map((stage) => ({\n      ...stage,\n      steps: stage.steps.map((step) => {\n        const stepAny = step as any;\n        const newStep = step;\n        const newStepAny = newStep as any;\n\n        // Renaming videoLesson -> miniLesson\n        if (stepAny.videoLessonReference) {\n          newStep.miniLessonReference = stepAny.videoLessonReference;\n          delete newStepAny.videoLessonReference;\n        }\n        if (stepAny.videoLessonEmbedded) {\n          newStep.miniLessonEmbedded = stepAny.videoLessonEmbedded;\n          delete newStepAny.videoLessonEmbedded;\n        }\n        if (newStepAny.type === 'VideoLessonReference') newStep.type = 'MiniLessonReference';\n        if (newStepAny.type === 'VideoLessonEmbedded') newStep.type = 'MiniLessonEmbedded';\n\n        // Refactoring any embedded mini-lessons\n        if (newStep.miniLessonEmbedded) {\n          newStep.miniLessonEmbedded = MotionDatabase.updateLessonFormat(newStep.miniLessonEmbedded);\n        }\n\n        return newStep;\n      }),\n    }));\n\n    return updatedWorkflow;\n  }\n\n  public static hasSavedCustomLesson(id: string) {\n    const custWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    return custWorkflowIds.indexOf(id) !== -1;\n  }\n\n  public addSessionWorkflow(workflow: Workflow) {\n    const updatedWorkflow = WorkflowManager.updateToLatestWorkflowFormat(workflow);\n    this.workflows.set(updatedWorkflow.id, updatedWorkflow);\n  }\n\n  public tryLoadCustomWorkflow(id: string) {\n    try {\n      const workflowRaw = window.localStorage.getItem(`workflow-${id}`);\n      if (!workflowRaw) throw new Error(`No workflow found with id: ${id}`);\n      const workflow = JSON.parse(workflowRaw);\n      workflow.created = new Date(workflow.created);\n      this.addSessionWorkflow(workflow);\n    } catch (e) {\n      console.warn('Error loading custom lesson', id, e);\n    }\n  }\n\n  public deleteCustomWorkflow(id: string) {\n    this.workflows.delete(id);\n    window.localStorage.removeItem(`workflow-${id}`);\n    const custWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    const index = custWorkflowIds.indexOf(id);\n    if (index !== -1) {\n      custWorkflowIds.splice(index, 1);\n      WorkflowManager.saveCustomWorkflowIdsList(custWorkflowIds);\n    }\n  }\n\n  public upsertCustomWorkflow(workflow: Workflow) {\n    this.addSessionWorkflow(workflow);\n    this.workflows.set(workflow.id, workflow);\n    window.localStorage.setItem(`workflow-${workflow.id}`, JSON.stringify(workflow));\n\n    const custWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    if (!WorkflowManager.hasSavedCustomLesson(workflow.id)) {\n      console.log(`Added custom lesson ${workflow.title} id=${workflow.id} to localstorage`);\n      custWorkflowIds.push(workflow.id);\n    } else {\n      console.log(`Updated custom lesson ${workflow.title} id=${workflow.id} in localstorage`);\n    }\n    WorkflowManager.saveCustomWorkflowIdsList(custWorkflowIds);\n  }\n\n  public setActiveFlow(workflowId: string) {\n    const matchingWorkflow = this.workflows.get(workflowId);\n\n    if (!matchingWorkflow) {\n      console.error(`setActiveFlow: Couldn't find workflow with id ${workflowId}`);\n      return false;\n    }\n\n    const flow = Utils.deepCopy(matchingWorkflow);\n    const trackingFlow = {\n      ...flow,\n      stages: flow.stages.map((stage) => ({\n        ...stage,\n        steps: stage.steps.map((step) => ({\n          ...step,\n          status: 'notstarted',\n        }) as TrackingWorkflowStep),\n      } as TrackingWorkflowStage)),\n    } as TrackingWorkflow;\n\n    trackingFlow.stages.forEach((stage) => {\n      const { steps } = stage;\n      const shuffleInfo = (stage as any).shuffle;\n      if (shuffleInfo) {\n        // Shuffle the sequences of steps, as appropiate\n        Utils.shuffleArray(steps, shuffleInfo.startIndex, shuffleInfo.endIndex);\n      }\n      stage.steps = steps;\n    });\n\n    this.activeFlow.value = trackingFlow;\n    return true;\n  }\n\n  public completeActivitesPriorToStageAndStep(stageIndex: number, stepIndex: number) {\n    if (!this.activeFlow.value) return;\n    const { stages } = this.activeFlow.value;\n    for (let i = 0; i < stages.length; i += 1) {\n      const { steps } = stages[i];\n      for (let j = 0; j < steps.length; j += 1) {\n        steps[j].status = i < stageIndex ? 'completed' : 'notstarted';\n        if (i === stageIndex) {\n          steps[j].status = j < stepIndex ? 'completed' : 'notstarted';\n        }\n      }\n    }\n  }\n\n  public static validateWorkflow(workflow: Workflow) {\n    if (!workflow?.id) throw new Error('Workflow must have an id');\n    if (!workflow?.title) throw new Error('Workflow must have an title');\n    if (!Array.isArray(workflow.stages)) throw new Error('Workflow must have stages');\n    workflow.stages.forEach((stage) => {\n      WorkflowManager.validateWorkflowStage(stage);\n    });\n  }\n\n  public static validateWorkflowStage(stage: WorkflowStage) {\n    if (!stage.title) throw new Error('Stage must have a title');\n    if (!Array.isArray(stage.steps)) throw new Error('Stage must have steps');\n    stage.steps.forEach((step) => {\n      WorkflowManager.validateWorkflowStep(step);\n    });\n  }\n\n  public static validateWorkflowStep(step: WorkflowStep) {\n    if (!step.title) throw new Error('Step must have a title');\n    if (!step.type) throw new Error('Step must have a type');\n\n    if (step.type === 'InstructionOnly') {\n      if (!step.instructions) throw new Error('Step must have an instruction');\n      if (!step.instructions.text) throw new Error('Step instruction must have a text');\n      if (!step.instructions.heading) throw new Error('Step instruction must have a heading');\n\n    } else if (step.type === 'MiniLessonReference') {\n      if (!step.miniLessonReference) throw new Error('Step must have a referenced lesson');\n      if (!motionDB.lessonsById.has(step.miniLessonReference.lessonId)) throw new Error(`Step's referenced lesson id ${step.miniLessonReference.lessonId} does not exist`);\n      if (!motionDB.lessonsByVideo.has(step.miniLessonReference.clipName)) throw new Error(`Step's referenced lesson clipName ${step.miniLessonReference.clipName} does not exist`);\n\n    } else if (step.type === 'MiniLessonEmbedded') {\n      if (!step.miniLessonEmbedded) throw new Error('Step must have a embedded lesson');\n\n      try {\n        motionDB.validateLesson(step.miniLessonEmbedded);\n      } catch (e) {\n        throw new Error(`Step ${step.title} has an invalid embedded lesson. Error: ${e}`);\n      }\n\n    } else if (step.type === 'UploadTask') {\n      if (!step.upload) throw new Error('Step must have an upload task');\n\n    } else {\n      throw new Error(`Step type ${step.type} is not supported`);\n    }\n  }\n}\n\nconst workflowManager = new WorkflowManager();\nexport default workflowManager;\n","<template>\n  <section class=\"section\">\n    <div class=\"container\">\n      <h1 class=\"title\">{{title}}</h1>\n      <h2 class=\"subtitle\" v-show=\"subtitle\">{{subtitle}}</h2>\n\n      <p class=\"block\"><strong>Instructions:</strong> {{prompt}}</p>\n\n      <div class=\"block\" v-if=\"state === 'Record'\">\n        <WebcamBox />\n\n        <div class=\"field is-grouped is-grouped-centered\" v-show=\"webcamStatus === 'running'\">\n          <p class=\"control\">\n            <span class=\"record-icon\" :class=\"{'is-recording': isRecording}\">\n            </span>\n            <!-- <span class=\"icon is-medium\" :class=\"{'has-text-danger': isRecording}\">\n              <FAIcon icon=\"record-vinyl\" size=\"lg\" pulse />\n            </span> -->\n          </p>\n          <p class=\"control\">\n            <button class=\"button animate-width\"\n              @click=\"toggleRecording\">\n\n               <span v-show=\"isRecording\">\n                Stop\n              </span>\n              <span v-show=\"!isRecording\">\n                Record\n              </span>\n\n              <!-- <span v-if=\"!isRecording\">Start Recording</span> -->\n            </button>\n          </p>\n        </div>\n      </div>\n      <video class=\"block flipped\" v-else controls :src=\"recordedObjectUrl\"></video>\n      <div class=\"block\" v-if=\"state === 'Review'\">\n        <div class=\"field is-grouped is-grouped-centered\">\n          <p class=\"control\">\n            <button class=\"button\" :disabled=\"isUploading\" @click=\"rerecord\">\n              Rerecord\n              <!-- <span class=\"icon is-medium\" :class=\"{'has-text-danger': isRecording}\">\n                <FAIcon icon=\"record-vinyl\" />\n              </span> -->\n              <!-- <span v-if=\"!isRecording\">Start Recording</span> -->\n            </button>\n          </p>\n          <p class=\"control\">\n            <button class=\"button is-primary\"\n              :disabled=\"isUploading\"\n              :class=\"{'is-loading': isUploading}\"\n              @click=\"uploadVideo\">\n              Upload Video\n            </button>\n          </p>\n        </div>\n\n        <div class=\"notification\" v-if=\"uploadError\">\n          <strong>Error Uploading Video:</strong>\n          {{uploadError}}\n        </div>\n      </div>\n      <div class=\"block has-text-centered\" v-if=\"state === 'Success'\">\n        <span class=\"icon\"><i class=\"fas fa-check\"></i></span> Upload Successful\n      </div>\n\n      <div class=\"block buttons is-right\" >\n        <!-- {{successfullyUploaded}} -->\n        <button v-show=\"!successfullyUploaded\" class=\"is-outlined button is-danger\" @click=\"$emit('upload-canceled')\">Cancel</button>\n        <button :disabled=\"!successfullyUploaded\" class=\"button is-primary\" @click=\"$emit('upload-completed')\">Done</button>\n      </div>\n\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport AzureUploader from '@/services/AzureUploader';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\n\nexport default defineComponent({\n  name: 'UploadScreen',\n  components: { WebcamBox },\n  emits: ['upload-canceled', 'upload-completed'],\n  props: {\n    title: {\n      type: String,\n      default: 'Video Upload',\n    },\n    subtitle: {\n      type: String,\n      default: null,\n    },\n    prompt: {\n      type: String,\n      default: 'Upload your video here',\n    },\n    uploadFilename: {\n      type: String,\n      default: null,\n    },\n  },\n  setup() {\n\n    const state = ref('Record' as 'Record' | 'Review' | 'Success');\n\n    const lastRecordedBlob = ref(null as Blob | null);\n    const recordedObjectUrl = ref('');\n    const isUploading = ref(false);\n    const uploadError = ref(null as null | any);\n    const successfullyUploaded = computed(() => state.value === 'Success');\n\n    return {\n      state,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n      lastRecordedBlob,\n      recordedObjectUrl,\n      isUploading,\n      uploadError,\n      successfullyUploaded,\n    };\n  },\n  methods: {\n    async toggleRecording() {\n      if (!webcamProvider.isRecording.value) {\n        await webcamProvider.startWebcam();\n        await webcamProvider.startRecording();\n      } else {\n        this.lastRecordedBlob = await webcamProvider.stopRecording();\n        this.recordedObjectUrl = URL.createObjectURL(this.lastRecordedBlob);\n        this.state = 'Review';\n        await webcamProvider.stopWebcam();\n      }\n    },\n    async rerecord() {\n      this.successfullyUploaded = false;\n      this.lastRecordedBlob = null;\n      this.recordedObjectUrl = '';\n      this.uploadError = null;\n      this.state = 'Record';\n      await webcamProvider.startWebcam();\n    },\n    async uploadVideo() {\n      if (!this.lastRecordedBlob) return;\n      if (this.isUploading) return;\n\n      this.isUploading = true;\n      this.uploadError = null;\n      const blobName = `${this.$props.uploadFilename}.webm`;\n\n      try {\n        await AzureUploader.upload(this.lastRecordedBlob, blobName);\n      } catch (e) {\n        console.error('Error uploading video', e);\n        this.uploadError = e;\n      }\n\n      if (this.uploadError === null) {\n        this.state = 'Success';\n      }\n\n      this.isUploading = false;\n    },\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n\n@import \"@/assets/main.scss\";\n\n.animate-width {\n  transition: width 0.2s ease;\n}\n\n.record-icon {\n  display: block;\n  width: 1.5rem;\n  height: 1.5rem;\n  border-radius: 1rem;\n  background-color: $dark;\n  transition: background-color 0.2s ease;\n\n  &.is-recording {\n    background-color: $red;\n  }\n}\n\n.control .record-icon {\n  margin-top: 8px;\n}\n</style>\n","// import { DefaultAzureCredential } from '@azure/identity';\nimport { BlobServiceClient } from '@azure/storage-blob';\n\n// const credential = new DefaultAzureCredential();\n\nconst blobServiceClient = new BlobServiceClient(\n  'https://dartrobotlabstorage.blob.core.windows.net/study-video-uploads?sp=acw&st=2021-04-07T02:19:35Z&se=2022-04-07T10:19:35Z&sv=2020-02-10&sr=c&sig=9fpKagbOjUqAjHF579%2FW7KiM4U8YcBrbI8J70tH35Y4%3D',\n  // credential,\n);\n\nexport default class AzureUploader {\n  public static async upload(data: Blob, blobName: string): Promise<void> {\n    const client = blobServiceClient.getContainerClient('study-video-uploads');\n\n    const blockBlobClient = client.getBlockBlobClient(blobName);\n\n    await blockBlobClient.uploadData(data);\n  }\n}\n","\nimport { computed, defineComponent, ref } from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport AzureUploader from '@/services/AzureUploader';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\n\nexport default defineComponent({\n  name: 'UploadScreen',\n  components: { WebcamBox },\n  emits: ['upload-canceled', 'upload-completed'],\n  props: {\n    title: {\n      type: String,\n      default: 'Video Upload',\n    },\n    subtitle: {\n      type: String,\n      default: null,\n    },\n    prompt: {\n      type: String,\n      default: 'Upload your video here',\n    },\n    uploadFilename: {\n      type: String,\n      default: null,\n    },\n  },\n  setup() {\n\n    const state = ref('Record' as 'Record' | 'Review' | 'Success');\n\n    const lastRecordedBlob = ref(null as Blob | null);\n    const recordedObjectUrl = ref('');\n    const isUploading = ref(false);\n    const uploadError = ref(null as null | any);\n    const successfullyUploaded = computed(() => state.value === 'Success');\n\n    return {\n      state,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n      lastRecordedBlob,\n      recordedObjectUrl,\n      isUploading,\n      uploadError,\n      successfullyUploaded,\n    };\n  },\n  methods: {\n    async toggleRecording() {\n      if (!webcamProvider.isRecording.value) {\n        await webcamProvider.startWebcam();\n        await webcamProvider.startRecording();\n      } else {\n        this.lastRecordedBlob = await webcamProvider.stopRecording();\n        this.recordedObjectUrl = URL.createObjectURL(this.lastRecordedBlob);\n        this.state = 'Review';\n        await webcamProvider.stopWebcam();\n      }\n    },\n    async rerecord() {\n      this.successfullyUploaded = false;\n      this.lastRecordedBlob = null;\n      this.recordedObjectUrl = '';\n      this.uploadError = null;\n      this.state = 'Record';\n      await webcamProvider.startWebcam();\n    },\n    async uploadVideo() {\n      if (!this.lastRecordedBlob) return;\n      if (this.isUploading) return;\n\n      this.isUploading = true;\n      this.uploadError = null;\n      const blobName = `${this.$props.uploadFilename}.webm`;\n\n      try {\n        await AzureUploader.upload(this.lastRecordedBlob, blobName);\n      } catch (e) {\n        console.error('Error uploading video', e);\n        this.uploadError = e;\n      }\n\n      if (this.uploadError === null) {\n        this.state = 'Success';\n      }\n\n      this.isUploading = false;\n    },\n  },\n});\n\n","import { render } from \"./FeedbackUploadScreen.vue?vue&type=template&id=663b38c1\"\nimport script from \"./FeedbackUploadScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./FeedbackUploadScreen.vue?vue&type=script&lang=ts\"\n\nimport \"./FeedbackUploadScreen.vue?vue&type=style&index=0&id=663b38c1&lang=scss\"\nscript.render = render\n\nexport default script","import { ref } from 'vue';\n\nclass OptionsManager {\n\n  public workflowId = ref(null as string | null);\n\n  public participantId = ref(null as string | null);\n\n  public participantIdWasSet = ref(false);\n\n  public isTest = ref(false);\n\n  constructor() {\n    this.parsePath();\n    window.addEventListener('hashchange', this.parsePath);\n  }\n\n  parsePath() {\n    const urlParams = new URLSearchParams(window.location.search);\n\n    console.log('Parsing path....', urlParams);\n\n    this.workflowId.value = urlParams.get('workflowId');\n    this.participantId.value = urlParams.get('participantId');\n    this.isTest.value = this.workflowId.value === null || this.participantId.value === null;\n\n    if (this.participantId.value) {\n      this.participantIdWasSet.value = true;\n    }\n  }\n}\n\nconst optionsManager = new OptionsManager();\nexport default optionsManager;\n","import { DatabaseEntry } from '@/services/MotionDatabase';\nimport Utils from '@/services/Utils';\nimport MiniLesson from './MiniLesson';\n\n/**\n * Userflow.ts\n *\n * Data types that represent a specific workflow in the app\n */\nexport interface Instructions {\n  heading: string;\n  text: string;\n}\n\nexport interface WorkflowStep {\n  type: 'InstructionOnly' | 'MiniLessonReference' | 'MiniLessonEmbedded' | 'UploadTask';\n  title: string;\n  instructions?: Instructions;\n  miniLessonReference?: {\n    clipName: string;\n    lessonId: string;\n  };\n  miniLessonEmbedded?: MiniLesson;\n  upload?: {\n    identifier: string;\n    prompt: string;\n  };\n  experiment?: {\n    showInExperimentOnly?: boolean;\n    // disableRepitition?: boolean;\n    isTimeExpiredTask?: boolean;\n    isBeforeTimeStartTask?: boolean;\n  };\n}\n\nexport interface WorkflowStage {\n  title: string;\n  steps: WorkflowStep[];\n  shuffle?: {\n    startIndex: number;\n    endIndex: number;\n  };\n  maxStageTimeSecs?: number;\n}\n\nexport interface Workflow {\n  title: string;\n  creationMethod: string;\n  id: string;\n  stages: WorkflowStage[];\n  experimentMaxTimeSecs?: number;\n  created: Date | string;\n  thumbnailSrc?: string;\n}\n\nexport function CreateBlankWorkflow() {\n  return {\n    title: 'New Workflow',\n    id: Utils.uuidv4(),\n    creationMethod: 'User Created',\n    stages: [],\n    created: new Date(),\n  } as Workflow;\n}\n\nexport function IsMiniLessonStep(step: WorkflowStep) {\n  return step.type === 'MiniLessonReference' || step.type === 'MiniLessonEmbedded';\n}\nexport function GetWorkflowStepVideoClipName(step: WorkflowStep) {\n  return IsMiniLessonStep(step)\n    ? (step.type === 'MiniLessonReference'\n      ? step.miniLessonReference?.clipName ?? null\n      : step.miniLessonEmbedded?.header.clipName) ?? null\n    : null;\n}\nexport function GetVideoEntryForWorkflowStep(db: any, step: WorkflowStep): DatabaseEntry | null{\n  if (!IsMiniLessonStep(step)) return null;\n  return db.motionsMap.get(GetWorkflowStepVideoClipName(step));\n}\n","\nimport {\n  computed, defineComponent, nextTick, onBeforeUnmount, onMounted, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport workflowManager, { TrackingWorkflow, TrackingWorkflowStage, TrackingWorkflowStep } from '@/services/WorkflowManager';\nimport FeedbackUploadScreen from '@/components/screens/FeedbackUploadScreen.vue';\nimport optionsManager from '@/services/OptionsManager';\nimport {\n  GetVideoEntryForWorkflowStep, IsMiniLessonStep, Workflow, WorkflowStage,\n} from '@/model/Workflow';\n\nfunction getDurationString(seconds: number) {\n  if (seconds === Infinity) return 'Untimed';\n  if (Number.isNaN(seconds)) return 'Unknown';\n\n  const secsRemainingConstrained = Math.max(0, seconds);\n\n  if (secsRemainingConstrained < 3600) {\n    return new Date(secsRemainingConstrained * 1000).toISOString().substr(14, 5);\n  }\n  return new Date(secsRemainingConstrained * 1000).toISOString().substr(11, 8);\n}\n\nexport default defineComponent({\n  name: 'WorkflowMenu',\n  props: {\n    showHeader: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    enableTiming: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: [\n    'back-selected',\n  ],\n  components: {\n    MiniLessonPlayer,\n    FeedbackUploadScreen,\n  },\n  computed: {\n    stages() { return ((this as any).workflow?.stages ?? []) as TrackingWorkflowStage[]; },\n    currentVideoEntry(): DatabaseEntry | null {\n      if (this.currentStep?.type === 'MiniLessonReference' && this.currentStep?.miniLessonReference) {\n        return db.motionsMap.get(this.currentStep.miniLessonReference.clipName) ?? null;\n      }\n      if (this.currentStep?.type === 'MiniLessonEmbedded' && this.currentStep?.miniLessonEmbedded?.header.clipName) {\n        return db.motionsMap.get(this.currentStep.miniLessonEmbedded.header.clipName) ?? null;\n      }\n      return null;\n    },\n    currentLesson(): MiniLesson | null {\n      if (this.currentStep?.type === 'MiniLessonReference' && this.currentStep?.miniLessonReference) {\n        return db.lessonsById.get(this.currentStep.miniLessonReference.lessonId) ?? null;\n      }\n      if (this.currentStep?.type === 'MiniLessonEmbedded' && this.currentStep?.miniLessonEmbedded) {\n        return this.currentStep.miniLessonEmbedded;\n      }\n      return null;\n    },\n    uploadFilename(): string {\n      const uploadId = this.currentStep?.upload?.identifier ?? 'NoIdentifier';\n      const participantId = optionsManager.participantId.value ?? 'Anonomous';\n      const workflowId = this.workflow?.id ?? 'NullWorkflow';\n\n      return `${workflowId}-${participantId}-${uploadId}`;\n    },\n    filteredStages() {\n      const workflow = (this as any).workflow as TrackingWorkflow;\n      const stages = workflow?.stages ?? [];\n      const isExperimentMode = (this as any).enableExperimentMode as boolean;\n      const activeStage = (this as any).activeStage as WorkflowStage;\n      const stageSecondsRemaining = (this as any).stageSecondsRemaining as number;\n\n      return stages.map((stage, stageIndex) => {\n        const filteredSteps = stage.steps\n          .filter((step) => isExperimentMode || !(step.experiment?.showInExperimentOnly ?? false))\n          .map((step, stepIndex) => {\n\n            const isTestMode = !isExperimentMode;\n            const isInActiveStage = activeStage === stage;\n            const isTimeExpiredTask = step.experiment?.isTimeExpiredTask ?? false;\n            const stageTimeExpired = stageSecondsRemaining <= 0;\n            const isValidAfterExpiredTask = isInActiveStage && isTimeExpiredTask && stageTimeExpired;\n            const isValidUnexpired = !isInActiveStage || (!isTimeExpiredTask && !stageTimeExpired);\n            // const isNewlyOnThisStage = this.activeStageIndex === stageIndex-1 && this.isStageCompleted(filteredStages[i-1])\n            const isBeforeTime = (step.experiment?.isBeforeTimeStartTask ?? false);\n\n            return {\n              step,\n              isComplete: step.status === 'completed',\n              dbEntry: GetVideoEntryForWorkflowStep(db, step),\n              isExpired: !isTimeExpiredTask && stageTimeExpired,\n              isClickable: (isTestMode || isInActiveStage || isBeforeTime)\n                          && (isValidUnexpired || isValidAfterExpiredTask),\n              isValidAfterExpiredTask,\n              waitingForTimeExpiration: isInActiveStage && isTimeExpiredTask && !stageTimeExpired,\n              stageIndex,\n              stepIndex,\n            };\n          });\n        return {\n          ...stage,\n          filteredSteps,\n          timeLimitString: stage.maxStageTimeSecs ? getDurationString(stage.maxStageTimeSecs) : null,\n        };\n      });\n    },\n    nextStepInStage() {\n      // for (let i = 0; i < this.stages.length; i += 1) {\n      if (!this.filteredStages) return null;\n\n      const stage = (this as any).filteredStages[(this as any).activeStageIndex];\n      if (!stage) return null;\n\n      for (let j = 0; j < stage.filteredSteps.length; j += 1) {\n        const filteredStep = stage.filteredSteps[j];\n        if (filteredStep.step.status !== 'completed' && filteredStep.isClickable) return filteredStep.step as TrackingWorkflowStep;\n      }\n      // }\n      return null;\n    },\n  },\n  setup(props, ctx) {\n\n    const currentStep = ref(null as null | TrackingWorkflowStep);\n    const instructionsActive = ref(false);\n    const lessonActive = ref(false);\n    const uploadActive = ref(false);\n    const workflow = workflowManager.activeFlow;\n\n    const workflowStartTime = ref(new Date());\n    const workflowStageStartTime = ref(new Date());\n    const enableExperimentMode = ref(!optionsManager.isTest.value);\n    const isTiming = ref(!optionsManager.isTest.value);\n    const timingNotStarted = computed(() => isTiming.value && !workflowStartTime.value);\n\n    const activeStageIndex = ref(-1);\n    const activeStage = computed(() => workflow.value?.stages[activeStageIndex.value] ?? null);\n    onMounted(() => {\n      workflowStartTime.value = new Date();\n      workflowStageStartTime.value = new Date();\n    });\n    let stageTimer = -1;\n    const workflowSecsElapsed = ref(Infinity);\n    const workflowSecondsRemaining = computed(() => {\n      if (!workflow.value?.experimentMaxTimeSecs) return Infinity;\n      return workflow.value.experimentMaxTimeSecs - workflowSecsElapsed.value;\n    });\n    const workflowSecondsRemainingString = computed(() => getDurationString(workflowSecondsRemaining.value));\n    const stageSecsElapsed = ref(Infinity);\n    const stageSecondsRemaining = computed(() => {\n      if (!activeStage.value?.maxStageTimeSecs) return Infinity;\n      return activeStage.value.maxStageTimeSecs - stageSecsElapsed.value;\n    });\n    const stageSecondsRemainingString = computed(() => getDurationString(stageSecondsRemaining.value));\n    onMounted(() => {\n      stageTimer = window.setInterval(() => {\n\n        const now = Date.now();\n        workflowSecsElapsed.value = (now - workflowStartTime.value.getTime()) / 1000;\n        stageSecsElapsed.value = (now - workflowStageStartTime.value.getTime()) / 1000;\n\n      }, 1000);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(stageTimer);\n    });\n\n    watch(workflow, () => {\n      currentStep.value = null;\n    });\n    watchEffect(() => {\n      const isInCurrentStage = (activeStage.value?.steps ?? []).indexOf(currentStep.value as any) !== -1;\n      if (isInCurrentStage && stageSecondsRemaining.value <= 0 && !currentStep.value?.experiment?.isTimeExpiredTask) {\n        lessonActive.value = false;\n      }\n    });\n\n    return {\n      activeStage,\n      activeStageIndex,\n      currentStep,\n      instructionsActive,\n      lessonActive,\n      uploadActive,\n      workflow,\n      optionsManager,\n\n      workflowStartTime,\n      timingNotStarted,\n      isTiming,\n      workflowStageStartTime,\n      enableExperimentMode,\n      workflowSecsElapsed,\n      workflowSecondsRemaining,\n      workflowSecondsRemainingString,\n      stageSecsElapsed,\n      stageSecondsRemaining,\n      stageSecondsRemainingString,\n    };\n  },\n  methods: {\n    startTiming() {\n      this.workflowStartTime = new Date();\n    },\n    // getStepInfo(stage: TrackingWorkflowStage, stageIndex: number) {\n\n    //   return stage.steps\n    //     .filter((step) => this.enableExperimentMode || !(step.experiment?.showInExperimentOnly ?? false))\n    //     .map((step, stepIndex) => {\n\n    //       const isTestMode = !this.enableExperimentMode;\n    //       const isInActiveStage = this.activeStage === stage;\n    //       const isTimeExpiredTask = step.experiment?.isTimeExpiredTask ?? false;\n    //       const stageTimeExpired = this.stageSecondsRemaining <= 0;\n    //       const waitingForTimeExpiration = isTimeExpiredTask && !stageTimeExpired;\n\n    //       return {\n    //         step,\n    //         isComplete: step.status === 'completed',\n    //         isNextStep: step === this.nextStepInStage,\n    //         dbEntry: GetVideoEntryForWorkflowStep(db, step),\n    //         isClickable: (isTestMode || isInActiveStage)\n    //                     && (!isTimeExpiredTask || !stageTimeExpired)\n    //                     && !waitingForTimeExpiration,\n    //         waitingForTimeExpiration,\n    //         stageIndex,\n    //         stepIndex,\n    //       };\n    //     });\n    // },\n    instructionsFinished() {\n      this.instructionsActive = false;\n      const step = this.currentStep;\n      if (!step) return;\n      step.status = 'inprogress';\n      this.continueWorkflowStep(step);\n    },\n    startWorkflowStep(item: TrackingWorkflowStep) {\n      // if (!this.isClickable(item)) return;\n      this.currentStep = item;\n      if (item.type === 'InstructionOnly') {\n        this.instructionsActive = true;\n        return;\n      }\n      this.continueWorkflowStep(item);\n    },\n    continueWorkflowStep(item: TrackingWorkflowStep) {\n      if (item.type === 'InstructionOnly') {\n        // Instructions only - there's nothing else to do. Move to next activity!\n        this.completeStep(item);\n      } else if (item.type === 'MiniLessonReference' || item.type === 'MiniLessonEmbedded') {\n        this.lessonActive = true;\n      } else if (item.type === 'UploadTask') {\n        this.uploadActive = true;\n      } else {\n        console.error(`Item type ${item.type} not supported`);\n      }\n    },\n    lessonCompleted() {\n      this.lessonActive = false;\n      this.completeStep(this.currentStep);\n    },\n    uploadComplete() {\n      this.uploadActive = false;\n      this.completeStep(this.currentStep);\n    },\n    completeStep(step: TrackingWorkflowStep | null) {\n      if (!step) return;\n      step.status = 'completed';\n    },\n    isStageCompleted(stage: TrackingWorkflowStage) {\n      if (!stage) return true;\n\n      const steps = (stage as any).filteredSteps ?? [];\n      return steps.reduce((wasTrue: boolean, thisStep: any) => wasTrue && (thisStep.isComplete || thisStep.isExpired), true);\n    },\n    startStage(stageIndex: number) {\n      this.workflowStageStartTime = new Date();\n      nextTick(() => {\n        this.activeStageIndex = stageIndex;\n      });\n    },\n  },\n});\n","import { render } from \"./WorkflowMenu.vue?vue&type=template&id=59dabe74\"\nimport script from \"./WorkflowMenu.vue?vue&type=script&lang=ts\"\nexport * from \"./WorkflowMenu.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <section class=\"section create-workflow-screen\" :class=\"{\n      'is-clipped': editLessonActive,\n    }\" :style=\"{\n      'max-height:100vh': editLessonActive,\n    }\">\n    <div class=\"hero is-primary block\">\n      <div class=\"hero-body\">\n        <div class=\"container\">\n          <p class=\"title\">\n            Workflow Creation\n          </p>\n          <p class=\"subtitle\">\n            <span v-if=\"activeWorkflow\">{{activeWorkflow.title}}</span>\n            <span v-else>Select a starting point...</span>\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"container block\">\n      <div class=\"buttons is-centered\">\n        <button class=\"button\" :class=\"{\n          'is-success': !isDirty && activeWorkflow,\n        }\"\n        @click=\"goBack()\">&lt; Back</button>\n        <button v-if=\"activeWorkflow && workflowInDatabase\" class=\"button is-danger\" @click=\"deleteWorkflow\">\n          Delete\n        </button>\n        <button v-if=\"activeWorkflow\" class=\"button\" @click=\"exportWorkflow\">Export</button>\n        <button v-if=\"activeWorkflow\" class=\"button\"\n                :class=\"{\n                  'is-primary': isDirty\n                }\"\n                :disabled=\"!isDirty\"\n                @click=\"saveWorkflow\">\n          <!-- <span v-if=\"workflowInDatabase\">Update</span> -->\n          <span>Save</span>\n        </button>\n      </div>\n    </div>\n\n    <div class=\"container block has-text-centered\" v-if=\"!activeWorkflow\">\n      <div class=\"card block center-block has-text-left is-inline-block\">\n          <!-- <div class=\"card-header\">\n            <h4 class=\"card-header-title\">Pick a template:</h4>\n          </div> -->\n          <div class=\"card-content menu\">\n            <ul class=\"menu-list\">\n              <li>\n                <a @click=\"selectingWorkflowIndex = -1\"\n                  :class=\"{'is-active': selectingWorkflowIndex === -1}\">(start from scratch)</a>\n              </li>\n              <li v-for=\"(workflow, i) in availableWorkflows\" :key=\"workflow.id\">\n                <a @click=\"selectingWorkflowIndex = i\" :class=\"{'is-active': selectingWorkflowIndex === i}\">\n                  <strong>#{{i+1}}</strong>&nbsp;{{workflow.title}}\n                </a>\n              </li>\n            </ul>\n          </div>\n          <div class=\"card-footer\" v-if=\"canEditWorkflow\">\n            <a class=\"card-footer-item\" @click=\"canEditWorkflow && startCreation(false)\">Edit</a>\n          </div><div class=\"card-footer\">\n            <a class=\"card-footer-item\" @click=\"startCreation(true)\">\n              <span v-if=\"selectingWorkflowIndex === -1\">Start New</span>\n              <span v-else>Use as Template</span>\n            </a>\n          </div>\n        </div>\n    </div>\n    <div class=\"block columns is-multiline\" v-else>\n\n      <div class=\"column is-narrow\">\n        <div class=\"box\">\n          <p class=\"title is-5\">Workflow</p>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">ID</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" disabled type=\"text\" :value=\"activeWorkflow.id\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeWorkflow.title\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label\">\n              <label class=\"label\">Stages</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <ul class=\"menu-list\">\n                    <li v-for=\"(stage, i) in activeWorkflow.stages\" :key=\"i\">\n                      <a :class=\"{'is-active': selectedStageIndex === i}\" @click=\"selectStage(i)\"><strong>{{i+1}}&nbsp;</strong>&nbsp;{{stage.title}}</a>\n                    </li>\n                    <li v-if=\"activeStage\"><a @click=\"duplicateStage()\"><span class=\"icon\"><i class=\"far fa-copy\"></i></span><span>Duplicate</span></a></li>\n                    <li><a @click=\"addStage()\"><span class=\"icon\">&plus;</span><span>Add Stage</span></a></li>\n                    <li v-if=\"activeWorkflow.stages.length === 0\">No Stages</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"column is-narrow\" v-if=\"activeStage\">\n        <div class=\"box\">\n          <div class=\"title is-5\">Stage #{{selectedStageIndex + 1}}: <code>{{activeStage.title}}</code></div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Order</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field has-addons\">\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStage(-1)\" @click=\"reorderStage(-1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-down\"></i></div>\n                  </button>\n                </div>\n                <div class=\"control is-expanded\">\n                  <input class=\"input\" type=\"text\" disabled :value=\"selectedStageIndex + 1\">\n                </div>\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStage(1)\" @click=\"reorderStage(1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-up\"></i></div>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeStage.title\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label\">\n              <label class=\"label\">Steps</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <ul class=\"menu-list\">\n                    <li v-for=\"(step, i) in activeStage.steps\" :key=\"i\">\n                      <a :class=\"{'is-active': selectedStepIndex === i}\" @click=\"selectStep(i)\"><strong>{{i+1}}&nbsp;</strong>&nbsp;{{step.title}}</a>\n                    </li>\n                    <li v-if=\"activeStep\"><a @click=\"duplicateStep()\"><span class=\"icon\"><i class=\"far fa-copy\"></i></span><span>Duplicate</span></a></li>\n                    <li><a @click=\"addStep()\">&plus; Add Step</a></li>\n                    <li v-if=\"activeStage.steps.length === 0\">No Steps</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n          <hr>\n          <div class=\"buttons is-right\">\n            <button class=\"button is-danger is-outlined\" @click=\"deleteStage\">Delete</button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"column is-narrow\" v-if=\"activeStep\">\n        <div class=\"box\">\n          <div class=\"title is-5\">Step #{{selectedStepIndex + 1}}: <code>{{activeStep.title}}</code></div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Order</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field has-addons\">\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStep(-1)\" @click=\"reorderStep(-1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-down\"></i></div>\n                  </button>\n                </div>\n                <div class=\"control is-expanded\">\n                  <input class=\"input\" type=\"text\" disabled :value=\"selectedStepIndex + 1\">\n                </div>\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStep(1)\" @click=\"reorderStep(1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-up\"></i></div>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeStep.title\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label\">\n              <label class=\"label\">Type</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <div class=\"select\">\n                    <select v-model=\"activeStep.type\">\n                      <option :value=\"'InstructionOnly'\">Instruction</option>\n                      <option :value=\"'MiniLessonReference'\">Mini Lesson (Reference)</option>\n                      <option :value=\"'MiniLessonEmbedded'\">Mini Lesson (Embedded)</option>\n                      <option :value=\"'UploadTask'\">Video Upload</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-grouped is-grouped-right\" v-if=\"(activeWorkflow?.stages ?? []).length > 1\">\n            <div class=\"control\">\n              <div class=\"dropdown is-right\" :class=\"{'is-active': isMoveStepDropdownActive}\">\n                <div class=\"dropdown-trigger\">\n                  <button class=\"button\" @click=\"isMoveStepDropdownActive = !isMoveStepDropdownActive\">\n                    <span>Move to stage&hellip;</span>\n                    <span class=\"icon is-small\" v-if=\"!isMoveStepDropdownActive\"><i class=\"fas fa-angle-down\" aria-hidden=\"true\"></i></span>\n                    <span class=\"icon is-small\" v-if=\"isMoveStepDropdownActive\"><i class=\"fas fa-angle-up\" aria-hidden=\"true\"></i></span>\n                  </button>\n                </div>\n                <div class=\"dropdown-menu\">\n                  <div class=\"box has-background-white\">\n                    <div class=\"menu\">\n                      <p class=\"menu-label\">Move to stage:</p>\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(stage, stageI) in this.activeWorkflow?.stages ?? []\" :key=\"stageI\">\n                          <a @click=\"moveStep(stageI)\" :class=\"{'is-active': selectedStageIndex === stageI }\">\n                            <strong>{{stageI + 1}}</strong>&nbsp;&nbsp;{{stage.title}}\n                          </a>\n                        </li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <hr>\n\n          <div v-if=\"isInstructionStep\" class=\"block\">\n              <div class=\"field is-horizontal\">\n              <div class=\"field-label is-normal\">\n                <label class=\"label\">Heading</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <input class=\"input\" type=\"text\" v-model=\"activeStep.instructions.heading\">\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"field is-horizontal\">\n              <div class=\"field-label is-normal\">\n                <label class=\"label\">Text</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <textarea class=\"textarea\" v-model=\"activeStep.instructions.text\"></textarea>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div v-if=\"isLessonEmbeddedStep\" class=\"block\">\n            <div v-if=\"activeStep.miniLessonEmbedded\" class=\"card\">\n              <header class=\"card-header\">\n                <p class=\"card-header-title\">{{activeStep.miniLessonEmbedded.header.lessonTitle}}</p>\n              </header>\n              <div class=\"card-content\">\n                <div class=\"content\" v-if=\"activeStepLesson.activities\">\n                  <p>Activities</p>\n                  <ol v-if=\"activeStepLesson.activities.length <= 6\">\n                    <li v-for=\"(activity, i) in activeStepLesson.activities\" :key=\"i\">\n                      {{activity.title}}\n                    </li>\n                  </ol>\n                  <ol v-else>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(0, 3)\" :key=\"i\">{{activity.title}}</li>\n                      <li style=\"list-style:none;\">&hellip;</li>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(-3)\" :key=\"i\" :value=\"activeStepLesson.activities.length - 2 + i\">{{activity.title}}</li>\n                  </ol>\n                </div>\n              </div>\n              <div class=\"card-footer\">\n                <a class=\"card-footer-item has-text-danger\" @click=\"removeEmbeddedLesson\">Remove</a>\n                <a class=\"card-footer-item\" @click=\"convertEmbeddedLessonToReference\">Make Reference</a>\n                <a class=\"card-footer-item\" @click=\"editWorkflowStepLesson\">Edit</a>\n              </div>\n            </div>\n            <div v-else class=\"has-text-centered\">\n              <p>No Embedded Lesson</p>\n\n              <div class=\"field has-addons\">\n                <div class=\"control is-expanded\">\n                  <div class=\"select is-fullwidth\">\n                    <select class=\"select\" v-model=\"newEmbeddedLessonClipName\">\n                      <option disabled value=\"\">Select a clip</option>\n                      <option v-for=\"clipName in availableClips\" :key=\"clipName\">{{clipName}}</option>\n                    </select>\n                  </div>\n                </div>\n                <div class=\"control\">\n                  <button class=\"button is-primary\" :disabled=\"!canCreateEmbeddedLesson\" @click=\"startCreateEmbeddedLesson\">Create</button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div v-if=\"isLessonReferenceStep\" class=\"block\">\n            <div class=\"field is-horizontal\">\n              <div class=\"field-label\">\n                <label class=\"label\">Clip</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <div class=\"select\" v-if=\"activeStep.miniLessonReference\">\n                      <select v-model=\"activeStep.miniLessonReference.clipName\">\n                        <option disabled value=\"\">Select a clip</option>\n                        <option v-for=\"clipName in availableClips\" :key=\"clipName\">{{clipName}}</option>\n                      </select>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\"field is-horizontal\">\n              <div class=\"field-label\">\n                <label class=\"label\">Lesson</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <div class=\"select\">\n                      <select v-model=\"activeStep.miniLessonReference.lessonId\">\n                        <option value=\"\">&plus; Create New</option>\n                        <option disabled>──────────</option>\n                        <option v-for=\"lesson in availableReferenceLessons\" :key=\"lesson._id\" :value=\"lesson._id\">{{lesson.header.lessonTitle}}</option>\n                      </select>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <hr>\n            <div v-if=\"activeStepLesson\" class=\"card\">\n              <header class=\"card-header\">\n                <p class=\"card-header-title\">{{activeStepLesson.header.lessonTitle}}</p>\n              </header>\n              <div class=\"card-content\">\n                <div class=\"content\">\n                  <p>Activities</p>\n                  <ol v-if=\"activeStepLesson.activities.length <= 6\">\n                    <li v-for=\"(activity, i) in activeStepLesson.activities\" :key=\"i\">\n                      {{activity.title}}\n                    </li>\n                  </ol>\n                  <ol v-else>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(0, 3)\" :key=\"i\">{{activity.title}}</li>\n                      <li style=\"list-style:none;\">&hellip;</li>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(-3)\" :key=\"i\" :value=\"activeStepLesson.activities.length - 2 + i\">{{activity.title}}</li>\n                  </ol>\n                </div>\n              </div>\n              <div class=\"card-footer\">\n                <a v-if=\"canEditActiveStepLessonReference\" class=\"card-footer-item\" @click=\"editWorkflowStepLesson\">Edit Referenced Lesson</a>\n                <p v-else class=\"card-footer-item\">Unable to edit a built-in lesson</p>\n              </div>\n            </div>\n            <div v-else class=\"buttons is-centered\">\n              <button class=\"button is-outlined is-primary\" @click=\"createReferencedLesson\"><span class=\"icon is-small\"><i class=\"fa fa-plus\"></i></span><span>Create Referenced Lesson</span></button>\n            </div>\n          </div>\n\n          <div v-if=\"isVideoUploadStep\" class=\"block\"></div>\n\n          <hr>\n\n          <div class=\"buttons is-right\">\n            <button class=\"button is-danger is-outlined\" @click=\"deleteStep\">Delete</button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"column\">\n        <div class=\"box\">\n          <div class=\"title is-5\">Demo</div>\n        </div>\n        <WorkflowMenu :showHeader=\"true\" :showBackButton=\"false\"/>\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': editLessonActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\" style=\"width: 96%; height: 100vh;\">\n        <div class=\"box\">\n          <CreateLessonScreen v-if=\"editLessonActive\"\n            :motion=\"embeddedLessonMotion\"\n            :lessonToEdit=\"activeStepLesson\"\n            @back-selected=\"editLessonActive = false\"\n            @lesson-saved=\"updateWorkflowStepLesson\"\n            :saveToDatabase=\"isLessonReferenceStep\"\n            :showBackButton=\"false\"\n            :showCloseButton=\"true\"\n            :showExportButton=\"isLessonReferenceStep\"\n            :disableEditingExisting=\"true\"\n          />\n        </div>\n        <!-- <UploadCard\n          v-if=\"uploadUIActive\"\n          @cancelled=\"uploadUIActive = false\"\n          :uploadAccept=\"'*.json'\"\n          :onFilesSelected=\"uploadFiles\"\n          :savingText=\"'Loading lessons...'\"\n          :successText=\"'Lessons loaded successfully'\"\n        /> -->\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  CreateBlankWorkflow, GetVideoEntryForWorkflowStep, Instructions, Workflow, WorkflowStage, WorkflowStep,\n} from '@/model/Workflow';\nimport Utils from '@/services/Utils';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport {\n  computed, defineComponent, nextTick, ref, watchEffect,\n} from 'vue';\nimport motionDb from '@/services/MotionDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport CreateLessonScreen from '@/components/screens/CreateLessonScreen.vue';\n\nexport default defineComponent({\n  name: 'CreateWorkflowScreen',\n  emits: ['back-selected', 'workflow-created'],\n  components: {\n    WorkflowMenu,\n    CreateLessonScreen,\n  },\n  setup() {\n\n    const isDirty = ref(false);\n\n    const activeWorkflow = ref(null as null | Workflow);\n    const selectingWorkflowIndex = ref(-1);\n    const canEditWorkflow = computed(() => {\n      const workflow = workflowManager.allWorkflows.value[selectingWorkflowIndex.value];\n      return workflow && workflowManager.isCustomWorkflow(workflow.id);\n    });\n    const workflowInDatabase = computed(() => activeWorkflow.value?.id && WorkflowManager.hasSavedCustomLesson(activeWorkflow.value.id));\n    const selectedStageIndex = ref(0);\n    const activeStage = computed(() => activeWorkflow.value?.stages[selectedStageIndex.value] ?? null);\n    const selectedStepIndex = ref(0);\n    const activeStep = computed(() => activeStage.value?.steps[selectedStepIndex.value] ?? null);\n    const isVideoUploadStep = computed(() => activeStep.value?.type === 'UploadTask');\n    const isLessonReferenceStep = computed(() => activeStep.value?.type === 'MiniLessonReference');\n    const isLessonEmbeddedStep = computed(() => activeStep.value?.type === 'MiniLessonEmbedded');\n    const isInstructionStep = computed(() => activeStep.value?.type === 'InstructionOnly');\n    const availableReferenceLessons = computed(() => {\n      if (!activeStep.value) return [] as MiniLesson[];\n      if (!activeStep.value.miniLessonReference?.clipName) return [] as MiniLesson[];\n      return motionDb.lessonsByVideo.get(activeStep.value.miniLessonReference.clipName) ?? [];\n    });\n    const activeStepLesson = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonReferenceStep.value && activeStep.value.miniLessonReference?.lessonId) return motionDb.lessonsById.get(activeStep.value.miniLessonReference.lessonId) ?? null;\n      if (isLessonEmbeddedStep.value) return activeStep.value.miniLessonEmbedded ?? null;\n      return null;\n    });\n    const canEditActiveStepLessonReference = computed(() => activeStepLesson.value?.source === 'custom');\n    const newEmbeddedLessonClipName = ref('');\n    const newEmbeddedLessonMotion = computed(() => motionDb.motionsMap.get(newEmbeddedLessonClipName.value) ?? null);\n    const canCreateEmbeddedLesson = computed(() => newEmbeddedLessonMotion.value !== null);\n    const editLessonActive = ref(false);\n    const embeddedLessonMotion = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonEmbeddedStep.value && activeStep.value.miniLessonEmbedded) return GetVideoEntryForWorkflowStep(motionDb, activeStep.value);\n      if (isLessonEmbeddedStep.value) return newEmbeddedLessonMotion.value;\n      if (isLessonReferenceStep.value) return GetVideoEntryForWorkflowStep(motionDb, activeStep.value);\n      return null;\n    });\n\n    watchEffect(() => {\n      if (activeWorkflow.value) {\n        workflowManager.setActiveFlow(activeWorkflow.value.id);\n        workflowManager.completeActivitesPriorToStageAndStep(selectedStageIndex.value, selectedStepIndex.value);\n        // TODO: improve logic to keep status of intra-stage workflow steps.\n      }\n    });\n\n    watchEffect(() => {\n      if (!activeStep.value) return;\n      if (isInstructionStep.value) {\n        activeStep.value.instructions = activeStep.value.instructions ?? {\n          heading: 'Instructions Heading',\n          text: '',\n        } as Instructions;\n      } else if (isLessonReferenceStep.value) {\n        activeStep.value.miniLessonReference = activeStep.value.miniLessonReference ?? {} as any;\n        //  ?? {\n\n        // };\n      } else if (isLessonEmbeddedStep.value) {\n        // activeStep.value.miniLessonEmbedded = activeStep.value.miniLessonEmbedded;\n        //  ?? {\n\n        // };\n      } else if (isVideoUploadStep.value) {\n        activeStep.value.upload = activeStep.value.upload ?? {\n          identifier: activeStep.value.title,\n          prompt: 'Upload your video here',\n        };\n      }\n    });\n\n    return {\n      selectingWorkflowIndex,\n      activeWorkflow,\n      canEditWorkflow,\n      workflowInDatabase,\n      availableWorkflows: workflowManager.allWorkflows,\n      selectedStageIndex,\n      activeStage,\n\n      selectedStepIndex,\n      activeStep,\n      isVideoUploadStep,\n      isLessonReferenceStep,\n      isLessonEmbeddedStep,\n      isInstructionStep,\n      availableClips: motionDb.motionNames,\n      availableReferenceLessons,\n      newEmbeddedLessonClipName,\n      newEmbeddedLessonMotion,\n      embeddedLessonMotion,\n      canCreateEmbeddedLesson,\n      editLessonActive,\n      activeStepLesson,\n      canEditActiveStepLessonReference,\n      isMoveStepDropdownActive: ref(false),\n\n      isDirty,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  watch: {\n    activeWorkflow: {\n      handler(newVal) {\n        console.log('Workflow now dirty');\n        this.isDirty = ((newVal ?? null) !== null);\n      },\n      deep: true,\n    },\n  },\n  computed: {\n  },\n  methods: {\n    goBack(skipPrompt?: boolean) {\n      if (!this.activeWorkflow) {\n        this.$emit('back-selected');\n        return;\n      }\n\n      if (skipPrompt || !this.isDirty) {\n        this.activeWorkflow = null;\n        return;\n      }\n\n      // eslint-disable-next-line no-alert\n      if (window.confirm('Go back without saving changes?')) {\n        workflowManager.reloadCustomWorkflow(this.activeWorkflow.id);\n        this.activeWorkflow = null;\n      }\n    },\n    deleteWorkflow() {\n      if (!this.activeWorkflow) return;\n\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      workflowManager.deleteCustomWorkflow(this.activeWorkflow.id);\n      this.goBack(true);\n    },\n    exportWorkflow() {\n      if (!this.activeWorkflow) return;\n      Utils.PromptDownloadFile(`${this.activeWorkflow.title}.workflow.json`, JSON.stringify(this.activeWorkflow));\n    },\n    saveWorkflow() {\n      if (!this.activeWorkflow) return;\n      console.log('Saving workflow');\n      workflowManager.upsertCustomWorkflow(this.activeWorkflow);\n      nextTick(() => {\n        this.isDirty = false;\n        console.log('Workflow saved; not dirty now');\n      });\n      // window.setTimeout(() => {\n      // }, 200);\n    },\n    startCreation(asTemplate: boolean) {\n      const existingWorkflow = this.availableWorkflows[this.selectingWorkflowIndex];\n      if (existingWorkflow && asTemplate) {\n        this.activeWorkflow = Utils.deepCopy(existingWorkflow);\n        this.activeWorkflow.id = Utils.uuidv4();\n      } else if (existingWorkflow && !asTemplate) {\n        this.activeWorkflow = existingWorkflow;\n        nextTick(() => {\n          this.isDirty = false;\n        });\n\n      } else {\n        this.activeWorkflow = CreateBlankWorkflow();\n      }\n\n      workflowManager.addSessionWorkflow(this.activeWorkflow);\n      workflowManager.setActiveFlow(this.activeWorkflow.id);\n    },\n    selectStage(stageIndex: number) {\n\n      // Clear selection if this stage was already selected\n      if (stageIndex === this.selectedStageIndex) {\n        this.selectedStageIndex = -1;\n        this.selectedStepIndex = -1;\n        return;\n      }\n\n      this.selectedStageIndex = stageIndex;\n      this.selectedStepIndex = -1;\n      workflowManager.completeActivitesPriorToStageAndStep(stageIndex, this.selectedStepIndex);\n    },\n    canReorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      const swapStage = stages[this.selectedStageIndex + increment];\n      return (curStage !== undefined) && (swapStage !== undefined);\n    },\n    reorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const swapIndex = this.selectedStageIndex + increment;\n      const curSelected = stages[this.selectedStageIndex];\n      const toSwap = stages[swapIndex];\n      if ((curSelected === undefined) || (toSwap === undefined)) {\n        console.warn(`Unable to swap stages ${this.selectedStageIndex} and ${swapIndex}`);\n        return;\n      }\n      stages[this.selectedStageIndex] = toSwap;\n      stages[swapIndex] = curSelected;\n      this.selectedStageIndex = swapIndex;\n      workflow.stages = stages;\n    },\n    addStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n\n      workflow.stages.push({\n        title: `New-Stage-${workflow.stages.length + 1}`,\n        steps: [],\n      } as WorkflowStage);\n      this.selectStage(workflow.stages.length - 1);\n    },\n    duplicateStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      if (!curStage) return;\n      stages.splice(this.selectedStageIndex, 0, Utils.deepCopy(curStage));\n      workflow.stages = stages;\n      this.selectedStageIndex += 1;\n    },\n    deleteStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Stage #${this.selectedStageIndex + 1}?`)) return;\n\n      const { stages } = workflow;\n      stages.splice(this.selectedStageIndex, 1);\n      workflow.stages = stages;\n      this.selectedStageIndex = Math.min(this.selectedStageIndex, stages.length - 1);\n    },\n    selectStep(stepIndex: number) {\n\n      // Clear selectedStep if already selected\n      if (this.selectedStepIndex === stepIndex) {\n        this.selectedStepIndex = -1;\n        return;\n      }\n      this.selectedStepIndex = stepIndex;\n\n      workflowManager.completeActivitesPriorToStageAndStep(this.selectedStageIndex, this.selectedStepIndex);\n    },\n    canReorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return false;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[this.selectedStepIndex + increment];\n      return (curStep !== undefined) && (swapStep !== undefined);\n    },\n    reorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return;\n      const swapIndex = this.selectedStepIndex + increment;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[swapIndex];\n      if ((curStep === undefined) || (swapStep === undefined)) {\n        console.warn(`Unable to swap steps ${this.selectedStepIndex} and ${swapIndex}`);\n        return;\n      }\n      steps[this.selectedStageIndex] = swapStep;\n      steps[swapIndex] = curStep;\n      this.selectedStepIndex = swapIndex;\n      workflow.stages[this.selectedStageIndex].steps = steps;\n    },\n    addStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n\n      stage.steps.push({\n        title: `New-Step-${stage.steps.length + 1}`,\n        type: 'InstructionOnly',\n      } as WorkflowStep);\n      this.selectStep(stage.steps.length - 1);\n    },\n    duplicateStep() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const curStep = this.activeWorkflow?.stages[this.selectedStageIndex]?.steps[this.selectedStepIndex];\n      if (!curStep) return;\n      const { steps } = workflow.stages[this.selectedStageIndex];\n      steps.splice(this.selectedStepIndex, 0, Utils.deepCopy(curStep));\n      workflow.stages[this.selectedStageIndex].steps = steps;\n      this.selectedStepIndex += 1;\n    },\n    moveStep(targetStageIndex: number) {\n      if (targetStageIndex === this.selectedStageIndex) return;\n      const stage = this.activeStage;\n      const stepToMove = this.activeStep;\n      const targetPhase = this.activeWorkflow?.stages[targetStageIndex];\n      if (!stage || !stepToMove || !targetPhase) return;\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      targetPhase.steps.push(stepToMove);\n      this.selectedStageIndex = targetStageIndex;\n      this.selectedStepIndex = this.activeStage?.steps.length ?? 0;\n      this.isMoveStepDropdownActive = false;\n    },\n    deleteStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Step #${this.selectedStepIndex + 1}?`)) return;\n\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      this.selectedStepIndex = Math.min(this.selectedStepIndex, steps.length - 1);\n    },\n    updateWorkflowStepLesson(lesson: MiniLesson) {\n      if (!this.activeStep) return;\n      if (this.isLessonEmbeddedStep) {\n        this.activeStep.miniLessonEmbedded = lesson;\n        console.log('Updated embedded lesson', lesson.header.lessonTitle);\n      }\n      if (this.isLessonReferenceStep && this.activeStep.miniLessonReference) {\n        this.activeStep.miniLessonReference.lessonId = lesson._id;\n        console.log('Updated reference lesson', lesson);\n      }\n    },\n    startCreateEmbeddedLesson() {\n      if (!this.activeStep) return;\n      if (!this.newEmbeddedLessonMotion) return;\n      // this.activeStep.miniLessonEmbedded = createBlankLesson(this.newEmbeddedLessonMotion);\n      // this.activeStep.miniLessonEmbedded.header.lessonTitle = this.activeStep.title;\n      this.editLessonActive = true;\n    },\n    createReferencedLesson() {\n      if (!this.isLessonReferenceStep) return;\n      if (this.activeStep?.miniLessonReference?.lessonId === '') {\n        this.editLessonActive = true;\n      }\n    },\n    editWorkflowStepLesson() {\n      if (!this.activeStepLesson) return;\n      this.editLessonActive = true;\n    },\n    removeEmbeddedLesson() {\n      if (!this.activeStep?.miniLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (window.confirm(`Are you sure you want to delete the embedded lesson ${this.activeStep.miniLessonEmbedded.header.lessonTitle}?`)) {\n        this.activeStep.miniLessonEmbedded = undefined;\n      }\n    },\n    convertEmbeddedLessonToReference() {\n      if (!this.activeStep?.miniLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to save this lesson into a new file and convert this to a reference?'\n                         + '\\n\\nNote: be sure to save the lesson.json!')\n      ) return;\n\n      motionDb.saveCustomLesson(this.activeStep.miniLessonEmbedded);\n      this.activeStep.miniLessonReference = {\n        clipName: this.activeStep.miniLessonEmbedded.header.clipName,\n        lessonId: this.activeStep.miniLessonEmbedded._id,\n      };\n      const exportLessonData = this.activeStep.miniLessonEmbedded;\n      this.activeStep.type = 'MiniLessonReference';\n      this.activeStep.miniLessonEmbedded = undefined;\n      Utils.PromptDownloadFile(`${exportLessonData.header.lessonTitle}.lesson.json`, JSON.stringify(exportLessonData));\n    },\n  },\n});\n</script>\n\n<style lang=\"sass\">\n\n</style>\n","<template>\n    <section class=\"section create-lesson-screen\">\n      <div class=\"hero is-primary block\">\n        <div class=\"hero-body\">\n          <div class=\"container\">\n            <p class=\"title\">\n              Lesson Creation\n            </p>\n            <p class=\"subtitle\">\n              <span v-if=\"state === LessonCreationState.SelectOpenLesson\">Template Selection</span>\n              <span v-else>Editing &quot;{{lessonUnderConstruction.header.lessonTitle}}&quot;</span>\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"container block\">\n        <div class=\"buttons is-centered has-addons\">\n          <button v-if=\"showBackButton\" class=\"button\" :class=\"{'is-danger': isDirty, 'is-outlined': isDirty, 'is-primary': !isDirty}\" @click=\"goBack\">&lt; Back</button>\n          <button v-if=\"showCloseButton\" class=\"button\" :class=\"{'is-danger': isDirty, 'is-outlined': isDirty, 'is-primary': !isDirty}\" @click=\"goBack\"><i class=\"fa fa-close\"></i> Close</button>\n          <button v-if=\"state === LessonCreationState.ModifyLesson && canDeleteLesson\" class=\"button is-danger is-outlined\" @click=\"deleteLesson\">\n            Delete\n          </button>\n          <button v-if=\"state === LessonCreationState.ModifyLesson && showExportButton\" class=\"button\" @click=\"exportLesson\">Export</button>\n          <button v-if=\"state === LessonCreationState.ModifyLesson\" class=\"button\" :class=\"{'is-primary': isDirty}\" :disabled=\"!isDirty\" @click=\"saveLesson\">\n            <span v-if=\"lessonInDatabase\">Update</span>\n            <span v-else>Save</span>\n          </button>\n        </div>\n      </div>\n\n      <div v-if=\"state === LessonCreationState.SelectOpenLesson\" class=\"container has-text-centered\">\n        <div class=\"card block center-block has-text-left\">\n          <div class=\"card-header\">\n            <h4 class=\"card-header-title\">Pick a template:</h4>\n          </div>\n          <div class=\"card-content menu\">\n            <ul class=\"menu-list\">\n              <li>\n                <a @click=\"activeLessonSelectionIndex = -1\"\n                  :class=\"{'is-active': activeLessonSelectionIndex === -1}\">(start from scratch)</a>\n              </li>\n              <li v-for=\"(lesson, i) in lessons\" :key=\"lesson._id\">\n                <a @click=\"activeLessonSelectionIndex = i\" :class=\"{'is-active': activeLessonSelectionIndex === i}\">\n                  <strong>#{{i+1}}</strong>&nbsp;{{lesson.header.lessonTitle}}\n                </a>\n              </li>\n            </ul>\n          </div>\n          <div class=\"card-footer\" v-if=\"canEditActiveLesson && !disableEditingExisting\">\n            <p v-if=\"disableEditingExisting\" class=\"card-footer-item\">Editing disabled</p>\n            <a v-else class=\"card-footer-item\" @click=\"startCreation(false)\">Edit</a>\n          </div><div class=\"card-footer\">\n            <a class=\"card-footer-item\" @click=\"startCreation(true)\">\n              <span v-if=\"activeLessonSelectionIndex === -1\">Start New</span>\n              <span v-else>Use as Template</span>\n            </a>\n          </div>\n        </div>\n      </div>\n\n      <div v-if=\"state === LessonCreationState.ModifyLesson\" class=\"block\">\n        <div class=\"columns is-multiline is-centered\">\n          <div class=\"column is-half is-one-third-widescreen is-one-quarter-fullhd\">\n            <div class=\"box\">\n              <h5 class=\"title is-5\">Lesson</h5>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Id</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" disabled type=\"text\" :value=\"lessonUnderConstruction._id\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Clip</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" disabled type=\"text\" :value=\"motion.title\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Title</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" type=\"text\" v-model=\"lessonUnderConstruction.header.lessonTitle\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field\">\n                <label class=\"label\">Segments</label>\n                <div class=\"control block\">\n                  <SegmentedProgressBar\n                  :segments=\"progressSegments\"\n                    :progress=\"motion.duration\"\n                    :enableAll=\"true\"/>\n                  </div>\n                  <div class=\"control block\">\n                    <div class=\"block\">\n                      <div class=\"field has-addons is-inline-block m-1\" v-for=\"(segBreak, i) in lessonUnderConstruction.segmentBreaks\" :key=\"i\">\n                        <span class=\"control\">\n                          <input\n                              class=\"input narrow-number-input is-small\"\n                              :key=\"i\"\n                              type=\"number\"\n                              :value=\"lessonUnderConstruction.segmentBreaks[i].toFixed(2)\"\n                              @input=\"setSegmentBreak(i, $event)\"\n                              :min=\"0\"\n                              :step=\"0.01\"\n                              :max=\"motion.duration\" />\n                          </span>\n                          <span class=\"control\">\n                            <button class=\"button is-danger is-small is-light\" :disabled=\"!canDeleteSegment(i)\" @click=\"removeSegmentBreak(i)\">\n                              <span class=\"icon\">\n                                <i class=\"fas fa-times\"></i>\n                              </span>\n                            </button>\n                          </span>\n                      </div>\n                    </div>\n                    <div class=\"block has-text-right\">\n                      <!-- <span>Add New</span> -->\n                      <input\n                          class=\"input narrow-number-input is-info\"\n                          type=\"number\"\n                          v-model.number=\"newSegmentVal\"\n                          :min=\"0\"\n                          :step=\"0.01\"\n                          :max=\"motion.duration\" />\n                      <button class=\"ml-1 button is-info is-light\" @click=\"addSegmentBreak(newSegmentVal)\">Add Segment</button>\n                    </div>\n                  </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Activities</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(activity, i) in lessonUnderConstruction.activities\" :key=\"i\">\n                          <a :class=\"{'is-active': activeActivityIndex === i}\" @click=\"selectActivity(i)\"><strong>{{i+1}}&nbsp;</strong>&nbsp;{{activity.title}}</a>\n                        </li>\n                        <li v-if=\"activeActivity\"><a @click=\"duplicateActivity()\"><span class=\"icon\"><i class=\"far fa-copy\"></i></span><span>Duplicate</span></a></li>\n                        <li><a @click=\"addActivity()\">&plus; Add Activity</a></li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Activities</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"column is-half is-one-third-widescreen is-one-quarter-fullhd\">\n            <div class=\"box\">\n              <h5 class=\"title is-5\">Activity</h5>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Order</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field has-addons\">\n                    <div class=\"control\">\n                      <button class=\"button\" :disabled=\"!canReorderActivity(activeActivityIndex, -1)\" @click=\"reorderActivity(activeActivityIndex, -1)\">\n                        <div class=\"icon\"><i class=\"fas fa-chevron-down\"></i></div>\n                      </button>\n                    </div>\n                    <div class=\"control is-expanded\">\n                      <input class=\"input\" type=\"text\" disabled :value=\"activeActivityIndex + 1\">\n                    </div>\n                    <div class=\"control\">\n                      <button class=\"button\" :disabled=\"!canReorderActivity(activeActivityIndex, 1)\" @click=\"reorderActivity(activeActivityIndex, 1)\">\n                        <div class=\"icon\"><i class=\"fas fa-chevron-up\"></i></div>\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Title</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.title\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Playback Speed</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeActivity.practiceSpeed\" min=\"0\" step=\"0.01\" :max=\"2\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Focused Segments</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div v-for=\"(segInfo, i) in activeActivityFocusedSegments\" :key=\"i\">\n                      <label class=\"checkbox\">\n                        <input type=\"checkbox\" :checked=\"activeActivityFocusedSegments[i].isFocused\" @input=\"setFocusedSegment(i, $event)\">&nbsp;<strong>{{i+1}}</strong>: <code>{{segInfo.startTime.toFixed(2)}}</code>-<code>{{segInfo.endTime.toFixed(2)}}</code>\n                      </label>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Start Time</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeActivity.startTime\" min=\"0\" step=\"0.01\" :max=\"motion.duration\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeActivity.startTime\" min=\"0\" step=\"0.01\" :max=\"motion.duration\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">End Time</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeActivity.endTime\" :min=\"0\" step=\"0.01\" :max=\"motion.duration\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeActivity.endTime\" :min=\"0\" step=\"0.01\" :max=\"motion.duration\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">User Visual</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <div class=\"select\">\n                        <select v-model=\"activeActivity.userVisual\">\n                          <option value=\"none\">None</option>\n                          <option value=\"skeleton\">Skeleton</option>\n                          <option value=\"viideo\">Webcam</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Demo Visual</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <div class=\"select\">\n                        <select v-model=\"activeActivity.demoVisual\">\n                          <option value=\"none\">None</option>\n                          <option value=\"skeleton\">Skeleton</option>\n                          <option value=\"video\">Video</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Keyframe Visual</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <div class=\"select\">\n                        <select v-model=\"activeActivity.keyframeVisual\">\n                          <option value=\"none\">None</option>\n                          <option value=\"skeleton\">Skeleton</option>\n                          <option value=\"video\">Video</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Keyframes</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field has-addons\">\n                    <div class=\"control\">\n                      <button class=\"button is-static\">\n                        {{activeActivityKeyframes.length}} Keyframes\n                      </button>\n                    </div>\n                    <div class=\"control\">\n                      <button class=\"button\" @click=\"keyframeSelectorToolActive = !keyframeSelectorToolActive\">\n                        Edit\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Start Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.startInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Playing Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.playingInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">End Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.endInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Static Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.staticInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Pauses</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(pause, i) in activeActivity.pauses ?? []\" :key=\"i\">\n                          <a :class=\"{'is-active': activePauseIndex === i}\" @click=\"selectPause(i)\">\n                            <strong>#{{i+1}}</strong>\n                            at <span class=\"is-underlined\">{{pause.time.toFixed(2)}}</span>\n                            for <span class=\"is-underlined\">{{(pause.pauseDuration ?? Constants.DefaultPauseDuration).toFixed(2)}}</span>s\n                            <small v-if=\"pause.instruction\">&nbsp; : &nbsp;<span>&quot;{{pause.instruction}}&quot;</span></small>\n                          </a>\n                        </li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Pauses</li>\n                        <li><a @click=\"addPause()\">&plus; Add Pause</a></li>\n                        <li v-show=\"(activeActivity.pauses?.length ?? 0) >= 2\"><a @click=\"sortPauses()\">Sort Pauses</a></li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Timed Instructions</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(ti, i) in activeActivity.timedInstructions ?? []\" :key=\"i\">\n                          <a :class=\"{'is-active': activeTimedInstructionIndex === i}\" @click=\"selectTimedInstruction(i)\">\n                            <strong>#{{i+1}}</strong>&nbsp;\n                            <small>&quot;{{ti.text}}&quot;</small>\n                            from <span class=\"is-underlined\">{{ti.startTime.toFixed(2)}}</span>s\n                            to <span class=\"is-underlined\">{{ti.endTime.toFixed(2)}}</span>s\n                          </a>\n                        </li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Timed Instructions</li>\n                        <li><a @click=\"addTimedInstruction()\">&plus; Add Timed Instruction</a></li>\n                        <li v-show=\"(activeActivity.timedInstructions?.length ?? 0) >= 2\"><a @click=\"sortTimedInstructions()\">Sort Timed Instructions</a></li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Timed Instructions</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"block buttons is-right\">\n                <button class=\"button is-outlined is-danger\" :disabled=\"!canDeleteActivity(activeActivityIndex)\" @click=\"deleteActivity(activeActivityIndex)\">Delete Activity #{{activeActivityIndex + 1}}</button>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"column is-half is-one-third-widescreen is-one-quarter-fullhd\"\n               v-if=\"activePause || activeTimedInstruction\">\n            <div v-if=\"activePause\" class=\"box\">\n              <h6 class=\"title is-5\">Pause {{activePauseIndex + 1}} Details</h6>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\"><label class=\"label\">Time</label></div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activePause.time\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activePause.time\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Duration</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activePause.pauseDuration\" min=\"0\" step=\"0.01\" :max=\"10\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activePause.instruction\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field\">\n                <div class=\"control\">\n                  <button class=\"button is-danger is-outlined\" @click=\"deletePause(activePause)\">Remove Pause {{activePauseIndex + 1}}</button>\n                </div>\n              </div>\n            </div> <!-- End pause detail section-->\n\n            <div v-if=\"activeTimedInstruction\" class=\"box\">\n              <h6 class=\"title is-5\">Timed Instruction {{activeTimedInstructionIndex + 1}} Details</h6>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\"><label class=\"label\">Start Time</label></div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeTimedInstruction.startTime\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeTimedInstruction.endTime\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeTimedInstruction.startTime\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\"><label class=\"label\">End Time</label></div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeTimedInstruction.endTime\" :min=\"activeTimedInstruction.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeTimedInstruction.endTime\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Text</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeTimedInstruction.text\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field\">\n                <div class=\"control\">\n                  <button class=\"button is-danger is-outlined\" @click=\"deleteTimedInstruction(activeTimedInstruction)\">Remove Timed Instruction {{activeTimedInstructionIndex + 1}}</button>\n                </div>\n              </div>\n            </div> <!-- End timed instruction detail section-->\n          </div>\n\n          <div class=\"column is-half-tablet is-half-desktop is-one-third-widescreen is-one-quarter-fullhd\">\n            <div class=\"box\">\n              <h5 class=\"title is-5\">Demo</h5>\n\n              <div class=\"image is-square\">\n                <!-- <div style=\"height:400px;width:100%;\"> -->\n                  <MiniLessonPlayer\n                   class=\"is-overlay\"\n                    ref=\"miniLessonPlayer\"\n                    @activity-changed=\"selectActivity\"\n                    :videoEntry=\"motion\"\n                    :miniLesson=\"lessonUnderConstruction\"\n                    :enableCompleteLesson=\"false\"\n                  />\n                <!-- </div> -->\n              </div>\n            <!--\n              <ActivityVideoPlayer\n                class=\"block\"\n                ref=\"activityVideoPlayer\"\n                :motion=\"motion\"\n                :lesson=\"lessonUnderConstruction\"\n                :activity=\"activeActivity\"\n                :maxHeight=\"'400px'\"\n                @progress=\"onProgress\" />\n\n              <SegmentedProgressBar\n                class=\"block\"\n                :segments=\"progressSegments\"\n                :progress=\"activityProgress\"/>\n\n              <div class=\"buttons is-centered has-addons\">\n                <button class=\"button\" :disabled=\"!hasPreviousActivity\" @click=\"activeActivityIndex -= 1\">&lt;</button>\n                <button class=\"button is-primary\" :disabled=\"!($refs.activityVideoPlayer?.awaitingStart ?? false)\" @click=\"playDemo\">Play Activity</button>\n                <button class=\"button\" :disabled=\"!($refs.activityVideoPlayer?.activityFinished ?? false)\" @click=\"$refs.activityVideoPlayer?.reset()\">Reset</button>\n                <button class=\"button\" :disabled=\"!hasNextActivity\" @click=\"activeActivityIndex += 1\">&gt;</button>\n              </div> -->\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div v-bind:class=\"{ 'is-active': keyframeSelectorToolActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\" style=\"width: 96%; height: 100vh;\">\n        <KeyframeSelectorTool\n          v-if=\"keyframeSelectorToolActive\"\n          v-model=\"activeActivityKeyframes\"\n          :videoEntry=\"motion\"\n          @back-selected=\"keyframeSelectorToolActive=false\"\n          :startTime=\"activeActivity.startTime\"\n          :endTime=\"activeActivity.endTime\"\n        />\n      </div>\n    </div>\n    </section>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed,\n  defineComponent, nextTick, ref, toRefs, watchEffect,\n} from 'vue';\n\nimport Constants from '@/services/Constants';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport db, { createBlankActivity, createBlankLesson, DatabaseEntry } from '@/services/MotionDatabase';\nimport MiniLesson, { MiniLessonActivity, PauseInfo, TimedInstruction } from '@/model/MiniLesson';\nimport Utils from '@/services/Utils';\nimport SegmentedProgressBar, { ProgressSegmentData, calculateProgressSegments } from '@/components/elements/SegmentedProgressBar.vue';\nimport KeyframeSelectorTool from '@/components/tools/KeyframeSelectorTool.vue';\n\nconst LessonCreationState = Object.freeze({\n  SelectOpenLesson: 'SelectOpenLesson',\n  ModifyLesson: 'ModifyLesson',\n});\n\ninterface SegmentInfo {\n  isFocused: boolean;\n  startTime: number;\n  endTime: number;\n}\n\nexport default defineComponent({\n  name: 'CreateLessonScreen',\n  components: {\n    MiniLessonPlayer,\n    SegmentedProgressBar,\n    KeyframeSelectorTool,\n  },\n  props: {\n    motion: {\n      type: Object,\n      required: true,\n    },\n    saveReference: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    showCloseButton: {\n      type: Boolean,\n      default: false,\n    },\n    showExportButton: {\n      type: Boolean,\n      default: true,\n    },\n    lessonToEdit: {\n      type: Object,\n      default: null,\n    },\n    saveToDatabase: {\n      type: Boolean,\n      default: true,\n    },\n    disableEditingExisting: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['back-selected', 'lesson-saved'],\n  data() {\n    return {\n      newPauseTime: 0,\n      newSegmentVal: 0,\n      activeLessonSelectionIndex: -1,\n      activePauseIndex: 0,\n      activeTimedInstructionIndex: 0,\n      keyframeSelectorToolActive: false,\n      // activityProgress: 0,\n    };\n  },\n  computed: {\n    activeActivityKeyframes: {\n      get(): number[] {\n        return (this as any).activeActivity?.keyframes ?? [];\n      },\n      set(newVal: number[]) {\n        this.activeActivity.keyframes = newVal;\n      },\n    },\n    displayMode: {\n      get() {\n        const demoVisual = this.activeActivity.demoVisual ?? 'video';\n        const userVisual = this.activeActivity.userVisual ?? 'none';\n        if (demoVisual === 'video' && userVisual === 'none') return 'video-demo';\n        if (demoVisual === 'skeleton' && userVisual === 'video') return 'skeleton-overlay';\n        return 'other';\n      },\n      set(newVal: 'other' | 'video-demo' | 'skeleton-overlay') {\n        if (newVal === 'video-demo') {\n          this.activeActivity.demoVisual = 'video';\n          this.activeActivity.userVisual = 'none';\n        } else if (newVal === 'skeleton-overlay') {\n          this.activeActivity.demoVisual = 'skeleton';\n          this.activeActivity.userVisual = 'video';\n        }\n      },\n    },\n    activeActivityFocusedSegments() {\n      const segBreaks = (this as any).lessonUnderConstruction.segmentBreaks as number[];\n      const segs: number[] = (this as any).activeActivity?.focusedSegments ?? [];\n      const segsSet = new Set(segs);\n      const boolArray = Utils.range((this as any).lessonUnderConstruction.segmentBreaks.length - 1)\n        .map((i) => ({\n          isFocused: segsSet.has(i),\n          startTime: segBreaks[i],\n          endTime: segBreaks[i + 1],\n        } as SegmentInfo));\n      return boolArray;\n    },\n    activeLessonSelection(): MiniLesson | null {\n      return this.lessons[this.activeLessonSelectionIndex] ?? null;\n    },\n    lessonInDatabase(): boolean {\n      return db.hasLesson(this.lessonUnderConstruction);\n    },\n    canDeleteLesson(): boolean {\n      return this.lessonInDatabase && this.lessonUnderConstruction.source === 'custom';\n    },\n    lessonStartTime(): number {\n      return this.lessonUnderConstruction?.segmentBreaks[0] ?? 0;\n    },\n    lessonEndTime(): number {\n      return this.lessonUnderConstruction.segmentBreaks[this.lessonUnderConstruction.segmentBreaks.length - 1] ?? this.motion?.duration ?? 1;\n    },\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      const lessons = db.getLessons(motion);\n      return lessons ?? [];\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lessonUnderConstruction) return calculateProgressSegments(this.lessonUnderConstruction, this.activeActivity);\n      return [];\n    },\n    activePause(): null | PauseInfo {\n      return ((this as any).activeActivity.pauses ?? [])[(this as any).activePauseIndex] ?? null;\n    },\n    activeTimedInstruction(): null | TimedInstruction {\n      return ((this as any).activeActivity.timedInstructions ?? [])[(this as any).activeTimedInstructionIndex] ?? null;\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < this.lessonUnderConstruction.activities.length;\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    canEditActiveLesson() {\n      const acLes = this.activeLessonSelection as MiniLesson;\n      return acLes?.source === 'custom';\n    },\n  },\n  mounted() {\n    const passedInLesson = this.$props.lessonToEdit as MiniLesson | null;\n    if (passedInLesson) {\n      console.log('CreateLessonScreen:: using passed in lesson', passedInLesson);\n      this.startCreation(false, Utils.deepCopy(passedInLesson));\n      nextTick(() => { this.isDirty = false; });\n    } else if (this.lessons.length === 0) {\n      console.log('CreateLessonScreen:: creating blank lesson (no templates available)');\n      this.startCreation(true);\n    }\n  },\n  setup(props) {\n    const { motion } = toRefs(props);\n    const isDirty = ref(false);\n    const typedMotion = computed(() => motion.value as unknown as DatabaseEntry);\n    const state = ref(LessonCreationState.SelectOpenLesson);\n    const lessonUnderConstruction = ref(createBlankLesson(typedMotion.value));\n    const activeActivityIndex = ref(0);\n    const activeActivity = computed(() => lessonUnderConstruction.value.activities[activeActivityIndex.value]);\n\n    watchEffect(() => {\n      if (activeActivity.value.startTime < 0) activeActivity.value.startTime = 0;\n      if (activeActivity.value.endTime > motion.value.duration) activeActivity.value.endTime = motion.value.duration;\n      if (+activeActivity.value.endTime < +activeActivity.value.startTime) activeActivity.value.endTime = activeActivity.value.startTime;\n    });\n\n    return {\n      isDirty,\n      state,\n      typedMotion,\n      LessonCreationState,\n      lessonUnderConstruction,\n      activeActivityIndex,\n      activeActivity,\n      Constants,\n    };\n  },\n  watch: {\n    activeActivityIndex: {\n      handler(newVal: number) {\n        (this.$refs.miniLessonPlayer as any).activeActivityIndex = newVal;\n      },\n    },\n    lessonUnderConstruction: {\n      handler() {\n        this.isDirty = true;\n      },\n      deep: true,\n    },\n    'lessonUnderConstruction.segmentBreaks': {\n      handler() {\n        this.sortSegmentBreaks();\n      },\n      deep: true,\n    },\n    'activePause.time': {\n      handler() {\n        this.sortPauses();\n      },\n    },\n    'activeTimedInstruction.startTime': {\n      handler() {\n        this.sortTimedInstructions();\n      },\n    },\n  },\n  methods: {\n    canDeleteSegment(segmentIndex: number) {\n      return this.progressSegments.length > 1;\n    },\n    goBack() {\n      // eslint-disable-next-line no-alert\n      if (!this.isDirty || window.confirm('Are you sure you want to go back without saving?')) {\n        this.$emit('back-selected');\n      }\n    },\n    startCreation(asTemplate: boolean, sourceLesson?: MiniLesson) {\n      const existingLesson = sourceLesson ?? this.activeLessonSelection;\n      if (existingLesson && asTemplate) {\n        console.log('Creating new lesson from template');\n        this.lessonUnderConstruction = Utils.deepCopy(existingLesson);\n        this.lessonUnderConstruction._id = Utils.uuidv4();\n        this.lessonUnderConstruction.source = 'custom';\n      } else if (existingLesson && !asTemplate) {\n        console.log('Editing existing lesson');\n        this.lessonUnderConstruction = existingLesson;\n        nextTick(() => { this.isDirty = false; });\n      } else {\n        console.log('Creating new lesson from scratch');\n        this.lessonUnderConstruction = createBlankLesson(this.typedMotion);\n      }\n      this.state = LessonCreationState.ModifyLesson;\n    },\n    addActivity(targetIndex?: number) {\n      const newActivity: MiniLessonActivity = createBlankActivity(this.typedMotion, `Activity ${this.lessonUnderConstruction.activities.length + 1}`);\n\n      if (targetIndex === undefined) {\n        this.lessonUnderConstruction.activities.push(newActivity);\n        this.activeActivityIndex = this.lessonUnderConstruction.activities.length - 1;\n      } else {\n        this.lessonUnderConstruction.activities.splice(targetIndex, 0, newActivity);\n        this.activeActivityIndex = targetIndex;\n      }\n    },\n    selectActivity(targetIndex: number) {\n      this.activeActivityIndex = targetIndex;\n    },\n    canDeleteActivity(targetIndex: number) {\n      return this.lessonUnderConstruction.activities.length > 1;\n    },\n    canReorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapActivity = this.lessonUnderConstruction.activities[targetIndex + indexDelta];\n      return (curActivity !== undefined && swapActivity !== undefined);\n    },\n    reorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapIndex = targetIndex + indexDelta;\n      const swapActivity = this.lessonUnderConstruction.activities[swapIndex];\n      if (curActivity === undefined || swapActivity === undefined) {\n        console.error(`Cannot reorder activities ${targetIndex} and ${swapIndex}`);\n        return;\n      }\n\n      this.lessonUnderConstruction.activities[swapIndex] = curActivity;\n      this.lessonUnderConstruction.activities[targetIndex] = swapActivity;\n      if (this.activeActivityIndex === targetIndex) {\n        this.activeActivityIndex = swapIndex;\n      }\n    },\n    deleteActivity(targetIndex: number) {\n      const indexToDelete = targetIndex ?? this.activeActivityIndex;\n      const activities = this.lessonUnderConstruction.activities ?? [];\n      if (activities.length < 2) {\n        console.error(\"Can't delete activity - no activities would be left\");\n        return;\n      }\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this activity?')) return;\n      console.log('Deleting activity at index', indexToDelete);\n      activities.splice(indexToDelete, 1);\n      this.lessonUnderConstruction.activities = activities;\n      this.activeActivityIndex = Math.max(Math.min(activities.length - 1, this.activeActivityIndex), 0);\n    },\n    duplicateActivity() {\n      const activity = this.activeActivity;\n      const lesson = this.lessonUnderConstruction;\n      if (!activity || !lesson) return;\n      const dupActivity = Utils.deepCopy(activity);\n      lesson.activities.splice(this.activeActivityIndex, 0, dupActivity);\n      this.activeActivityIndex += 1;\n    },\n    addPause(targetIndex?: number) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const newPause: PauseInfo = {\n        time: this.activeActivity.startTime,\n        pauseDuration: Constants.DefaultPauseDuration,\n      };\n      if (targetIndex === undefined) {\n        pauses.push(newPause);\n        this.activePauseIndex = pauses.length - 1;\n      } else {\n        pauses.splice(targetIndex, 0, newPause);\n        this.activePauseIndex = targetIndex;\n      }\n      this.sortPauses();\n      this.activeActivity.pauses = pauses;\n    },\n    selectPause(targetIndex: number) {\n      if (targetIndex === this.activePauseIndex) this.activePauseIndex = -1;\n      else this.activePauseIndex = targetIndex;\n    },\n    sortPauses() {\n      const pauses = this.activeActivity.pauses ?? [];\n      const selectedPause = pauses[this.activePauseIndex];\n      pauses.sort((a, b) => a.time - b.time);\n      const newIndex = pauses.indexOf(selectedPause);\n      if (newIndex >= 0) this.activePauseIndex = newIndex;\n      this.activeActivity.pauses = pauses;\n    },\n    deletePause(pauseObj: PauseInfo) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const pauseIndex = pauses.indexOf(pauseObj);\n      // eslint-disable-next-line no-alert\n      if (pauseIndex >= 0 && window.confirm('Are you sure you want to delete this pause?')) pauses.splice(pauseIndex, 1);\n      this.activeActivity.pauses = pauses;\n    },\n    addTimedInstruction(targetIndex?: number) {\n      const timedInstructions = this.activeActivity.timedInstructions ?? [];\n      const newInstruction: TimedInstruction = {\n        startTime: 0,\n        endTime: 1,\n        text: 'Do XYZ',\n      };\n      if (targetIndex === undefined) {\n        timedInstructions.push(newInstruction);\n        this.activeTimedInstructionIndex = timedInstructions.length - 1;\n      } else {\n        timedInstructions.splice(targetIndex, 0, newInstruction);\n        this.activeTimedInstructionIndex = targetIndex;\n      }\n      this.sortTimedInstructions();\n\n      this.activeActivity.timedInstructions = timedInstructions;\n    },\n    selectTimedInstruction(targetIndex: number) {\n      if (targetIndex === this.activeTimedInstructionIndex) this.activeTimedInstructionIndex = -1;\n      else this.activeTimedInstructionIndex = targetIndex;\n    },\n    sortTimedInstructions() {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const selectedTimedInstruc = timedInstructs[this.activeTimedInstructionIndex];\n      timedInstructs.sort((a, b) => a.startTime - b.startTime);\n      const newIndex = timedInstructs.indexOf(selectedTimedInstruc);\n      if (newIndex >= 0) this.activeTimedInstructionIndex = newIndex;\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    deleteTimedInstruction(timedInstruction: TimedInstruction) {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const tiIndex = timedInstructs.indexOf(timedInstruction);\n      // eslint-disable-next-line no-restricted-globals, no-alert\n      if (tiIndex >= 0 && window.confirm('Are you sure you want to delete this timed instruction?')) timedInstructs.splice(tiIndex, 1);\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    addSegmentBreak(breakTime: number) {\n      breakTime = +breakTime;\n      if (Number.isNaN(breakTime) || breakTime < 0 || breakTime > this.motion.duration) return;\n      this.lessonUnderConstruction.segmentBreaks.push(breakTime);\n      const newList = this.lessonUnderConstruction.segmentBreaks.sort((a, b) => a - b);\n      this.lessonUnderConstruction.segmentBreaks = newList;\n      this.newSegmentVal = 0;\n    },\n    setFocusedSegment(i: number, event: InputEvent) {\n      const focusedSegments = this.activeActivity.focusedSegments ?? [];\n      const curIndex = focusedSegments.indexOf(i);\n      const isFocused: boolean = (event.target as any)?.checked ?? false;\n      if (curIndex === -1 && isFocused) {\n        focusedSegments.push(i);\n        focusedSegments.sort();\n      } else if (curIndex !== -1 && !isFocused) {\n        focusedSegments.splice(curIndex, 1);\n      }\n\n      this.activeActivity.focusedSegments = focusedSegments;\n    },\n    sortSegmentBreaks() {\n      this.lessonUnderConstruction.segmentBreaks = this.lessonUnderConstruction.segmentBreaks.sort((a, b) => a - b);\n    },\n    setSegmentBreak(i: number, event: InputEvent) {\n      const val = parseFloat((event.target as any)?.value ?? '');\n      if (!Number.isNaN(val) && val >= 0 && val <= this.motion.duration) {\n        this.lessonUnderConstruction.segmentBreaks[i] = val;\n      }\n    },\n    removeSegmentBreak(i: number) {\n      this.lessonUnderConstruction.segmentBreaks.splice(i, 1);\n    },\n    // playDemo() {\n    //   (this.$refs.activityVideoPlayer as any).play();\n    // },\n    // onProgress(progress: number) {\n    //   this.activityProgress = progress;\n    // },\n    saveLesson() {\n      if (this.$props.saveToDatabase) {\n        db.saveCustomLesson(this.lessonUnderConstruction);\n      }\n      this.$emit('lesson-saved', this.lessonUnderConstruction);\n      this.isDirty = false;\n    },\n    deleteLesson() {\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      db.deleteCustomLesson(this.lessonUnderConstruction);\n      this.$emit('back-selected');\n    },\n    exportLesson() {\n      Utils.PromptDownloadFile(`${this.lessonUnderConstruction.header.lessonTitle}.lesson.json`, JSON.stringify(this.lessonUnderConstruction));\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.create-lesson-screen {\n  .center-block {\n    display: inline-block;\n    margin-left: auto;\n    margin-right: auto;\n  }\n\n  .narrow-number-input {\n    max-width: 5.5rem;\n  }\n\n  .seg-break {\n    background: white;\n  }\n}\n\n</style>\n","<template>\n  <section class=\"keyframe-selection section\">\n    <div class=\"container box\">\n      <h1 class=\"title\">Keyframe Selection Tool</h1>\n\n      <div class=\"buttons\">\n        <button class=\"button\" @click=\"$emit('back-selected')\">Done</button>\n      </div>\n\n      <div class=\"block has-text-centered\">\n        <video\n          ref=\"videoElement\"\n          @playing=\"paused = false\"\n          @pause=\"paused = true\"\n          @seeked=\"updateCurrentTime\"\n          :src=\"videoEntry.videoSrc\"\n          controls\n          style=\"max-height: 50vh; max-width: 768px;margin:auto;\"></video>\n      </div>\n\n      <div class=\"buttons is-grouped is-centered\">\n        <button class=\"button\" @click=\"videoElement.currentTime -= 0.1\">&lt;&lt;</button>\n        <button class=\"button\" @click=\"videoElement.currentTime -= 0.03\">&lt;</button>\n        <span class=\"button is-text\" disabled>\n          {{currentTime.toFixed(2)}}s\n        </span>\n        <button class=\"button\" @click=\"addKeyframe\">&plus; Add</button>\n        <button class=\"button\" @click=\"videoElement.currentTime += 0.03\">&gt;</button>\n        <button class=\"button\" @click=\"videoElement.currentTime += 0.1\">&gt;&gt;</button>\n      </div>\n      <div>\n        <input class=\"slider is-fullwidth\" type=\"range\" :value=\"currentTime\" :min=\"videoEntry.startTime\" :max=\"videoEntry.endTime\" step=\"0.03\" @input=\"this.$refs.videoElement.currentTime = $event.target.value\">\n      </div>\n      <div class=\"field is-horizontal\">\n        <div class=\"field-label\">\n          <label class=\"label\">Draw Mode</label>\n        </div>\n        <div class=\"field-body\">\n          <div class=\"field\">\n            <div class=\"control\">\n              <div class=\"select\">\n                <select v-model=\"drawMode\">\n                  <!-- <option value=\"none\">None</option> -->\n                  <option value=\"skeleton\">Skeleton</option>\n                  <option value=\"video\">Video</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n<!--\n      <div class=\"block\">\n        <pre>{{JSON.stringify(modelValue)}}</pre>\n      </div> -->\n\n      <div class=\"block\">\n        <KeyframeTimeline\n          :keyframes=\"modelValue\"\n          :currentTime=\"currentTime\"\n          :dbEntry=\"videoEntry\"\n          :showTimestamps=\"true\"\n          :drawMode=\"drawMode\"\n        />\n      </div>\n\n      <div class=\"block\">\n        <h3 class=\"subtitle\">Keyframes</h3>\n        <div class=\"is-flex is-flex-wrap-wrap\">\n          <div class=\"keyframe\">\n            <div class=\"vcenter-parent\">\n              <div class=\"p-1 has-text-centered\">\n                StartTime<br />\n                <span class=\"tag\">{{effectiveStartTime.toFixed(2)}}s</span>\n              </div>\n            </div>\n          </div>\n          <div\n              class=\"keyframe is-relative  over-expand is-clickable\"\n              v-for=\"kf in modelValue\"\n              :key=\"kf\"\n              @click=\"deleteKeyframe(kf)\">\n\n            <!-- <div class=\"has-text-right is-overlay\"><button class=\"button is-small is-danger is-light\">&times;</button></div> -->\n            <video class=\"keyframe-thumb\"\n            :src=\"videoEntry.videoSrc + '#t=' + kf\">\n            </video>\n            <div class=\"has-text-centered mb-2\"><span class=\"tag\">{{kf.toFixed(2)}}</span></div>\n          </div>\n          <div class=\"keyframe\">\n            <div class=\"vcenter-parent\">\n              <div class=\"p-1 has-text-centered\">\n                EndTime<br />\n                <span class=\"tag\">{{effectiveEndTime.toFixed(2)}}s</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref, toRefs, watchEffect,\n} from 'vue';\nimport KeyframeTimeline from '@/components/elements/KeyframeTimeline.vue';\nimport motionDb, { DatabaseEntry } from '@/services/MotionDatabase';\n\n// [2.28,2.73,2.93,3.18,3.26,3.47,3.54,3.69,4.02,4.2,4.35,4.53,4.71,4.98,5.13,5.44,5.53]\nexport default defineComponent({\n  name: 'KeyframeSelectorTool',\n  emits: ['back-selected', 'update:modelValue'],\n  components: {\n    KeyframeTimeline,\n  },\n  props: {\n    videoEntry: {\n      type: Object,\n      required: true,\n    },\n    modelValue: {\n      type: Array,\n      default: Array,\n      required: true,\n    },\n    startTime: {\n      type: Number,\n      default: -1,\n    },\n    endTime: {\n      type: Number,\n      default: -1,\n    },\n  },\n  setup(props) {\n    const {\n      modelValue, startTime, endTime, videoEntry,\n    } = toRefs(props);\n    const paused = ref(false);\n    const currentTime = ref(0);\n    const videoElement = ref(null as HTMLVideoElement | null);\n\n    const effectiveStartTime = computed(() => {\n      if (startTime.value > 0) return startTime.value;\n      if (videoEntry.value?.startTime) return videoEntry.value.startTime;\n      return 0;\n    });\n    const effectiveEndTime = computed(() => {\n      if (endTime.value > 0) return endTime.value;\n      if (videoEntry.value?.endTime) return videoEntry.value.endTime;\n      if (videoEntry.value?.duration) return videoEntry.value.duration;\n      return -1;\n    });\n\n    onMounted(() => {\n      if (videoElement.value) videoElement.value.currentTime = effectiveStartTime.value;\n    });\n\n    const updateCurrentTime = () => { currentTime.value = videoElement.value?.currentTime ?? 0; };\n    let updateIntervalId = -1;\n    onBeforeUnmount(() => { clearInterval(updateIntervalId); });\n    watchEffect(() => {\n      if (paused.value) {\n        updateCurrentTime();\n        clearInterval(updateIntervalId);\n      } else {\n        updateIntervalId = window.setInterval(updateCurrentTime, 100);\n      }\n    });\n\n    onMounted(() => {\n      if (videoElement.value) videoElement.value.playbackRate = 0.25;\n    });\n\n    watchEffect(() => {\n\n    });\n\n    return {\n      videoElement,\n      paused,\n      currentTime,\n      updateCurrentTime,\n      drawMode: ref('skeleton'),\n\n      effectiveStartTime,\n      effectiveEndTime,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  computed: {\n    prevKeyframe() {\n      const keyframes = (this as any).modelValue as number[];\n      let i = 0;\n      for (;i < this.modelValue.length; i += 1) {\n        const kf = keyframes[i];\n        if (kf > this.currentTime) {\n          return keyframes[i - 1] ?? null;\n        }\n      }\n      return keyframes[i - 1] ?? null;\n    },\n    nextKeyframe() {\n      const keyframes = (this as any).modelValue as number[];\n      for (let i = 0; i < this.modelValue.length; i += 1) {\n        const kf = keyframes[i];\n        if (kf > this.currentTime) {\n          return keyframes[i];\n        }\n      }\n      return null;\n    },\n  },\n  methods: {\n    addKeyframe() {\n      const modelCopy = [...this.modelValue];\n      const nearestKf = Number.parseFloat(this.currentTime.toFixed(2));\n      if (modelCopy.indexOf(nearestKf) === -1) {\n        modelCopy.push(nearestKf);\n        modelCopy.sort();\n      } else {\n        console.warn('Not adding keyframe - it already exists');\n      }\n      this.$emit('update:modelValue', modelCopy);\n      console.log('update:modelValue (added kf)', modelCopy);\n    },\n    deleteKeyframe(timestamp: number) {\n      const modelCopy = [...this.modelValue];\n      const index = modelCopy.indexOf(timestamp);\n      // eslint-disable-next-line no-alert\n      if (index !== -1 && window.confirm(`Delete keyframe at ${timestamp.toFixed(2)}?`)) {\n        // const kfs = modelCopy;\n        modelCopy.splice(index, 1);\n        // this.keyframes = kfs;\n      }\n\n      this.$emit('update:modelValue', modelCopy);\n      console.log('update:modelValue (deleted kf)', modelCopy);\n    },\n  },\n});\n</script>\n\n<style lang=\"sass\">\n\n.keyframe-selection\n  display: block\n\n  .keyframe\n    margin: 0.25rem\n    // padding: 0.25rem\n    border-radius: 0.25rem\n    background: lightgray\n    overflow: clip\n\n    &.is-active\n      background: lightblue\n\n  .keyframe-thumb\n    max-width: 200px\n    max-height: 200px\n\n</style>\n","\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref, toRefs, watchEffect,\n} from 'vue';\nimport KeyframeTimeline from '@/components/elements/KeyframeTimeline.vue';\nimport motionDb, { DatabaseEntry } from '@/services/MotionDatabase';\n\n// [2.28,2.73,2.93,3.18,3.26,3.47,3.54,3.69,4.02,4.2,4.35,4.53,4.71,4.98,5.13,5.44,5.53]\nexport default defineComponent({\n  name: 'KeyframeSelectorTool',\n  emits: ['back-selected', 'update:modelValue'],\n  components: {\n    KeyframeTimeline,\n  },\n  props: {\n    videoEntry: {\n      type: Object,\n      required: true,\n    },\n    modelValue: {\n      type: Array,\n      default: Array,\n      required: true,\n    },\n    startTime: {\n      type: Number,\n      default: -1,\n    },\n    endTime: {\n      type: Number,\n      default: -1,\n    },\n  },\n  setup(props) {\n    const {\n      modelValue, startTime, endTime, videoEntry,\n    } = toRefs(props);\n    const paused = ref(false);\n    const currentTime = ref(0);\n    const videoElement = ref(null as HTMLVideoElement | null);\n\n    const effectiveStartTime = computed(() => {\n      if (startTime.value > 0) return startTime.value;\n      if (videoEntry.value?.startTime) return videoEntry.value.startTime;\n      return 0;\n    });\n    const effectiveEndTime = computed(() => {\n      if (endTime.value > 0) return endTime.value;\n      if (videoEntry.value?.endTime) return videoEntry.value.endTime;\n      if (videoEntry.value?.duration) return videoEntry.value.duration;\n      return -1;\n    });\n\n    onMounted(() => {\n      if (videoElement.value) videoElement.value.currentTime = effectiveStartTime.value;\n    });\n\n    const updateCurrentTime = () => { currentTime.value = videoElement.value?.currentTime ?? 0; };\n    let updateIntervalId = -1;\n    onBeforeUnmount(() => { clearInterval(updateIntervalId); });\n    watchEffect(() => {\n      if (paused.value) {\n        updateCurrentTime();\n        clearInterval(updateIntervalId);\n      } else {\n        updateIntervalId = window.setInterval(updateCurrentTime, 100);\n      }\n    });\n\n    onMounted(() => {\n      if (videoElement.value) videoElement.value.playbackRate = 0.25;\n    });\n\n    watchEffect(() => {\n\n    });\n\n    return {\n      videoElement,\n      paused,\n      currentTime,\n      updateCurrentTime,\n      drawMode: ref('skeleton'),\n\n      effectiveStartTime,\n      effectiveEndTime,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  computed: {\n    prevKeyframe() {\n      const keyframes = (this as any).modelValue as number[];\n      let i = 0;\n      for (;i < this.modelValue.length; i += 1) {\n        const kf = keyframes[i];\n        if (kf > this.currentTime) {\n          return keyframes[i - 1] ?? null;\n        }\n      }\n      return keyframes[i - 1] ?? null;\n    },\n    nextKeyframe() {\n      const keyframes = (this as any).modelValue as number[];\n      for (let i = 0; i < this.modelValue.length; i += 1) {\n        const kf = keyframes[i];\n        if (kf > this.currentTime) {\n          return keyframes[i];\n        }\n      }\n      return null;\n    },\n  },\n  methods: {\n    addKeyframe() {\n      const modelCopy = [...this.modelValue];\n      const nearestKf = Number.parseFloat(this.currentTime.toFixed(2));\n      if (modelCopy.indexOf(nearestKf) === -1) {\n        modelCopy.push(nearestKf);\n        modelCopy.sort();\n      } else {\n        console.warn('Not adding keyframe - it already exists');\n      }\n      this.$emit('update:modelValue', modelCopy);\n      console.log('update:modelValue (added kf)', modelCopy);\n    },\n    deleteKeyframe(timestamp: number) {\n      const modelCopy = [...this.modelValue];\n      const index = modelCopy.indexOf(timestamp);\n      // eslint-disable-next-line no-alert\n      if (index !== -1 && window.confirm(`Delete keyframe at ${timestamp.toFixed(2)}?`)) {\n        // const kfs = modelCopy;\n        modelCopy.splice(index, 1);\n        // this.keyframes = kfs;\n      }\n\n      this.$emit('update:modelValue', modelCopy);\n      console.log('update:modelValue (deleted kf)', modelCopy);\n    },\n  },\n});\n","import { render } from \"./KeyframeSelectorTool.vue?vue&type=template&id=51d13512\"\nimport script from \"./KeyframeSelectorTool.vue?vue&type=script&lang=ts\"\nexport * from \"./KeyframeSelectorTool.vue?vue&type=script&lang=ts\"\n\nimport \"./KeyframeSelectorTool.vue?vue&type=style&index=0&id=51d13512&lang=sass\"\nscript.render = render\n\nexport default script","\n\nimport {\n  computed,\n  defineComponent, nextTick, ref, toRefs, watchEffect,\n} from 'vue';\n\nimport Constants from '@/services/Constants';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport db, { createBlankActivity, createBlankLesson, DatabaseEntry } from '@/services/MotionDatabase';\nimport MiniLesson, { MiniLessonActivity, PauseInfo, TimedInstruction } from '@/model/MiniLesson';\nimport Utils from '@/services/Utils';\nimport SegmentedProgressBar, { ProgressSegmentData, calculateProgressSegments } from '@/components/elements/SegmentedProgressBar.vue';\nimport KeyframeSelectorTool from '@/components/tools/KeyframeSelectorTool.vue';\n\nconst LessonCreationState = Object.freeze({\n  SelectOpenLesson: 'SelectOpenLesson',\n  ModifyLesson: 'ModifyLesson',\n});\n\ninterface SegmentInfo {\n  isFocused: boolean;\n  startTime: number;\n  endTime: number;\n}\n\nexport default defineComponent({\n  name: 'CreateLessonScreen',\n  components: {\n    MiniLessonPlayer,\n    SegmentedProgressBar,\n    KeyframeSelectorTool,\n  },\n  props: {\n    motion: {\n      type: Object,\n      required: true,\n    },\n    saveReference: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    showCloseButton: {\n      type: Boolean,\n      default: false,\n    },\n    showExportButton: {\n      type: Boolean,\n      default: true,\n    },\n    lessonToEdit: {\n      type: Object,\n      default: null,\n    },\n    saveToDatabase: {\n      type: Boolean,\n      default: true,\n    },\n    disableEditingExisting: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['back-selected', 'lesson-saved'],\n  data() {\n    return {\n      newPauseTime: 0,\n      newSegmentVal: 0,\n      activeLessonSelectionIndex: -1,\n      activePauseIndex: 0,\n      activeTimedInstructionIndex: 0,\n      keyframeSelectorToolActive: false,\n      // activityProgress: 0,\n    };\n  },\n  computed: {\n    activeActivityKeyframes: {\n      get(): number[] {\n        return (this as any).activeActivity?.keyframes ?? [];\n      },\n      set(newVal: number[]) {\n        this.activeActivity.keyframes = newVal;\n      },\n    },\n    displayMode: {\n      get() {\n        const demoVisual = this.activeActivity.demoVisual ?? 'video';\n        const userVisual = this.activeActivity.userVisual ?? 'none';\n        if (demoVisual === 'video' && userVisual === 'none') return 'video-demo';\n        if (demoVisual === 'skeleton' && userVisual === 'video') return 'skeleton-overlay';\n        return 'other';\n      },\n      set(newVal: 'other' | 'video-demo' | 'skeleton-overlay') {\n        if (newVal === 'video-demo') {\n          this.activeActivity.demoVisual = 'video';\n          this.activeActivity.userVisual = 'none';\n        } else if (newVal === 'skeleton-overlay') {\n          this.activeActivity.demoVisual = 'skeleton';\n          this.activeActivity.userVisual = 'video';\n        }\n      },\n    },\n    activeActivityFocusedSegments() {\n      const segBreaks = (this as any).lessonUnderConstruction.segmentBreaks as number[];\n      const segs: number[] = (this as any).activeActivity?.focusedSegments ?? [];\n      const segsSet = new Set(segs);\n      const boolArray = Utils.range((this as any).lessonUnderConstruction.segmentBreaks.length - 1)\n        .map((i) => ({\n          isFocused: segsSet.has(i),\n          startTime: segBreaks[i],\n          endTime: segBreaks[i + 1],\n        } as SegmentInfo));\n      return boolArray;\n    },\n    activeLessonSelection(): MiniLesson | null {\n      return this.lessons[this.activeLessonSelectionIndex] ?? null;\n    },\n    lessonInDatabase(): boolean {\n      return db.hasLesson(this.lessonUnderConstruction);\n    },\n    canDeleteLesson(): boolean {\n      return this.lessonInDatabase && this.lessonUnderConstruction.source === 'custom';\n    },\n    lessonStartTime(): number {\n      return this.lessonUnderConstruction?.segmentBreaks[0] ?? 0;\n    },\n    lessonEndTime(): number {\n      return this.lessonUnderConstruction.segmentBreaks[this.lessonUnderConstruction.segmentBreaks.length - 1] ?? this.motion?.duration ?? 1;\n    },\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      const lessons = db.getLessons(motion);\n      return lessons ?? [];\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lessonUnderConstruction) return calculateProgressSegments(this.lessonUnderConstruction, this.activeActivity);\n      return [];\n    },\n    activePause(): null | PauseInfo {\n      return ((this as any).activeActivity.pauses ?? [])[(this as any).activePauseIndex] ?? null;\n    },\n    activeTimedInstruction(): null | TimedInstruction {\n      return ((this as any).activeActivity.timedInstructions ?? [])[(this as any).activeTimedInstructionIndex] ?? null;\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < this.lessonUnderConstruction.activities.length;\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    canEditActiveLesson() {\n      const acLes = this.activeLessonSelection as MiniLesson;\n      return acLes?.source === 'custom';\n    },\n  },\n  mounted() {\n    const passedInLesson = this.$props.lessonToEdit as MiniLesson | null;\n    if (passedInLesson) {\n      console.log('CreateLessonScreen:: using passed in lesson', passedInLesson);\n      this.startCreation(false, Utils.deepCopy(passedInLesson));\n      nextTick(() => { this.isDirty = false; });\n    } else if (this.lessons.length === 0) {\n      console.log('CreateLessonScreen:: creating blank lesson (no templates available)');\n      this.startCreation(true);\n    }\n  },\n  setup(props) {\n    const { motion } = toRefs(props);\n    const isDirty = ref(false);\n    const typedMotion = computed(() => motion.value as unknown as DatabaseEntry);\n    const state = ref(LessonCreationState.SelectOpenLesson);\n    const lessonUnderConstruction = ref(createBlankLesson(typedMotion.value));\n    const activeActivityIndex = ref(0);\n    const activeActivity = computed(() => lessonUnderConstruction.value.activities[activeActivityIndex.value]);\n\n    watchEffect(() => {\n      if (activeActivity.value.startTime < 0) activeActivity.value.startTime = 0;\n      if (activeActivity.value.endTime > motion.value.duration) activeActivity.value.endTime = motion.value.duration;\n      if (+activeActivity.value.endTime < +activeActivity.value.startTime) activeActivity.value.endTime = activeActivity.value.startTime;\n    });\n\n    return {\n      isDirty,\n      state,\n      typedMotion,\n      LessonCreationState,\n      lessonUnderConstruction,\n      activeActivityIndex,\n      activeActivity,\n      Constants,\n    };\n  },\n  watch: {\n    activeActivityIndex: {\n      handler(newVal: number) {\n        (this.$refs.miniLessonPlayer as any).activeActivityIndex = newVal;\n      },\n    },\n    lessonUnderConstruction: {\n      handler() {\n        this.isDirty = true;\n      },\n      deep: true,\n    },\n    'lessonUnderConstruction.segmentBreaks': {\n      handler() {\n        this.sortSegmentBreaks();\n      },\n      deep: true,\n    },\n    'activePause.time': {\n      handler() {\n        this.sortPauses();\n      },\n    },\n    'activeTimedInstruction.startTime': {\n      handler() {\n        this.sortTimedInstructions();\n      },\n    },\n  },\n  methods: {\n    canDeleteSegment(segmentIndex: number) {\n      return this.progressSegments.length > 1;\n    },\n    goBack() {\n      // eslint-disable-next-line no-alert\n      if (!this.isDirty || window.confirm('Are you sure you want to go back without saving?')) {\n        this.$emit('back-selected');\n      }\n    },\n    startCreation(asTemplate: boolean, sourceLesson?: MiniLesson) {\n      const existingLesson = sourceLesson ?? this.activeLessonSelection;\n      if (existingLesson && asTemplate) {\n        console.log('Creating new lesson from template');\n        this.lessonUnderConstruction = Utils.deepCopy(existingLesson);\n        this.lessonUnderConstruction._id = Utils.uuidv4();\n        this.lessonUnderConstruction.source = 'custom';\n      } else if (existingLesson && !asTemplate) {\n        console.log('Editing existing lesson');\n        this.lessonUnderConstruction = existingLesson;\n        nextTick(() => { this.isDirty = false; });\n      } else {\n        console.log('Creating new lesson from scratch');\n        this.lessonUnderConstruction = createBlankLesson(this.typedMotion);\n      }\n      this.state = LessonCreationState.ModifyLesson;\n    },\n    addActivity(targetIndex?: number) {\n      const newActivity: MiniLessonActivity = createBlankActivity(this.typedMotion, `Activity ${this.lessonUnderConstruction.activities.length + 1}`);\n\n      if (targetIndex === undefined) {\n        this.lessonUnderConstruction.activities.push(newActivity);\n        this.activeActivityIndex = this.lessonUnderConstruction.activities.length - 1;\n      } else {\n        this.lessonUnderConstruction.activities.splice(targetIndex, 0, newActivity);\n        this.activeActivityIndex = targetIndex;\n      }\n    },\n    selectActivity(targetIndex: number) {\n      this.activeActivityIndex = targetIndex;\n    },\n    canDeleteActivity(targetIndex: number) {\n      return this.lessonUnderConstruction.activities.length > 1;\n    },\n    canReorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapActivity = this.lessonUnderConstruction.activities[targetIndex + indexDelta];\n      return (curActivity !== undefined && swapActivity !== undefined);\n    },\n    reorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapIndex = targetIndex + indexDelta;\n      const swapActivity = this.lessonUnderConstruction.activities[swapIndex];\n      if (curActivity === undefined || swapActivity === undefined) {\n        console.error(`Cannot reorder activities ${targetIndex} and ${swapIndex}`);\n        return;\n      }\n\n      this.lessonUnderConstruction.activities[swapIndex] = curActivity;\n      this.lessonUnderConstruction.activities[targetIndex] = swapActivity;\n      if (this.activeActivityIndex === targetIndex) {\n        this.activeActivityIndex = swapIndex;\n      }\n    },\n    deleteActivity(targetIndex: number) {\n      const indexToDelete = targetIndex ?? this.activeActivityIndex;\n      const activities = this.lessonUnderConstruction.activities ?? [];\n      if (activities.length < 2) {\n        console.error(\"Can't delete activity - no activities would be left\");\n        return;\n      }\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this activity?')) return;\n      console.log('Deleting activity at index', indexToDelete);\n      activities.splice(indexToDelete, 1);\n      this.lessonUnderConstruction.activities = activities;\n      this.activeActivityIndex = Math.max(Math.min(activities.length - 1, this.activeActivityIndex), 0);\n    },\n    duplicateActivity() {\n      const activity = this.activeActivity;\n      const lesson = this.lessonUnderConstruction;\n      if (!activity || !lesson) return;\n      const dupActivity = Utils.deepCopy(activity);\n      lesson.activities.splice(this.activeActivityIndex, 0, dupActivity);\n      this.activeActivityIndex += 1;\n    },\n    addPause(targetIndex?: number) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const newPause: PauseInfo = {\n        time: this.activeActivity.startTime,\n        pauseDuration: Constants.DefaultPauseDuration,\n      };\n      if (targetIndex === undefined) {\n        pauses.push(newPause);\n        this.activePauseIndex = pauses.length - 1;\n      } else {\n        pauses.splice(targetIndex, 0, newPause);\n        this.activePauseIndex = targetIndex;\n      }\n      this.sortPauses();\n      this.activeActivity.pauses = pauses;\n    },\n    selectPause(targetIndex: number) {\n      if (targetIndex === this.activePauseIndex) this.activePauseIndex = -1;\n      else this.activePauseIndex = targetIndex;\n    },\n    sortPauses() {\n      const pauses = this.activeActivity.pauses ?? [];\n      const selectedPause = pauses[this.activePauseIndex];\n      pauses.sort((a, b) => a.time - b.time);\n      const newIndex = pauses.indexOf(selectedPause);\n      if (newIndex >= 0) this.activePauseIndex = newIndex;\n      this.activeActivity.pauses = pauses;\n    },\n    deletePause(pauseObj: PauseInfo) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const pauseIndex = pauses.indexOf(pauseObj);\n      // eslint-disable-next-line no-alert\n      if (pauseIndex >= 0 && window.confirm('Are you sure you want to delete this pause?')) pauses.splice(pauseIndex, 1);\n      this.activeActivity.pauses = pauses;\n    },\n    addTimedInstruction(targetIndex?: number) {\n      const timedInstructions = this.activeActivity.timedInstructions ?? [];\n      const newInstruction: TimedInstruction = {\n        startTime: 0,\n        endTime: 1,\n        text: 'Do XYZ',\n      };\n      if (targetIndex === undefined) {\n        timedInstructions.push(newInstruction);\n        this.activeTimedInstructionIndex = timedInstructions.length - 1;\n      } else {\n        timedInstructions.splice(targetIndex, 0, newInstruction);\n        this.activeTimedInstructionIndex = targetIndex;\n      }\n      this.sortTimedInstructions();\n\n      this.activeActivity.timedInstructions = timedInstructions;\n    },\n    selectTimedInstruction(targetIndex: number) {\n      if (targetIndex === this.activeTimedInstructionIndex) this.activeTimedInstructionIndex = -1;\n      else this.activeTimedInstructionIndex = targetIndex;\n    },\n    sortTimedInstructions() {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const selectedTimedInstruc = timedInstructs[this.activeTimedInstructionIndex];\n      timedInstructs.sort((a, b) => a.startTime - b.startTime);\n      const newIndex = timedInstructs.indexOf(selectedTimedInstruc);\n      if (newIndex >= 0) this.activeTimedInstructionIndex = newIndex;\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    deleteTimedInstruction(timedInstruction: TimedInstruction) {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const tiIndex = timedInstructs.indexOf(timedInstruction);\n      // eslint-disable-next-line no-restricted-globals, no-alert\n      if (tiIndex >= 0 && window.confirm('Are you sure you want to delete this timed instruction?')) timedInstructs.splice(tiIndex, 1);\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    addSegmentBreak(breakTime: number) {\n      breakTime = +breakTime;\n      if (Number.isNaN(breakTime) || breakTime < 0 || breakTime > this.motion.duration) return;\n      this.lessonUnderConstruction.segmentBreaks.push(breakTime);\n      const newList = this.lessonUnderConstruction.segmentBreaks.sort((a, b) => a - b);\n      this.lessonUnderConstruction.segmentBreaks = newList;\n      this.newSegmentVal = 0;\n    },\n    setFocusedSegment(i: number, event: InputEvent) {\n      const focusedSegments = this.activeActivity.focusedSegments ?? [];\n      const curIndex = focusedSegments.indexOf(i);\n      const isFocused: boolean = (event.target as any)?.checked ?? false;\n      if (curIndex === -1 && isFocused) {\n        focusedSegments.push(i);\n        focusedSegments.sort();\n      } else if (curIndex !== -1 && !isFocused) {\n        focusedSegments.splice(curIndex, 1);\n      }\n\n      this.activeActivity.focusedSegments = focusedSegments;\n    },\n    sortSegmentBreaks() {\n      this.lessonUnderConstruction.segmentBreaks = this.lessonUnderConstruction.segmentBreaks.sort((a, b) => a - b);\n    },\n    setSegmentBreak(i: number, event: InputEvent) {\n      const val = parseFloat((event.target as any)?.value ?? '');\n      if (!Number.isNaN(val) && val >= 0 && val <= this.motion.duration) {\n        this.lessonUnderConstruction.segmentBreaks[i] = val;\n      }\n    },\n    removeSegmentBreak(i: number) {\n      this.lessonUnderConstruction.segmentBreaks.splice(i, 1);\n    },\n    // playDemo() {\n    //   (this.$refs.activityVideoPlayer as any).play();\n    // },\n    // onProgress(progress: number) {\n    //   this.activityProgress = progress;\n    // },\n    saveLesson() {\n      if (this.$props.saveToDatabase) {\n        db.saveCustomLesson(this.lessonUnderConstruction);\n      }\n      this.$emit('lesson-saved', this.lessonUnderConstruction);\n      this.isDirty = false;\n    },\n    deleteLesson() {\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      db.deleteCustomLesson(this.lessonUnderConstruction);\n      this.$emit('back-selected');\n    },\n    exportLesson() {\n      Utils.PromptDownloadFile(`${this.lessonUnderConstruction.header.lessonTitle}.lesson.json`, JSON.stringify(this.lessonUnderConstruction));\n    },\n  },\n});\n","import { render } from \"./CreateLessonScreen.vue?vue&type=template&id=f2bdc050\"\nimport script from \"./CreateLessonScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./CreateLessonScreen.vue?vue&type=script&lang=ts\"\n\nimport \"./CreateLessonScreen.vue?vue&type=style&index=0&id=f2bdc050&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  CreateBlankWorkflow, GetVideoEntryForWorkflowStep, Instructions, Workflow, WorkflowStage, WorkflowStep,\n} from '@/model/Workflow';\nimport Utils from '@/services/Utils';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport {\n  computed, defineComponent, nextTick, ref, watchEffect,\n} from 'vue';\nimport motionDb from '@/services/MotionDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport CreateLessonScreen from '@/components/screens/CreateLessonScreen.vue';\n\nexport default defineComponent({\n  name: 'CreateWorkflowScreen',\n  emits: ['back-selected', 'workflow-created'],\n  components: {\n    WorkflowMenu,\n    CreateLessonScreen,\n  },\n  setup() {\n\n    const isDirty = ref(false);\n\n    const activeWorkflow = ref(null as null | Workflow);\n    const selectingWorkflowIndex = ref(-1);\n    const canEditWorkflow = computed(() => {\n      const workflow = workflowManager.allWorkflows.value[selectingWorkflowIndex.value];\n      return workflow && workflowManager.isCustomWorkflow(workflow.id);\n    });\n    const workflowInDatabase = computed(() => activeWorkflow.value?.id && WorkflowManager.hasSavedCustomLesson(activeWorkflow.value.id));\n    const selectedStageIndex = ref(0);\n    const activeStage = computed(() => activeWorkflow.value?.stages[selectedStageIndex.value] ?? null);\n    const selectedStepIndex = ref(0);\n    const activeStep = computed(() => activeStage.value?.steps[selectedStepIndex.value] ?? null);\n    const isVideoUploadStep = computed(() => activeStep.value?.type === 'UploadTask');\n    const isLessonReferenceStep = computed(() => activeStep.value?.type === 'MiniLessonReference');\n    const isLessonEmbeddedStep = computed(() => activeStep.value?.type === 'MiniLessonEmbedded');\n    const isInstructionStep = computed(() => activeStep.value?.type === 'InstructionOnly');\n    const availableReferenceLessons = computed(() => {\n      if (!activeStep.value) return [] as MiniLesson[];\n      if (!activeStep.value.miniLessonReference?.clipName) return [] as MiniLesson[];\n      return motionDb.lessonsByVideo.get(activeStep.value.miniLessonReference.clipName) ?? [];\n    });\n    const activeStepLesson = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonReferenceStep.value && activeStep.value.miniLessonReference?.lessonId) return motionDb.lessonsById.get(activeStep.value.miniLessonReference.lessonId) ?? null;\n      if (isLessonEmbeddedStep.value) return activeStep.value.miniLessonEmbedded ?? null;\n      return null;\n    });\n    const canEditActiveStepLessonReference = computed(() => activeStepLesson.value?.source === 'custom');\n    const newEmbeddedLessonClipName = ref('');\n    const newEmbeddedLessonMotion = computed(() => motionDb.motionsMap.get(newEmbeddedLessonClipName.value) ?? null);\n    const canCreateEmbeddedLesson = computed(() => newEmbeddedLessonMotion.value !== null);\n    const editLessonActive = ref(false);\n    const embeddedLessonMotion = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonEmbeddedStep.value && activeStep.value.miniLessonEmbedded) return GetVideoEntryForWorkflowStep(motionDb, activeStep.value);\n      if (isLessonEmbeddedStep.value) return newEmbeddedLessonMotion.value;\n      if (isLessonReferenceStep.value) return GetVideoEntryForWorkflowStep(motionDb, activeStep.value);\n      return null;\n    });\n\n    watchEffect(() => {\n      if (activeWorkflow.value) {\n        workflowManager.setActiveFlow(activeWorkflow.value.id);\n        workflowManager.completeActivitesPriorToStageAndStep(selectedStageIndex.value, selectedStepIndex.value);\n        // TODO: improve logic to keep status of intra-stage workflow steps.\n      }\n    });\n\n    watchEffect(() => {\n      if (!activeStep.value) return;\n      if (isInstructionStep.value) {\n        activeStep.value.instructions = activeStep.value.instructions ?? {\n          heading: 'Instructions Heading',\n          text: '',\n        } as Instructions;\n      } else if (isLessonReferenceStep.value) {\n        activeStep.value.miniLessonReference = activeStep.value.miniLessonReference ?? {} as any;\n        //  ?? {\n\n        // };\n      } else if (isLessonEmbeddedStep.value) {\n        // activeStep.value.miniLessonEmbedded = activeStep.value.miniLessonEmbedded;\n        //  ?? {\n\n        // };\n      } else if (isVideoUploadStep.value) {\n        activeStep.value.upload = activeStep.value.upload ?? {\n          identifier: activeStep.value.title,\n          prompt: 'Upload your video here',\n        };\n      }\n    });\n\n    return {\n      selectingWorkflowIndex,\n      activeWorkflow,\n      canEditWorkflow,\n      workflowInDatabase,\n      availableWorkflows: workflowManager.allWorkflows,\n      selectedStageIndex,\n      activeStage,\n\n      selectedStepIndex,\n      activeStep,\n      isVideoUploadStep,\n      isLessonReferenceStep,\n      isLessonEmbeddedStep,\n      isInstructionStep,\n      availableClips: motionDb.motionNames,\n      availableReferenceLessons,\n      newEmbeddedLessonClipName,\n      newEmbeddedLessonMotion,\n      embeddedLessonMotion,\n      canCreateEmbeddedLesson,\n      editLessonActive,\n      activeStepLesson,\n      canEditActiveStepLessonReference,\n      isMoveStepDropdownActive: ref(false),\n\n      isDirty,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  watch: {\n    activeWorkflow: {\n      handler(newVal) {\n        console.log('Workflow now dirty');\n        this.isDirty = ((newVal ?? null) !== null);\n      },\n      deep: true,\n    },\n  },\n  computed: {\n  },\n  methods: {\n    goBack(skipPrompt?: boolean) {\n      if (!this.activeWorkflow) {\n        this.$emit('back-selected');\n        return;\n      }\n\n      if (skipPrompt || !this.isDirty) {\n        this.activeWorkflow = null;\n        return;\n      }\n\n      // eslint-disable-next-line no-alert\n      if (window.confirm('Go back without saving changes?')) {\n        workflowManager.reloadCustomWorkflow(this.activeWorkflow.id);\n        this.activeWorkflow = null;\n      }\n    },\n    deleteWorkflow() {\n      if (!this.activeWorkflow) return;\n\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      workflowManager.deleteCustomWorkflow(this.activeWorkflow.id);\n      this.goBack(true);\n    },\n    exportWorkflow() {\n      if (!this.activeWorkflow) return;\n      Utils.PromptDownloadFile(`${this.activeWorkflow.title}.workflow.json`, JSON.stringify(this.activeWorkflow));\n    },\n    saveWorkflow() {\n      if (!this.activeWorkflow) return;\n      console.log('Saving workflow');\n      workflowManager.upsertCustomWorkflow(this.activeWorkflow);\n      nextTick(() => {\n        this.isDirty = false;\n        console.log('Workflow saved; not dirty now');\n      });\n      // window.setTimeout(() => {\n      // }, 200);\n    },\n    startCreation(asTemplate: boolean) {\n      const existingWorkflow = this.availableWorkflows[this.selectingWorkflowIndex];\n      if (existingWorkflow && asTemplate) {\n        this.activeWorkflow = Utils.deepCopy(existingWorkflow);\n        this.activeWorkflow.id = Utils.uuidv4();\n      } else if (existingWorkflow && !asTemplate) {\n        this.activeWorkflow = existingWorkflow;\n        nextTick(() => {\n          this.isDirty = false;\n        });\n\n      } else {\n        this.activeWorkflow = CreateBlankWorkflow();\n      }\n\n      workflowManager.addSessionWorkflow(this.activeWorkflow);\n      workflowManager.setActiveFlow(this.activeWorkflow.id);\n    },\n    selectStage(stageIndex: number) {\n\n      // Clear selection if this stage was already selected\n      if (stageIndex === this.selectedStageIndex) {\n        this.selectedStageIndex = -1;\n        this.selectedStepIndex = -1;\n        return;\n      }\n\n      this.selectedStageIndex = stageIndex;\n      this.selectedStepIndex = -1;\n      workflowManager.completeActivitesPriorToStageAndStep(stageIndex, this.selectedStepIndex);\n    },\n    canReorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      const swapStage = stages[this.selectedStageIndex + increment];\n      return (curStage !== undefined) && (swapStage !== undefined);\n    },\n    reorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const swapIndex = this.selectedStageIndex + increment;\n      const curSelected = stages[this.selectedStageIndex];\n      const toSwap = stages[swapIndex];\n      if ((curSelected === undefined) || (toSwap === undefined)) {\n        console.warn(`Unable to swap stages ${this.selectedStageIndex} and ${swapIndex}`);\n        return;\n      }\n      stages[this.selectedStageIndex] = toSwap;\n      stages[swapIndex] = curSelected;\n      this.selectedStageIndex = swapIndex;\n      workflow.stages = stages;\n    },\n    addStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n\n      workflow.stages.push({\n        title: `New-Stage-${workflow.stages.length + 1}`,\n        steps: [],\n      } as WorkflowStage);\n      this.selectStage(workflow.stages.length - 1);\n    },\n    duplicateStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      if (!curStage) return;\n      stages.splice(this.selectedStageIndex, 0, Utils.deepCopy(curStage));\n      workflow.stages = stages;\n      this.selectedStageIndex += 1;\n    },\n    deleteStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Stage #${this.selectedStageIndex + 1}?`)) return;\n\n      const { stages } = workflow;\n      stages.splice(this.selectedStageIndex, 1);\n      workflow.stages = stages;\n      this.selectedStageIndex = Math.min(this.selectedStageIndex, stages.length - 1);\n    },\n    selectStep(stepIndex: number) {\n\n      // Clear selectedStep if already selected\n      if (this.selectedStepIndex === stepIndex) {\n        this.selectedStepIndex = -1;\n        return;\n      }\n      this.selectedStepIndex = stepIndex;\n\n      workflowManager.completeActivitesPriorToStageAndStep(this.selectedStageIndex, this.selectedStepIndex);\n    },\n    canReorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return false;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[this.selectedStepIndex + increment];\n      return (curStep !== undefined) && (swapStep !== undefined);\n    },\n    reorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return;\n      const swapIndex = this.selectedStepIndex + increment;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[swapIndex];\n      if ((curStep === undefined) || (swapStep === undefined)) {\n        console.warn(`Unable to swap steps ${this.selectedStepIndex} and ${swapIndex}`);\n        return;\n      }\n      steps[this.selectedStageIndex] = swapStep;\n      steps[swapIndex] = curStep;\n      this.selectedStepIndex = swapIndex;\n      workflow.stages[this.selectedStageIndex].steps = steps;\n    },\n    addStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n\n      stage.steps.push({\n        title: `New-Step-${stage.steps.length + 1}`,\n        type: 'InstructionOnly',\n      } as WorkflowStep);\n      this.selectStep(stage.steps.length - 1);\n    },\n    duplicateStep() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const curStep = this.activeWorkflow?.stages[this.selectedStageIndex]?.steps[this.selectedStepIndex];\n      if (!curStep) return;\n      const { steps } = workflow.stages[this.selectedStageIndex];\n      steps.splice(this.selectedStepIndex, 0, Utils.deepCopy(curStep));\n      workflow.stages[this.selectedStageIndex].steps = steps;\n      this.selectedStepIndex += 1;\n    },\n    moveStep(targetStageIndex: number) {\n      if (targetStageIndex === this.selectedStageIndex) return;\n      const stage = this.activeStage;\n      const stepToMove = this.activeStep;\n      const targetPhase = this.activeWorkflow?.stages[targetStageIndex];\n      if (!stage || !stepToMove || !targetPhase) return;\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      targetPhase.steps.push(stepToMove);\n      this.selectedStageIndex = targetStageIndex;\n      this.selectedStepIndex = this.activeStage?.steps.length ?? 0;\n      this.isMoveStepDropdownActive = false;\n    },\n    deleteStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Step #${this.selectedStepIndex + 1}?`)) return;\n\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      this.selectedStepIndex = Math.min(this.selectedStepIndex, steps.length - 1);\n    },\n    updateWorkflowStepLesson(lesson: MiniLesson) {\n      if (!this.activeStep) return;\n      if (this.isLessonEmbeddedStep) {\n        this.activeStep.miniLessonEmbedded = lesson;\n        console.log('Updated embedded lesson', lesson.header.lessonTitle);\n      }\n      if (this.isLessonReferenceStep && this.activeStep.miniLessonReference) {\n        this.activeStep.miniLessonReference.lessonId = lesson._id;\n        console.log('Updated reference lesson', lesson);\n      }\n    },\n    startCreateEmbeddedLesson() {\n      if (!this.activeStep) return;\n      if (!this.newEmbeddedLessonMotion) return;\n      // this.activeStep.miniLessonEmbedded = createBlankLesson(this.newEmbeddedLessonMotion);\n      // this.activeStep.miniLessonEmbedded.header.lessonTitle = this.activeStep.title;\n      this.editLessonActive = true;\n    },\n    createReferencedLesson() {\n      if (!this.isLessonReferenceStep) return;\n      if (this.activeStep?.miniLessonReference?.lessonId === '') {\n        this.editLessonActive = true;\n      }\n    },\n    editWorkflowStepLesson() {\n      if (!this.activeStepLesson) return;\n      this.editLessonActive = true;\n    },\n    removeEmbeddedLesson() {\n      if (!this.activeStep?.miniLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (window.confirm(`Are you sure you want to delete the embedded lesson ${this.activeStep.miniLessonEmbedded.header.lessonTitle}?`)) {\n        this.activeStep.miniLessonEmbedded = undefined;\n      }\n    },\n    convertEmbeddedLessonToReference() {\n      if (!this.activeStep?.miniLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to save this lesson into a new file and convert this to a reference?'\n                         + '\\n\\nNote: be sure to save the lesson.json!')\n      ) return;\n\n      motionDb.saveCustomLesson(this.activeStep.miniLessonEmbedded);\n      this.activeStep.miniLessonReference = {\n        clipName: this.activeStep.miniLessonEmbedded.header.clipName,\n        lessonId: this.activeStep.miniLessonEmbedded._id,\n      };\n      const exportLessonData = this.activeStep.miniLessonEmbedded;\n      this.activeStep.type = 'MiniLessonReference';\n      this.activeStep.miniLessonEmbedded = undefined;\n      Utils.PromptDownloadFile(`${exportLessonData.header.lessonTitle}.lesson.json`, JSON.stringify(exportLessonData));\n    },\n  },\n});\n","import { render } from \"./CreateWorkflowScreen.vue?vue&type=template&id=51670130\"\nimport script from \"./CreateWorkflowScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./CreateWorkflowScreen.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n<!-- <div class=\"test123\">\n  <div class=\"flexpar\">\n    <div class=\"flexexpand\"></div>\n    <div class=\"flexbar\"></div>\n  </div>\n</div> -->\n  <div class=\"layout-test\">\n    <MiniLessonPlayer\n      :videoEntry=\"{\n        videoSrc: 'videos/derulo.mp4',\n      }\"\n      :miniLesson=\"miniLesson\"\n      :drawPoseLandmarks=\"true\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport MiniLesson from '@/model/MiniLesson';\n\nconst miniLesson: MiniLesson = {\n  _id: 'f60a2a6c-6324-4cb0-8034-38f3ac077a17',\n  header: {\n    clipName: 'renegade',\n    lessonTitle: '65% Practice',\n  },\n  segmentBreaks: [\n    0,\n    2.3333333333333335,\n    7.7,\n    12.233333333333333,\n  ],\n  activities: [\n    {\n      title: 'Refresher',\n      startTime: 0,\n      endTime: 12.233333333333333,\n      demoVisual: 'video',\n      userVisual: 'none',\n      focusedSegments: [\n        0,\n        1,\n        2,\n      ],\n      pauses: [],\n      practiceSpeed: 0.5,\n      startInstruction: \"We're going to speed it up a bit now\",\n      timedInstructions: [],\n      endInstruction: \"Next you'll try it at this speed WITHOUT the video!\",\n      playingInstruction: 'Follow along',\n    },\n    {\n      title: 'No Video',\n      startTime: 0,\n      endTime: 12.233333333333333,\n      demoVisual: 'skeleton',\n      userVisual: 'video',\n      focusedSegments: [\n        0,\n        1,\n        2,\n      ],\n      pauses: [],\n      startInstruction: 'Follow along with the teacher skeleton!',\n      timedInstructions: [],\n      practiceSpeed: 0.65,\n      endInstruction: \"Repeat until you've got it!\",\n      playingInstruction: '',\n    },\n  ],\n  source: 'builtin',\n};\n\nexport default defineComponent({\n  components: {\n    MiniLessonPlayer,\n  },\n  data() {\n    return {\n      miniLesson,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n.layout-test {\n  background: white;\n  padding: 1rem;\n  // margin: 0 auto;\n\n  width: 100vw;\n  height: calc(100vh);\n\n  // overflow: hidden;\n  box-sizing: border-box;\n  // height: 400px;\n}\n\n.test123 {\n  margin: 0 auto;\n  width: 300px;\n  height: 300px;\n  padding: 50px;\n  background: black;\n\n  .flexpar {\n    display: flex;\n    flex-flow: column nowrap;\n    height: 100%;\n    width: 100%;\n    background: gray;\n  }\n\n  .flexbar {\n    flex: 0 0 auto;\n    height: 150px;\n    background: green;\n  }\n\n  .flexexpand {\n    flex: 1 1 0;\n    background: blue;\n    height: 200px;\n  }\n}\n</style>\n","\nimport { defineComponent } from 'vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport MiniLesson from '@/model/MiniLesson';\n\nconst miniLesson: MiniLesson = {\n  _id: 'f60a2a6c-6324-4cb0-8034-38f3ac077a17',\n  header: {\n    clipName: 'renegade',\n    lessonTitle: '65% Practice',\n  },\n  segmentBreaks: [\n    0,\n    2.3333333333333335,\n    7.7,\n    12.233333333333333,\n  ],\n  activities: [\n    {\n      title: 'Refresher',\n      startTime: 0,\n      endTime: 12.233333333333333,\n      demoVisual: 'video',\n      userVisual: 'none',\n      focusedSegments: [\n        0,\n        1,\n        2,\n      ],\n      pauses: [],\n      practiceSpeed: 0.5,\n      startInstruction: \"We're going to speed it up a bit now\",\n      timedInstructions: [],\n      endInstruction: \"Next you'll try it at this speed WITHOUT the video!\",\n      playingInstruction: 'Follow along',\n    },\n    {\n      title: 'No Video',\n      startTime: 0,\n      endTime: 12.233333333333333,\n      demoVisual: 'skeleton',\n      userVisual: 'video',\n      focusedSegments: [\n        0,\n        1,\n        2,\n      ],\n      pauses: [],\n      startInstruction: 'Follow along with the teacher skeleton!',\n      timedInstructions: [],\n      practiceSpeed: 0.65,\n      endInstruction: \"Repeat until you've got it!\",\n      playingInstruction: '',\n    },\n  ],\n  source: 'builtin',\n};\n\nexport default defineComponent({\n  components: {\n    MiniLessonPlayer,\n  },\n  data() {\n    return {\n      miniLesson,\n    };\n  },\n});\n","import { render } from \"./LayoutTest.vue?vue&type=template&id=09cd6f46\"\nimport script from \"./LayoutTest.vue?vue&type=script&lang=ts\"\nexport * from \"./LayoutTest.vue?vue&type=script&lang=ts\"\n\nimport \"./LayoutTest.vue?vue&type=style&index=0&id=09cd6f46&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div ref=\"canvasBackground\" class=\"surface-container is-slightly-rounded\">\n\n    <div class=\"overlay overlay-background\">\n      <slot name=\"background\"></slot>\n    </div>\n\n    <video\n      class=\"mirrored is-slightly-rounded\"\n      ref=\"videoE\"\n      muted\n      :style=\"{\n        height: '720px',\n        width: '1280px',\n      }\"\n    ></video>\n\n    <div class=\"overlay\">\n      <slot name=\"ui\"></slot>\n    </div>\n\n    <DrawingSurface\n      :enableDrawing=\"isActivelyTracking\"\n      ref=\"drawingSurface\"\n      class=\"overlay\"/>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, onUpdated, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { setupMediaPipeListening } from '@/services/EventHub';\nimport { MpHolisticResults } from '@/services/MediaPipeTypes';\nimport DrawingSurface from './DrawingSurface.vue';\nimport { isTracking as mpIsTracking, StartTracking } from '../services/MediaPipe';\n\nexport default defineComponent({\n  name: 'CameraSurface',\n  components: {\n    DrawingSurface,\n  },\n  data() {\n    return {\n      trackingIntervalId: -1,\n    };\n  },\n  setup(props, { emit }) {\n    // const { enableDrawing } = toRefs(props);\n    const hasStartedTracking = ref(false);\n    const isActivelyTracking = ref(false);\n    const hasResults = ref(false);\n    const trackingResults = ref({});\n\n    let timerId = -1;\n    onMounted(() => {\n      timerId = window.setInterval(() => {\n        isActivelyTracking.value = mpIsTracking();\n      }, 500);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(timerId);\n    });\n\n    function onResults(results: MpHolisticResults) {\n      if (!hasResults.value) {\n        emit('tracking-attained');\n        console.log('Got Results', results);\n        hasResults.value = true;\n      }\n      trackingResults.value = results;\n      // this.$refs.drawingSurface.draw(results, canvasCtx);\n    }\n\n    setupMediaPipeListening(onResults);\n\n    return {\n      hasStartedTracking,\n      isActivelyTracking,\n      hasResults,\n      trackingResults,\n    };\n  },\n  methods: {\n    startTracking() {\n      if (this.trackingIntervalId !== -1) return;\n\n      const videoE = this.$refs.videoE as HTMLVideoElement;\n      const whenReady = () => {\n        if (this.hasStartedTracking) return;\n        this.hasStartedTracking = true;\n        console.log('Video loaded. Starting tracking...');\n\n        StartTracking(\n            this.$refs.videoE as HTMLVideoElement,\n        );\n\n        videoE.onloadedmetadata = null;\n      };\n\n      this.trackingIntervalId = window.setInterval(() => {\n\n        if (this.hasStartedTracking) {\n          clearInterval(this.trackingIntervalId);\n          this.trackingIntervalId = -1;\n        }\n\n        if (videoE.readyState === 4) {\n          whenReady();\n          return;\n        }\n\n        console.log('Video not ready, will start tracking when loaded.');\n      }, 100);\n\n      webcamProvider.connectVideoElement(videoE);\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.surface-container {\n  position: relative;\n  margin: auto;\n  width: 1280px;\n  height: 720px;\n  box-sizing: content-box;\n  text-align: center;\n\n  background: rgba(0, 0, 0, 0.3);\n\n  .overlay {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n  }\n\n  .overlay.overlay-bottom {\n    top: auto;\n  }\n  .overlay.overlay-left {\n    right: auto;\n  }\n  .overlay.overlay-right {\n    left: auto;\n  }\n  .overlay.overlay-top {\n    bottom: auto;\n  }\n}\n\n.mirrored {\n  transform: scaleX(-1);\n}\n\n// .overlay-background {\n//   z-index: -1;\n// }\n\n</style>\n","<template>\n  <canvas ref=\"canvasE\" width=\"1280\" height=\"720\" class=\"drawCanvas\"></canvas>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  ref, defineComponent, watch, toRefs, onMounted, Ref,\n} from 'vue';\nimport { WEBCAM_DIMENSIONS } from '@/services/WebcamProvider';\nimport { GestureNames, setupGestureListening } from '../services/EventHub';\n\nimport { MpHolisticResults } from '../services/MediaPipeTypes';\nimport {\n  HAND_LANDMARK_CONNECTIONS, DrawConnections, DrawPose,\n} from '../services/MediaPipe';\n\nfunction drawHandShape(results: MpHolisticResults, canvasCtx: CanvasRenderingContext2D) {\n  if (!results.rightHandLandmarks) {\n    return;\n  }\n\n  canvasCtx.save();\n\n  /* eslint-disable no-param-reassign */\n  canvasCtx.strokeStyle = 'white';\n  canvasCtx.lineWidth = 3.0;\n  canvasCtx.lineCap = 'round';\n\n  DrawConnections(canvasCtx, results.rightHandLandmarks, HAND_LANDMARK_CONNECTIONS);\n  canvasCtx.restore();\n}\n\nfunction drawTrackingResults(\n  enabled: boolean,\n  detectedGesture: string,\n  results: MpHolisticResults,\n  fadeTimeMs: number,\n  canvasCtx: CanvasRenderingContext2D,\n) {\n  if (!enabled) return;\n\n  const sourceAR = (results.image?.width ?? WEBCAM_DIMENSIONS.width)\n                   / (results.image?.height ?? WEBCAM_DIMENSIONS.height);\n\n  canvasCtx.save();\n  const trackingTimestamp = results.timestamp ?? Date.now();\n  canvasCtx.globalAlpha = 1 - (Date.now() - trackingTimestamp) / fadeTimeMs;\n\n  if (results.poseLandmarks) {\n    DrawPose(canvasCtx, results.poseLandmarks, {\n      sourceAspectRatio: sourceAR,\n    });\n  }\n  if (detectedGesture !== GestureNames.none) drawHandShape(results, canvasCtx);\n  canvasCtx.restore();\n}\n\nexport default defineComponent({\n  name: 'DrawingSurface',\n  props: {\n    enableDrawing: {\n      type: Boolean,\n      default: true,\n    },\n    fadeTimeMs: {\n      type: Number,\n      default: 1000,\n    },\n  },\n  setup(props) {\n    const { enableDrawing, fadeTimeMs } = toRefs(props);\n\n    const canvasE = ref(null) as unknown as Ref<HTMLCanvasElement>;\n    const gesture = ref(GestureNames.none);\n    const mpResults = ref({} as MpHolisticResults);\n\n    setupGestureListening({},\n      (ges, trackingResults) => {\n        gesture.value = ges;\n        mpResults.value = trackingResults;\n        // console.log('Drawing surface: recvived tracking results', ges, trackingResults);\n      });\n\n    onMounted(() => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.strokeStyle = 'rgba(200, 250, 200, 0.75)';\n      canvasCtx.lineWidth = 6;\n      canvasCtx.lineCap = 'round';\n    });\n\n    watch([enableDrawing, mpResults, gesture], (newVals) => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.clearRect(0, 0, canvas.width, canvas.height);\n\n      const isEnabled = newVals[0];\n      const holisticResults = newVals[1];\n      const detectedGesture = newVals[2];\n\n      drawTrackingResults(\n        isEnabled as unknown as boolean,\n        detectedGesture as unknown as string,\n        holisticResults as unknown as MpHolisticResults,\n        fadeTimeMs.value,\n        canvasCtx,\n      );\n    });\n\n    return {\n      canvasE,\n      gesture,\n      mpResults,\n    };\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n\n$pointer-size: 64px;\n\n.drawCanvas {\n  transform: scaleX(-1);\n  pointer-events: none;\n}\n\n.pointer-container {\n  position: fixed;\n  // transition: top .1s, left .1s;\n\n  img {\n    position: relative;\n    left: -$pointer-size / 2;\n    top: -32px;\n    width: 64px;\n    height: 64px;\n  }\n}\n\n</style>\n","\n\nimport {\n  ref, defineComponent, watch, toRefs, onMounted, Ref,\n} from 'vue';\nimport { WEBCAM_DIMENSIONS } from '@/services/WebcamProvider';\nimport { GestureNames, setupGestureListening } from '../services/EventHub';\n\nimport { MpHolisticResults } from '../services/MediaPipeTypes';\nimport {\n  HAND_LANDMARK_CONNECTIONS, DrawConnections, DrawPose,\n} from '../services/MediaPipe';\n\nfunction drawHandShape(results: MpHolisticResults, canvasCtx: CanvasRenderingContext2D) {\n  if (!results.rightHandLandmarks) {\n    return;\n  }\n\n  canvasCtx.save();\n\n  /* eslint-disable no-param-reassign */\n  canvasCtx.strokeStyle = 'white';\n  canvasCtx.lineWidth = 3.0;\n  canvasCtx.lineCap = 'round';\n\n  DrawConnections(canvasCtx, results.rightHandLandmarks, HAND_LANDMARK_CONNECTIONS);\n  canvasCtx.restore();\n}\n\nfunction drawTrackingResults(\n  enabled: boolean,\n  detectedGesture: string,\n  results: MpHolisticResults,\n  fadeTimeMs: number,\n  canvasCtx: CanvasRenderingContext2D,\n) {\n  if (!enabled) return;\n\n  const sourceAR = (results.image?.width ?? WEBCAM_DIMENSIONS.width)\n                   / (results.image?.height ?? WEBCAM_DIMENSIONS.height);\n\n  canvasCtx.save();\n  const trackingTimestamp = results.timestamp ?? Date.now();\n  canvasCtx.globalAlpha = 1 - (Date.now() - trackingTimestamp) / fadeTimeMs;\n\n  if (results.poseLandmarks) {\n    DrawPose(canvasCtx, results.poseLandmarks, {\n      sourceAspectRatio: sourceAR,\n    });\n  }\n  if (detectedGesture !== GestureNames.none) drawHandShape(results, canvasCtx);\n  canvasCtx.restore();\n}\n\nexport default defineComponent({\n  name: 'DrawingSurface',\n  props: {\n    enableDrawing: {\n      type: Boolean,\n      default: true,\n    },\n    fadeTimeMs: {\n      type: Number,\n      default: 1000,\n    },\n  },\n  setup(props) {\n    const { enableDrawing, fadeTimeMs } = toRefs(props);\n\n    const canvasE = ref(null) as unknown as Ref<HTMLCanvasElement>;\n    const gesture = ref(GestureNames.none);\n    const mpResults = ref({} as MpHolisticResults);\n\n    setupGestureListening({},\n      (ges, trackingResults) => {\n        gesture.value = ges;\n        mpResults.value = trackingResults;\n        // console.log('Drawing surface: recvived tracking results', ges, trackingResults);\n      });\n\n    onMounted(() => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.strokeStyle = 'rgba(200, 250, 200, 0.75)';\n      canvasCtx.lineWidth = 6;\n      canvasCtx.lineCap = 'round';\n    });\n\n    watch([enableDrawing, mpResults, gesture], (newVals) => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.clearRect(0, 0, canvas.width, canvas.height);\n\n      const isEnabled = newVals[0];\n      const holisticResults = newVals[1];\n      const detectedGesture = newVals[2];\n\n      drawTrackingResults(\n        isEnabled as unknown as boolean,\n        detectedGesture as unknown as string,\n        holisticResults as unknown as MpHolisticResults,\n        fadeTimeMs.value,\n        canvasCtx,\n      );\n    });\n\n    return {\n      canvasE,\n      gesture,\n      mpResults,\n    };\n  },\n});\n\n","import { render } from \"./DrawingSurface.vue?vue&type=template&id=002e5f90\"\nimport script from \"./DrawingSurface.vue?vue&type=script&lang=ts\"\nexport * from \"./DrawingSurface.vue?vue&type=script&lang=ts\"\n\nimport \"./DrawingSurface.vue?vue&type=style&index=0&id=002e5f90&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, onUpdated, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { setupMediaPipeListening } from '@/services/EventHub';\nimport { MpHolisticResults } from '@/services/MediaPipeTypes';\nimport DrawingSurface from './DrawingSurface.vue';\nimport { isTracking as mpIsTracking, StartTracking } from '../services/MediaPipe';\n\nexport default defineComponent({\n  name: 'CameraSurface',\n  components: {\n    DrawingSurface,\n  },\n  data() {\n    return {\n      trackingIntervalId: -1,\n    };\n  },\n  setup(props, { emit }) {\n    // const { enableDrawing } = toRefs(props);\n    const hasStartedTracking = ref(false);\n    const isActivelyTracking = ref(false);\n    const hasResults = ref(false);\n    const trackingResults = ref({});\n\n    let timerId = -1;\n    onMounted(() => {\n      timerId = window.setInterval(() => {\n        isActivelyTracking.value = mpIsTracking();\n      }, 500);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(timerId);\n    });\n\n    function onResults(results: MpHolisticResults) {\n      if (!hasResults.value) {\n        emit('tracking-attained');\n        console.log('Got Results', results);\n        hasResults.value = true;\n      }\n      trackingResults.value = results;\n      // this.$refs.drawingSurface.draw(results, canvasCtx);\n    }\n\n    setupMediaPipeListening(onResults);\n\n    return {\n      hasStartedTracking,\n      isActivelyTracking,\n      hasResults,\n      trackingResults,\n    };\n  },\n  methods: {\n    startTracking() {\n      if (this.trackingIntervalId !== -1) return;\n\n      const videoE = this.$refs.videoE as HTMLVideoElement;\n      const whenReady = () => {\n        if (this.hasStartedTracking) return;\n        this.hasStartedTracking = true;\n        console.log('Video loaded. Starting tracking...');\n\n        StartTracking(\n            this.$refs.videoE as HTMLVideoElement,\n        );\n\n        videoE.onloadedmetadata = null;\n      };\n\n      this.trackingIntervalId = window.setInterval(() => {\n\n        if (this.hasStartedTracking) {\n          clearInterval(this.trackingIntervalId);\n          this.trackingIntervalId = -1;\n        }\n\n        if (videoE.readyState === 4) {\n          whenReady();\n          return;\n        }\n\n        console.log('Video not ready, will start tracking when loaded.');\n      }, 100);\n\n      webcamProvider.connectVideoElement(videoE);\n    },\n  },\n});\n","import { render } from \"./CameraSurface.vue?vue&type=template&id=72ad0b54\"\nimport script from \"./CameraSurface.vue?vue&type=script&lang=ts\"\nexport * from \"./CameraSurface.vue?vue&type=script&lang=ts\"\n\nimport \"./CameraSurface.vue?vue&type=style&index=0&id=72ad0b54&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"onboardingUI\">\n    <div class=\"overlay instructions-overlay mb-4\">\n       <InstructionCarousel :instructions=\"instructions\" class=\"\"/>\n       <!-- <InstructionCarousel v-show=\"stage !== OnboardingStage.done\" :instructions=\"[{id: 0, text: 'How to use this app'}]\" class=\"m-2\"/> -->\n    </div>\n    <div class=\"vcenter-parent\" v-show=\"stage !== OnboardingStage.done\">\n      <div class=\"content translucent-text is-rounded p-6\">\n        <GestureIcon :gesture=\"gestureIcon\" />\n      </div>\n    </div>\n    <div class=\"overlay overlay-top overlay-right mt-4 mr-4\" v-show=\"stage !== OnboardingStage.done\">\n      <button class=\"button\" @click=\"skipOnboarding\">Skip</button>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport { usingHolistic } from '@/services/MediaPipe';\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref,\n} from 'vue';\n\nimport { setupGestureListening, GestureNames, TrackingActions } from '../services/EventHub';\nimport InstructionCarousel, { Instruction } from './elements/InstructionCarousel.vue';\nimport GestureIcon, { GestureIcons } from './elements/GestureIcon.vue';\n\nconst OnboardingStage = {\n  trySelectNext: 0,\n  trySelectPrevious: 1,\n  tryPerformPlay: 2,\n  done: 3,\n};\n\nexport default defineComponent({\n  name: 'OnboardingUI',\n  components: { InstructionCarousel, GestureIcon },\n  setup(props, ctx) {\n    const stage = ref(OnboardingStage.trySelectNext);\n    const output = ref('');\n\n    const instructions = computed(() => {\n      const instructs: Instruction[] = [];\n      if (stage.value === OnboardingStage.trySelectNext) {\n        instructs.push({\n          id: 0,\n          text:\n            usingHolistic\n              ? 'Point to the right with a flat hand to proceed'\n              : 'Point your left forearm to the right to proceed',\n        });\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        instructs.push({\n          id: 1,\n          text:\n          usingHolistic\n            ? 'Point to the left with a flat hand to repeat an activity'\n            : 'Point your right forearm to the left to repeat an activity',\n        });\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        instructs.push({\n          id: 2,\n          text: 'Put your hands together in a Namaste greeting to play a video',\n        });\n      } else {\n        instructs.push({\n          id: 3,\n          text: 'You got it!',\n        });\n      }\n      return instructs;\n    });\n\n    onMounted(() => {\n      TrackingActions.requestTracking('onboarding');\n    });\n    onBeforeUnmount(() => {\n      TrackingActions.endTrackingRequest('onboarding');\n    });\n\n    function advanceStage() {\n      if (stage.value === OnboardingStage.trySelectNext) {\n        stage.value = OnboardingStage.trySelectPrevious;\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        stage.value = OnboardingStage.tryPerformPlay;\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        stage.value = OnboardingStage.done;\n        TrackingActions.endTrackingRequest('onboarding');\n        setTimeout(() => {\n          ctx.emit('onboarding-complete');\n        }, 1500);\n      }\n    }\n    setupGestureListening({\n      [GestureNames.pointRight]: () => {\n        if (stage.value === OnboardingStage.trySelectNext) {\n          advanceStage();\n        }\n      },\n      [GestureNames.pointLeft]: () => {\n        if (stage.value === OnboardingStage.trySelectPrevious) {\n          advanceStage();\n        }\n      },\n      [GestureNames.namaste]: () => {\n        if (stage.value === OnboardingStage.tryPerformPlay) {\n          advanceStage();\n        }\n      },\n    });\n\n    function skipOnboarding() {\n      advanceStage();\n    }\n\n    const gestureIcon = computed(() => {\n      switch (stage.value) {\n        case OnboardingStage.trySelectNext:\n          return GestureIcons.forward;\n        case OnboardingStage.trySelectPrevious:\n          return GestureIcons.backward;\n        case OnboardingStage.tryPerformPlay:\n          return GestureIcons.play;\n        default:\n          return '';\n      }\n    });\n\n    return {\n      stage,\n      output,\n      instructions,\n      OnboardingStage,\n      skipOnboarding,\n      gestureIcon,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.onboardingUI {\n  width: 100%;\n  height: 100%;\n}\n\n</style>\n","<template>\n  <span class=\"icon is-large\" :class=\"iconClass\" v-if=\"showIcon\">\n    <i class=\"fas fa-2x fa-hand-paper fa-rotate-90\"></i>\n  </span>\n  <span v-else>\n    <img :src=\"gestureImgSrc\" :alt=\"gesture\">\n  </span>\n</template>\n\n<script lang=\"ts\">\nimport { usingHolistic } from '@/services/MediaPipe';\nimport { computed, defineComponent, toRefs } from 'vue';\n\nexport const GestureIcons = Object.freeze({\n  forward: 'forward',\n  backward: 'backward',\n  play: 'play',\n});\n\nexport default defineComponent({\n  props: {\n    gesture: {\n      type: String,\n      default: 'foward',\n    },\n  },\n  setup(props) {\n\n    const { gesture } = toRefs(props);\n\n    const showIcon = computed(() => usingHolistic);\n    const iconClass = computed(() => {\n      switch (gesture.value) {\n        case 'backward': return ['fa-flip-horizontal'];\n        case 'forward': return [];\n        default:\n          return [];\n      }\n    });\n    /* eslint-disable global-require */\n    /* eslint-disable import/no-dynamic-require */\n    const gestureImgSrc = computed(() => {\n      try {\n        return require(`../../assets/gestures/${gesture.value}.svg`);\n      } catch {\n        return '';\n      }\n    });\n\n    return {\n      showIcon,\n      iconClass,\n      gestureImgSrc,\n    };\n  },\n});\n</script>\n\n<style>\n</style>\n","\nimport { usingHolistic } from '@/services/MediaPipe';\nimport { computed, defineComponent, toRefs } from 'vue';\n\nexport const GestureIcons = Object.freeze({\n  forward: 'forward',\n  backward: 'backward',\n  play: 'play',\n});\n\nexport default defineComponent({\n  props: {\n    gesture: {\n      type: String,\n      default: 'foward',\n    },\n  },\n  setup(props) {\n\n    const { gesture } = toRefs(props);\n\n    const showIcon = computed(() => usingHolistic);\n    const iconClass = computed(() => {\n      switch (gesture.value) {\n        case 'backward': return ['fa-flip-horizontal'];\n        case 'forward': return [];\n        default:\n          return [];\n      }\n    });\n    /* eslint-disable global-require */\n    /* eslint-disable import/no-dynamic-require */\n    const gestureImgSrc = computed(() => {\n      try {\n        return require(`../../assets/gestures/${gesture.value}.svg`);\n      } catch {\n        return '';\n      }\n    });\n\n    return {\n      showIcon,\n      iconClass,\n      gestureImgSrc,\n    };\n  },\n});\n","import { render } from \"./GestureIcon.vue?vue&type=template&id=35fcd4fc\"\nimport script from \"./GestureIcon.vue?vue&type=script&lang=ts\"\nexport * from \"./GestureIcon.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\n\nimport { usingHolistic } from '@/services/MediaPipe';\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref,\n} from 'vue';\n\nimport { setupGestureListening, GestureNames, TrackingActions } from '../services/EventHub';\nimport InstructionCarousel, { Instruction } from './elements/InstructionCarousel.vue';\nimport GestureIcon, { GestureIcons } from './elements/GestureIcon.vue';\n\nconst OnboardingStage = {\n  trySelectNext: 0,\n  trySelectPrevious: 1,\n  tryPerformPlay: 2,\n  done: 3,\n};\n\nexport default defineComponent({\n  name: 'OnboardingUI',\n  components: { InstructionCarousel, GestureIcon },\n  setup(props, ctx) {\n    const stage = ref(OnboardingStage.trySelectNext);\n    const output = ref('');\n\n    const instructions = computed(() => {\n      const instructs: Instruction[] = [];\n      if (stage.value === OnboardingStage.trySelectNext) {\n        instructs.push({\n          id: 0,\n          text:\n            usingHolistic\n              ? 'Point to the right with a flat hand to proceed'\n              : 'Point your left forearm to the right to proceed',\n        });\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        instructs.push({\n          id: 1,\n          text:\n          usingHolistic\n            ? 'Point to the left with a flat hand to repeat an activity'\n            : 'Point your right forearm to the left to repeat an activity',\n        });\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        instructs.push({\n          id: 2,\n          text: 'Put your hands together in a Namaste greeting to play a video',\n        });\n      } else {\n        instructs.push({\n          id: 3,\n          text: 'You got it!',\n        });\n      }\n      return instructs;\n    });\n\n    onMounted(() => {\n      TrackingActions.requestTracking('onboarding');\n    });\n    onBeforeUnmount(() => {\n      TrackingActions.endTrackingRequest('onboarding');\n    });\n\n    function advanceStage() {\n      if (stage.value === OnboardingStage.trySelectNext) {\n        stage.value = OnboardingStage.trySelectPrevious;\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        stage.value = OnboardingStage.tryPerformPlay;\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        stage.value = OnboardingStage.done;\n        TrackingActions.endTrackingRequest('onboarding');\n        setTimeout(() => {\n          ctx.emit('onboarding-complete');\n        }, 1500);\n      }\n    }\n    setupGestureListening({\n      [GestureNames.pointRight]: () => {\n        if (stage.value === OnboardingStage.trySelectNext) {\n          advanceStage();\n        }\n      },\n      [GestureNames.pointLeft]: () => {\n        if (stage.value === OnboardingStage.trySelectPrevious) {\n          advanceStage();\n        }\n      },\n      [GestureNames.namaste]: () => {\n        if (stage.value === OnboardingStage.tryPerformPlay) {\n          advanceStage();\n        }\n      },\n    });\n\n    function skipOnboarding() {\n      advanceStage();\n    }\n\n    const gestureIcon = computed(() => {\n      switch (stage.value) {\n        case OnboardingStage.trySelectNext:\n          return GestureIcons.forward;\n        case OnboardingStage.trySelectPrevious:\n          return GestureIcons.backward;\n        case OnboardingStage.tryPerformPlay:\n          return GestureIcons.play;\n        default:\n          return '';\n      }\n    });\n\n    return {\n      stage,\n      output,\n      instructions,\n      OnboardingStage,\n      skipOnboarding,\n      gestureIcon,\n    };\n  },\n});\n","import { render } from \"./OnboardingUI.vue?vue&type=template&id=69ed9ac4\"\nimport script from \"./OnboardingUI.vue?vue&type=script&lang=ts\"\nexport * from \"./OnboardingUI.vue?vue&type=script&lang=ts\"\n\nimport \"./OnboardingUI.vue?vue&type=style&index=0&id=69ed9ac4&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <section class=\"section dance-menu\">\n\n    <div class=\"hero is-primary block\">\n      <div class=\"hero-body\">\n        <div class=\"container\">\n          <p class=\"title\">\n            Main Menu\n          </p>\n          <p class=\"subtitle mb-0\">\n            What do you want to learn?\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"tabs is-centered is-medium-desktop is-small-mobile is-toggle is-toggle-rounded\">\n      <ul>\n        <li v-for=\"(tab, i) in TabList\" :key=\"i\" :class=\"{'is-active': currentTab===tab}\">\n          <a @click=\"setTab(tab)\">{{tab}}</a>\n        </li>\n      </ul>\n    </div>\n\n    <div class=\"grid-menu container block\" v-show=\"currentTab === Tabs.Workflows\">\n      <div class=\"box m-4 hover-expand is-clickable\"\n        v-for=\"workflow in workflows\"\n        :key=\"workflow.id\"\n        @click=\"$emit('workflow-selected', workflow.id)\">\n        <div class=\"level\">\n          <div class=\"level-item mr-4\" v-if=\"workflow.thumbnailSrc\">\n            <img :src=\"workflow.thumbnailSrc\" class=\"image is-96x96 is-cover\">\n          </div>\n          <div class=\"level-item has-text-left\">\n            <div>\n              <p class=\"is-uppercase\">{{workflow.title}}</p>\n              <p class=\"is-size-7 has-text-grey mt-1 mb-1\" style=\"max-width:40ch;\">{{workflow.creationMethod}}</p>\n              <p class=\"is-size-7 has-text-grey\">Created {{workflow.created.toLocaleDateString()}} at {{workflow.created.toLocaleTimeString()}}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div v-if=\"currentTab === Tabs.Videos && availableTags.size > 0\" class=\"has-text-centered container\">\n      <!-- <h3 class=\"subtitle\">Tags</h3> -->\n      <strong>Filter by tag: </strong>\n      <span\n        v-for=\"tag in availableTags\"\n        :key=\"tag\"\n        class=\"tag m-1 is-size-6 is-clickable is-unselectable\"\n        :class=\"{'is-primary': activeTags.has(tag)}\"\n        @click=\"toggleTag(tag)\"\n      >{{tag}}</span>\n\n    </div>\n\n    <div class=\"grid-menu container block\"\n      v-show=\"currentTab === Tabs.Videos\"\n    >\n      <div\n        class=\"video-card card hover-expand\"\n        v-for=\"motion in filteredMotionList\"\n        :key=\"motion.title\"\n        @mouseover=\"motion.hovering = true\"\n        @mouseleave=\"motion.hovering = false\"\n        @click = \"motion.clicked = !motion.clicked\"\n      >\n        <div class=\"card-image\">\n          <figure class=\"image is-2by3\" v-if=\"(!motion.hovering) && (!motion.clicked)\">\n            <img :src=\"motion.thumbnailSrc\" class=\"is-contain\" />\n          </figure>\n          <figure class=\"image is-2by3\" v-else><video controls :src=\"motion.videoSrc\" @playing=\"motion.clicked=True\"></video></figure>\n        </div>\n        <div class=\"card-content\" >\n          <div class=\"level\">\n            <div class=\"level-item\">\n              {{ motion.title }}\n            </div>\n            <!-- <transition name=\"expand-down\" appear> -->\n              <div class=\"level-item\">\n                <button\n                  class=\"button is-small transition-all is-primary\"\n                  :class=\"{\n                    'is-outlined': !(motion.clicked || motion.hovering)\n                  }\"\n                  @click=\"selectedMotion = motion\">\n                  <span>Go</span>\n                  <span class=\"icon is-small\">\n                    <i class=\"fas fa-arrow-right\"></i>\n                  </span>\n                  </button>\n              </div>\n            <!-- </transition> -->\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"grid-menu container block\" v-show=\"currentTab === Tabs.Tools\">\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"uploadLessonUIActive = true\">\n        Upload Custom Lesson\n      </div>\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"uploadWorkflowUIActive = true\">\n        Upload Custom Workflow\n      </div>\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"$emit('pose-drawer-selected')\">\n        Pose Drawer Test\n      </div>\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"$emit('create-workflow-selected')\">\n        Workflow Editor\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': selectedMotion }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <LessonCard\n          :motion=\"selectedMotion\"\n          @closed=\"selectedMotion = null\"\n          @lesson-selected=\"onLessonSelected\"\n          @create-lesson-selected=\"createLessonSelected\"\n          @keyframeselectortool-selected=\"onKeyframeSelectorToolSelected\"\n        />\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': uploadLessonUIActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <UploadCard\n          v-if=\"uploadLessonUIActive\"\n          @cancelled=\"uploadLessonUIActive = false\"\n          :uploadAccept=\"'*.json'\"\n          :onFilesSelected=\"uploadLessons\"\n          :savingText=\"'Loading lessons...'\"\n          :successText=\"'Lessons loaded successfully'\"\n        />\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': uploadWorkflowUIActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <UploadCard\n          v-if=\"uploadWorkflowUIActive\"\n          @cancelled=\"uploadWorkflowUIActive = false\"\n          :uploadAccept=\"'*.json'\"\n          :onFilesSelected=\"uploadWorkflows\"\n          :savingText=\"'Loading workflows...'\"\n          :successText=\"'Workflows loaded successfully'\"\n        />\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport LessonCard from '@/components/elements/LessonCard.vue';\nimport UploadCard from '@/components/elements/UploadCard.vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\n\nconst Tabs = Object.freeze({\n  Workflows: 'Workflows',\n  Videos: 'Videos',\n  Tools: 'Tools',\n});\nconst TabSet = Object.freeze(new Set(Object.values(Tabs)));\nconst TabList = Object.freeze(new Array(...Object.values(Tabs)));\n\nexport default defineComponent({\n  name: 'MainMenu',\n  emits: [\n    'lesson-selected',\n    'pose-drawer-selected',\n    'create-lesson-selected',\n    'workflow-selected',\n    'create-workflow-selected',\n    'keyframeselectortool-selected',\n  ],\n  components: {\n    LessonCard,\n    UploadCard,\n  },\n  setup(props, ctx) {\n    const motionList = db.motions;\n    const selectedMotion = ref(null as DatabaseEntry | null);\n    const uploadLessonUIActive = ref(false);\n    const currentTab = ref(Tabs.Workflows);\n    const activeTags = ref(new Set());\n\n    function onLessonSelected(\n      videoEntry: DatabaseEntry,\n      lesson: MiniLesson,\n    ) {\n      ctx.emit('lesson-selected', videoEntry, lesson);\n      selectedMotion.value = null;\n    }\n\n    function createLessonSelected(videoEntry: DatabaseEntry) {\n      ctx.emit('create-lesson-selected', videoEntry);\n      selectedMotion.value = null;\n    }\n\n    const filteredMotionList = computed(() => {\n      const tagMatchingMotions = motionList.value.filter((motion) => {\n\n        if (activeTags.value.size === 0) return true;\n\n        const allTagsMatch = motion.tags.reduce((someTagMatches, currTag) => {\n          const thisTagMatches = activeTags.value.has(currTag);\n          return someTagMatches || thisTagMatches;\n        }, false);\n\n        return allTagsMatch;\n\n      });\n\n      return tagMatchingMotions;\n    });\n\n    return {\n      workflows: workflowManager.allWorkflows,\n      selectedMotion,\n      motionList,\n      filteredMotionList,\n      onLessonSelected,\n      createLessonSelected,\n      uploadLessonUIActive,\n      uploadWorkflowUIActive: ref(false),\n      workflowManager,\n      activeTags,\n      availableTags: db.allTags,\n      TabList,\n      Tabs,\n      currentTab,\n    };\n  },\n  methods: {\n    toggleTag(tag: string) {\n      if (this.activeTags.has(tag)) {\n        this.activeTags.delete(tag);\n      } else {\n        this.activeTags.add(tag);\n      }\n    },\n    setTab(tab: string) {\n      console.log('Switching to tab:', tab);\n      if (!TabSet.has(tab)) {\n        console.error(`Tab ${tab} not recognized!`);\n        return;\n      }\n      this.currentTab = tab;\n    },\n    onKeyframeSelectorToolSelected(videoEntry: DatabaseEntry, keyframes: number[]) {\n      this.$emit('keyframeselectortool-selected', videoEntry, keyframes);\n    },\n    async uploadLessons(files: FileList) {\n      console.log('Uploading lessons', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const lesson = JSON.parse(text);\n        db.validateLesson(lesson);\n        db.saveCustomLesson(lesson);\n      }\n      return true;\n    },\n    async uploadWorkflows(files: FileList) {\n      console.log('Uploading workflows', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const workflow = JSON.parse(text);\n        WorkflowManager.validateWorkflow(workflow);\n\n        if (workflowManager.hasBakedInWorkflow(workflow.id)) throw new Error(`Cannot overwrite baked in workflow ${workflowManager.workflows.get(workflow.id)?.title}`);\n\n        // eslint-disable-next-line no-alert\n        if (!workflowManager.hasWorkflow(workflow.id) || window.confirm(`Are you sure you want to overwrite workflow '${workflowManager.workflows.get(workflow.id)?.title}'?`)) {\n          workflowManager.upsertCustomWorkflow(workflow);\n        }\n      }\n      return true;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n// .dance-menu {\n// backdrop-filter: blur(4px);\n// background: rgba(0, 0, 0, 0.2);\n// }\n\n.video-card.card {\n  max-width: 300px;\n}\n\n.video-card {\n  width: 210px;\n  flex-grow: 1;\n\n  margin: 1em;\n\n  img {\n    object-fit: cover;\n  }\n\n  .subtitle {\n    margin: 2rem 1rem 2em;\n    color: white;\n  }\n\n  .section {\n    padding: 1.5rem;\n  }\n\n  .image video {\n    bottom: 0;\n    left: 0;\n    right: 0;\n    top: 0;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n}\n\n/* Enter and leave animations can use different */\n/* durations and timing functions.              */\n.expand-down-enter-active {\n  transition: all .3s ease;\n}\n.expand-down-leave-active {\n  transition: all .8s cubic-bezier(1.0, 0.5, 0.8, 1.0);\n}\n.expand-down-enter, .expand-down-leave-to\n/* .slide-fade-leave-active below version 2.1.8 */ {\n  transform: scaleY(0);\n  height: 0;\n  opacity: 0;\n}\n.collapsed {\n  transform: scaleY(0);\n  height: 0;\n}\n.animate-height {\n  transition: transform 0.15s ease;\n}\n\n.transition-all {\n  transition: all 0.15s ease;\n}\n</style>\n","<template>\n  <div class=\"card lesson-card\" v-if=\"motion\">\n    <div class=\"card-header\">\n      <h4 class=\"card-header-title\">\n        {{ motion.title }}\n      </h4>\n\n      <a class=\"card-header-icon\" @click=\"$emit('closed')\">\n        <i class=\"fas fa-times\"></i>\n      </a>\n    </div>\n    <div class=\"card-content\">\n      <div class=\"columns\">\n        <div class=\"column is-narrow is-hidden-mobile\">\n          <video :src=\"motion.videoSrc\" autoplay=\"true\" muted=\"true\" width=\"180\" />\n        </div>\n        <div class=\"column\">\n          <div class=\"menu\">\n            <p class=\"menu-label\">\n              Pick a mini-lesson\n            </p>\n            <ul class=\"menu-list\">\n              <li v-for=\"lesson in lessons\" :key=\"lesson._id\">\n                <a @click=\"$emit('lesson-selected', motion, lesson)\">\n                  {{ lesson.header.lessonTitle }}\n                </a>\n              </li>\n              <li v-if=\"canCreateLesson\">\n                <a @click=\"$emit('create-lesson-selected', motion)\">Create Lesson</a>\n              </li>\n              <li v-for=\"(kfopt, i) in keyframeOptions\" :key=\"i\">\n                <a @click=\"$emit('keyframeselectortool-selected', motion, kfopt.keyframes)\">Keyframes - {{kfopt.title}}</a>\n              </li>\n              <li>\n                <a @click=\"$emit('keyframeselectortool-selected', motion, [])\">Select Keyframes</a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport keyframeOptions from '@/model/keyframeOptions.json';\n\nexport default defineComponent({\n  name: 'LessonCard',\n  props: {\n    motion: {\n      type: Object,\n    },\n    canCreateLesson: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  computed: {\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      const lessons = db.getLessons(motion);\n      return lessons ?? [];\n    },\n    keyframeOptions() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      return keyframeOptions.filter((option) => option.clipName === motion.clipName);\n    },\n  },\n  emits: ['lesson-selected', 'create-lesson-selected', 'closed', 'keyframeselectortool-selected'],\n});\n</script>\n\n<style lang=\"scss\">\n\n.lesson-card .dance-image {\n  max-height: 50vh;\n}\n\n</style>\n","\nimport { defineComponent } from 'vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport keyframeOptions from '@/model/keyframeOptions.json';\n\nexport default defineComponent({\n  name: 'LessonCard',\n  props: {\n    motion: {\n      type: Object,\n    },\n    canCreateLesson: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  computed: {\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      const lessons = db.getLessons(motion);\n      return lessons ?? [];\n    },\n    keyframeOptions() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      return keyframeOptions.filter((option) => option.clipName === motion.clipName);\n    },\n  },\n  emits: ['lesson-selected', 'create-lesson-selected', 'closed', 'keyframeselectortool-selected'],\n});\n","import { render } from \"./LessonCard.vue?vue&type=template&id=03645483\"\nimport script from \"./LessonCard.vue?vue&type=script&lang=ts\"\nexport * from \"./LessonCard.vue?vue&type=script&lang=ts\"\n\nimport \"./LessonCard.vue?vue&type=style&index=0&id=03645483&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"card upload-card\">\n    <div class=\"card-header\">\n      <h4 class=\"card-header-title\">Upload File</h4>\n\n      <a class=\"card-header-icon\" @click=\"$emit('cancelled')\">\n        <i class=\"fas fa-times\"></i>\n      </a>\n    </div>\n    <div class=\"card-content\">\n      <form\n        enctype=\"multipart/form-data\"\n        novalidate\n        v-if=\"isInitial || isSaving || isFailed\"\n      >\n        <div class=\"field\">\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <div class=\"dropbox is-rounded\">\n              <input\n                type=\"file\"\n                :name=\"uploadFieldName\"\n                :disabled=\"isSaving\"\n                @change=\"\n                  save($event.target.files, $event.target);\n                  fileCount = $event.target.files.length;\n                \"\n                :accept=\"uploadAccept\"\n                class=\"file-input\"\n              />\n              <p class=\"is-size-7\" v-if=\"isInitial\">\n                {{uploadInstructions}}\n              </p>\n              <p class=\"is-size-7\" v-if=\"isSaving\">\n                {{savingText}}\n              </p>\n              <div class=\"is-size-7 has-text-centered\" v-if=\"isFailed\">\n                <p>Error saving:</p>\n                <p style=\"max-width:60ch;\" class=\"has-text-danger\">{{uploadError}}</p>\n                <p><strong>Please try again.</strong></p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </form>\n      <div class=\"has-text-success\" v-if=\"isSuccess\">{{successText}}</div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nconst Status = Object.freeze({\n  Initial: 'Initial',\n  Saving: 'Saving',\n  Success: 'Success',\n  Failed: 'Failed',\n});\n\nexport default defineComponent({\n  name: 'UploadCard',\n  props: {\n    uploadAccept: {\n      type: String,\n      default: '*',\n    },\n    uploadInstructions: {\n      type: String,\n      default: 'Click here or drag your file(s) over this area',\n    },\n    savingText: {\n      type: String,\n      default: 'Processing File(s)...',\n    },\n    onFilesSelected: {\n      type: Function,\n      default: () => {},\n    },\n    successText: {\n      type: String,\n      default: 'Files uploaded successfully',\n    },\n  },\n  data() {\n    return {\n      uploadError: null,\n      currentStatus: null as null | string,\n      uploadFieldName: 'files',\n    };\n  },\n  emits: ['cancelled', 'done'],\n  computed: {\n    isInitial() { return (this as any).currentStatus === Status.Initial; },\n    isSaving() { return (this as any).currentStatus === Status.Saving; },\n    isSuccess() { return (this as any).currentStatus === Status.Success; },\n    isFailed() { return (this as any).currentStatus === Status.Failed; },\n  },\n  methods: {\n    reset() {\n      // reset form to initial state\n      this.currentStatus = Status.Initial;\n      this.uploadError = null;\n    },\n    async save(fileList: FileList) {\n      // upload data to the server\n      this.currentStatus = Status.Saving;\n\n      try {\n        const result = await this.onFilesSelected(fileList);\n        if (result) {\n          this.$emit('done');\n          this.currentStatus = Status.Success;\n        } else {\n          this.currentStatus = Status.Initial;\n        }\n      } catch (e) {\n        this.currentStatus = Status.Failed;\n        this.uploadError = e;\n      }\n    },\n  },\n  mounted() {\n    this.reset();\n  },\n});\n</script>\n\n<style lang=\"scss\">\n.upload-card {\n  .file-input {\n    opacity: 0;\n    width: 100%;\n    height: 160px;\n    position: absolute;\n    cursor: pointer;\n  }\n\n  .dropbox {\n    outline: 2px dashed gray;\n    outline-offset: -1rem;\n    min-height: 160px;\n    min-width: 320px;\n    color: dimgray;\n    padding: 1.5rem;\n    position: relative;\n    cursor: pointer;\n\n    &:hover {\n      background: lightblue;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent } from 'vue';\n\nconst Status = Object.freeze({\n  Initial: 'Initial',\n  Saving: 'Saving',\n  Success: 'Success',\n  Failed: 'Failed',\n});\n\nexport default defineComponent({\n  name: 'UploadCard',\n  props: {\n    uploadAccept: {\n      type: String,\n      default: '*',\n    },\n    uploadInstructions: {\n      type: String,\n      default: 'Click here or drag your file(s) over this area',\n    },\n    savingText: {\n      type: String,\n      default: 'Processing File(s)...',\n    },\n    onFilesSelected: {\n      type: Function,\n      default: () => {},\n    },\n    successText: {\n      type: String,\n      default: 'Files uploaded successfully',\n    },\n  },\n  data() {\n    return {\n      uploadError: null,\n      currentStatus: null as null | string,\n      uploadFieldName: 'files',\n    };\n  },\n  emits: ['cancelled', 'done'],\n  computed: {\n    isInitial() { return (this as any).currentStatus === Status.Initial; },\n    isSaving() { return (this as any).currentStatus === Status.Saving; },\n    isSuccess() { return (this as any).currentStatus === Status.Success; },\n    isFailed() { return (this as any).currentStatus === Status.Failed; },\n  },\n  methods: {\n    reset() {\n      // reset form to initial state\n      this.currentStatus = Status.Initial;\n      this.uploadError = null;\n    },\n    async save(fileList: FileList) {\n      // upload data to the server\n      this.currentStatus = Status.Saving;\n\n      try {\n        const result = await this.onFilesSelected(fileList);\n        if (result) {\n          this.$emit('done');\n          this.currentStatus = Status.Success;\n        } else {\n          this.currentStatus = Status.Initial;\n        }\n      } catch (e) {\n        this.currentStatus = Status.Failed;\n        this.uploadError = e;\n      }\n    },\n  },\n  mounted() {\n    this.reset();\n  },\n});\n","import { render } from \"./UploadCard.vue?vue&type=template&id=4565a82c\"\nimport script from \"./UploadCard.vue?vue&type=script&lang=ts\"\nexport * from \"./UploadCard.vue?vue&type=script&lang=ts\"\n\nimport \"./UploadCard.vue?vue&type=style&index=0&id=4565a82c&lang=scss\"\nscript.render = render\n\nexport default script","\nimport { computed, defineComponent, ref } from 'vue';\nimport LessonCard from '@/components/elements/LessonCard.vue';\nimport UploadCard from '@/components/elements/UploadCard.vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport MiniLesson from '@/model/MiniLesson';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\n\nconst Tabs = Object.freeze({\n  Workflows: 'Workflows',\n  Videos: 'Videos',\n  Tools: 'Tools',\n});\nconst TabSet = Object.freeze(new Set(Object.values(Tabs)));\nconst TabList = Object.freeze(new Array(...Object.values(Tabs)));\n\nexport default defineComponent({\n  name: 'MainMenu',\n  emits: [\n    'lesson-selected',\n    'pose-drawer-selected',\n    'create-lesson-selected',\n    'workflow-selected',\n    'create-workflow-selected',\n    'keyframeselectortool-selected',\n  ],\n  components: {\n    LessonCard,\n    UploadCard,\n  },\n  setup(props, ctx) {\n    const motionList = db.motions;\n    const selectedMotion = ref(null as DatabaseEntry | null);\n    const uploadLessonUIActive = ref(false);\n    const currentTab = ref(Tabs.Workflows);\n    const activeTags = ref(new Set());\n\n    function onLessonSelected(\n      videoEntry: DatabaseEntry,\n      lesson: MiniLesson,\n    ) {\n      ctx.emit('lesson-selected', videoEntry, lesson);\n      selectedMotion.value = null;\n    }\n\n    function createLessonSelected(videoEntry: DatabaseEntry) {\n      ctx.emit('create-lesson-selected', videoEntry);\n      selectedMotion.value = null;\n    }\n\n    const filteredMotionList = computed(() => {\n      const tagMatchingMotions = motionList.value.filter((motion) => {\n\n        if (activeTags.value.size === 0) return true;\n\n        const allTagsMatch = motion.tags.reduce((someTagMatches, currTag) => {\n          const thisTagMatches = activeTags.value.has(currTag);\n          return someTagMatches || thisTagMatches;\n        }, false);\n\n        return allTagsMatch;\n\n      });\n\n      return tagMatchingMotions;\n    });\n\n    return {\n      workflows: workflowManager.allWorkflows,\n      selectedMotion,\n      motionList,\n      filteredMotionList,\n      onLessonSelected,\n      createLessonSelected,\n      uploadLessonUIActive,\n      uploadWorkflowUIActive: ref(false),\n      workflowManager,\n      activeTags,\n      availableTags: db.allTags,\n      TabList,\n      Tabs,\n      currentTab,\n    };\n  },\n  methods: {\n    toggleTag(tag: string) {\n      if (this.activeTags.has(tag)) {\n        this.activeTags.delete(tag);\n      } else {\n        this.activeTags.add(tag);\n      }\n    },\n    setTab(tab: string) {\n      console.log('Switching to tab:', tab);\n      if (!TabSet.has(tab)) {\n        console.error(`Tab ${tab} not recognized!`);\n        return;\n      }\n      this.currentTab = tab;\n    },\n    onKeyframeSelectorToolSelected(videoEntry: DatabaseEntry, keyframes: number[]) {\n      this.$emit('keyframeselectortool-selected', videoEntry, keyframes);\n    },\n    async uploadLessons(files: FileList) {\n      console.log('Uploading lessons', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const lesson = JSON.parse(text);\n        db.validateLesson(lesson);\n        db.saveCustomLesson(lesson);\n      }\n      return true;\n    },\n    async uploadWorkflows(files: FileList) {\n      console.log('Uploading workflows', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const workflow = JSON.parse(text);\n        WorkflowManager.validateWorkflow(workflow);\n\n        if (workflowManager.hasBakedInWorkflow(workflow.id)) throw new Error(`Cannot overwrite baked in workflow ${workflowManager.workflows.get(workflow.id)?.title}`);\n\n        // eslint-disable-next-line no-alert\n        if (!workflowManager.hasWorkflow(workflow.id) || window.confirm(`Are you sure you want to overwrite workflow '${workflowManager.workflows.get(workflow.id)?.title}'?`)) {\n          workflowManager.upsertCustomWorkflow(workflow);\n        }\n      }\n      return true;\n    },\n  },\n});\n","import { render } from \"./MainMenu.vue?vue&type=template&id=1d2c3212\"\nimport script from \"./MainMenu.vue?vue&type=script&lang=ts\"\nexport * from \"./MainMenu.vue?vue&type=script&lang=ts\"\n\nimport \"./MainMenu.vue?vue&type=style&index=0&id=1d2c3212&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n   <div class=\"webcam-prompt-card vcenter-parent\" >\n        <div class=\"card\">\n          <div class=\"card-header\">\n            <h3 class=\"card-header-title\">\n            Webcam Access Needed\n            </h3>\n          </div>\n          <div class=\"card-content\">\n            <div class=\"content\">\n              <p>\n                During the lesson, you'll step back from your computer\n                and control this app with gestures. Later on, we'll also\n                use your webcam to give you tips on your technique.\n              </p>\n              <p class=\"notification is-warning\">\n                Please <strong>stop other programs that are using your webcam</strong>. On most computers, only one app is able to use the webcam at a time.\n              </p>\n              <p>\n                <strong>To continue, please grant access to your webcam.</strong>\n              </p>\n            </div>\n          </div>\n          <div class=\"card-content\">\n            <div class=\"buttons is-right\">\n              <a @click=\"$emit('cancelSelected')\" class=\"is-inverted button is-danger\">\n                Cancel\n              </a>\n              <a @click=\"$emit('startWebcamSelected')\" class=\"button is-primary\">\n                Start Webcam\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n</template>\n\n<script>\n\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n  name: 'WebcamPromptCard',\n});\n</script>\n\n<style lang=\"scss\">\n\n.webcam-prompt-card .content {\n  max-width: 60ch;\n  text-align: left;\n}\n</style>\n","import { render } from \"./WebcamPromptCard.vue?vue&type=template&id=07a96404\"\nimport script from \"./WebcamPromptCard.vue?vue&type=script&lang=js\"\nexport * from \"./WebcamPromptCard.vue?vue&type=script&lang=js\"\n\nimport \"./WebcamPromptCard.vue?vue&type=style&index=0&id=07a96404&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"pose-drawer p-4 content\">\n    <teleport to=\"#topbarLeft\">\n      <button class=\"button\" @click=\"$emit('back-selected')\">&lt; Back</button>\n    </teleport>\n\n    <teleport to='#belowSurface'>\n      <span class=\"is-pulled-right mt-4\">\n        <button class=\"button mr-2\"  @click=\"playVideo\">Play</button>\n        <button class=\"button\" @click=\"pauseVideo\">Pause</button>\n      </span>\n    </teleport>\n    <h3>Pose Drawer Test</h3>\n\n    <div class=\"dropdown\" :class=\"{ 'is-active': dropdownOpen}\">\n      <div class=\"dropdown-trigger\">\n        <button class=\"button\" @click=\"dropdownOpen = !dropdownOpen\">\n          <span>Select a dance</span>\n          <span class=\"icon is-small\">\n            <i class=\"fas fa-angle-down\" aria-hidden=\"true\"></i>\n          </span>\n        </button>\n      </div>\n      <div class=\"dropdown-menu\">\n        <div class=\"dropdown-content\">\n          <a v-for=\"motion in motions\"\n                  :key=\"motion.title\"\n                  class=\"dropdown-item\"\n            @click=\"loadMotion(motion)\">\n            {{motion.title}}\n          </a>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"columns\">\n      <div class=\"column\">\n        <h4 class=\"mt-4\">{{clipName}}</h4>\n\n        <div class=\"notification is-danger\" v-show=\"error\">\n          {{error}}\n        </div>\n\n        <div class=\"table-container\" style=\"overflow:auto auto; max-height: 500px;\">\n          <table class=\"table is-fullwidth is-hoverable is-bordered\" v-if=\"videoPlayer && videoPlayer.currentPose\">\n            <thead>\n              <tr>\n                <th>id</th>\n                <th>x</th>\n                <th>y</th>\n                <th>vis</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr v-for=\"(lm, index) in videoPlayer.currentPose\" :key=\"index\">\n                <td>{{index}}</td>\n                <td>{{lm.x}}</td>\n                <td>{{lm.y}}</td>\n                <td>{{lm.visibility}}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n      <div class=\"column is-one-third\" v-if=\"activeVideoEntry\">\n        <VideoPlayer\n        :videoBaseUrl=\"videoSrc\"\n        ref=\"videoPlayer\"\n        :drawPoseLandmarks=\"true\"\n        @progress=\"onProgress\"/>\n        <div>\n          <input class=\"mt-0 slider is-fullwidth is-primary\" type=\"range\" @input=\"changeTime($event)\" :min=\"0\" :max=\"activeVideoEntry.duration\" step=\"0.01\" />\n        </div>\n      </div>\n    </div>\n\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport {\n  computed, defineComponent, ref,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'PoseDrawerTest',\n  components: { VideoPlayer },\n  setup() {\n    const { motions } = db;\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n    const dropdownOpen = ref(false);\n\n    const activeVideoEntry = ref(null as null | DatabaseEntry);\n    const clipName = computed(() => activeVideoEntry.value?.clipName ?? 'No clip selected');\n    const videoSrc = computed(() => activeVideoEntry.value?.videoSrc ?? '');\n    const videoTime = ref(0);\n    const fps = ref(30);\n    const error = ref(null as string | null);\n\n    async function loadMotion(entry: DatabaseEntry) {\n      activeVideoEntry.value = entry;\n      error.value = null;\n      dropdownOpen.value = false;\n      fps.value = entry.fps;\n    }\n\n    function playVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.playVideo(0, 1000, 0.5);\n    }\n    function pauseVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.pauseVideo();\n    }\n\n    function onProgress(time: number) {\n      videoTime.value = time;\n    }\n\n    return {\n      motions,\n      activeVideoEntry,\n      videoPlayer,\n      error,\n      loadMotion,\n      dropdownOpen,\n      clipName,\n      videoSrc,\n      playVideo,\n      pauseVideo,\n      onProgress,\n    };\n  },\n  methods: {\n    changeTime(event: InputEvent) {\n      const vidPlayer = this.videoPlayer;\n      if (!vidPlayer) return;\n      const time = (event.target as HTMLInputElement).valueAsNumber;\n      if (!Number.isNaN(time)) vidPlayer.setTime(time);\n    },\n  },\n});\n</script>\n\n<style>\n\n.pose-drawer {\n  margin: auto;\n  width: 1280px;\n  height: 720px;\n  position: relative;\n  background: white;\n  box-sizing: border-box;\n}\n</style>\n","\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport {\n  computed, defineComponent, ref,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'PoseDrawerTest',\n  components: { VideoPlayer },\n  setup() {\n    const { motions } = db;\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n    const dropdownOpen = ref(false);\n\n    const activeVideoEntry = ref(null as null | DatabaseEntry);\n    const clipName = computed(() => activeVideoEntry.value?.clipName ?? 'No clip selected');\n    const videoSrc = computed(() => activeVideoEntry.value?.videoSrc ?? '');\n    const videoTime = ref(0);\n    const fps = ref(30);\n    const error = ref(null as string | null);\n\n    async function loadMotion(entry: DatabaseEntry) {\n      activeVideoEntry.value = entry;\n      error.value = null;\n      dropdownOpen.value = false;\n      fps.value = entry.fps;\n    }\n\n    function playVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.playVideo(0, 1000, 0.5);\n    }\n    function pauseVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.pauseVideo();\n    }\n\n    function onProgress(time: number) {\n      videoTime.value = time;\n    }\n\n    return {\n      motions,\n      activeVideoEntry,\n      videoPlayer,\n      error,\n      loadMotion,\n      dropdownOpen,\n      clipName,\n      videoSrc,\n      playVideo,\n      pauseVideo,\n      onProgress,\n    };\n  },\n  methods: {\n    changeTime(event: InputEvent) {\n      const vidPlayer = this.videoPlayer;\n      if (!vidPlayer) return;\n      const time = (event.target as HTMLInputElement).valueAsNumber;\n      if (!Number.isNaN(time)) vidPlayer.setTime(time);\n    },\n  },\n});\n","import { render } from \"./PoseDrawerTest.vue?vue&type=template&id=2804ff56\"\nimport script from \"./PoseDrawerTest.vue?vue&type=script&lang=ts\"\nexport * from \"./PoseDrawerTest.vue?vue&type=script&lang=ts\"\n\nimport \"./PoseDrawerTest.vue?vue&type=style&index=0&id=2804ff56&lang=css\"\nscript.render = render\n\nexport default script","\nimport {\n  computed, defineComponent, nextTick, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { DatabaseEntry } from '@/services/MotionDatabase';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport CreateWorkflowScreen from '@/components/screens/CreateWorkflowScreen.vue';\nimport MiniLessonPlayer from '@/components/elements/MiniLessonPlayer.vue';\nimport LayoutTest from '@/components/elements/LayoutTest.vue';\nimport KeyframeSelectorTool from '@/components/tools/KeyframeSelectorTool.vue';\nimport CameraSurface from './components/CameraSurface.vue';\nimport OnboardingUI from './components/OnboardingUI.vue';\nimport MainMenu from './components/screens/MainMenu.vue';\n// import LearningScreen from './components/screens/LearningScreen.vue';\nimport MiniLesson from './model/MiniLesson';\nimport WebcamPromptCard from './components/elements/WebcamPromptCard.vue';\n\nimport PoseDrawerTest from './components/screens/PoseDrawerTest.vue';\nimport CreateLessonScreen from './components/screens/CreateLessonScreen.vue';\nimport workflowManager from './services/WorkflowManager';\nimport optionsManager from './services/OptionsManager';\n\nconst State = {\n  LayoutTest: 'LayoutTest',\n  MainMenu: 'MainMenu',\n  PromptStartWebcam: 'PromptStartWebcam',\n  StartingWebcam: 'StartingWebcam',\n  LoadingTracking: 'LoadingTracking',\n  Onboarding: 'Onboarding',\n  LessonActive: 'LessonActive',\n  WorkflowActive: 'WorkflowActive',\n  PoseDrawingTester: 'PoseDrawingTester',\n  CreateLesson: 'CreateLesson',\n  CreateWorkflow: 'CreateWorkflow',\n  KeyframeSelectorTool: 'KeyframeSelectorTool',\n};\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    CameraSurface,\n    OnboardingUI,\n    MainMenu,\n    LayoutTest,\n    WorkflowMenu,\n    // LearningScreen,\n    KeyframeSelectorTool,\n    WebcamPromptCard,\n    PoseDrawerTest,\n    CreateLessonScreen,\n    CreateWorkflowScreen,\n    MiniLessonPlayer,\n  },\n  setup() {\n    const state = ref(State.MainMenu);\n    const cameraSurface = ref(null as typeof CameraSurface | null);\n    const hasCompletedOnboarding = ref(false);\n\n    const currentVideo = ref(null as DatabaseEntry | null);\n    const currentLesson = ref(null as MiniLesson | null);\n    const keyframes = ref([] as number[]);\n\n    const showCameraSurface = computed(() => [\n      State.PromptStartWebcam,\n      State.StartingWebcam,\n      State.LoadingTracking,\n      State.Onboarding,\n      // State.LessonActive,\n    ].indexOf(state.value) !== -1);\n\n    function lessonSelected(videoEntry: DatabaseEntry, lesson: MiniLesson) {\n      currentVideo.value = videoEntry;\n      currentLesson.value = lesson;\n\n      state.value = State.LessonActive;\n      // if (webcamProvider.webcamStatus.value === 'running') state.value = State.LessonActive;\n      // else state.value = State.PromptStartWebcam;\n    }\n\n    function startKeyframeSelection(videoEntry: DatabaseEntry, kfs: number[]) {\n      console.log('startKeyframeSelection', videoEntry, kfs);\n      keyframes.value = kfs;\n      currentVideo.value = videoEntry;\n      state.value = State.KeyframeSelectorTool;\n    }\n\n    function goHome() {\n      state.value = State.MainMenu;\n      currentVideo.value = null;\n      currentLesson.value = null;\n    }\n\n    async function startTracking() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      nextTick(() => {\n        const camSurface: any = cameraSurface.value;\n        state.value = State.LoadingTracking;\n        camSurface.startTracking();\n      });\n    }\n\n    async function startWebcam() {\n      console.log('Starting Webcam');\n\n      if (webcamProvider.webcamStatus.value !== 'running') {\n        state.value = State.StartingWebcam;\n\n        try {\n          await webcamProvider.startWebcam();\n        } catch (e) {\n          console.error('Error starting webcam: ', e);\n          // eslint-disable-next-line no-alert\n          alert('Failed to start the webcam\\n\\nPlease ensure this is the only app using the camera and that you\\'ve allowed camera access in your browser.');\n          state.value = State.MainMenu;\n          return;\n        }\n      }\n\n      state.value = State.LoadingTracking;\n      try {\n        await startTracking();\n      } catch (e) {\n        console.error(\"Couldn't start tracking\", e);\n      }\n    }\n\n    function onTrackingAttained() {\n      console.log('Tracking attained');\n      if (hasCompletedOnboarding.value) {\n        state.value = State.LessonActive;\n      } else state.value = State.Onboarding;\n    }\n\n    return {\n      showCameraSurface,\n      currentVideo,\n      currentLesson,\n      lessonSelected,\n      goHome,\n      startWebcam,\n      onTrackingAttained,\n      startKeyframeSelection,\n      keyframes,\n      state,\n      cameraSurface,\n      State,\n      startedWithWorkflow: ref(false),\n      isTest: optionsManager.isTest,\n      participantId: optionsManager.participantId,\n    };\n  },\n  mounted() {\n    // If app was launched with a workflowId, skip straight\n    // to that workflow\n    if (optionsManager.workflowId.value) {\n      if (this.startWorkflow(optionsManager.workflowId.value)) {\n        this.startedWithWorkflow = true;\n      }\n    }\n  },\n  methods: {\n    poseDrawerSelected() {\n      this.state = State.PoseDrawingTester;\n    },\n    createLessonSelected(dance: DatabaseEntry) {\n      this.currentVideo = dance;\n      this.state = State.CreateLesson;\n    },\n    startWorkflow(workflowId: string) {\n      console.log('Starting workflow', workflowId);\n      if (workflowManager.setActiveFlow(workflowId)) {\n        this.state = State.WorkflowActive;\n        return true;\n      }\n      return false;\n    },\n  },\n});\n","import { render } from \"./App.vue?vue&type=template&id=5caf3638\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=5caf3638&lang=scss\"\nscript.render = render\n\nexport default script","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker';\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready() {\n      console.log(\n        'App is being served from cache by a service worker.\\n'\n        + 'For more details, visit https://goo.gl/AFskqB',\n      );\n    },\n    registered() {\n      console.log('Service worker has been registered.');\n    },\n    cached() {\n      console.log('Content has been cached for offline use.');\n    },\n    updatefound() {\n      console.log('New content is downloading.');\n    },\n    updated() {\n      console.log('New content is available; please refresh.');\n    },\n    offline() {\n      console.log('No internet connection found. App is running in offline mode.');\n    },\n    error(error) {\n      console.error('Error during service worker registration:', error);\n    },\n  });\n}\n","import { Landmark, MpHolisticResults, PoseLandmarks } from './MediaPipeTypes';\nimport eventHub, { EventNames, GestureNames } from './EventHub';\nimport {\n  HAND, usingHolistic,\n} from './MediaPipe';\n\nconst minDetectionVisibility = 0.85;\n\nfunction getAngle(lm0: Landmark, lm1: Landmark, aspectRatio: number) {\n  return Math.atan2(lm1.y - lm0.y, aspectRatio * (lm1.x - lm0.x));\n}\nfunction dist(lm0: Landmark, lm1: Landmark, aspectRatio: number) {\n  return Math.sqrt((aspectRatio * (lm1.x - lm0.x)) ** 2 + (lm1.y - lm0.y) ** 2);\n}\nconst getSum = (input: Array<number>) => input.reduce((a, b) => a + b, 0);\n\nfunction midPoint(lm0: Landmark, lm1: Landmark): Landmark {\n  return {\n    x: (0.5) * (lm0.x + lm1.x),\n    y: (0.5) * (lm0.y + lm1.y),\n  };\n}\n\nfunction averageAngle(input: Array<Landmark>, aspectRatio: number): number {\n  if (input.length < 2) return 0;\n\n  const angles = input.map(\n    (val, i, arr) => (arr[i + 1] === undefined ? 0 : getAngle(arr[i], arr[i + 1], aspectRatio)),\n  );\n  angles.pop();\n\n  const y = getSum(angles.map(Math.sin));\n  const x = getSum(angles.map(Math.cos));\n\n  return Math.atan2(y, x);\n}\n\nfunction isLine(input: Array<Landmark>, angleTolerance: number | undefined, aspectRatio: number): boolean {\n  if (input.length < 2) { return false; } // Single point: not a line\n\n  // Default the tolerance to 15 deg (on either side)\n  const tolerance = angleTolerance ?? Math.PI / 12;\n  let lastAngle = getAngle(input[0], input[1], aspectRatio);\n\n  // Make sure the angle is about correct\n  for (let i = 1; i < input.length - 1; i += 1) {\n    const thisAngle = getAngle(input[i], input[i + 1], aspectRatio);\n    if (Math.abs(thisAngle - lastAngle) >= tolerance) { return false; }\n\n    lastAngle = thisAngle;\n  }\n  return true;\n}\n\nfunction detectHandPointingGestures(handLandmarks: Landmark[] | undefined, aspectRatio: number): string {\n  if (!handLandmarks) return GestureNames.none;\n\n  const FINGERS = [\n    HAND.INDEX_FINGER,\n    HAND.MIDDLE_FINGER,\n    HAND.RING_FINGER,\n    HAND.PINKY_FINGER,\n  ];\n\n  const FINGER_LANDMARKS = FINGERS.map((indices) => indices.map((lm) => handLandmarks[lm]));\n\n  let areLines = true;\n  FINGER_LANDMARKS.forEach((finger) => {\n    if (!isLine(finger, undefined, aspectRatio)) areLines = false;\n  });\n\n  const avgAngle = averageAngle(FINGER_LANDMARKS[0], aspectRatio);\n  const avgAngleDeg = (avgAngle * 180) / Math.PI;\n\n  const tolerance = 30;\n  if (Math.abs(avgAngleDeg) < tolerance && areLines) return GestureNames.pointLeft;\n  if (Math.abs(avgAngleDeg) > 180 - tolerance && areLines) return GestureNames.pointRight;\n\n  return GestureNames.none;\n}\n\nfunction detectPosePointingGestures(poseLandmarks: Landmark[] | undefined, aspectRatio: number): string {\n  if (!poseLandmarks) return GestureNames.none;\n\n  const TOLERANCE = 20;\n  const TOLERANCE_RADS = TOLERANCE / (180 * Math.PI);\n\n  const left = [PoseLandmarks.leftElbow, PoseLandmarks.leftWrist].map((i) => poseLandmarks[i]);\n  const lelb = left[0];\n  const lwrist = left[1];\n  if (lelb.visibility && lelb.visibility > minDetectionVisibility && lwrist.visibility && lwrist.visibility > minDetectionVisibility) {\n    const ang = getAngle(lelb, lwrist, aspectRatio);\n    if (Math.abs(ang) > Math.PI - TOLERANCE_RADS) return GestureNames.pointRight;\n  }\n\n  const right = [PoseLandmarks.rightElbow, PoseLandmarks.rightWrist].map((i) => poseLandmarks[i]);\n  const relb = right[0];\n  const rwrist = right[1];\n  if (relb.visibility && relb.visibility > minDetectionVisibility && rwrist.visibility && rwrist.visibility > minDetectionVisibility) {\n    const ang = getAngle(relb, rwrist, aspectRatio);\n    if (Math.abs(ang) < TOLERANCE_RADS) return GestureNames.pointLeft;\n  }\n\n  return GestureNames.none;\n}\n\nfunction isNamasteGesture(results: MpHolisticResults, aspectRatio: number): boolean {\n  /* eslint-disable operator-linebreak, no-multi-spaces */\n  const IDs = PoseLandmarks;\n  const poseLMs = results.poseLandmarks;\n  if (!poseLMs) return false;\n\n  const areArmLandmarksVisible =\n    (poseLMs[IDs.leftShoulder].visibility  ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.leftElbow].visibility     ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.leftWrist].visibility     ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightShoulder].visibility ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightElbow].visibility    ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightWrist].visibility    ?? 0) > minDetectionVisibility;\n\n  // See if elbows are down, against the stomach\n  const downwards = -Math.PI / 2; // -90 deg\n  const leftForearmTargetAngle = downwards;\n  const rightForearmTargetAngle = downwards;\n  const elbowAngleTolerance = Math.PI / 9; // 20 deg\n\n  const leftForearmAngle = getAngle(poseLMs[IDs.leftShoulder], poseLMs[IDs.leftElbow], aspectRatio);\n  const rightForearmAngle = getAngle(poseLMs[IDs.rightShoulder], poseLMs[IDs.rightElbow], aspectRatio);\n\n  const areElbowsNearChest =\n    Math.abs(leftForearmAngle - leftForearmTargetAngle) < elbowAngleTolerance / 2 &&\n    Math.abs(rightForearmAngle - rightForearmTargetAngle) < elbowAngleTolerance / 2;\n\n  // See if hands are up and together, near base of neck\n  const handNeckMinRelativeDist = 0.8;\n  const shoulderDist = dist(poseLMs[IDs.leftShoulder], poseLMs[IDs.rightShoulder], aspectRatio);\n  const neckCenter = midPoint(poseLMs[IDs.leftShoulder], poseLMs[IDs.rightShoulder]);\n  const leftWristNeckDist = dist(neckCenter, poseLMs[IDs.leftWrist], aspectRatio) / shoulderDist;\n  const rightWristNeckDist = dist(neckCenter, poseLMs[IDs.rightWrist], aspectRatio) / shoulderDist;\n\n  const areHandsNearNeckBase =\n    leftWristNeckDist  < handNeckMinRelativeDist &&\n    rightWristNeckDist < handNeckMinRelativeDist;\n\n  // console.log('areArmLandmarksVisible', areArmLandmarksVisible);\n  // console.log('areElbowsNearChest', areElbowsNearChest);\n  // console.log('areHandsNearNeckBase', areHandsNearNeckBase);\n  // console.log('  leftWristNeckDist', leftWristNeckDist);\n  // console.log('  rightWristNeckDist', rightWristNeckDist);\n  return areArmLandmarksVisible &&\n  //  areElbowsNearChest &&\n         areHandsNearNeckBase;\n\n  /* eslint-enable operator-linebreak, no-multi-spaces */\n}\n\nexport default function detectGesture(mpResults?: MpHolisticResults): string {\n\n  const aspectRatio = (mpResults?.image?.width ?? 1) / (mpResults?.image?.height ?? 1);\n\n  if (!mpResults) return GestureNames.none;\n  let detectedGesture = GestureNames.none;\n\n  if (usingHolistic) {\n    if (detectedGesture === GestureNames.none) detectedGesture = detectHandPointingGestures(mpResults.rightHandLandmarks, aspectRatio);\n    if (detectedGesture === GestureNames.none) detectedGesture = detectHandPointingGestures(mpResults.leftHandLandmarks, aspectRatio);\n  } else detectedGesture = detectPosePointingGestures(mpResults.poseLandmarks, aspectRatio);\n\n  if (detectedGesture === GestureNames.none && isNamasteGesture(mpResults, aspectRatio)) {\n    detectedGesture = GestureNames.namaste;\n  }\n\n  return detectedGesture;\n}\n\nexport function startGestureDetection() {\n  eventHub.on(EventNames.trackingResults, (results: MpHolisticResults) => {\n    const detectedGesture = detectGesture(results);\n    eventHub.emit(EventNames.gesture, detectedGesture, results);\n  });\n}\n","import { createApp } from 'vue';\n\nimport App from './App.vue';\n\nimport './registerServiceWorker';\nimport { startGestureDetection } from './services/GestureDetection';\n\nrequire('bulma-slider');\n\nrequire('@/assets/main.scss');\n\nconst app = createApp(App);\napp.mount('#app');\n\nstartGestureDetection();\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./KeyframeTimeline.vue?vue&type=style&index=0&id=1326a96d&lang=scss\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./OnboardingUI.vue?vue&type=style&index=0&id=69ed9ac4&lang=scss\""],"sourceRoot":""}