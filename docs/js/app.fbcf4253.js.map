{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/elements/WebcamBox.vue?bb0f","webpack:///./src/App.vue?b2cf","webpack:///./src/assets/gestures sync ^\\.\\/.*\\.svg$","webpack:///./src/components/elements/SegmentedProgressBar.vue?403c","webpack:///./src/components/elements/InstructionCarousel.vue?dcdc","webpack:///./src/assets/gestures/forward.svg","webpack:///./src/components/screens/PoseDrawerTest.vue?7360","webpack:///./src/components/elements/WebcamPromptCard.vue?02bc","webpack:///./src/components/screens/CreateLessonScreen.vue?e40b","webpack:///./src/assets/gestures/play.svg","webpack:///./src/components/screens/MainMenu.vue?6d49","webpack:///./src/assets/gestures/backward.svg","webpack:///./src/components/elements/UploadCard.vue?d451","webpack:///./src/assets/tiktokdances.jpg","webpack:///./src/components/screens/FeedbackUploadScreen.vue?de9c","webpack:///./src/components/CameraSurface.vue?1759","webpack:///./src/components/elements/VideoLessonPlayer.vue?d4f0","webpack:///./src/components/elements/VideoPlayer.vue?d6cb","webpack:///./src/components/elements/LessonCard.vue?048f","webpack:///./src/components/DrawingSurface.vue?d0d9","webpack:///./src/App.vue","webpack:///./src/services/WebcamProvider.ts","webpack:///./src/components/screens/WorkflowMenu.vue","webpack:///./src/components/elements/VideoLessonPlayer.vue","webpack:///./src/components/elements/ActivityVideoPlayer.vue","webpack:///./src/components/elements/InstructionCarousel.vue","webpack:///./src/components/elements/InstructionCarousel.vue?eae7","webpack:///./src/components/elements/InstructionCarousel.vue?3dde","webpack:///./src/components/elements/PausingVideoPlayer.vue","webpack:///./src/services/Constants.ts","webpack:///./src/components/elements/VideoPlayer.vue","webpack:///./src/services/MediaPipeTypes.ts","webpack:///./src/services/EventHub.ts","webpack:///./src/services/Utils.ts","webpack:///./src/services/MediaPipe.ts","webpack:///./src/services/PoseProvider.ts","webpack:///./src/components/elements/VideoPlayer.vue?e7d3","webpack:///./src/components/elements/VideoPlayer.vue?b67d","webpack:///./src/components/elements/PausingVideoPlayer.vue?fe03","webpack:///./src/components/elements/PausingVideoPlayer.vue?8e8a","webpack:///./src/components/elements/WebcamBox.vue","webpack:///./src/components/elements/WebcamBox.vue?0a4a","webpack:///./src/components/elements/WebcamBox.vue?e390","webpack:///./src/components/elements/ActivityVideoPlayer.vue?e80c","webpack:///./src/components/elements/ActivityVideoPlayer.vue?f161","webpack:///./src/components/elements/SegmentedProgressBar.vue","webpack:///./src/components/elements/SegmentedProgressBar.vue?1c88","webpack:///./src/components/elements/SegmentedProgressBar.vue?1b9d","webpack:///./src/components/elements/VideoLessonPlayer.vue?4f67","webpack:///./src/components/elements/VideoLessonPlayer.vue?7598","webpack:///./src/services/MotionDatabase.ts","webpack:///./src/services/WorkflowManager.ts","webpack:///./src/components/screens/FeedbackUploadScreen.vue","webpack:///./src/services/AzureUploader.ts","webpack:///./src/components/screens/FeedbackUploadScreen.vue?3036","webpack:///./src/components/screens/FeedbackUploadScreen.vue?209b","webpack:///./src/services/OptionsManager.ts","webpack:///./src/model/Workflow.ts","webpack:///./src/components/screens/WorkflowMenu.vue?8157","webpack:///./src/components/screens/WorkflowMenu.vue?71fa","webpack:///./src/components/screens/CreateWorkflowScreen.vue","webpack:///./src/components/screens/CreateLessonScreen.vue","webpack:///./src/components/screens/CreateLessonScreen.vue?a8e9","webpack:///./src/components/screens/CreateLessonScreen.vue?8b77","webpack:///./src/components/screens/CreateWorkflowScreen.vue?a634","webpack:///./src/components/screens/CreateWorkflowScreen.vue?638d","webpack:///./src/components/CameraSurface.vue","webpack:///./src/components/DrawingSurface.vue","webpack:///./src/components/DrawingSurface.vue?0145","webpack:///./src/components/DrawingSurface.vue?3b98","webpack:///./src/components/CameraSurface.vue?7f23","webpack:///./src/components/CameraSurface.vue?8fa7","webpack:///./src/components/OnboardingUI.vue","webpack:///./src/components/elements/GestureIcon.vue","webpack:///./src/components/elements/GestureIcon.vue?548f","webpack:///./src/components/elements/GestureIcon.vue?1324","webpack:///./src/components/OnboardingUI.vue?b3c5","webpack:///./src/components/OnboardingUI.vue?fcd3","webpack:///./src/components/screens/MainMenu.vue","webpack:///./src/components/elements/LessonCard.vue","webpack:///./src/components/elements/LessonCard.vue?090b","webpack:///./src/components/elements/LessonCard.vue?8b6b","webpack:///./src/components/elements/UploadCard.vue","webpack:///./src/components/elements/UploadCard.vue?311e","webpack:///./src/components/elements/UploadCard.vue?f397","webpack:///./src/components/screens/MainMenu.vue?7063","webpack:///./src/components/screens/MainMenu.vue?0a41","webpack:///./src/components/elements/WebcamPromptCard.vue","webpack:///./src/components/elements/WebcamPromptCard.vue?a879","webpack:///./src/components/screens/PoseDrawerTest.vue","webpack:///./src/components/screens/PoseDrawerTest.vue?af42","webpack:///./src/components/screens/PoseDrawerTest.vue?bc96","webpack:///./src/App.vue?3acc","webpack:///./src/App.vue?eabf","webpack:///./src/registerServiceWorker.ts","webpack:///./src/services/GestureDetection.ts","webpack:///./src/main.ts","webpack:///./src/components/elements/ActivityVideoPlayer.vue?ac7c","webpack:///./src/components/OnboardingUI.vue?9114"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","map","webpackContext","req","id","webpackContextResolve","e","Error","code","keys","resolve","class","style","src","alt","poseDrawerSelected","lessonSelected","createLessonSelected","startWorkflow","state","State","CreateWorkflow","MainMenu","CreateLesson","motion","currentVideo","goHome","WorkflowActive","showBackButton","startedWithWorkflow","PoseDrawingTester","LessonActive","videoEntry","videoLesson","currentLesson","maxVideoHeight","enableCompleteLesson","aria-label","ref","onTrackingAttained","background","OnboardingLoading","ui","PromptStartWebcam","startWebcam","StartingWebcam","LoadingTracking","Onboarding","showCameraSurface","WEBCAM_DIMENSIONS","freeze","width","height","recorder","mediaStream","activeConnections","Set","permissionState","isWebcamLoading","webcamError","isRecording","webcamStatus","this","readPermissionStatus","navigator","permissions","query","constraints","video","aspectRatio","frameRate","audio","mediaDevices","getUserMedia","videoE","add","console","log","srcObject","onloadedmetadata","play","delete","size","stopWebcam","stopRecording","getTracks","forEach","x","stop","rtc","type","startRecording","Promise","res","getBlob","defaultProvider","showHeader","workflow","title","$emit","stages","stage","isStageCompleted","getStepInfo","stepInfo","startWorkflowStep","step","dbEntry","thumbnailSrc","status","nextStep","instructionsActive","currentStep","instructions","heading","text","instructionsFinished","lessonActive","currentVideoEntry","lessonCompleted","uploadActive","prompt","upload","subtitle","uploadFilename","uploadComplete","lesson","activity","activeActivity","maxHeight","onProgress","segments","progressSegments","progress","activityProgress","needsStartWebcam","$refs","activityVideoPlayer","activityFinished","disabled","isPlaying","awaitingStart","repeat","hasNextActivity","nextActivity","nearbyActivityIndices","index","activeActivityIndex","gotoActivity","showStartWebcamButton","showingWebcam","videoSrc","drawPoseLandmarks","demoVisual","videoOpacity","emphasizedJoints","onPlaybackCompleted","onPauseHit","onPauseEnded","sizeClass","timedInstructions","staticInstruction","tag","inst","tagClass","props","Array","default","String","render","videoBaseUrl","onSegmentPlaybackCompleted","setDrawStyle","emphasizedJointStyle","Constants","DefaultPauseDuration","videoUrl","scheduleCanvasResizing","endReported","PoseLandmarks","nose","leftEyeInner","leftEye","leftEyeOuter","rightEyeInner","rightEye","rightEyeOuter","leftEar","rightEar","mouthLeft","mouthRight","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftPinky","rightPinky","leftIndex","rightIndex","leftThumb","rightThumb","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle","leftHeel","rightHeel","leftFootIndex","rightFootIndex","EventNames","gesture","trackingProcessingStarted","trackingResults","trackingRequested","trackingRequestFinished","GestureNames","none","pointLeft","pointRight","namaste","eventHub","setupGestureListening","callbacks","fallback","onGesture","cb","on","off","setupMediaPipeListening","callback","onFrameProcessingStarted","TrackingActions","requestTracking","emit","endTrackingRequest","secs","setTimeout","filename","element","document","createElement","setAttribute","encodeURIComponent","display","body","appendChild","click","removeChild","onFrame","shouldRun","undefined","requestAnimationFrame","then","Utils","DoEveryFrame","replace","crypto","getRandomValues","Uint8Array","toString","obj","Date","copy","setTime","getTime","isArray","len","deepCopy","typedObj","attrs","attr","val","array","fromIndex","toIndex","sliceStart","sliceEnd","Math","floor","random","usingHolistic","mp","HAND_LANDMARK_CONNECTIONS","HAND","THUMB_FINGER","INDEX_FINGER","MIDDLE_FINGER","RING_FINGER","PINKY_FINGER","CONNECTIONS_TO_DRAW","v0","v1","trackingStarted","DrawConnections","canvasCtx","landmarks","connections","w","canvas","h","beginPath","connection","p1","p2","moveTo","y","lineTo","stroke","restore","DrawPose","poseLandmarks","options","jointsWithEmphasis","save","sourceAR","sourceAspectRatio","canvasAR","adjustedHeight","pixelsTaller","translate","adjustedWidth","pixelsWider","visibility","emphasized","indexOf","emphasisStroke","strokeStyle","lineWidth","p1a","p1b","trackingRequests","trackingCount","filter","StartTracking","initial","mpInstance","Holistic","locateFile","file","Pose","setOptions","upperBodyOnly","smoothLandmarks","minDetectionConfidence","minTrackingConfidence","frameId","timestamp","now","onResults","send","image","isTracking","VIDEO_EXTENSIONS","poseFiles","Map","videoName","poseFilename","extension","cached","stored","localStorage","getItem","JSON","parse","set","PoseProvider","getPoseFile","poseFile","poses","convertToPoseList","setItem","stringify","url","fetch","response","ok","statusText","csv","temp","row","convertRow","startsWith","lms","Number","parseFloat","poseProvider","onResize","canvasE","modified","offsetWidth","offsetHeight","setupCanvasResizing","videoElement","canvasElement","resizeCanvas","addEventListener","removeEventListener","setupVideoPlaying","startTime","endTime","startProgressUpdating","playVideo","from","to","speed","pause","playbackRate","currentTime","error","pauseVideo","Boolean","fps","Function","emits","setup","ctx","getContext","canvasModified","currentPose","frame","pose","prevTime","timerId","onTimeUpdated","vidElement","time","clearInterval","setInterval","clearDrawing","drawCtx","clearRect","drawPose","GetPose","getVideoDimensions","methods","keepPlaying","getVideoTime","DEFAULT_PAUSE_DURATION","computePlaySegments","pauses","segs","nextPauseIndex","prevIndex","pTime","max","pauseIndex","pi","segStartTime","components","VideoPlayer","lineCap","videoPlayer","playTimeoutId","vidPlayer","clearTimeout","playSegment","seg","delaySecs","emitResume","onPlayStart","playingSegments","playingSegmentIndex","playDelaySecs","nextSeg","manualResume","pauseDuration","muted","disablePictureInPicture","webcamStartError","enableRecordButton","connectVideoElement","disconnectVideoElement","webcamProvider","computed","webcamStarted","ActivityPlayState","AwaitingStart","PendingStart","Playing","ActivityEnded","defaultPauseDuration","PausingVideoPlayer","InstructionCarousel","WebcamBox","webcamBox","videoTime","pauseInstructs","instruction","reset","newTime","userVisual","mActivity","instructs","startInstruction","playingInstruction","endInstruction","concat","activeTimedInstructions","ti","start","end","delay","vidActivity","practiceSpeed","segmentsData","enableAll","enabled","cssClass","min","calculateProgressSegments","last","segmentBreaks","segData","focusedSegments","cssClassOptions","range","startAt","SegmentedProgressBar","ActivityVideoPlayer","margin","minIndex","maxActivityIndex","activities","maxIndex","count","indices","$props","activityIndex","hasPreviousActivity","playActivity","motionsMap","motions","values","motionNames","clipName","lessonsByVideo","lessonsById","videoDatabase","clipPath","upsertLesson","source","customLessonCount","loadCustomLessons","lessonList","header","lessonIndex","findIndex","_id","existingIndex","les","lessons","customLessonIds","MotionDatabase","getCustomLessonIdsList","countLoaded","custLesson","has","custLessonIds","lessonTitle","saveCustomLessonsIdsList","removeLesson","lessonIdIndex","removeItem","createBlankActivity","duration","createBlankLesson","uuidv4","db","defaultWorkflows","workflows","TestWorkflow","steps","videoLessonReference","lessonId","identifier","sampleUploadWorkflow","bakedInWorkflows","allWorkflows","activeFlow","loadWorkflows","customWorkflowIds","WorkflowManager","getCustomWorkflowIdsList","tryLoadCustomLesson","isCustomWorkflow","hasSavedCustomLesson","workflowRaw","addSessionWorkflow","warn","custWorkflowIds","saveCustomWorkflowIdsList","workflowId","matchingWorkflow","flow","trackingFlow","shuffleInfo","shuffle","shuffleArray","startIndex","endIndex","stageIndex","stepIndex","workflowManager","toggleRecording","controls","recordedObjectUrl","isUploading","rerecord","uploadVideo","uploadError","successfullyUploaded","blobServiceClient","BlobServiceClient","blobName","client","getContainerClient","blockBlobClient","getBlockBlobClient","uploadData","lastRecordedBlob","URL","createObjectURL","participantId","participantIdWasSet","parsePath","urlParams","URLSearchParams","location","search","optionsManager","CreateBlankWorkflow","IsVideoLessonStep","GetWorkflowStepVideoClipName","videoLessonEmbedded","GetVideoEntryForWorkflowStep","VideoLessonPlayer","FeedbackUploadScreen","uploadId","continueWorkflowStep","isClickable","item","reduce","wasTrue","thisStep","activeWorkflow","goBack","workflowInDatabase","deleteWorkflow","exportWorkflow","isDirty","saveWorkflow","selectedStageIndex","selectStage","activeStage","duplicateStage","addStage","canReorderStage","reorderStage","selectedStepIndex","selectStep","activeStep","duplicateStep","addStep","deleteStage","canReorderStep","reorderStep","isInstructionStep","isLessonEmbeddedStep","activeStepLesson","removeEmbeddedLesson","convertEmbeddedLessonToReference","editWorkflowStepLesson","newEmbeddedLessonClipName","availableClips","canCreateEmbeddedLesson","startCreateEmbeddedLesson","isLessonReferenceStep","availableReferenceLessons","canEditActiveStepLessonReference","createReferencedLesson","isVideoUploadStep","deleteStep","selectingWorkflowIndex","availableWorkflows","canEditWorkflow","startCreation","editLessonActive","embeddedLessonMotion","lessonToEdit","updateWorkflowStepLesson","saveToDatabase","showCloseButton","showExportButton","disableEditingExisting","LessonCreationState","SelectOpenLesson","lessonUnderConstruction","ModifyLesson","canDeleteLesson","deleteLesson","exportLesson","saveLesson","lessonInDatabase","activeLessonSelectionIndex","canEditActiveLesson","segBreak","newSegmentVal","addSegmentBreak","selectActivity","addActivity","canReorderActivity","reorderActivity","activePauseIndex","selectPause","addPause","sortPauses","activeTimedInstructionIndex","selectTimedInstruction","addTimedInstruction","sortTimedInstructions","canDeleteActivity","deleteActivity","activePause","deletePause","activeTimedInstruction","deleteTimedInstruction","playDemo","required","saveReference","newPauseTime","activeLessonSelection","hasLesson","lessonStartTime","lessonEndTime","getLessons","acLes","mounted","passedInLesson","typedMotion","watch","handler","deep","confirm","asTemplate","sourceLesson","existingLesson","targetIndex","newActivity","indexDelta","curActivity","swapActivity","swapIndex","indexToDelete","newPause","selectedPause","sort","a","b","newIndex","pauseObj","newInstruction","timedInstructs","selectedTimedInstruc","timedInstruction","tiIndex","breakTime","isNaN","newList","saveCustomLesson","deleteCustomLesson","PromptDownloadFile","WorkflowMenu","CreateLessonScreen","newEmbeddedLessonMotion","setActiveFlow","completeActivitesPriorToStageAndStep","newVal","skipPrompt","reloadCustomWorkflow","deleteCustomWorkflow","upsertCustomWorkflow","existingWorkflow","increment","curStage","swapStage","curSelected","toSwap","curStep","swapStep","exportLessonData","enableDrawing","isActivelyTracking","drawHandShape","results","rightHandLandmarks","drawTrackingResults","detectedGesture","fadeTimeMs","trackingTimestamp","globalAlpha","mpResults","ges","newVals","isEnabled","holisticResults","DrawingSurface","trackingIntervalId","hasStartedTracking","hasResults","startTracking","whenReady","readyState","gestureIcon","OnboardingStage","done","skipOnboarding","showIcon","iconClass","gestureImgSrc","GestureIcons","forward","backward","trySelectNext","trySelectPrevious","tryPerformPlay","GestureIcon","output","advanceStage","TabList","tab","currentTab","setTab","Tabs","Workflows","motionList","dance","hovering","clicked","True","selectedDance","Videos","uploadUIActive","Tools","onLessonSelected","uploadAccept","onFilesSelected","uploadFiles","savingText","successText","autoplay","canCreateLesson","enctype","novalidate","isInitial","isSaving","isFailed","uploadFieldName","accept","uploadInstructions","isSuccess","Status","Initial","Saving","Success","Failed","currentStatus","fileList","TabSet","LessonCard","UploadCard","files","validateLesson","aria-hidden","dropdownOpen","loadMotion","cPose","lm","CameraSurface","OnboardingUI","WebcamPromptCard","PoseDrawerTest","CreateWorkflowScreen","cameraSurface","hasCompletedOnboarding","camSurface","alert","ready","registered","updatefound","updated","offline","minDetectionVisibility","getAngle","lm0","lm1","atan2","dist","sqrt","getSum","input","midPoint","averageAngle","angles","arr","pop","sin","cos","isLine","angleTolerance","tolerance","PI","lastAngle","thisAngle","abs","detectHandPointingGestures","handLandmarks","FINGERS","FINGER_LANDMARKS","areLines","finger","avgAngle","avgAngleDeg","detectPosePointingGestures","TOLERANCE","TOLERANCE_RADS","left","lelb","lwrist","ang","right","relb","rwrist","isNamasteGesture","IDs","poseLMs","areArmLandmarksVisible","downwards","leftForearmTargetAngle","rightForearmTargetAngle","elbowAngleTolerance","leftForearmAngle","rightForearmAngle","handNeckMinRelativeDist","shoulderDist","neckCenter","leftWristNeckDist","rightWristNeckDist","areHandsNearNeckBase","detectGesture","leftHandLandmarks","startGestureDetection","app","App","mount"],"mappings":"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","file":"js/app.fbcf4253.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([1,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./WebcamBox.vue?vue&type=style&index=0&id=0a81f5cd&lang=scss\"","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&id=f7dea538&lang=scss\"","var map = {\n\t\"./backward.svg\": \"6218\",\n\t\"./forward.svg\": \"3b9e\",\n\t\"./play.svg\": \"5cd5\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"1942\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./SegmentedProgressBar.vue?vue&type=style&index=0&id=60b0197e&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./InstructionCarousel.vue?vue&type=style&index=0&id=639bc8bc&lang=scss\"","module.exports = __webpack_public_path__ + \"img/forward.e257a03f.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./PoseDrawerTest.vue?vue&type=style&index=0&id=9399757c&lang=css\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./WebcamPromptCard.vue?vue&type=style&index=0&id=07a96404&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CreateLessonScreen.vue?vue&type=style&index=0&id=04173f9d&lang=scss\"","module.exports = __webpack_public_path__ + \"img/play.8c9e21c7.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./MainMenu.vue?vue&type=style&index=0&id=4b6f86b5&lang=scss\"","module.exports = __webpack_public_path__ + \"img/backward.434f566c.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./UploadCard.vue?vue&type=style&index=0&id=4565a82c&lang=scss\"","module.exports = __webpack_public_path__ + \"img/tiktokdances.589b3b61.jpg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./FeedbackUploadScreen.vue?vue&type=style&index=0&id=663b38c1&lang=scss\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CameraSurface.vue?vue&type=style&index=0&id=72ad0b54&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./VideoLessonPlayer.vue?vue&type=style&index=0&id=3b23f3ca&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./VideoPlayer.vue?vue&type=style&index=0&id=97f109d0&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./LessonCard.vue?vue&type=style&index=0&id=0310a410&lang=scss\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./DrawingSurface.vue?vue&type=style&index=0&id=002e5f90&lang=scss\"","<template>\n<div class=\"app\">\n\n  <MainMenu\n        v-show=\"state === State.MainMenu\"\n        @pose-drawer-selected=\"poseDrawerSelected\"\n        @lesson-selected=\"lessonSelected\"\n        @create-lesson-selected=\"createLessonSelected\"\n        @workflow-selected=\"startWorkflow\"\n        @create-workflow-selected=\"state = State.CreateWorkflow\"\n      />\n\n  <CreateLessonScreen\n        v-if=\"state === State.CreateLesson\"\n          :motion=\"currentVideo\"\n          @back-selected=\"goHome\"\n          @lesson-created=\"goHome\" />\n\n  <CreateWorkflowScreen\n    v-if=\"state === State.CreateWorkflow\"\n    @back-selected=\"goHome\"\n    @workflow-created=\"goHome\"\n    />\n\n  <WorkflowMenu\n        v-if=\"state === State.WorkflowActive\"\n        @back-selected=\"goHome\"\n        :showBackButton=\"!startedWithWorkflow\"/>\n\n  <PoseDrawerTest\n        v-if=\"state === State.PoseDrawingTester\"\n        @back-selected=\"goHome\" />\n\n  <div v-bind:class=\"{ 'is-active': state == State.LessonActive }\" class=\"modal\">\n    <div class=\"modal-background\"></div>\n    <div class=\"container\" style=\"max-height=100vh; max-width=100vw;\">\n      <div class=\"vcenter-parent\">\n        <div class=\"box\" >\n          <VideoLessonPlayer\n            v-if=\"state == State.LessonActive\"\n            :videoEntry=\"currentVideo\"\n            :videoLesson=\"currentLesson\"\n            @lesson-completed=\"goHome\"\n            :maxVideoHeight=\"'calc(100vh - 152px - 3.75rem)'\"\n            :enableCompleteLesson=\"true\"/>\n        </div>\n      </div>\n    </div>\n    <button class=\"modal-close is-large\" aria-label=\"close\" @click=\"goHome\"></button>\n  </div>\n\n  <div id=\"aboveSurface\" class=\"pb-4 pt-4\">\n     <span id=\"topbarLeft\"></span>\n     <span class=\"spacer\"></span>\n     <span id=\"topbarCenter\"></span>\n     <span class=\"spacer\"></span>\n     <span id=\"topbarRight\"></span>\n  </div>\n  <CameraSurface\n    ref=\"cameraSurface\"\n    @tracking-attained=\"onTrackingAttained()\"\n    v-show=\"showCameraSurface\">\n\n    <template v-slot:background>\n      <img v-show=\"state == State.OnboardingLoading\"\n      src=\"./assets/tiktokdances.jpg\"\n      alt=\"Background Image\">\n    </template>\n\n    <template v-slot:ui>\n\n      <!-- <LearningScreen v-if=\"state == State.LessonActive\"\n        :target-dance=\"currentVideo\"\n        :target-lesson=\"currentLesson\"\n        @lesson-completed=\"goHome\"\n        @back-selected=\"goHome\"\n        style=\"width: 1280px\"\n        height=\"auto\"\n      /> -->\n\n     <WebcamPromptCard v-if=\"state === State.PromptStartWebcam\"\n      @cancel-selected=\"state = State.MainMenu\"\n      @startWebcamSelected=\"startWebcam\"\n     />\n\n      <div class=\"vcenter-parent\" v-if=\"state === State.StartingWebcam\">\n        <div class=\"translucent-text is-rounded has-text-centered\">\n          <div class=\"content\">\n            <h3 class=\"has-text-white m-2\">Starting Webcam...</h3>\n          </div>\n          <div class=\"loader-progress loader is-loading mt-5 mb-5\"></div>\n        </div>\n      </div>\n\n      <div class=\"vcenter-parent\" v-if=\"state === State.LoadingTracking\">\n        <div class=\"translucent-text is-rounded has-text-centered\">\n          <div class=\"content has-text-white m-2 has-text-centered\">\n            <h3 class=\"has-text-white\">Starting Gestures...</h3>\n          </div>\n          <div class=\"loader-progress loader is-loading mt-5 mb-5\"></div>\n        </div>\n      </div>\n\n      <OnboardingUI v-if=\"state == State.Onboarding\"\n        @onboarding-complete=\"state= State.LessonActive \"/>\n    </template>\n\n  </CameraSurface>\n  <div id=\"belowSurface\"></div>\n</div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed, defineComponent, nextTick, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { DatabaseEntry } from '@/services/MotionDatabase';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport CreateWorkflowScreen from '@/components/screens/CreateWorkflowScreen.vue';\nimport VideoLessonPlayer from '@/components/elements/VideoLessonPlayer.vue';\nimport CameraSurface from './components/CameraSurface.vue';\nimport OnboardingUI from './components/OnboardingUI.vue';\nimport MainMenu from './components/screens/MainMenu.vue';\n// import LearningScreen from './components/screens/LearningScreen.vue';\nimport VideoLesson from './model/VideoLesson';\nimport WebcamPromptCard from './components/elements/WebcamPromptCard.vue';\n\nimport PoseDrawerTest from './components/screens/PoseDrawerTest.vue';\nimport CreateLessonScreen from './components/screens/CreateLessonScreen.vue';\nimport workflowManager from './services/WorkflowManager';\nimport optionsManager from './services/OptionsManager';\n\nconst State = {\n  MainMenu: 'MainMenu',\n  PromptStartWebcam: 'PromptStartWebcam',\n  StartingWebcam: 'StartingWebcam',\n  LoadingTracking: 'LoadingTracking',\n  Onboarding: 'Onboarding',\n  LessonActive: 'LessonActive',\n  WorkflowActive: 'WorkflowActive',\n  PoseDrawingTester: 'PoseDrawingTester',\n  CreateLesson: 'CreateLesson',\n  CreateWorkflow: 'CreateWorkflow',\n};\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    CameraSurface,\n    OnboardingUI,\n    MainMenu,\n    WorkflowMenu,\n    // LearningScreen,\n    WebcamPromptCard,\n    PoseDrawerTest,\n    CreateLessonScreen,\n    CreateWorkflowScreen,\n    VideoLessonPlayer,\n  },\n  setup() {\n    const state = ref(State.MainMenu);\n    const cameraSurface = ref(null as typeof CameraSurface | null);\n    const hasCompletedOnboarding = ref(false);\n\n    const currentVideo = ref(null as DatabaseEntry | null);\n    const currentLesson = ref(null as VideoLesson | null);\n\n    const showCameraSurface = computed(() => [\n      State.PromptStartWebcam,\n      State.StartingWebcam,\n      State.LoadingTracking,\n      State.Onboarding,\n      // State.LessonActive,\n    ].indexOf(state.value) !== -1);\n\n    function lessonSelected(videoEntry: DatabaseEntry, lesson: VideoLesson) {\n      currentVideo.value = videoEntry;\n      currentLesson.value = lesson;\n\n      state.value = State.LessonActive;\n      // if (webcamProvider.webcamStatus.value === 'running') state.value = State.LessonActive;\n      // else state.value = State.PromptStartWebcam;\n    }\n\n    function goHome() {\n      state.value = State.MainMenu;\n      currentVideo.value = null;\n      currentLesson.value = null;\n    }\n\n    async function startTracking() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      nextTick(() => {\n        const camSurface: any = cameraSurface.value;\n        state.value = State.LoadingTracking;\n        camSurface.startTracking();\n      });\n    }\n\n    async function startWebcam() {\n      console.log('Starting Webcam');\n\n      if (webcamProvider.webcamStatus.value !== 'running') {\n        state.value = State.StartingWebcam;\n\n        try {\n          await webcamProvider.startWebcam();\n        } catch (e) {\n          console.error('Error starting webcam: ', e);\n          // eslint-disable-next-line no-alert\n          alert('Failed to start the webcam\\n\\nPlease ensure this is the only app using the camera and that you\\'ve allowed camera access in your browser.');\n          state.value = State.MainMenu;\n          return;\n        }\n      }\n\n      state.value = State.LoadingTracking;\n      try {\n        await startTracking();\n      } catch (e) {\n        console.error(\"Couldn't start tracking\", e);\n      }\n    }\n\n    function onTrackingAttained() {\n      console.log('Tracking attained');\n      if (hasCompletedOnboarding.value) {\n        state.value = State.LessonActive;\n      } else state.value = State.Onboarding;\n    }\n\n    return {\n      showCameraSurface,\n      currentVideo,\n      currentLesson,\n      lessonSelected,\n      goHome,\n      startWebcam,\n      onTrackingAttained,\n      state,\n      cameraSurface,\n      State,\n      startedWithWorkflow: ref(false),\n    };\n  },\n  mounted() {\n    // If app was launched with a workflowId, skip straight\n    // to that workflow\n    if (optionsManager.workflowId.value) {\n      if (this.startWorkflow(optionsManager.workflowId.value)) {\n        this.startedWithWorkflow = true;\n      }\n    }\n  },\n  methods: {\n    poseDrawerSelected() {\n      this.state = State.PoseDrawingTester;\n    },\n    createLessonSelected(dance: DatabaseEntry) {\n      this.currentVideo = dance;\n      this.state = State.CreateLesson;\n    },\n    startWorkflow(workflowId: string) {\n      console.log('Starting workflow', workflowId);\n      if (workflowManager.setActiveFlow(workflowId)) {\n        this.state = State.WorkflowActive;\n        return true;\n      }\n      return false;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\nbody, html {\n  margin: 0;\n  padding: 0;\n  width: 100%;\n  background-color: #00d1b2;\n  // background-image: linear-gradient(45deg, #00d1b2 0%, #3475da 100%);\n\n  // background-color: #FF9A8B;\n  // background-image: linear-gradient(135deg, #B721FF 0%, #145eb3 100%);\n\n  background-image: linear-gradient(120deg, #daece1 0%, #d1d1d1 100%);\n\n  background-size: 100vw 100vh;\n  background-attachment: fixed;\n}\n\n.vcenter-parent {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n}\n\n.loader-progress {\n  width: 100px;\n  height: 100px;\n  margin: auto;\n}\n\n#aboveSurface {\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n\n  span {\n    flex: 0 0 auto;\n  }\n  .spacer {\n    flex: 1 1 0;\n  }\n\n  width: 1280px;\n  margin: auto;\n}\n\n#belowSurface {\n  width: 1280px;\n  margin: auto;\n}\n\n#topbarLeft, #topbarRight, #topbarCenter {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n.background-blur {\n  backdrop-filter: blur(4px);\n  background: rgba(0, 0, 0, 0.75);\n}\n\n.translucent-text {\n  backdrop-filter: blur(4px);\n  color: white;\n  padding: 10px 20px;\n  background: rgba(0, 0, 0, 0.55);\n}\n\n.translucent-text.is-rounded {\n  border-radius: 0.25rem;\n}\n\n.is-slightly-rounded {\n  border-radius: 0.25rem;\n}\n\n</style>\n","import RecordRTC, { invokeSaveAsDialog } from 'recordrtc';\n\nimport { computed, ref, Ref } from 'vue';\n\nexport const WEBCAM_DIMENSIONS = Object.freeze({\n  width: 640,\n  height: 480,\n});\n\nexport class WebcamProvider {\n\n  // Recorder class\n  private recorder = ref(null as null | RecordRTC);\n\n  // The actual media stream\n  private mediaStream = ref(null as null | MediaStream);\n\n  // List of active connections. Used so we know when to pause the webcam\n  private activeConnections: Set<HTMLVideoElement> = new Set();\n\n  private permissionState: Ref<PermissionState> = ref('prompt');\n\n  private isWebcamLoading = ref(false);\n\n  public webcamError = ref(null as any);\n\n  public isRecording = ref(false);\n\n  constructor() {\n    this.readPermissionStatus();\n  }\n\n  private async readPermissionStatus(): Promise<void> {\n    if (navigator.permissions) {\n      try {\n        const result = await navigator.permissions.query({ name: 'camera' });\n        this.permissionState.value = result.state;\n\n        // eslint-disable-next-line no-empty\n      } catch { }\n    }\n  }\n\n  public permissionStatus(): Ref<PermissionState> {\n    return this.permissionState;\n  }\n\n  public async startWebcam(): Promise<void> {\n    if (this.mediaStream.value || this.isWebcamLoading.value) {\n      return;\n    }\n    this.isWebcamLoading.value = true;\n\n    try {\n      const constraints: MediaStreamConstraints = {\n        video: {\n          // facingMode: 'user',\n          width: WEBCAM_DIMENSIONS.width,\n          height: WEBCAM_DIMENSIONS.height,\n          aspectRatio: 1.777777778,\n          frameRate: 30,\n        },\n        audio: true,\n      };\n\n      if (!navigator.mediaDevices?.getUserMedia) throw new Error(\"Browser doesn't support webcam\");\n\n      this.mediaStream.value = await navigator.mediaDevices.getUserMedia(constraints);\n\n      this.permissionState.value = 'granted';\n    } finally {\n      this.isWebcamLoading.value = false;\n    }\n  }\n\n  public webcamStatus = computed(() => {\n    if (this.mediaStream.value) return 'running';\n    if (this.isWebcamLoading.value) return 'loading';\n    return 'stopped';\n  });\n\n  public async connectVideoElement(videoE: HTMLVideoElement): Promise<void> {\n\n    if (this.permissionState.value !== 'granted') throw new Error(\"Doesn't have permissions yet!\");\n\n    this.activeConnections.add(videoE);\n\n    // eslint-disable-next-line no-param-reassign\n    console.log('Connecting media stream to video');\n    videoE.srcObject = this.mediaStream.value;\n    videoE.onloadedmetadata = () => {\n      videoE.play();\n      console.log('Connected media stream to video');\n    };\n  }\n\n  public disconnectVideoElement(videoE: HTMLVideoElement): void {\n    this.activeConnections.delete(videoE);\n\n    videoE.srcObject = null;\n\n    if (this.activeConnections.size === 0 && !this.recorder) {\n      this.stopWebcam();\n    }\n  }\n\n  public async stopWebcam(): Promise<void> {\n    if (this.recorder) {\n      try {\n        await this.stopRecording();\n        // eslint-disable-next-line no-empty\n      } catch { }\n    }\n\n    if (this.mediaStream.value) {\n      this.mediaStream.value.getTracks().forEach((x) => x.stop());\n    }\n    this.mediaStream.value = null;\n  }\n\n  public async startRecording(): Promise<void> {\n    if (this.recorder.value || this.isRecording.value) {\n      return;\n    }\n\n    if (!this.mediaStream.value) {\n      throw new Error('Webcam must be started before recording can happen');\n    }\n\n    this.isRecording.value = true;\n\n    const rtc = new RecordRTC(this.mediaStream.value, {\n      type: 'video',\n    });\n    rtc.startRecording();\n    this.recorder.value = rtc;\n  }\n\n  public async stopRecording(): Promise<Blob> {\n\n    return new Promise((res) => {\n      if (!this.recorder.value) throw new Error(\"Haven't started recording\");\n      this.isRecording.value = false;\n      const recorder = this.recorder.value;\n      this.recorder.value.stopRecording(() => {\n        res(recorder.getBlob());\n        this.recorder.value = null;\n      });\n    });\n  }\n\n  public async clearRecording(): Promise<void> {\n    // TODO: pay attention to status of recording\n    // this.recorder?.stopRecording();\n    this.recorder.value = null;\n  }\n\n  // public async postFiles(url: string, filename: string): Promise<void> {\n  //   if (!this.recorder) throw new Error('Nothing to post');\n\n  //   const blob = this.recorder.getBlob();\n  //   invokeSaveAsDialog(blob, filename);\n\n  //   const fname = `${filename}.webm`;\n\n  //   const file = new File([blob], fname, {\n  //     type: 'video/webm',\n  //   });\n\n  // videoElement.src = '';\n  // videoElement.srcObject = null;\n\n  // if (mediaStream) { mediaStream.stop(); }\n  // }\n}\n\nexport const saveBlob = invokeSaveAsDialog;\n\nconst defaultProvider = new WebcamProvider();\n\nexport default defaultProvider;\n","<template>\n  <section class=\"section workflow-menu\">\n\n    <div class=\"hero is-primary block\" v-if=\"showHeader\">\n      <div class=\"hero-body\">\n        <div class=\"container\">\n          <p class=\"title\">\n            {{workflow?.title}}\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"container block\" v-if=\"showBackButton\">\n      <button class=\"button\" @click=\"$emit('back-selected')\">&lt; Back</button>\n    </div>\n\n    <div class=\"block\" v-for=\"(stage, i) in workflow?.stages ?? []\" :key=\"i\">\n\n      <p class=\"subtitle has-text-centered\">\n        <span class=\"icon-text\">\n          <span v-text=\"stage.title\"></span>\n          <span class=\"icon\" v-if=\"isStageCompleted(stage)\"><i class=\"fa fa-check\"></i></span>\n        </span>\n      </p>\n\n      <div class=\"grid-menu container block\">\n        <div class=\"box m-4\"\n            :class=\"{\n                  'is-clickable': isClickable(stepInfo.step),\n                  'hover-expand': isClickable(stepInfo.step),\n                  'has-text-grey': !isClickable(stepInfo.step),\n                  'has-background-grey-lighter': !isClickable(stepInfo.step),\n                  'has-border-success': stepInfo.step.status === 'completed',\n                  'has-border-grey': stepInfo.step === nextStep\n                }\"\n            @click=\"startWorkflowStep(stepInfo.step)\"\n            v-for=\"(stepInfo, j) in getStepInfo(stage)\" :key=\"j\">\n          <article\n            class=\"level\"\n          >\n            <div class=\"level-left\">\n              <div class=\"level-item\">\n                <p class=\"image is-48x48\" v-if=\"stepInfo.dbEntry?.thumbnailSrc\">\n                  <img class=\"is-100percent is-contain\" :src=\"stepInfo.dbEntry?.thumbnailSrc\" :alt=\"stepInfo.step.title\">\n                </p>\n                <p class=\"icon is-large\" v-else>\n                  <i class=\"fas fa-2x fa-align-center\" v-if=\"stepInfo.step.type === 'InstructionOnly'\"></i>\n                  <i class=\"fas fa-2x fa-images\" v-if=\"stepInfo.step.type === 'VideoLessonEmbedded' || stepInfo.step.type === 'VideoLessonReference'\"></i>\n                  <i class=\"fas fa-2x fa-camera\" v-if=\"stepInfo.step.type === 'UploadTask'\"></i>\n                </p>\n              </div>\n              <div class=\"level-item\">\n                <span v-text=\"stepInfo.step.title\"></span>\n              </div>\n            </div>\n            <div class=\"level-right\">\n              <div class=\"level-item\">\n                <span class=\"icon is-large\">\n                  <i class=\"far fa-check-circle has-text-success\" v-if=\"stepInfo.step.status==='completed'\"></i>\n                  <i class=\"far fa-play-circle\" v-if=\"stepInfo.step===nextStep\"></i>\n                  <i class=\"far fa-circle\" v-if=\"stepInfo.step !== nextStep && stepInfo.step.status==='notstarted'\"></i>\n                </span>\n              </div>\n            </div>\n          </article>\n        </div>\n      </div>\n\n      <div v-bind:class=\"{ 'is-active': instructionsActive }\" class=\"modal\">\n        <div class=\"modal-background\"></div>\n        <div class=\"modal-content\">\n          <div class=\"box content\">\n            <h3>{{currentStep?.instructions?.heading}}</h3>\n            <p style=\"white-space: pre-wrap;\">{{currentStep?.instructions?.text}}</p>\n            <div class=\"buttons is-right\">\n              <button class=\"button is-primary\" @click=\"instructionsFinished\">OK</button>\n            </div>\n          </div>\n        </div>\n        <button class=\"modal-close\" @click=\"instructionsActive = false\" aria-label=\"close\"></button>\n      </div>\n\n      <div v-bind:class=\"{ 'is-active': lessonActive }\" class=\"modal\">\n        <div class=\"modal-background\"></div>\n        <div class=\"container\" style=\"max-width: 100vw; max-height: 100vh;\">\n          <div class=\"box\" style=\"max-height: 100%\" >\n            <VideoLessonPlayer\n              v-show=\"lessonActive\"\n              :videoEntry=\"currentVideoEntry\"\n              :videoLesson=\"currentLesson\"\n              @lesson-completed=\"lessonCompleted\"\n              :maxVideoHeight=\"'calc(100vh - 152px - 3.75rem)'\"\n              :enableCompleteLesson=\"true\"/>\n          </div>\n        </div>\n        <button class=\"modal-close is-large\" aria-label=\"close\" @click=\"lessonActive=false\"></button>\n      </div>\n\n      <div :class=\"{'is-active': uploadActive}\" class=\"modal\">\n        <div class=\"modal-background\"></div>\n        <div class=\"modal-content\">\n          <div class=\"container\">\n            <div class=\"box\">\n              <FeedbackUploadScreen\n                :prompt=\"currentStep?.upload?.prompt\"\n                :title=\"workflow?.title\"\n                :subtitle=\"currentStep?.title\"\n                :uploadFilename=\"uploadFilename\"\n                @upload-canceled=\"uploadActive = false\"\n                @upload-completed=\"uploadComplete\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed, defineComponent, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport VideoLessonPlayer from '@/components/elements/VideoLessonPlayer.vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport VideoLesson from '@/model/VideoLesson';\nimport workflowManager, { TrackingWorkflowStage, TrackingWorkflowStep } from '@/services/WorkflowManager';\nimport FeedbackUploadScreen from '@/components/screens/FeedbackUploadScreen.vue';\nimport optionsManager from '@/services/OptionsManager';\nimport { GetVideoEntryForWorkflowStep, IsVideoLessonStep } from '@/model/Workflow';\n\nexport default defineComponent({\n  name: 'WorkflowMenu',\n  props: {\n    showHeader: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  emits: [\n    'back-selected',\n  ],\n  components: {\n    VideoLessonPlayer,\n    FeedbackUploadScreen,\n  },\n  computed: {\n    stages() { return ((this as any).workflow?.stages ?? []) as TrackingWorkflowStage[]; },\n    nextStep() {\n      for (let i = 0; i < this.stages.length; i += 1) {\n        const stage = (this as any).stages[i];\n        for (let j = 0; j < stage.steps.length; j += 1) {\n          const step = stage.steps[j];\n          if (step.status !== 'completed') return step as TrackingWorkflowStep;\n        }\n      }\n      return null;\n    },\n    currentVideoEntry(): DatabaseEntry | null {\n      if (this.currentStep?.type === 'VideoLessonReference' && this.currentStep?.videoLessonReference) {\n        return db.motionsMap.get(this.currentStep.videoLessonReference.clipName) ?? null;\n      }\n      if (this.currentStep?.type === 'VideoLessonEmbedded' && this.currentStep?.videoLessonEmbedded?.header.clipName) {\n        return db.motionsMap.get(this.currentStep.videoLessonEmbedded.header.clipName) ?? null;\n      }\n      return null;\n    },\n    currentLesson(): VideoLesson | null {\n      if (this.currentStep?.type === 'VideoLessonReference' && this.currentStep?.videoLessonReference) {\n        return db.lessonsById.get(this.currentStep.videoLessonReference.lessonId) ?? null;\n      }\n      if (this.currentStep?.type === 'VideoLessonEmbedded' && this.currentStep?.videoLessonEmbedded) {\n        return this.currentStep.videoLessonEmbedded;\n      }\n      return null;\n    },\n    uploadFilename(): string {\n      const uploadId = this.currentStep?.upload?.identifier ?? 'NoIdentifier';\n      const participantId = optionsManager.participantId.value ?? 'Anonomous';\n      const workflowId = this.workflow?.id ?? 'NullWorkflow';\n\n      return `${workflowId}-${participantId}-${uploadId}`;\n    },\n  },\n  setup(props, ctx) {\n    const currentStep = ref(null as null | TrackingWorkflowStep);\n    const instructionsActive = ref(false);\n    const lessonActive = ref(false);\n    const uploadActive = ref(false);\n\n    watch(workflowManager.activeFlow, () => {\n      currentStep.value = null;\n    });\n\n    return {\n      currentStep,\n      instructionsActive,\n      lessonActive,\n      uploadActive,\n      workflow: workflowManager.activeFlow,\n    };\n  },\n  methods: {\n    getStepInfo(stage: TrackingWorkflowStage) {\n\n      return stage.steps.map((step) => ({\n        step,\n        dbEntry: GetVideoEntryForWorkflowStep(db, step),\n      }));\n    },\n    instructionsFinished() {\n      this.instructionsActive = false;\n      const step = this.currentStep;\n      if (!step) return;\n      step.status = 'inprogress';\n      this.continueWorkflowStep(step);\n    },\n    isClickable(step: TrackingWorkflowStep) {\n      return this.nextStep === step\n      || (step.type === 'InstructionOnly' && step.status === 'completed');\n    },\n    startWorkflowStep(item: TrackingWorkflowStep) {\n      if (!this.isClickable(item)) return;\n      this.currentStep = item;\n      if (item.type === 'InstructionOnly') {\n        this.instructionsActive = true;\n        return;\n      }\n      this.continueWorkflowStep(item);\n    },\n    continueWorkflowStep(item: TrackingWorkflowStep) {\n      if (item.type === 'InstructionOnly') {\n        // Instructions only - there's nothing else to do. Move to next activity!\n        item.status = 'completed';\n      } else if (item.type === 'VideoLessonReference' || item.type === 'VideoLessonEmbedded') {\n        this.lessonActive = true;\n      } else if (item.type === 'UploadTask') {\n        this.uploadActive = true;\n      } else {\n        console.error(`Item type ${item.type} not supported`);\n      }\n    },\n    lessonCompleted() {\n      this.lessonActive = false;\n      if (this.currentStep) this.currentStep.status = 'completed';\n    },\n    uploadComplete() {\n      this.uploadActive = false;\n      if (this.currentStep) this.currentStep.status = 'completed';\n    },\n    isStageCompleted(stage: TrackingWorkflowStage) {\n      return stage.steps.reduce((wasTrue: boolean, thisStep: TrackingWorkflowStep) => wasTrue && thisStep.status === 'completed', true);\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n</style>\n","<template>\n  <div class=\"video-lesson-player\">\n    <div class=\"columns is-flex-grow-1 is-flex-shrink-1\">\n      <!-- <div class=\"column is-narrow\" v-if=\"videoLesson\">\n        <div class=\"tile is-ancestor is-vertical\" style=\"overflow-y:auto;\" :style=\"{\n              'max-height':maxVideoHeight\n            }\">\n          <div class=\"tile is-child box has-text-centered m-4\"\n               v-for=\"(activity, i) in videoLesson.activities\" :key=\"i\"\n               :class=\"{'is-active': activeActivityIndex === i}\"\n          >\n            <p class=\"subtitle\" v-text=\"activity.title\"></p>\n          </div>\n        </div> -->\n        <!-- <nav class=\"panel\" :style=\"{\n              'max-height':maxVideoHeight,\n              'overflow-y': 'scroll',\n            }\"\n            v-if=\"videoLesson\">\n          <div class=\"panel-heading\">Activities</div>\n          <a class=\"panel-block is-size-7\"\n            v-for=\"(activity, i) in videoLesson.activities\" :key=\"i\"\n            :class=\"{'is-active': activeActivityIndex === i}\"\n            @click=\"gotoActivity(i)\"\n            >\n            <strong class=\"panel-icon\">{{i+1}}&nbsp;</strong>&nbsp;{{activity.title}}\n          </a>\n        </nav>\n      </div> -->\n      <div class=\"column\">\n        <ActivityVideoPlayer\n          class=\"block\"\n          ref=\"activityVideoPlayer\"\n          :motion=\"videoEntry\"\n          :lesson=\"videoLesson\"\n          :activity=\"activeActivity\"\n          :maxHeight=\"maxVideoHeight\"\n          @progress=\"onProgress\"\n        />\n      </div>\n\n    </div>\n    <div class=\"is-flex-grow-0 is-flex-shrink-0\">\n      <SegmentedProgressBar\n        class=\"block\"\n        :segments=\"progressSegments\"\n        :progress=\"activityProgress\"\n      />\n\n      <div class=\"buttons is-centered has-addons\">\n        <button\n          v-if=\"!needsStartWebcam && !$refs.activityVideoPlayer?.activityFinished\"\n          class=\"button\"\n          :class=\"{\n            'is-primary': ($refs.activityVideoPlayer?.awaitingStart ?? false),\n            'is-loading': ($refs.activityVideoPlayer?.isPlaying ?? false),\n          }\"\n          :disabled=\"($refs.activityVideoPlayer?.isPlaying ?? (!$refs.activityVideoPlayer?.awaitingStart) ?? false)\"\n          @click=\"$refs.activityVideoPlayer.play()\"\n        >\n          <span class=\"icon\"><i class=\"fas fa-play\"></i></span>\n        </button>\n        <button\n          class=\"button is-primary\"\n          v-if=\"needsStartWebcam\"\n          :class=\"{'is-loading': webcamStatus==='loading'}\"\n          @click=\"startWebcam\">\n          Start Webcam\n        </button>\n        <button\n          class=\"button\"\n          v-if=\"$refs.activityVideoPlayer?.activityFinished\"\n          @click=\"repeat()\"\n        >\n          <div class=\"icon\"><i class=\"fas fa-redo fa-flip-horizontal\"></i></div>\n        </button>\n        <button\n          class=\"button\"\n          v-if=\"$refs.activityVideoPlayer?.activityFinished && (hasNextActivity || enableCompleteLesson)\"\n          :class=\"{\n            'is-primary': (!hasNextActivity && enableCompleteLesson && $refs.activityVideoPlayer?.activityFinished) || ($refs.activityVideoPlayer?.activityFinished ?? false)\n          }\"\n          @click=\"nextActivity\"\n        >\n          <span v-if=\"hasNextActivity || !enableCompleteLesson\" class=\"icon\"><i class=\"fas fa-step-forward\"></i></span>\n          <span v-else>\n            <span class=\"icon\"><i class=\"fas fa-check\"></i></span>\n            <span>Done</span>\n          </span>\n        </button>\n      </div>\n\n      <nav class=\"pagination is-centered\" v-if=\"videoLesson\">\n        <div class=\"pagination-list\" style=\"flex-wrap:nowrap;max-width:calc(100vw - 2.5rem);\">\n          <li  v-for=\"(i, index) in nearbyActivityIndices\" :key=\"index\">\n            <a class=\"pagination-link\"\n               :class=\"{'is-current': activeActivityIndex === i}\"\n               @click=\"gotoActivity(i)\"\n               v-if=\"i >= 0\">\n               {{i + 1}}\n            </a>\n            <span class=\"pagination-ellipses\" v-if=\"i<0\">\n              &hellip;\n            </span>\n          </li>\n        </div>\n      </nav>\n\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport VideoLesson, { Activity } from '@/model/VideoLesson';\nimport { defineComponent } from 'vue';\nimport ActivityVideoPlayer from '@/components/elements/ActivityVideoPlayer.vue';\nimport SegmentedProgressBar, { calculateProgressSegments, ProgressSegmentData } from '@/components/elements/SegmentedProgressBar.vue';\nimport webcamProvider from '@/services/WebcamProvider';\n\nfunction range(size: number, startAt = 0) {\n  return [...Array(size).keys()].map((i) => i + startAt);\n}\n\nexport default defineComponent({\n  name: 'VideoLessonPlayer',\n  components: {\n    SegmentedProgressBar,\n    ActivityVideoPlayer,\n  },\n  props: {\n    videoEntry: { type: Object },\n    videoLesson: { type: Object },\n    maxVideoHeight: { type: String, default: 'none' },\n    enableCompleteLesson: { type: Boolean, default: false },\n  },\n  emits: ['lesson-completed', 'previous-activity', 'next-activity'],\n  computed: {\n    nearbyActivityIndices(): number[] {\n      const margin = 1;\n      const minIndex = Math.max(0, this.activeActivityIndex - margin);\n      const maxActivityIndex = (this.lesson?.activities.length ?? 0) - 1;\n      const maxIndex = Math.min(maxActivityIndex, this.activeActivityIndex + margin);\n      const count = (maxIndex + 1) - minIndex;\n      let indices: number[] = [];\n      if (minIndex > 0) indices = indices.concat([0, -1]);\n      indices = indices.concat(range(count, minIndex));\n      if (maxIndex < maxActivityIndex) indices = indices.concat([-1, maxActivityIndex]);\n      return indices;\n    },\n    lesson() {\n      const lesson = (this.$props.videoLesson ?? null) as null | VideoLesson;\n      return lesson;\n    },\n    activeActivity() {\n      const lesson = (this.$props.videoLesson ?? null) as null | VideoLesson;\n      const activityIndex = this.activeActivityIndex as number;\n      const activity = lesson?.activities[activityIndex] ?? null as null | Activity;\n      return activity;\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lesson) return calculateProgressSegments(this.lesson, this.activeActivity);\n      return [];\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < (this.lesson?.activities.length ?? 0);\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    needsStartWebcam(): boolean {\n      return this.activeActivity !== null && this.activeActivity?.userVisual !== 'none' && webcamProvider.webcamStatus.value !== 'running';\n    },\n  },\n  data() {\n    return {\n      activeActivityIndex: 0,\n      activityProgress: 0,\n      webcamStatus: webcamProvider.webcamStatus,\n    };\n  },\n  methods: {\n    onProgress(val: number) { this.activityProgress = val; },\n    playActivity() { (this.$refs.activityVideoPlayer as any).play(); },\n    nextActivity() {\n      if (this.hasNextActivity) this.activeActivityIndex += 1;\n      else this.$emit('lesson-completed');\n    },\n    gotoActivity(i: number) {\n      this.activeActivityIndex = i;\n    },\n    async startWebcam() {\n      return (this.$refs.activityVideoPlayer as any)?.startWebcam();\n    },\n    repeat() {\n      const vidPlayer = (this.$refs.activityVideoPlayer as any);\n      vidPlayer.reset();\n      vidPlayer.play();\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.video-lesson-player {\n  display: flex;\n  flex-flow: column;\n  max-height: 100%;\n  max-width: 100%;\n}\n</style>\n","<template>\n  <div class=\"activity-video-player\">\n\n    <div v-show=\"showingWebcam\" class=\"is-100percent-v \">\n      <WebcamBox ref=\"webcamBox\" :maxHeight=\"maxHeight\" :showStartWebcamButton=\"false\"/>\n    </div>\n\n    <div :class=\"{\n          'is-overlay': showingWebcam\n        }\" class=\"is-100percent-v\">\n      <PausingVideoPlayer\n        :videoSrc=\"motion?.videoSrc\"\n        ref=\"videoPlayer\"\n        :maxHeight=\"maxHeight\"\n        :drawPoseLandmarks=\"activity?.demoVisual === 'skeleton'\"\n        :videoOpacity=\"activity?.demoVisual === 'video' ? 1 : 0\"\n        :emphasizedJoints=\"emphasizedJoints\"\n        @progress=\"onProgress\"\n        @playback-completed=\"onPlaybackCompleted\"\n        @pause-hit=\"onPauseHit\"\n        @pause-end=\"onPauseEnded\"\n      />\n    </div>\n\n    <div class=\"is-overlay instructions-overlay mb-4\">\n      <InstructionCarousel v-show=\"!activityFinished && timedInstructions.length > 0\" :sizeClass=\"''\" :instructions=\"timedInstructions\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"instructions.length > 0\" :sizeClass=\"''\" :instructions=\"instructions\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"activity?.staticInstruction\" :sizeClass=\"''\"  :instructions=\"[{id:0, text:activity?.staticInstruction}]\" class=\"m-2\"/>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed, ComputedRef, defineComponent, nextTick, onBeforeUnmount, onMounted, Ref, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport InstructionCarousel, { Instruction } from '@/components/elements/InstructionCarousel.vue';\nimport PausingVideoPlayer from '@/components/elements/PausingVideoPlayer.vue';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\nimport { Activity, PauseInfo } from '@/model/VideoLesson';\nimport Constants from '@/services/Constants';\n\nconst ActivityPlayState = Object.freeze({\n  AwaitingStart: 'AwaitingStart',\n  PendingStart: 'PendingStart',\n  Playing: 'Playing',\n  ActivityEnded: 'ActivityEnded',\n});\n\nexport default defineComponent({\n  name: 'ActivityVideoPlayer',\n  emits: ['progress', 'activityEnded'],\n  props: {\n    motion: { type: Object },\n    lesson: { type: Object },\n    activity: { type: Object },\n    defaultPauseDuration: { type: Number, default: 1.5 },\n    maxHeight: { type: String, default: '400px' },\n  },\n  components: {\n    PausingVideoPlayer,\n    InstructionCarousel,\n    WebcamBox,\n  },\n  setup(props, { emit }) {\n    const { motion, lesson, activity } = toRefs(props);\n    const state = ref(ActivityPlayState.AwaitingStart);\n    const activityFinished = computed(() => state.value === ActivityPlayState.ActivityEnded);\n    const awaitingStart = computed(() => state.value === ActivityPlayState.AwaitingStart);\n    const isPlaying = computed(() => state.value === ActivityPlayState.Playing);\n    const videoPlayer = ref(null as null | typeof PausingVideoPlayer);\n    const webcamBox = ref(null as null | typeof WebcamBox);\n    const videoTime = ref(0);\n\n    const pauseInstructs = ref([] as Instruction[]);\n    const onPlaybackCompleted = () => {\n      state.value = ActivityPlayState.ActivityEnded;\n    };\n    const onPauseHit = (pause: PauseInfo) => {\n      console.log(`Hit pause${pause}`);\n      if (pause.instruction) pauseInstructs.value.push({ id: pause.time, text: pause.instruction });\n    };\n    const onPauseEnded = () => pauseInstructs.value.splice(0);\n\n    const startTime = computed(() => activity?.value?.startTime ?? 0);\n\n    function reset(newTime?: number) {\n      pauseInstructs.value.splice(0);\n      state.value = ActivityPlayState.AwaitingStart;\n      const time = newTime ?? startTime.value ?? 0;\n\n      if (videoPlayer.value) videoPlayer.value.setTime(time);\n    }\n\n    watchEffect(() => reset(startTime.value));\n\n    return {\n      webcamBox,\n      videoPlayer,\n      videoTime,\n      state,\n      ActivityPlayState,\n      awaitingStart,\n      activityFinished,\n      pauseInstructs,\n      isPlaying,\n\n      reset,\n      startTime,\n\n      onPlaybackCompleted,\n      onPauseHit,\n      onPauseEnded,\n    };\n  },\n  computed: {\n    showingWebcam() {\n      return (this as any)?.activity?.userVisual !== 'none';\n    },\n    emphasizedJoints(): number[] { return this.activity?.emphasizedJoints ?? []; },\n    instructions(): Instruction[] {\n      const mActivity = this.activity;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if ((this.state === ActivityPlayState.AwaitingStart || this.state === ActivityPlayState.PendingStart) && mActivity.startInstruction) {\n        let text = mActivity.startInstruction;\n        if (this.state === ActivityPlayState.PendingStart) { text += '...'; }\n        instructs.push({\n          id: 1,\n          text,\n        });\n      } else if (this.state === ActivityPlayState.Playing && mActivity.playingInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.playingInstruction,\n        });\n      } else if (this.state === ActivityPlayState.ActivityEnded && mActivity.endInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.endInstruction,\n        });\n      }\n\n      instructs.concat(this.pauseInstructs);\n\n      return instructs;\n    },\n    timedInstructions(): Instruction[] {\n      const mActivity = this.activity as unknown as Activity | null;\n      const time = this.videoTime;\n\n      if (!mActivity) return [];\n\n      const activeTimedInstructions = mActivity.timedInstructions?.map(\n        (ti, i) => ({\n          id: i,\n          text: ti.text,\n          start: ti.startTime,\n          end: ti.endTime,\n        })\n      ).filter((ti) => ti.start <= time && time < ti.end) ?? [];\n\n      // console.log(`TimedI updated for time ${time}, count=${activeTimedInstructions.length}`, mActivity.timedInstructions);\n\n      return activeTimedInstructions;\n    },\n  },\n  methods: {\n    async startWebcam() {\n      return this.webcamBox?.startWebcam() ?? new Error('WebcamBox is null');\n    },\n    play(delay?: number | undefined) {\n      this.reset();\n      const vidPlayer = this.videoPlayer;\n      const vidActivity = this.activity as Activity | null;\n      if (!vidActivity) return;\n      if (!vidPlayer) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer is null');\n        return;\n      }\n\n      this.state = ActivityPlayState.PendingStart;\n\n      vidPlayer.play(\n        vidActivity.startTime,\n        vidActivity.endTime,\n        vidActivity.practiceSpeed ?? 1,\n        vidActivity.pauses ?? [],\n        delay ?? Constants.DefaultPauseDuration,\n        () => {\n          this.state = ActivityPlayState.Playing;\n        },\n      );\n    },\n    onProgress(val: number) {\n      this.videoTime = val;\n      this.$emit('progress', val);\n    },\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n\n.activity-video-player {\n  // background: black;\n  position: relative;\n}\n\n.instructions-overlay {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: flex-end;\n}\n\n</style>\n","<template>\n  <transition-group name=\"slide-fade\" mode=\"out-in\" tag=\"div\" class=\"instructionCarousel\">\n    <p\n      class=\"tag\"\n      :class=\"[sizeClass, tagClass]\"\n      v-for=\"inst in instructions\"\n      :key=\"inst.id\">{{inst.text}}</p>\n  </transition-group>\n</template>\n\n<script lang=\"ts\">\n\nimport { defineComponent } from 'vue';\n\nexport type Instruction = {\n  id: number;\n  text: string;\n}\n\nexport default defineComponent({\n  props: {\n    instructions: {\n      type: Array,\n      default: Array,\n    },\n    sizeClass: {\n      type: String,\n      default: 'is-normal',\n    },\n    tagClass: {\n      type: String,\n      default: 'is-dark',\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.instructionCarousel {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Enter and leave animations can use different */\n/* durations and timing functions.              */\n.slide-fade-enter-active {\n  transition: all .15s ease;\n  overflow: hidden;\n  // transform: translateX(-100%);\n}\n.slide-fade-leave-active {\n  transition: all .15s ease;\n  overflow: clip;\n  // transform: translateX(-100%);\n}\n.slide-fade-enter, .slide-fade-leave-to\n/* .slide-fade-leave-active below version 2.1.8 */ {\n  transform: translateX(10px) scaleX(0);\n  opacity: 0;\n}\n\n</style>\n","\n\nimport { defineComponent } from 'vue';\n\nexport type Instruction = {\n  id: number;\n  text: string;\n}\n\nexport default defineComponent({\n  props: {\n    instructions: {\n      type: Array,\n      default: Array,\n    },\n    sizeClass: {\n      type: String,\n      default: 'is-normal',\n    },\n    tagClass: {\n      type: String,\n      default: 'is-dark',\n    },\n  },\n});\n","import { render } from \"./InstructionCarousel.vue?vue&type=template&id=639bc8bc\"\nimport script from \"./InstructionCarousel.vue?vue&type=script&lang=ts\"\nexport * from \"./InstructionCarousel.vue?vue&type=script&lang=ts\"\n\nimport \"./InstructionCarousel.vue?vue&type=style&index=0&id=639bc8bc&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"is-relative\" :style=\"{'max-height': maxHeight}\">\n    <VideoPlayer\n      ref=\"videoPlayer\"\n      :videoBaseUrl=\"videoSrc\"\n      @progress=\"onProgress\"\n      @playback-completed=\"onSegmentPlaybackCompleted\"\n      :videoOpacity=\"videoOpacity\"\n      :drawPoseLandmarks=\"drawPoseLandmarks\"\n      :setDrawStyle=\"setDrawStyle\"\n      :maxHeight=\"maxHeight\"\n      :emphasizedJoints=\"emphasizedJoints\"\n      :emphasizedJointStyle=\"emphasizedJointStyle\"\n      />\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport Constants from '@/services/Constants';\nimport { PauseInfo } from '@/model/VideoLesson';\nimport {\n  computed, defineComponent, onBeforeUnmount, ref,\n} from 'vue';\nimport VideoPlayer from './VideoPlayer.vue';\n\nconst DEFAULT_PAUSE_DURATION = Constants.DefaultPauseDuration;\n\ntype PlaySegment = {\n  from: number;\n  to: number;\n  speed: number;\n  pause: PauseInfo | null;\n}\nfunction computePlaySegments(from: number, to: number, speed: number, pauses: PauseInfo[]) {\n  const segs: PlaySegment[] = [];\n\n  function nextPauseIndex(prevIndex: number): number {\n    const pTime = Math.max((pauses[prevIndex]?.time ?? 0), from);\n    let pauseIndex = prevIndex + 1;\n    for (; pauseIndex < pauses.length; pauseIndex += 1) {\n      const pi = pauses[pauseIndex];\n      if (pi.time > pTime) break;\n    }\n    return pauseIndex;\n  }\n\n  let segStartTime = from;\n  let pauseIndex = nextPauseIndex(-1);\n  while (pauseIndex < pauses.length) {\n    segs.push({\n      from: segStartTime,\n      to: pauses[pauseIndex].time,\n      speed,\n      pause: pauses[pauseIndex],\n    });\n    segStartTime = pauses[pauseIndex].time;\n    pauseIndex = nextPauseIndex(pauseIndex);\n  }\n  segs.push({\n    from: segStartTime,\n    to,\n    speed,\n    pause: null,\n  });\n\n  return segs;\n}\n\nexport default defineComponent({\n  name: 'PausingVideoPlayer',\n  components: { VideoPlayer },\n  props: {\n    videoSrc: {\n      default: '',\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: (canvasCtx: CanvasRenderingContext2D) => {\n        if (!canvasCtx) return;\n\n        /* eslint-disable no-param-reassign */\n        canvasCtx.strokeStyle = 'rgba(250, 200, 250, 0.95)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n        /* eslint-enable no-param-reassign */\n      },\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    maxHeight: {\n      type: String,\n    },\n  },\n  emits: ['playback-completed', 'progress', 'pause-hit', 'pause-end'],\n  setup(props, { emit }) {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n\n    let playTimeoutId = undefined as undefined | number;\n\n    function setTime(time: number) {\n      const vidPlayer = videoPlayer.value;\n      clearTimeout(playTimeoutId);\n      if (vidPlayer) vidPlayer.setTime(time);\n      emit('progress', time);\n    }\n\n    function onProgress(time: number) {\n      emit('progress', time);\n    }\n\n    function playSegment(seg: PlaySegment, delaySecs: number, emitResume?: boolean, onPlayStart?: () => void) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n\n      clearTimeout(playTimeoutId);\n      playTimeoutId = window.setTimeout(() => {\n        if (emitResume ?? false) {\n          emit('pause-end');\n        }\n        vidPlayer.playVideo(seg.from, seg.to, seg.speed);\n        if (onPlayStart) onPlayStart();\n      }, 1000 * delaySecs);\n    }\n    onBeforeUnmount(() => {\n      clearTimeout(playTimeoutId);\n    });\n\n    let playingSegments: PlaySegment[] = [];\n    let playingSegmentIndex = 0;\n\n    function play(\n      from: number,\n      to: number,\n      speed: number,\n      pauses: Array<PauseInfo>,\n      playDelaySecs: number,\n      onPlayStart?: () => void,\n    ) {\n      clearTimeout(playTimeoutId);\n      setTime(from);\n      playingSegments = computePlaySegments(from, to, speed, pauses);\n      playingSegmentIndex = 0;\n\n      playSegment(playingSegments[playingSegmentIndex], playDelaySecs, false, onPlayStart);\n    }\n    function onSegmentPlaybackCompleted() {\n      const { pause, to } = playingSegments[playingSegmentIndex];\n      playingSegmentIndex += 1;\n      if (playingSegmentIndex >= playingSegments.length) {\n        setTime(to);\n        emit('playback-completed');\n        return;\n      }\n\n      if (!pause) throw new Error('Expected there to be a pause obj');\n      const nextSeg = playingSegments[playingSegmentIndex];\n\n      emit('pause-hit', pause);\n      const manualResume = pause.manualResume ?? false;\n      if (!manualResume) {\n        playSegment(nextSeg, pause.pauseDuration ?? DEFAULT_PAUSE_DURATION, true);\n      }\n    }\n\n    const currentPose = computed(() => videoPlayer.value?.currentPose ?? null);\n\n    return {\n      videoPlayer,\n      setTime,\n      onProgress,\n      onSegmentPlaybackCompleted,\n      play,\n      currentPose,\n    };\n  },\n  methods: {\n    getVideoDimensions() {\n      return (this.$refs.videoPlayer as typeof VideoPlayer)?.getVideoDimensions();\n    },\n    getVideoTime(): number {\n      return (this.videoPlayer as any)?.getVideoTime() ?? 0;\n    },\n  },\n});\n</script>\n\n<style>\n\n</style>\n","const Constants = Object.freeze({\n  DefaultPauseDuration: 1.5,\n});\nexport default Constants;\n","<template>\n  <div\n    class=\"is-relative video-player-container\"\n    :style=\"{\n      'max-height': maxHeight\n    }\"\n  >\n    <video\n      :src=\"videoUrl\"\n      :style=\"{\n        'max-height': maxHeight,\n        opacity: '' + videoOpacity,\n      }\"\n      ref=\"videoElement\"\n      @loadedmetadata=\"scheduleCanvasResizing\"\n      @ended=\"endReported = true\"\n    ></video>\n    <canvas class=\"is-overlay\" ref=\"canvasElement\"> </canvas>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { DrawPose } from '@/services/MediaPipe';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport poseProvider from '@/services/PoseProvider';\nimport {\n  computed,\n  defineComponent,\n  toRefs,\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  nextTick,\n  Ref,\n  watch,\n} from 'vue';\n\nfunction onResize(canvasE: HTMLCanvasElement, videoE: HTMLVideoElement, modified: Ref<boolean>) {\n  nextTick(() => {\n    if (!canvasE || !videoE) return;\n\n    if (canvasE.width !== videoE.offsetWidth) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.width = videoE.offsetWidth;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    if (canvasE.height !== videoE.offsetHeight) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.height = videoE.offsetHeight;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n  });\n}\n\nfunction setupCanvasResizing(\n  videoElement: Ref<null | HTMLVideoElement>,\n  canvasElement: Ref<null | HTMLCanvasElement>,\n  modified: Ref<boolean>,\n) {\n  function resizeCanvas() {\n    const videoE = videoElement.value;\n    const canvasE = canvasElement.value;\n    if (videoE && canvasE) onResize(canvasE, videoE, modified);\n  }\n  onMounted(() => {\n    window.addEventListener('resize', resizeCanvas);\n    nextTick(resizeCanvas);\n  });\n  onBeforeUnmount(() => {\n    window.removeEventListener('resize', resizeCanvas);\n  });\n  return resizeCanvas;\n}\n\nfunction setupVideoPlaying(\n  videoElement: Ref<HTMLVideoElement | null>,\n  startTime: Ref<number>,\n  endTime: Ref<number>,\n  startProgressUpdating: () => void,\n  endReported: Ref<boolean>,\n) {\n  function playVideo(\n    from: number,\n    to: number,\n    speed: number,\n  ) {\n    // console.log(`VideoPlayer :: Starting playback from ${from} to ${to} @ ${speed.toPrecision(2)}`);\n\n    // eslint-disable-next-line no-param-reassign\n    endReported.value = false;\n    // eslint-disable-next-line no-param-reassign\n    startTime.value = from;\n    // eslint-disable-next-line no-param-reassign\n    endTime.value = to;\n\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n\n    videoE.pause();\n    videoE.playbackRate = speed;\n    videoE.currentTime = from;\n\n    nextTick(() => {\n      startProgressUpdating();\n      videoE.play();\n    });\n  }\n\n  function pauseVideo() {\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n    videoE.pause();\n  }\n\n  return { playVideo, pauseVideo };\n}\n\nexport default defineComponent({\n  name: 'VideoPlayer',\n  props: {\n    videoBaseUrl: String,\n    maxHeight: String,\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    fps: {\n      type: Number,\n      default: 30,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: () => {},\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n  },\n  emits: [\n    'playback-completed',\n    'progress',\n  ],\n  setup(props, ctx) {\n    const {\n      videoBaseUrl, drawPoseLandmarks, fps, setDrawStyle, emphasizedJoints, emphasizedJointStyle,\n    } = toRefs(props);\n\n    const videoElement = ref(null as null | HTMLVideoElement);\n    const canvasElement = ref(null as null | HTMLCanvasElement);\n    const canvasCtx = computed(() => canvasElement.value?.getContext('2d') as CanvasRenderingContext2D | null);\n\n    const startTime = ref(0);\n    const endTime = ref(0);\n    const videoUrl = computed(() => videoBaseUrl?.value ?? '');\n    const currentTime = ref(0);\n    const canvasModified = ref(false);\n\n    const resizeCanvas = setupCanvasResizing(videoElement, canvasElement, canvasModified);\n    const endReported = ref(false);\n\n    const poses = ref([] as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>);\n    const currentPose = computed(() => {\n      const frame = Math.floor(currentTime.value * fps.value);\n      const pose = poses.value[frame] ?? [];\n      return pose;\n    });\n\n    let prevTime = -1;\n    let timerId = -1;\n    function onTimeUpdated() {\n      const vidElement = videoElement.value;\n      if (!vidElement) return;\n\n      const time = vidElement.currentTime;\n      if (time === prevTime) return;\n      prevTime = time;\n\n      currentTime.value = time;\n\n      if (time + 1 / 60 >= endTime.value || endReported.value) {\n        vidElement.pause();\n        vidElement.currentTime = endTime.value; // pin to end time\n        ctx.emit('progress', endTime.value);\n        console.log('VideoPlayer :: playback-completed');\n        ctx.emit('playback-completed');\n        clearInterval(timerId);\n        timerId = -1;\n      } else {\n        ctx.emit('progress', time);\n      }\n    }\n\n    const startProgressUpdating = () => {\n      if (timerId !== -1) clearInterval(timerId);\n      timerId = window.setInterval(onTimeUpdated, 1000 / 30);\n    };\n\n    const { playVideo, pauseVideo } = setupVideoPlaying(\n      videoElement,\n      startTime,\n      endTime,\n      startProgressUpdating,\n      endReported,\n    );\n\n    function scheduleCanvasResizing() {\n      setTimeout(() => {\n        nextTick(resizeCanvas);\n      }, 100);\n    }\n\n    // Update pose drawing\n    function clearDrawing() {\n      const canvasE = canvasElement.value;\n      const drawCtx = canvasCtx.value;\n      if (!canvasE || !drawCtx) return;\n      drawCtx.clearRect(0, 0, canvasE.width, canvasE.height);\n    }\n    function drawPose(lms: Landmark[]) {\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n      setDrawStyle.value(drawCtx);\n      DrawPose(drawCtx, lms, {\n        emphasizedJoints: emphasizedJoints.value as number[],\n        emphasisStroke: emphasizedJointStyle.value,\n      });\n    }\n\n    watch([videoBaseUrl, drawPoseLandmarks], async () => {\n      if (!drawPoseLandmarks.value) {\n        poses.value = [];\n        return;\n      }\n\n      try {\n        poses.value = await poseProvider.GetPose(videoBaseUrl?.value ?? '');\n      } catch (e) {\n        console.error(\"Couldn't get poses: \", e);\n      }\n    });\n    watch([canvasModified, currentPose, drawPoseLandmarks], () => {\n      canvasModified.value = false;\n      clearDrawing();\n\n      if (drawPoseLandmarks.value) {\n        drawPose(currentPose.value as any);\n      }\n    });\n\n    return {\n      videoUrl,\n      resizeCanvas,\n      videoElement,\n      canvasElement,\n      playVideo,\n      pauseVideo,\n      endTime,\n      scheduleCanvasResizing,\n      poses,\n      currentTime,\n      currentPose,\n      endReported,\n\n      getVideoDimensions: () => ({\n        height: videoElement.value?.height ?? 0,\n        width: videoElement.value?.width ?? 0,\n      }),\n    };\n  },\n  methods: {\n    setTime(time: number, keepPlaying?: boolean | undefined) {\n      const videoE = this.videoElement;\n      if (videoE) {\n        videoE.currentTime = time;\n      }\n      const pauseVideo = !(keepPlaying ?? false);\n      if (videoE && pauseVideo) videoE.pause();\n    },\n    getVideoTime() {\n      return this.videoElement?.currentTime ?? 0;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n.video-player-container {\n  canvas {\n    margin: auto;\n  }\n\n  video {\n    border-radius: 0.25rem;\n    display: block;\n    margin: auto;\n  }\n}\n</style>\n","// Inspired from https://gist.github.com/TheJLifeX/74958cc59db477a91837244ff598ef4a\n\nexport type Landmark = {\n  x: number;\n  y: number;\n  z?: number;\n  visibility?: number;\n}\n\nexport type MpHolisticResults = {\n  image?: any;\n  timestamp?: number;\n  faceLandmarks?: Array<Landmark>;\n  poseLandmarks?: Array<Landmark>;\n  rightHandLandmarks?: Array<Landmark>;\n  leftHandLandmarks?: Array<Landmark>;\n}\nexport const HandLandmarks = {\n  wrist: 0,\n  thumbCMC: 1,\n  thumbMCP: 2,\n  thumbIP: 3,\n  thumbTIP: 4,\n  indexMCP: 5,\n  indexPIP: 6,\n  indexDIP: 7,\n  indexTIP: 8,\n  middleMCP: 9,\n  middlePIP: 10,\n  middleDIP: 11,\n  middleTIP: 12,\n  ringMCP: 13,\n  ringPIP: 14,\n  ringDIP: 15,\n  ringTIP: 16,\n  pinkyMCP: 17,\n  pinkyPIP: 18,\n  pinkyDIP: 19,\n  pinkyTIP: 20,\n};\n\nexport const PoseLandmarks = {\n  nose: 0,\n  leftEyeInner: 1,\n  leftEye: 2,\n  leftEyeOuter: 3,\n  rightEyeInner: 4,\n  rightEye: 5,\n  rightEyeOuter: 6,\n  leftEar: 7,\n  rightEar: 8,\n  mouthLeft: 9,\n  mouthRight: 10,\n  leftShoulder: 11,\n  rightShoulder: 12,\n  leftElbow: 13,\n  rightElbow: 14,\n  leftWrist: 15,\n  rightWrist: 16,\n  leftPinky: 17,\n  rightPinky: 18,\n  leftIndex: 19,\n  rightIndex: 20,\n  leftThumb: 21,\n  rightThumb: 22,\n  leftHip: 23,\n  rightHip: 24,\n  leftKnee: 25,\n  rightKnee: 26,\n  leftAnkle: 27,\n  rightAnkle: 28,\n  leftHeel: 29,\n  rightHeel: 30,\n  leftFootIndex: 31,\n  rightFootIndex: 32,\n};\n","import { TinyEmitter } from 'tiny-emitter';\nimport { onMounted, onBeforeUnmount } from 'vue';\nimport { MpHolisticResults } from './MediaPipeTypes';\n\nexport const EventNames = Object.freeze({\n  gesture: 'gesture',\n  trackingProcessingStarted: 'trackingProcessingStarted',\n  trackingResults: 'trackingResults',\n  trackingRequested: 'trackingRequested',\n  trackingRequestFinished: 'trackingRequestFinished',\n});\n\nexport const GestureNames = Object.freeze({\n  none: 'none',\n  pointLeft: 'point-left',\n  pointRight: 'point-right',\n  namaste: 'namaste',\n});\n\nconst eventHub = new TinyEmitter();\n\nexport function setupGestureListening(\n  callbacks: Record<string, (trackingResults?: MpHolisticResults | undefined) => void>,\n  fallback?: undefined | ((gesture: string, trackingResults: MpHolisticResults) => void),\n) {\n  function onGesture(gesture: string, trackingResults: MpHolisticResults) {\n    const cb = callbacks[gesture];\n    if (cb) cb(trackingResults);\n\n    if (!cb && fallback) fallback(gesture, trackingResults);\n  }\n  onMounted(() => {\n    eventHub.on(EventNames.gesture, onGesture);\n  });\n  onBeforeUnmount(() => {\n    eventHub.off(EventNames.gesture, onGesture);\n  });\n}\n\nexport function setupMediaPipeListening(\n  callback: (res: MpHolisticResults, frameId?: number) => void,\n  onFrameProcessingStarted?: (frameId: number) => void,\n) {\n\n  onMounted(() => {\n    eventHub.on(EventNames.trackingResults, callback);\n    if (onFrameProcessingStarted) eventHub.on(EventNames.trackingProcessingStarted, onFrameProcessingStarted);\n  });\n  onBeforeUnmount(() => {\n    eventHub.off(EventNames.trackingResults, callback);\n    if (onFrameProcessingStarted) eventHub.off(EventNames.trackingProcessingStarted, onFrameProcessingStarted);\n  });\n}\n\nexport const TrackingActions = Object.freeze({\n  requestTracking: (id: string) => {\n    eventHub.emit(EventNames.trackingRequested, id);\n  },\n  endTrackingRequest: (id: string) => {\n    eventHub.emit(EventNames.trackingRequestFinished, id);\n  },\n});\n\nexport default eventHub;\n","//\n// Utils.ts\n//\n\nexport default class Utils {\n\n  static sleep(secs: number): Promise<void> {\n    return new Promise((res) => setTimeout(res, secs * 1000));\n  }\n\n  static PromptDownloadFile(filename: string, text: string) {\n    const element = document.createElement('a');\n    element.setAttribute('href', `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`);\n    element.setAttribute('download', filename);\n    element.style.display = 'none';\n\n    document.body.appendChild(element);\n    element.click();\n\n    document.body.removeChild(element);\n  }\n\n  // static CaptureVideoImage(videoE: HTMLVideoElement) {\n  //   const canvas = document.createElement('canvas');\n  //   canvas.style.display = 'none';\n  //   document.appendChild(canvas);\n  //   canvas.width = videoE.width;\n  //   canvas.height = videoE.height;\n  //   const ctx = canvas.getContext('2d')!;\n\n  //   ctx.drawImage(videoE, 0, 0, videoE.width, videoE.height);\n  // }\n\n  static DoEveryFrame(\n    onFrame: () => Promise<void>,\n    shouldRun?: () => boolean,\n  ) {\n\n    if (shouldRun !== undefined && !shouldRun()) {\n      requestAnimationFrame(() => {\n        Utils.DoEveryFrame(onFrame);\n      });\n    } else {\n      requestAnimationFrame(() => {\n        onFrame().then(() => {\n          Utils.DoEveryFrame(onFrame);\n        });\n      });\n    }\n  }\n\n  static uuidv4() {\n    // eslint-disable-next-line no-bitwise, no-mixed-operators, space-infix-ops\n    return (`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`).replace(/[018]/g, (c: any) => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));\n  }\n\n  static deepCopy<T>(obj: T): T {\n\n    // Handle the 3 simple types, and null or undefined\n    if (obj === null || undefined === obj || typeof obj !== 'object') {\n      return obj;\n    }\n\n    if (obj instanceof Date) {\n      const copy = new Date();\n      copy.setTime(obj.getTime());\n      return copy as unknown as T;\n    }\n\n    if (Array.isArray(obj)) {\n      const len = obj.length;\n      const copy = new Array(len);\n      for (let i = 0; i < len; i += 1) {\n        copy[i] = Utils.deepCopy(obj[i]);\n      }\n      return copy as unknown as T;\n    }\n\n    if (typeof obj === 'object') {\n      const typedObj = obj as any;\n      const copy = {} as any;\n      const attrs = Object.keys(typedObj);\n      for (let i = 0; i < attrs.length; i += 1) {\n        const attr = attrs[i];\n        const val = typedObj[attr];\n        // eslint-disable-next-line no-prototype-builtins\n        if (typedObj.hasOwnProperty(attr)) copy[attr] = Utils.deepCopy(val);\n      }\n      return copy;\n    }\n\n    throw new Error(`Unable to copy object ${obj}! It's type isn't supported`);\n  }\n\n  static shuffleArray<T>(array: Array<T>, fromIndex?: number, toIndex?: number) {\n    const sliceStart = fromIndex ?? 0;\n    const sliceEnd = toIndex ?? array.length - 1;\n\n    for (let i = sliceEnd; i > sliceStart; i -= 1) {\n      const j = sliceStart + Math.floor(Math.random() * (i - sliceStart + 1));\n      [array[i], array[j]] = [array[j], array[i]];\n    }\n  }\n}\n","/* eslint-disable no-multi-spaces */\n/* eslint-disable @typescript-eslint/no-var-requires */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable import/prefer-default-export */\nimport { Landmark, MpHolisticResults, PoseLandmarks } from './MediaPipeTypes';\nimport eventHub, { EventNames } from './EventHub';\nimport Utils from './Utils';\n\nexport const usingHolistic = false;\n\nlet mp: any = null;\n// eslint-disable-next-line global-require\nif (usingHolistic) mp = require('@mediapipe/holistic/holistic');\n// eslint-disable-next-line global-require\nelse mp = require('@mediapipe/pose/pose');\n\nexport const HAND_LANDMARK_CONNECTIONS = [\n  [0, 1], [1, 2], [2, 3], [3, 4], // Thumb\n  [0, 5], [5, 6], [6, 7], [7, 8], // Index\n  [5, 9], [9, 10], [10, 11], [11, 12], // Middle\n  [9, 13], [13, 14], [14, 15], [15, 16], // Ring\n  [0, 17], [13, 17], [17, 18], [18, 19], [19, 20], // Pinky\n];\n\nexport const HAND = {\n  THUMB_FINGER: [1, 2, 3, 4],\n  INDEX_FINGER: [5, 6, 7, 8],\n  MIDDLE_FINGER: [9, 10, 11, 12],\n  RING_FINGER: [13, 14, 15, 16],\n  PINKY_FINGER: [17, 18, 19, 20],\n};\n\nconst CONNECTIONS_TO_DRAW = [\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftPinky,      size: 1.0 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightPinky,     size: 1.0 },\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftThumb,      size: 1.0 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightThumb,     size: 1.0 },\n  { v0: PoseLandmarks.leftIndex,    v1: PoseLandmarks.leftWrist,      size: 1.0 },\n  { v0: PoseLandmarks.rightIndex,   v1: PoseLandmarks.rightWrist,     size: 1.0 },\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftElbow,      size: 1.1 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightElbow,     size: 1.1 },\n  { v0: PoseLandmarks.leftElbow,    v1: PoseLandmarks.leftShoulder,   size: 1.3 },\n  { v0: PoseLandmarks.rightElbow,   v1: PoseLandmarks.rightShoulder,  size: 1.3 },\n  { v0: PoseLandmarks.leftShoulder, v1: PoseLandmarks.rightShoulder,  size: 2.0 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.leftShoulder,   size: 1.7 },\n  { v0: PoseLandmarks.rightHip,     v1: PoseLandmarks.rightShoulder,  size: 1.7 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.rightHip,       size: 1.7 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.leftKnee,       size: 1.5 },\n  { v0: PoseLandmarks.rightHip,     v1: PoseLandmarks.rightKnee,      size: 1.5 },\n  { v0: PoseLandmarks.leftKnee,     v1: PoseLandmarks.leftAnkle,      size: 1.4 },\n  { v0: PoseLandmarks.rightKnee,    v1: PoseLandmarks.rightAnkle,     size: 1.4 },\n  { v0: PoseLandmarks.leftAnkle,    v1: PoseLandmarks.leftHeel,       size: 1.0 },\n  { v0: PoseLandmarks.rightAnkle,   v1: PoseLandmarks.rightHeel,      size: 1.0 },\n  { v0: PoseLandmarks.leftHeel,     v1: PoseLandmarks.leftFootIndex,  size: 1.0 },\n  { v0: PoseLandmarks.rightHeel,    v1: PoseLandmarks.rightFootIndex, size: 1.0 },\n  { v0: PoseLandmarks.leftAnkle,    v1: PoseLandmarks.leftFootIndex,  size: 1.0 },\n  { v0: PoseLandmarks.rightAnkle,   v1: PoseLandmarks.rightFootIndex, size: 1.0 },\n  { v0: PoseLandmarks.nose,         v1: PoseLandmarks.rightEye,       size: 1.0 },\n  { v0: PoseLandmarks.nose,         v1: PoseLandmarks.leftEye,        size: 1.0 },\n];\n\nlet trackingStarted = false;\n\nexport function DrawConnections(\n  canvasCtx: CanvasRenderingContext2D,\n  landmarks: Array<Landmark>,\n  connections: Array<Array<number>>,\n) {\n  const w = canvasCtx.canvas.width;\n  const h = canvasCtx.canvas.height;\n\n  canvasCtx.beginPath();\n  connections.forEach((connection) => {\n    const p1 = landmarks[connection[0]];\n    const p2 = landmarks[connection[1]];\n\n    if (!p1 || !p2) return;\n\n    canvasCtx.moveTo(p1.x * w, p1.y * h);\n    canvasCtx.lineTo(p2.x * w, p2.y * h);\n  });\n\n  canvasCtx.stroke();\n  canvasCtx.restore();\n}\n\nexport function DrawPose(\n  canvasCtx: CanvasRenderingContext2D,\n  poseLandmarks: Landmark[],\n  options?: {\n    sourceAspectRatio?: number;\n    emphasizedJoints?: number[];\n    emphasisStroke? : string;\n  },\n) {\n\n  if (poseLandmarks.length === 0) {\n    return;\n  }\n\n  const jointsWithEmphasis = options?.emphasizedJoints;\n\n  canvasCtx.save();\n  let w = canvasCtx.canvas.width;\n  let h = canvasCtx.canvas.height;\n\n  const sourceAR = options?.sourceAspectRatio;\n  if (sourceAR) {\n    const canvasAR = canvasCtx.canvas.width / canvasCtx.canvas.height;\n\n    if (sourceAR > canvasAR) {\n      // video source is wider than canvas\n      const adjustedHeight = w / sourceAR;\n      const pixelsTaller = h - adjustedHeight;\n      canvasCtx.translate(0, pixelsTaller / 2);\n      h = adjustedHeight;\n\n    } else if (sourceAR < canvasAR) {\n      // video source is taller than canvas\n      const adjustedWidth = sourceAR * h;\n      const pixelsWider = w - adjustedWidth;\n      canvasCtx.translate(pixelsWider / 2, 0);\n      w = adjustedWidth;\n    }\n  }\n\n  CONNECTIONS_TO_DRAW.forEach((connection) => {\n    const p1 = poseLandmarks[connection.v0];\n    const p2 = poseLandmarks[connection.v1];\n\n    if (!p1 || !p2) return;\n    if ((p1.visibility ?? 1) < 0.5 || (p2.visibility ?? 1) < 0.5) {\n      // console.log('skipping b/c of insufficient visibility');\n      return;\n    }\n\n    const emphasized = jointsWithEmphasis\n    && jointsWithEmphasis.indexOf(connection.v0) !== -1\n    && jointsWithEmphasis.indexOf(connection.v1) !== -1;\n\n    canvasCtx.save();\n    if (emphasized && options?.emphasisStroke) {\n      canvasCtx.strokeStyle = options.emphasisStroke;\n    }\n    canvasCtx.lineWidth *= connection.size;\n    canvasCtx.beginPath();\n    canvasCtx.moveTo(p1.x * w, p1.y * h);\n    canvasCtx.lineTo(p2.x * w, p2.y * h);\n    canvasCtx.stroke();\n    canvasCtx.restore();\n  });\n\n  const p1a = poseLandmarks[PoseLandmarks.leftShoulder];\n  const p1b = poseLandmarks[PoseLandmarks.rightShoulder];\n  const p2 = poseLandmarks[PoseLandmarks.nose];\n  if (!p1a || !p1b || !p2) {\n    canvasCtx.beginPath();\n    canvasCtx.moveTo(w * 0.5 * (p1a.x + p1b.x), h * 0.5 * (p1a.y + p1b.y));\n    canvasCtx.lineTo(w * p2.x, h * p2.y);\n    canvasCtx.stroke();\n  }\n\n  canvasCtx.restore();\n}\n\nconst trackingRequests: Record<string, boolean> = {};\nconst trackingCount = () => Object\n  .keys(trackingRequests)\n  .map((id) => trackingRequests[id])\n  .filter((x) => x).length;\n\nlet latestResults: MpHolisticResults | null = null;\nexport function GetLatestResults() {\n  return Object.freeze(latestResults);\n}\n\nexport function StartTracking(videoE: HTMLVideoElement): void {\n  if (trackingStarted) { throw Error('Tracking alread started'); }\n\n  trackingStarted = true;\n  trackingRequests.initial = true;\n\n  let mpInstance: any = null;\n  if (usingHolistic) mpInstance = new mp.Holistic({ locateFile: (file: any) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic@0.1.1613603339/${file}` });\n  else mpInstance = new mp.Pose({ locateFile: (file: any) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.2.1617147663/${file}` });\n\n  mpInstance.setOptions({\n    upperBodyOnly: false,\n    smoothLandmarks: true,\n    minDetectionConfidence: 0.5,\n    minTrackingConfidence: 0.5,\n  });\n\n  let frameId = 0;\n  let timestamp = Date.now();\n  mpInstance.onResults((res: MpHolisticResults) => {\n    trackingRequests.initial = false;\n    latestResults = res;\n    res.timestamp = timestamp;\n    eventHub.emit(EventNames.trackingResults, res, frameId);\n  });\n\n  eventHub.on(EventNames.trackingRequested, (id: string) => {\n    trackingRequests[id] = true;\n  });\n  eventHub.on(EventNames.trackingRequestFinished, (id: string) => {\n    trackingRequests[id] = false;\n  });\n\n  Utils.DoEveryFrame(\n    async () => {\n      frameId += 1;\n      eventHub.emit(EventNames.trackingProcessingStarted, frameId);\n      timestamp = Date.now();\n      if (trackingCount() > 0) await mpInstance.send({ image: videoE });\n    },\n    () => true,\n  );\n}\n\nexport function isTracking() {\n  return trackingCount() > 0;\n}\n","// import parse from 'csv-parse';\n\nimport Parser, { Row } from '@gregoranders/csv';\nimport { Landmark } from '@/services/MediaPipeTypes';\n\nconst VIDEO_EXTENSIONS = ['.mp4', '.m4v', '.mov'];\n\nexport class PoseProvider {\n\n  private poseFiles: Map<string, Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>> = new Map();\n\n  async GetPose(videoName: string) {\n    if (videoName.length < 4) return [];\n\n    let poseFilename = videoName.replace('videos', 'poses');\n    for (let i = 0; i < VIDEO_EXTENSIONS.length; i += 1) {\n      const extension = VIDEO_EXTENSIONS[i];\n      poseFilename = poseFilename.replace(extension, '.poses.csv');\n    }\n\n    const cached = this.poseFiles.get(poseFilename);\n    if (cached !== undefined) return cached;\n\n    const stored = localStorage.getItem(poseFilename);\n    if (stored !== null) {\n      const poses = JSON.parse(stored) as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>;\n      this.poseFiles.set(poseFilename, Object.freeze(poses));\n      return poses;\n    }\n\n    const poseFile = await PoseProvider.getPoseFile(poseFilename);\n    const poses = PoseProvider.convertToPoseList(poseFile);\n    this.poseFiles.set(poseFilename, poses);\n\n    localStorage.setItem(poseFilename, JSON.stringify(poses));\n\n    return poses;\n  }\n\n  private static async getPoseFile(url: string) {\n\n    const response = await fetch(url);\n    if (!response.ok) throw new Error(`Error fetching pose file: ${response.statusText}`);\n\n    const text = await response.text();\n\n    return new Parser().parse(text);\n  }\n\n  private static convertToPoseList(csv: readonly Row[]) {\n    const temp = csv.map((row) => PoseProvider.convertRow(row));\n    return Object.freeze(temp.filter((x) => x.length > 0));\n  }\n\n  private static convertRow(row: Row) {\n    if (row.length === 0) return [];\n    if (row[0].startsWith('#')) return [];\n\n    const lms = [] as Array<Readonly<Landmark>>;\n    for (let i = 0; i + 2 < row.length; i += 3) {\n      lms.push(\n        Object.freeze({\n          x: Number.parseFloat(row[i]),\n          y: Number.parseFloat(row[i + 1]),\n          visibility: Number.parseFloat(row[i + 2]),\n        }),\n      );\n    }\n\n    return Object.freeze(lms);\n  }\n}\n\nconst poseProvider = new PoseProvider();\n\nexport default poseProvider;\n","\nimport { DrawPose } from '@/services/MediaPipe';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport poseProvider from '@/services/PoseProvider';\nimport {\n  computed,\n  defineComponent,\n  toRefs,\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  nextTick,\n  Ref,\n  watch,\n} from 'vue';\n\nfunction onResize(canvasE: HTMLCanvasElement, videoE: HTMLVideoElement, modified: Ref<boolean>) {\n  nextTick(() => {\n    if (!canvasE || !videoE) return;\n\n    if (canvasE.width !== videoE.offsetWidth) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.width = videoE.offsetWidth;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    if (canvasE.height !== videoE.offsetHeight) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.height = videoE.offsetHeight;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n  });\n}\n\nfunction setupCanvasResizing(\n  videoElement: Ref<null | HTMLVideoElement>,\n  canvasElement: Ref<null | HTMLCanvasElement>,\n  modified: Ref<boolean>,\n) {\n  function resizeCanvas() {\n    const videoE = videoElement.value;\n    const canvasE = canvasElement.value;\n    if (videoE && canvasE) onResize(canvasE, videoE, modified);\n  }\n  onMounted(() => {\n    window.addEventListener('resize', resizeCanvas);\n    nextTick(resizeCanvas);\n  });\n  onBeforeUnmount(() => {\n    window.removeEventListener('resize', resizeCanvas);\n  });\n  return resizeCanvas;\n}\n\nfunction setupVideoPlaying(\n  videoElement: Ref<HTMLVideoElement | null>,\n  startTime: Ref<number>,\n  endTime: Ref<number>,\n  startProgressUpdating: () => void,\n  endReported: Ref<boolean>,\n) {\n  function playVideo(\n    from: number,\n    to: number,\n    speed: number,\n  ) {\n    // console.log(`VideoPlayer :: Starting playback from ${from} to ${to} @ ${speed.toPrecision(2)}`);\n\n    // eslint-disable-next-line no-param-reassign\n    endReported.value = false;\n    // eslint-disable-next-line no-param-reassign\n    startTime.value = from;\n    // eslint-disable-next-line no-param-reassign\n    endTime.value = to;\n\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n\n    videoE.pause();\n    videoE.playbackRate = speed;\n    videoE.currentTime = from;\n\n    nextTick(() => {\n      startProgressUpdating();\n      videoE.play();\n    });\n  }\n\n  function pauseVideo() {\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n    videoE.pause();\n  }\n\n  return { playVideo, pauseVideo };\n}\n\nexport default defineComponent({\n  name: 'VideoPlayer',\n  props: {\n    videoBaseUrl: String,\n    maxHeight: String,\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    fps: {\n      type: Number,\n      default: 30,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: () => {},\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n  },\n  emits: [\n    'playback-completed',\n    'progress',\n  ],\n  setup(props, ctx) {\n    const {\n      videoBaseUrl, drawPoseLandmarks, fps, setDrawStyle, emphasizedJoints, emphasizedJointStyle,\n    } = toRefs(props);\n\n    const videoElement = ref(null as null | HTMLVideoElement);\n    const canvasElement = ref(null as null | HTMLCanvasElement);\n    const canvasCtx = computed(() => canvasElement.value?.getContext('2d') as CanvasRenderingContext2D | null);\n\n    const startTime = ref(0);\n    const endTime = ref(0);\n    const videoUrl = computed(() => videoBaseUrl?.value ?? '');\n    const currentTime = ref(0);\n    const canvasModified = ref(false);\n\n    const resizeCanvas = setupCanvasResizing(videoElement, canvasElement, canvasModified);\n    const endReported = ref(false);\n\n    const poses = ref([] as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>);\n    const currentPose = computed(() => {\n      const frame = Math.floor(currentTime.value * fps.value);\n      const pose = poses.value[frame] ?? [];\n      return pose;\n    });\n\n    let prevTime = -1;\n    let timerId = -1;\n    function onTimeUpdated() {\n      const vidElement = videoElement.value;\n      if (!vidElement) return;\n\n      const time = vidElement.currentTime;\n      if (time === prevTime) return;\n      prevTime = time;\n\n      currentTime.value = time;\n\n      if (time + 1 / 60 >= endTime.value || endReported.value) {\n        vidElement.pause();\n        vidElement.currentTime = endTime.value; // pin to end time\n        ctx.emit('progress', endTime.value);\n        console.log('VideoPlayer :: playback-completed');\n        ctx.emit('playback-completed');\n        clearInterval(timerId);\n        timerId = -1;\n      } else {\n        ctx.emit('progress', time);\n      }\n    }\n\n    const startProgressUpdating = () => {\n      if (timerId !== -1) clearInterval(timerId);\n      timerId = window.setInterval(onTimeUpdated, 1000 / 30);\n    };\n\n    const { playVideo, pauseVideo } = setupVideoPlaying(\n      videoElement,\n      startTime,\n      endTime,\n      startProgressUpdating,\n      endReported,\n    );\n\n    function scheduleCanvasResizing() {\n      setTimeout(() => {\n        nextTick(resizeCanvas);\n      }, 100);\n    }\n\n    // Update pose drawing\n    function clearDrawing() {\n      const canvasE = canvasElement.value;\n      const drawCtx = canvasCtx.value;\n      if (!canvasE || !drawCtx) return;\n      drawCtx.clearRect(0, 0, canvasE.width, canvasE.height);\n    }\n    function drawPose(lms: Landmark[]) {\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n      setDrawStyle.value(drawCtx);\n      DrawPose(drawCtx, lms, {\n        emphasizedJoints: emphasizedJoints.value as number[],\n        emphasisStroke: emphasizedJointStyle.value,\n      });\n    }\n\n    watch([videoBaseUrl, drawPoseLandmarks], async () => {\n      if (!drawPoseLandmarks.value) {\n        poses.value = [];\n        return;\n      }\n\n      try {\n        poses.value = await poseProvider.GetPose(videoBaseUrl?.value ?? '');\n      } catch (e) {\n        console.error(\"Couldn't get poses: \", e);\n      }\n    });\n    watch([canvasModified, currentPose, drawPoseLandmarks], () => {\n      canvasModified.value = false;\n      clearDrawing();\n\n      if (drawPoseLandmarks.value) {\n        drawPose(currentPose.value as any);\n      }\n    });\n\n    return {\n      videoUrl,\n      resizeCanvas,\n      videoElement,\n      canvasElement,\n      playVideo,\n      pauseVideo,\n      endTime,\n      scheduleCanvasResizing,\n      poses,\n      currentTime,\n      currentPose,\n      endReported,\n\n      getVideoDimensions: () => ({\n        height: videoElement.value?.height ?? 0,\n        width: videoElement.value?.width ?? 0,\n      }),\n    };\n  },\n  methods: {\n    setTime(time: number, keepPlaying?: boolean | undefined) {\n      const videoE = this.videoElement;\n      if (videoE) {\n        videoE.currentTime = time;\n      }\n      const pauseVideo = !(keepPlaying ?? false);\n      if (videoE && pauseVideo) videoE.pause();\n    },\n    getVideoTime() {\n      return this.videoElement?.currentTime ?? 0;\n    },\n  },\n});\n","import { render } from \"./VideoPlayer.vue?vue&type=template&id=97f109d0\"\nimport script from \"./VideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./VideoPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./VideoPlayer.vue?vue&type=style&index=0&id=97f109d0&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport Constants from '@/services/Constants';\nimport { PauseInfo } from '@/model/VideoLesson';\nimport {\n  computed, defineComponent, onBeforeUnmount, ref,\n} from 'vue';\nimport VideoPlayer from './VideoPlayer.vue';\n\nconst DEFAULT_PAUSE_DURATION = Constants.DefaultPauseDuration;\n\ntype PlaySegment = {\n  from: number;\n  to: number;\n  speed: number;\n  pause: PauseInfo | null;\n}\nfunction computePlaySegments(from: number, to: number, speed: number, pauses: PauseInfo[]) {\n  const segs: PlaySegment[] = [];\n\n  function nextPauseIndex(prevIndex: number): number {\n    const pTime = Math.max((pauses[prevIndex]?.time ?? 0), from);\n    let pauseIndex = prevIndex + 1;\n    for (; pauseIndex < pauses.length; pauseIndex += 1) {\n      const pi = pauses[pauseIndex];\n      if (pi.time > pTime) break;\n    }\n    return pauseIndex;\n  }\n\n  let segStartTime = from;\n  let pauseIndex = nextPauseIndex(-1);\n  while (pauseIndex < pauses.length) {\n    segs.push({\n      from: segStartTime,\n      to: pauses[pauseIndex].time,\n      speed,\n      pause: pauses[pauseIndex],\n    });\n    segStartTime = pauses[pauseIndex].time;\n    pauseIndex = nextPauseIndex(pauseIndex);\n  }\n  segs.push({\n    from: segStartTime,\n    to,\n    speed,\n    pause: null,\n  });\n\n  return segs;\n}\n\nexport default defineComponent({\n  name: 'PausingVideoPlayer',\n  components: { VideoPlayer },\n  props: {\n    videoSrc: {\n      default: '',\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: (canvasCtx: CanvasRenderingContext2D) => {\n        if (!canvasCtx) return;\n\n        /* eslint-disable no-param-reassign */\n        canvasCtx.strokeStyle = 'rgba(250, 200, 250, 0.95)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n        /* eslint-enable no-param-reassign */\n      },\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n    maxHeight: {\n      type: String,\n    },\n  },\n  emits: ['playback-completed', 'progress', 'pause-hit', 'pause-end'],\n  setup(props, { emit }) {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n\n    let playTimeoutId = undefined as undefined | number;\n\n    function setTime(time: number) {\n      const vidPlayer = videoPlayer.value;\n      clearTimeout(playTimeoutId);\n      if (vidPlayer) vidPlayer.setTime(time);\n      emit('progress', time);\n    }\n\n    function onProgress(time: number) {\n      emit('progress', time);\n    }\n\n    function playSegment(seg: PlaySegment, delaySecs: number, emitResume?: boolean, onPlayStart?: () => void) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n\n      clearTimeout(playTimeoutId);\n      playTimeoutId = window.setTimeout(() => {\n        if (emitResume ?? false) {\n          emit('pause-end');\n        }\n        vidPlayer.playVideo(seg.from, seg.to, seg.speed);\n        if (onPlayStart) onPlayStart();\n      }, 1000 * delaySecs);\n    }\n    onBeforeUnmount(() => {\n      clearTimeout(playTimeoutId);\n    });\n\n    let playingSegments: PlaySegment[] = [];\n    let playingSegmentIndex = 0;\n\n    function play(\n      from: number,\n      to: number,\n      speed: number,\n      pauses: Array<PauseInfo>,\n      playDelaySecs: number,\n      onPlayStart?: () => void,\n    ) {\n      clearTimeout(playTimeoutId);\n      setTime(from);\n      playingSegments = computePlaySegments(from, to, speed, pauses);\n      playingSegmentIndex = 0;\n\n      playSegment(playingSegments[playingSegmentIndex], playDelaySecs, false, onPlayStart);\n    }\n    function onSegmentPlaybackCompleted() {\n      const { pause, to } = playingSegments[playingSegmentIndex];\n      playingSegmentIndex += 1;\n      if (playingSegmentIndex >= playingSegments.length) {\n        setTime(to);\n        emit('playback-completed');\n        return;\n      }\n\n      if (!pause) throw new Error('Expected there to be a pause obj');\n      const nextSeg = playingSegments[playingSegmentIndex];\n\n      emit('pause-hit', pause);\n      const manualResume = pause.manualResume ?? false;\n      if (!manualResume) {\n        playSegment(nextSeg, pause.pauseDuration ?? DEFAULT_PAUSE_DURATION, true);\n      }\n    }\n\n    const currentPose = computed(() => videoPlayer.value?.currentPose ?? null);\n\n    return {\n      videoPlayer,\n      setTime,\n      onProgress,\n      onSegmentPlaybackCompleted,\n      play,\n      currentPose,\n    };\n  },\n  methods: {\n    getVideoDimensions() {\n      return (this.$refs.videoPlayer as typeof VideoPlayer)?.getVideoDimensions();\n    },\n    getVideoTime(): number {\n      return (this.videoPlayer as any)?.getVideoTime() ?? 0;\n    },\n  },\n});\n","import { render } from \"./PausingVideoPlayer.vue?vue&type=template&id=caebeb90\"\nimport script from \"./PausingVideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./PausingVideoPlayer.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"is-relative webcam-box\">\n    <video\n      ref=\"videoE\" muted disablePictureInPicture\n      :style=\"{\n        'max-height': maxHeight,\n        'max-width': '100%',\n      }\"\n    ></video>\n    <div class=\"is-overlay\" v-if=\"webcamStatus !== 'running'\">\n      <div class=\"vcenter-parent\">\n        <div class=\"notification\" v-if=\"this.webcamStartError !== null\">\n          {{this.webcamStartError}}\n        </div>\n        <button\n          v-if=\"showStartWebcamButton\"\n          @click=\"startWebcam\"\n          class=\"button is-primary\"\n          v-show=\"webcamStatus !== 'running'\"\n          :class=\"{'is-loading': webcamStatus==='loading'}\">\n          Start Webcam\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, ref, watch,\n} from 'vue';\n\nimport webcamProvider from '@/services/WebcamProvider';\n\nexport default defineComponent({\n  name: 'WebcamBox',\n  props: {\n    showStartWebcamButton: {\n      type: Boolean,\n      default: true,\n    },\n    enableRecordButton: {\n      type: Boolean,\n      default: false,\n    },\n    maxHeight: {\n      type: String,\n    },\n  },\n  setup() {\n    // const enableRecordButton = toRefs(props);\n\n    const videoE = ref(null as null | HTMLVideoElement);\n    const webcamStartError = ref(null as null | any);\n\n    onMounted(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      if (webcamProvider.webcamStatus.value === 'running') {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    watch(webcamProvider.webcamStatus, (status) => {\n      if (status === 'running' && videoE.value) {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    onBeforeUnmount(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      webcamProvider.disconnectVideoElement(videoE.value);\n    });\n\n    return {\n      videoE,\n      webcamStartError,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n    };\n  },\n  computed: {\n    webcamStarted() {\n      return (this as any).webcamStatus === 'stopped';\n    },\n  },\n  methods: {\n    async startWebcam() {\n      this.webcamStartError = null;\n\n      try {\n        await webcamProvider.startWebcam();\n      } catch (e) {\n        this.webcamStartError = e;\n        return e;\n      }\n\n      if (!this.videoE) throw new Error('videoE is null');\n      await webcamProvider.connectVideoElement(this.videoE);\n\n      return false;\n    },\n    playVideo() {\n      if (!this.videoE) throw new Error('videoE is null');\n      this.videoE.play();\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.webcam-box {\n\n  max-width: 100%;\n  max-height: 100%;\n\n  video {\n    background: rgba(128, 128, 128, 0.5);\n    width: 1280px;\n    // height: 720px;\n    max-height: 100%;\n    max-width: 100%;\n\n    transform: scaleX(-1);\n  }\n}\n</style>\n","\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, ref, watch,\n} from 'vue';\n\nimport webcamProvider from '@/services/WebcamProvider';\n\nexport default defineComponent({\n  name: 'WebcamBox',\n  props: {\n    showStartWebcamButton: {\n      type: Boolean,\n      default: true,\n    },\n    enableRecordButton: {\n      type: Boolean,\n      default: false,\n    },\n    maxHeight: {\n      type: String,\n    },\n  },\n  setup() {\n    // const enableRecordButton = toRefs(props);\n\n    const videoE = ref(null as null | HTMLVideoElement);\n    const webcamStartError = ref(null as null | any);\n\n    onMounted(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      if (webcamProvider.webcamStatus.value === 'running') {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    watch(webcamProvider.webcamStatus, (status) => {\n      if (status === 'running' && videoE.value) {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    onBeforeUnmount(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      webcamProvider.disconnectVideoElement(videoE.value);\n    });\n\n    return {\n      videoE,\n      webcamStartError,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n    };\n  },\n  computed: {\n    webcamStarted() {\n      return (this as any).webcamStatus === 'stopped';\n    },\n  },\n  methods: {\n    async startWebcam() {\n      this.webcamStartError = null;\n\n      try {\n        await webcamProvider.startWebcam();\n      } catch (e) {\n        this.webcamStartError = e;\n        return e;\n      }\n\n      if (!this.videoE) throw new Error('videoE is null');\n      await webcamProvider.connectVideoElement(this.videoE);\n\n      return false;\n    },\n    playVideo() {\n      if (!this.videoE) throw new Error('videoE is null');\n      this.videoE.play();\n    },\n  },\n});\n","import { render } from \"./WebcamBox.vue?vue&type=template&id=0a81f5cd\"\nimport script from \"./WebcamBox.vue?vue&type=script&lang=ts\"\nexport * from \"./WebcamBox.vue?vue&type=script&lang=ts\"\n\nimport \"./WebcamBox.vue?vue&type=style&index=0&id=0a81f5cd&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  computed, ComputedRef, defineComponent, nextTick, onBeforeUnmount, onMounted, Ref, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport InstructionCarousel, { Instruction } from '@/components/elements/InstructionCarousel.vue';\nimport PausingVideoPlayer from '@/components/elements/PausingVideoPlayer.vue';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\nimport { Activity, PauseInfo } from '@/model/VideoLesson';\nimport Constants from '@/services/Constants';\n\nconst ActivityPlayState = Object.freeze({\n  AwaitingStart: 'AwaitingStart',\n  PendingStart: 'PendingStart',\n  Playing: 'Playing',\n  ActivityEnded: 'ActivityEnded',\n});\n\nexport default defineComponent({\n  name: 'ActivityVideoPlayer',\n  emits: ['progress', 'activityEnded'],\n  props: {\n    motion: { type: Object },\n    lesson: { type: Object },\n    activity: { type: Object },\n    defaultPauseDuration: { type: Number, default: 1.5 },\n    maxHeight: { type: String, default: '400px' },\n  },\n  components: {\n    PausingVideoPlayer,\n    InstructionCarousel,\n    WebcamBox,\n  },\n  setup(props, { emit }) {\n    const { motion, lesson, activity } = toRefs(props);\n    const state = ref(ActivityPlayState.AwaitingStart);\n    const activityFinished = computed(() => state.value === ActivityPlayState.ActivityEnded);\n    const awaitingStart = computed(() => state.value === ActivityPlayState.AwaitingStart);\n    const isPlaying = computed(() => state.value === ActivityPlayState.Playing);\n    const videoPlayer = ref(null as null | typeof PausingVideoPlayer);\n    const webcamBox = ref(null as null | typeof WebcamBox);\n    const videoTime = ref(0);\n\n    const pauseInstructs = ref([] as Instruction[]);\n    const onPlaybackCompleted = () => {\n      state.value = ActivityPlayState.ActivityEnded;\n    };\n    const onPauseHit = (pause: PauseInfo) => {\n      console.log(`Hit pause${pause}`);\n      if (pause.instruction) pauseInstructs.value.push({ id: pause.time, text: pause.instruction });\n    };\n    const onPauseEnded = () => pauseInstructs.value.splice(0);\n\n    const startTime = computed(() => activity?.value?.startTime ?? 0);\n\n    function reset(newTime?: number) {\n      pauseInstructs.value.splice(0);\n      state.value = ActivityPlayState.AwaitingStart;\n      const time = newTime ?? startTime.value ?? 0;\n\n      if (videoPlayer.value) videoPlayer.value.setTime(time);\n    }\n\n    watchEffect(() => reset(startTime.value));\n\n    return {\n      webcamBox,\n      videoPlayer,\n      videoTime,\n      state,\n      ActivityPlayState,\n      awaitingStart,\n      activityFinished,\n      pauseInstructs,\n      isPlaying,\n\n      reset,\n      startTime,\n\n      onPlaybackCompleted,\n      onPauseHit,\n      onPauseEnded,\n    };\n  },\n  computed: {\n    showingWebcam() {\n      return (this as any)?.activity?.userVisual !== 'none';\n    },\n    emphasizedJoints(): number[] { return this.activity?.emphasizedJoints ?? []; },\n    instructions(): Instruction[] {\n      const mActivity = this.activity;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if ((this.state === ActivityPlayState.AwaitingStart || this.state === ActivityPlayState.PendingStart) && mActivity.startInstruction) {\n        let text = mActivity.startInstruction;\n        if (this.state === ActivityPlayState.PendingStart) { text += '...'; }\n        instructs.push({\n          id: 1,\n          text,\n        });\n      } else if (this.state === ActivityPlayState.Playing && mActivity.playingInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.playingInstruction,\n        });\n      } else if (this.state === ActivityPlayState.ActivityEnded && mActivity.endInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.endInstruction,\n        });\n      }\n\n      instructs.concat(this.pauseInstructs);\n\n      return instructs;\n    },\n    timedInstructions(): Instruction[] {\n      const mActivity = this.activity as unknown as Activity | null;\n      const time = this.videoTime;\n\n      if (!mActivity) return [];\n\n      const activeTimedInstructions = mActivity.timedInstructions?.map(\n        (ti, i) => ({\n          id: i,\n          text: ti.text,\n          start: ti.startTime,\n          end: ti.endTime,\n        })\n      ).filter((ti) => ti.start <= time && time < ti.end) ?? [];\n\n      // console.log(`TimedI updated for time ${time}, count=${activeTimedInstructions.length}`, mActivity.timedInstructions);\n\n      return activeTimedInstructions;\n    },\n  },\n  methods: {\n    async startWebcam() {\n      return this.webcamBox?.startWebcam() ?? new Error('WebcamBox is null');\n    },\n    play(delay?: number | undefined) {\n      this.reset();\n      const vidPlayer = this.videoPlayer;\n      const vidActivity = this.activity as Activity | null;\n      if (!vidActivity) return;\n      if (!vidPlayer) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer is null');\n        return;\n      }\n\n      this.state = ActivityPlayState.PendingStart;\n\n      vidPlayer.play(\n        vidActivity.startTime,\n        vidActivity.endTime,\n        vidActivity.practiceSpeed ?? 1,\n        vidActivity.pauses ?? [],\n        delay ?? Constants.DefaultPauseDuration,\n        () => {\n          this.state = ActivityPlayState.Playing;\n        },\n      );\n    },\n    onProgress(val: number) {\n      this.videoTime = val;\n      this.$emit('progress', val);\n    },\n  },\n});\n\n","import { render } from \"./ActivityVideoPlayer.vue?vue&type=template&id=69bd566a\"\nimport script from \"./ActivityVideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./ActivityVideoPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./ActivityVideoPlayer.vue?vue&type=style&index=0&id=69bd566a&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"segmented-progress-bar\">\n    <progress\n      v-for=\"seg in segmentsData\"\n      :key=\"seg.id\"\n      :class=\"[{ 'is-disabled': !enableAll && !seg.enabled, [seg.cssClass]: enableAll || seg.enabled, 'is-dark': !enableAll && !seg.enabled}, ]\"\n      class=\"progress is-large\"\n      :max=\"seg.max - seg.min\"\n      :value=\"progress - seg.min\"\n      :style=\"{ 'flex-grow': (seg.max - seg.min) }\"\n    ></progress>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, toRefs } from 'vue';\nimport DanceLesson, { Activity } from '@/model/VideoLesson';\n\nexport interface ProgressSegmentData {\n  min: number;\n  max: number;\n  enabled: boolean;\n}\n\nexport function calculateProgressSegments(lesson: DanceLesson, activity: Activity) {\n  if (!lesson) return [];\n\n  let last = undefined as undefined | number;\n  const segs = lesson.segmentBreaks.map((timestamp, i) => {\n    let segData = undefined as undefined | ProgressSegmentData;\n    if (last !== undefined) {\n      segData = {\n        min: last,\n        max: timestamp,\n        enabled: activity?.focusedSegments ? activity.focusedSegments.indexOf(i - 1) !== -1 : true,\n      };\n    }\n    last = timestamp;\n    return segData;\n  }).filter((x) => x !== undefined);\n\n  return segs as ProgressSegmentData[];\n}\n\nconst cssClassOptions = [\n  'is-info',\n  'is-success',\n  'is-warning',\n  'is-primary',\n  'is-danger',\n];\n\nexport default defineComponent({\n  name: 'SegmentedProgressBar',\n  props: {\n    segments: {\n      default: Array,\n      type: Array,\n    },\n    progress: {\n      default: 0,\n      type: Number,\n    },\n    enableAll: {\n      default: false,\n      type: Boolean,\n    },\n  },\n  setup(props) {\n    const {\n      segments,\n    } = toRefs(props);\n\n    const segmentsData = computed(\n      () => segments.value.map(\n        (seg, i) => ({\n          id: i,\n          cssClass: cssClassOptions[i % cssClassOptions.length],\n          ...(seg as ProgressSegmentData),\n        }),\n      ),\n    );\n\n    return {\n      segmentsData,\n    };\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n.segmented-progress-bar {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n\n  progress.progress {\n    border-radius: 0.5rem;\n    flex-basis: 10px;\n    margin-bottom: auto;\n    // border: 2px solid #BBB;\n\n    -webkit-appearance: none;\n    appearance: none;\n\n    &.is-disabled::-webkit-progress-bar,\n    &.is-disabled {\n      background: #888;\n    }\n\n    &.is-disabled::-moz-progress-bar,\n    &.is-disabled::-webkit-progress-value,\n    &.is-disabled::-ms-fill {\n      background: #888;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent, computed, toRefs } from 'vue';\nimport DanceLesson, { Activity } from '@/model/VideoLesson';\n\nexport interface ProgressSegmentData {\n  min: number;\n  max: number;\n  enabled: boolean;\n}\n\nexport function calculateProgressSegments(lesson: DanceLesson, activity: Activity) {\n  if (!lesson) return [];\n\n  let last = undefined as undefined | number;\n  const segs = lesson.segmentBreaks.map((timestamp, i) => {\n    let segData = undefined as undefined | ProgressSegmentData;\n    if (last !== undefined) {\n      segData = {\n        min: last,\n        max: timestamp,\n        enabled: activity?.focusedSegments ? activity.focusedSegments.indexOf(i - 1) !== -1 : true,\n      };\n    }\n    last = timestamp;\n    return segData;\n  }).filter((x) => x !== undefined);\n\n  return segs as ProgressSegmentData[];\n}\n\nconst cssClassOptions = [\n  'is-info',\n  'is-success',\n  'is-warning',\n  'is-primary',\n  'is-danger',\n];\n\nexport default defineComponent({\n  name: 'SegmentedProgressBar',\n  props: {\n    segments: {\n      default: Array,\n      type: Array,\n    },\n    progress: {\n      default: 0,\n      type: Number,\n    },\n    enableAll: {\n      default: false,\n      type: Boolean,\n    },\n  },\n  setup(props) {\n    const {\n      segments,\n    } = toRefs(props);\n\n    const segmentsData = computed(\n      () => segments.value.map(\n        (seg, i) => ({\n          id: i,\n          cssClass: cssClassOptions[i % cssClassOptions.length],\n          ...(seg as ProgressSegmentData),\n        }),\n      ),\n    );\n\n    return {\n      segmentsData,\n    };\n  },\n});\n\n","import { render } from \"./SegmentedProgressBar.vue?vue&type=template&id=60b0197e\"\nimport script from \"./SegmentedProgressBar.vue?vue&type=script&lang=ts\"\nexport * from \"./SegmentedProgressBar.vue?vue&type=script&lang=ts\"\n\nimport \"./SegmentedProgressBar.vue?vue&type=style&index=0&id=60b0197e&lang=scss\"\nscript.render = render\n\nexport default script","\nimport VideoLesson, { Activity } from '@/model/VideoLesson';\nimport { defineComponent } from 'vue';\nimport ActivityVideoPlayer from '@/components/elements/ActivityVideoPlayer.vue';\nimport SegmentedProgressBar, { calculateProgressSegments, ProgressSegmentData } from '@/components/elements/SegmentedProgressBar.vue';\nimport webcamProvider from '@/services/WebcamProvider';\n\nfunction range(size: number, startAt = 0) {\n  return [...Array(size).keys()].map((i) => i + startAt);\n}\n\nexport default defineComponent({\n  name: 'VideoLessonPlayer',\n  components: {\n    SegmentedProgressBar,\n    ActivityVideoPlayer,\n  },\n  props: {\n    videoEntry: { type: Object },\n    videoLesson: { type: Object },\n    maxVideoHeight: { type: String, default: 'none' },\n    enableCompleteLesson: { type: Boolean, default: false },\n  },\n  emits: ['lesson-completed', 'previous-activity', 'next-activity'],\n  computed: {\n    nearbyActivityIndices(): number[] {\n      const margin = 1;\n      const minIndex = Math.max(0, this.activeActivityIndex - margin);\n      const maxActivityIndex = (this.lesson?.activities.length ?? 0) - 1;\n      const maxIndex = Math.min(maxActivityIndex, this.activeActivityIndex + margin);\n      const count = (maxIndex + 1) - minIndex;\n      let indices: number[] = [];\n      if (minIndex > 0) indices = indices.concat([0, -1]);\n      indices = indices.concat(range(count, minIndex));\n      if (maxIndex < maxActivityIndex) indices = indices.concat([-1, maxActivityIndex]);\n      return indices;\n    },\n    lesson() {\n      const lesson = (this.$props.videoLesson ?? null) as null | VideoLesson;\n      return lesson;\n    },\n    activeActivity() {\n      const lesson = (this.$props.videoLesson ?? null) as null | VideoLesson;\n      const activityIndex = this.activeActivityIndex as number;\n      const activity = lesson?.activities[activityIndex] ?? null as null | Activity;\n      return activity;\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lesson) return calculateProgressSegments(this.lesson, this.activeActivity);\n      return [];\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < (this.lesson?.activities.length ?? 0);\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    needsStartWebcam(): boolean {\n      return this.activeActivity !== null && this.activeActivity?.userVisual !== 'none' && webcamProvider.webcamStatus.value !== 'running';\n    },\n  },\n  data() {\n    return {\n      activeActivityIndex: 0,\n      activityProgress: 0,\n      webcamStatus: webcamProvider.webcamStatus,\n    };\n  },\n  methods: {\n    onProgress(val: number) { this.activityProgress = val; },\n    playActivity() { (this.$refs.activityVideoPlayer as any).play(); },\n    nextActivity() {\n      if (this.hasNextActivity) this.activeActivityIndex += 1;\n      else this.$emit('lesson-completed');\n    },\n    gotoActivity(i: number) {\n      this.activeActivityIndex = i;\n    },\n    async startWebcam() {\n      return (this.$refs.activityVideoPlayer as any)?.startWebcam();\n    },\n    repeat() {\n      const vidPlayer = (this.$refs.activityVideoPlayer as any);\n      vidPlayer.reset();\n      vidPlayer.play();\n    },\n  },\n});\n","import { render } from \"./VideoLessonPlayer.vue?vue&type=template&id=3b23f3ca\"\nimport script from \"./VideoLessonPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./VideoLessonPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./VideoLessonPlayer.vue?vue&type=style&index=0&id=3b23f3ca&lang=scss\"\nscript.render = render\n\nexport default script","import VideoLesson, { Activity } from '@/model/VideoLesson';\n\nimport videoDatabase from '@/model/videoDatabase.json';\nimport defaultLessons from '@/model/bakedInLessons.json';\n\nimport { computed, reactive } from 'vue';\nimport Utils from './Utils';\n\nexport interface DatabaseEntry {\n  title: string;\n  clipName: string;\n  clipPath: string;\n  frameCount: number;\n  fps: number;\n  duration: number;\n  width: number;\n  height: number;\n  videoSrc: string;\n  thumbnailSrc: string;\n}\n\nexport class MotionDatabase {\n  readonly motionsMap = reactive(new Map<string, DatabaseEntry>());\n\n  readonly motions = computed(() => Array.from(this.motionsMap.values()));\n\n  readonly motionNames = computed(() => this.motions.value.map((dbEntry) => dbEntry.clipName));\n\n  readonly lessonsByVideo = reactive(new Map<string, VideoLesson[]>());\n\n  readonly lessonsById = reactive(new Map<string, VideoLesson>());\n\n  constructor() {\n\n    videoDatabase.forEach((videoEntry) => {\n      this.motionsMap.set(videoEntry.clipName, {\n        videoSrc: `videos/${videoEntry.clipPath}`,\n        ...videoEntry,\n        thumbnailSrc: `thumbs/${videoEntry.thumbnailSrc}`,\n      });\n      this.lessonsByVideo.set(videoEntry.clipName, []);\n    });\n\n    console.log(`Motion database: loaded ${this.motionsMap.size} videos`);\n    defaultLessons.forEach((lesson) => {\n      this.upsertLesson({\n        source: 'builtin',\n        ...lesson,\n      } as VideoLesson);\n    });\n    console.log(`Motion database: loaded ${defaultLessons.length} built-in lessons`);\n\n    const customLessonCount = this.loadCustomLessons();\n    console.log(`Motion database: loaded ${customLessonCount} custom lessons`);\n  }\n\n  hasLesson(lesson: VideoLesson): boolean {\n    const lessonList = this.lessonsByVideo.get(lesson.header.clipName) ?? [];\n    const lessonIndex = lessonList.findIndex((val) => val._id === lesson._id);\n    return lessonIndex !== -1;\n  }\n\n  upsertLesson(lesson: VideoLesson) {\n    const lessonList = this.lessonsByVideo.get(lesson.header.clipName) ?? [];\n    const existingIndex = lessonList.findIndex((les) => les._id === lesson._id);\n    if (existingIndex !== -1) lessonList[existingIndex] = lesson;\n    else lessonList.push(lesson);\n    this.lessonsByVideo.set(lesson.header.clipName, lessonList);\n\n    this.lessonsById.set(lesson._id, lesson);\n  }\n\n  removeLesson(lesson: VideoLesson) {\n    const lessonList = this.lessonsByVideo.get(lesson.header.clipName) ?? [];\n    const lessonIndex = lessonList.findIndex((val) => val._id === lesson._id);\n    if (lessonIndex !== -1) lessonList.splice(lessonIndex, 1);\n    this.lessonsByVideo.set(lesson.header.clipName, lessonList);\n\n    this.lessonsById.delete(lesson._id);\n  }\n\n  getLessons(videoEntry: DatabaseEntry | string) {\n    let lessons = undefined as undefined | VideoLesson[];\n    if (typeof videoEntry === 'object' && videoEntry !== null) lessons = this.lessonsByVideo.get(videoEntry.clipName);\n    else lessons = this.lessonsByVideo.get(videoEntry);\n    return lessons;\n  }\n\n  private static getCustomLessonIdsList(): Array<string> {\n    return JSON.parse(window.localStorage.getItem('custom-lessons') ?? '[]');\n  }\n\n  private static saveCustomLessonsIdsList(customLessonIds: Array<string>) {\n    window.localStorage.setItem('custom-lessons', JSON.stringify(customLessonIds));\n  }\n\n  private loadCustomLessons(): number {\n    const customLessonIds = MotionDatabase.getCustomLessonIdsList();\n    let countLoaded = 0;\n    for (let i = 0; i < customLessonIds.length; i += 1) {\n      const id = customLessonIds[i];\n      const custLesson = localStorage.getItem(`lesson-${id}`);\n      if (custLesson) {\n        this.upsertLesson(JSON.parse(custLesson) as VideoLesson);\n        countLoaded += 1;\n      }\n    }\n    return countLoaded;\n  }\n\n  validateLesson(lesson: VideoLesson) {\n    if (!lesson) throw new Error('Lesson is null or undefined');\n    const clipName = lesson?.header?.clipName;\n    if (!clipName) throw new Error('Clip name missing');\n    if (!this.motionsMap.has(clipName)) throw new Error(`Matching video clip not found for ${clipName}`);\n    if (!Array.isArray(lesson.activities) || lesson.activities.length < 1) throw new Error('Lesson contains no activities');\n  }\n\n  saveCustomLesson(lesson: VideoLesson) {\n    this.upsertLesson(lesson);\n    window.localStorage.setItem(`lesson-${lesson._id}`, JSON.stringify(lesson));\n\n    const custLessonIds = MotionDatabase.getCustomLessonIdsList();\n    if (custLessonIds.indexOf(lesson._id) === -1) {\n      console.log(`Added custom lesson ${lesson.header.lessonTitle} id=${lesson._id} to localstorage`);\n      custLessonIds.push(lesson._id);\n    } else {\n      console.log(`Updated custom lesson ${lesson.header.lessonTitle} id=${lesson._id} in localstorage`);\n    }\n    MotionDatabase.saveCustomLessonsIdsList(custLessonIds);\n  }\n\n  deleteCustomLesson(lesson: VideoLesson) {\n    this.removeLesson(lesson);\n\n    const custLessonIds = MotionDatabase.getCustomLessonIdsList();\n    const lessonIdIndex = custLessonIds.indexOf(lesson._id);\n    if (lessonIdIndex !== -1) custLessonIds.splice(lessonIdIndex, 1);\n    MotionDatabase.saveCustomLessonsIdsList(custLessonIds);\n\n    window.localStorage.removeItem(`lesson-${lesson._id}`);\n  }\n}\n\nexport function createBlankActivity(motion: DatabaseEntry, title: string): Activity {\n  return {\n    title,\n    startTime: 0,\n    endTime: motion.duration,\n    demoVisual: 'video',\n    userVisual: 'none',\n    practiceSpeed: 1,\n  };\n}\n\nexport function createBlankLesson(videoEntry: DatabaseEntry): VideoLesson {\n  return {\n    _id: Utils.uuidv4(),\n    source: 'custom',\n    header: {\n      clipName: videoEntry.clipName,\n      lessonTitle: 'New Lesson',\n    },\n    segmentBreaks: [0, videoEntry.duration],\n    activities: [createBlankActivity(videoEntry, 'Activity 1')],\n    fps: videoEntry.fps,\n  };\n}\n\nconst db = new MotionDatabase();\nexport default db;\n","import { computed, reactive, ref } from 'vue';\nimport optionsManager from '@/services/OptionsManager';\nimport motionDB, { DatabaseEntry, MotionDatabase } from '@/services/MotionDatabase';\nimport VideoLesson from '@/model/VideoLesson';\nimport { Workflow, WorkflowStage, WorkflowStep } from '@/model/Workflow';\nimport workflowsJson from '@/model/workflows.json';\nimport eventHub, { EventNames } from './EventHub';\nimport Utils from './Utils';\n\nconst defaultWorkflows = workflowsJson as Workflow[];\n\nexport interface TrackingWorkflowStep extends WorkflowStep {\n  status: 'notstarted' | 'inprogress' | 'completed';\n}\n\nexport interface TrackingWorkflowStage extends WorkflowStage {\n  steps: TrackingWorkflowStep[];\n}\n\nexport interface TrackingWorkflow extends Workflow {\n  stages: TrackingWorkflowStage[];\n}\n\nconst TestWorkflow = Object.freeze(\n  {\n    title: '4-Tiktoks (Example Workflow)',\n    id: 'e61789dhgbuiqd6129',\n    stages: [{\n      title: 'Introduction',\n      steps: [{\n        title: 'Welcome',\n        type: 'InstructionOnly',\n        instructions: {\n          heading: 'Test Experiment',\n          text: 'This an example experiment. You\\'ll be taken through '\n          + 'a flow of activites and will be shown instructions '\n          + 'along the way.\\n'\n          + \"First, you'll learn 4 dances\\n\"\n          + \"Then, you'll be asked to upload a video of you performing the dances\",\n        },\n      }],\n    }, {\n      title: 'Learning Phase',\n      steps: [{\n        title: 'Savage Love',\n        type: 'VideoLessonReference',\n        // instructions: {},\n        videoLessonReference: {\n          clipName: 'derulo',\n          lessonId: 'cde1c09d-299a-4aed-8ad2-efa6c9d1b276',\n        },\n      }, {\n        title: \"It's a Fit\",\n        type: 'VideoLessonReference',\n        // instructions: {},\n        videoLessonReference: {\n          clipName: 'itsafit',\n          lessonId: '14cac0d6-ec00-41ae-ac80-e738d5cc09a1',\n        },\n      }, {\n        title: 'Renegade',\n        type: 'VideoLessonReference',\n        videoLessonReference: {\n          clipName: 'renegade',\n          lessonId: '4ecac1f9-b32c-42de-b290-d97c883437e5',\n        },\n      }, {\n        title: 'Unh-hunh',\n        type: 'VideoLessonReference',\n        videoLessonReference: {\n          clipName: 'unhhunh',\n          lessonId: '580baf76-412f-41c3-9f50-54ebf01ace46',\n        },\n      }],\n    }, {\n      title: 'Feedback',\n      steps: [{\n        title: 'Performance',\n        type: 'UploadTask',\n        upload: {\n          identifier: 'end-upload',\n          prompt: 'Upload yourself performing all these dances in order',\n        },\n      }],\n    }],\n  } as Workflow,\n);\n\nconst sampleUploadWorkflow: Workflow = {\n  id: '1472189',\n  stages: [\n    {\n      title: 'Upload',\n      steps: [{\n        title: 'SampleUpload',\n        type: 'UploadTask',\n        upload: {\n          identifier: 'UploadIdentifier123',\n          prompt: 'Upload Something PLzzz',\n        },\n      }],\n    },\n  ],\n  title: 'SingleUpload',\n};\n\nexport class WorkflowManager {\n\n  private bakedInWorkflows = new Set<string>();\n\n  private workflows = reactive(new Map() as Map<string, Workflow>);\n\n  public allWorkflows = computed(() => new Array(...this.workflows.values()))\n\n  public activeFlow = ref(null as TrackingWorkflow | null);\n\n  constructor() {\n    this.loadWorkflows();\n  }\n\n  private loadWorkflows() {\n    for (let i = 0; i < defaultWorkflows.length; i += 1) {\n      const workflow = defaultWorkflows[i] as Workflow;\n      this.workflows.set(workflow.id, workflow);\n      this.bakedInWorkflows.add(workflow.id);\n    }\n    this.workflows.set(TestWorkflow.id, TestWorkflow);\n    this.bakedInWorkflows.add(TestWorkflow.id);\n    this.workflows.set(sampleUploadWorkflow.id, sampleUploadWorkflow);\n    this.bakedInWorkflows.add(sampleUploadWorkflow.id);\n\n    const customWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    for (let i = 0; i < customWorkflowIds.length; i += 1) {\n      this.tryLoadCustomLesson(customWorkflowIds[i]);\n    }\n  }\n\n  public isCustomWorkflow(id: string) {\n    return !this.bakedInWorkflows.has(id);\n  }\n\n  public reloadCustomWorkflow(id: string) {\n    if (!this.isCustomWorkflow(id)) return;\n\n    if (!WorkflowManager.hasSavedCustomLesson(id)) {\n      this.workflows.delete(id);\n    } else {\n      this.tryLoadCustomLesson(id);\n    }\n  }\n\n  private static getCustomWorkflowIdsList(): Array<string> {\n    return JSON.parse(window.localStorage.getItem('custom-workflows') ?? '[]');\n  }\n\n  private static saveCustomWorkflowIdsList(customLessonIds: Array<string>) {\n    window.localStorage.setItem('custom-workflows', JSON.stringify(customLessonIds));\n  }\n\n  public static hasSavedCustomLesson(id: string) {\n    const custWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    return custWorkflowIds.indexOf(id) !== -1;\n  }\n\n  public addSessionWorkflow(workflow: Workflow) {\n    this.workflows.set(workflow.id, workflow);\n  }\n\n  public tryLoadCustomLesson(id: string) {\n    try {\n      const workflowRaw = window.localStorage.getItem(`workflow-${id}`);\n      if (!workflowRaw) throw new Error(`No workflow found with id: ${id}`);\n      const workflow = JSON.parse(workflowRaw);\n      this.addSessionWorkflow(workflow);\n    } catch (e) {\n      console.warn('Error loading custom lesson', id, e);\n    }\n  }\n\n  public deleteCustomWorkflow(id: string) {\n    this.workflows.delete(id);\n    window.localStorage.removeItem(`workflow-${id}`);\n    const custWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    const index = custWorkflowIds.indexOf(id);\n    if (index !== -1) {\n      custWorkflowIds.splice(index, 1);\n      WorkflowManager.saveCustomWorkflowIdsList(custWorkflowIds);\n    }\n  }\n\n  public upsertCustomWorkflow(workflow: Workflow) {\n    this.addSessionWorkflow(workflow);\n    this.workflows.set(workflow.id, workflow);\n    window.localStorage.setItem(`workflow-${workflow.id}`, JSON.stringify(workflow));\n\n    const custWorkflowIds = WorkflowManager.getCustomWorkflowIdsList();\n    if (!WorkflowManager.hasSavedCustomLesson(workflow.id)) {\n      console.log(`Added custom lesson ${workflow.title} id=${workflow.id} to localstorage`);\n      custWorkflowIds.push(workflow.id);\n    } else {\n      console.log(`Updated custom lesson ${workflow.title} id=${workflow.id} in localstorage`);\n    }\n    WorkflowManager.saveCustomWorkflowIdsList(custWorkflowIds);\n  }\n\n  public setActiveFlow(workflowId: string) {\n    const matchingWorkflow = this.workflows.get(workflowId);\n\n    if (!matchingWorkflow) {\n      console.error(`setActiveFlow: Couldn't find workflow with id ${workflowId}`);\n      return false;\n    }\n\n    const flow = Utils.deepCopy(matchingWorkflow);\n    const trackingFlow = {\n      ...flow,\n      stages: flow.stages.map((stage) => ({\n        ...stage,\n        steps: stage.steps.map((step) => ({\n          ...step,\n          status: 'notstarted',\n        }) as TrackingWorkflowStep),\n      } as TrackingWorkflowStage)),\n    } as TrackingWorkflow;\n\n    trackingFlow.stages.forEach((stage) => {\n      const { steps } = stage;\n      const shuffleInfo = (stage as any).shuffle;\n      if (shuffleInfo) {\n        // Shuffle the sequences of steps, as appropiate\n        Utils.shuffleArray(steps, shuffleInfo.startIndex, shuffleInfo.endIndex);\n      }\n      stage.steps = steps;\n    });\n\n    this.activeFlow.value = trackingFlow;\n    return true;\n  }\n\n  public completeActivitesPriorToStageAndStep(stageIndex: number, stepIndex: number) {\n    if (!this.activeFlow.value) return;\n    const { stages } = this.activeFlow.value;\n    for (let i = 0; i < stages.length; i += 1) {\n      const { steps } = stages[i];\n      for (let j = 0; j < steps.length; j += 1) {\n        steps[j].status = i < stageIndex ? 'completed' : 'notstarted';\n        if (i === stageIndex) {\n          steps[j].status = j < stepIndex ? 'completed' : 'notstarted';\n        }\n      }\n    }\n  }\n}\n\nconst workflowManager = new WorkflowManager();\nexport default workflowManager;\n","<template>\n  <section class=\"section\">\n    <div class=\"container\">\n      <h1 class=\"title\">{{title}}</h1>\n      <h2 class=\"subtitle\" v-show=\"subtitle\">{{subtitle}}</h2>\n\n      <p class=\"block\"><strong>Instructions:</strong> {{prompt}}</p>\n\n      <div class=\"block\" v-if=\"state === 'Record'\">\n        <WebcamBox />\n\n        <div class=\"field is-grouped is-grouped-centered\" v-show=\"webcamStatus === 'running'\">\n          <p class=\"control\">\n            <span class=\"record-icon\" :class=\"{'is-recording': isRecording}\">\n            </span>\n            <!-- <span class=\"icon is-medium\" :class=\"{'has-text-danger': isRecording}\">\n              <FAIcon icon=\"record-vinyl\" size=\"lg\" pulse />\n            </span> -->\n          </p>\n          <p class=\"control\">\n            <button class=\"button animate-width\"\n              @click=\"toggleRecording\">\n\n               <span v-show=\"isRecording\">\n                Stop\n              </span>\n              <span v-show=\"!isRecording\">\n                Record\n              </span>\n\n              <!-- <span v-if=\"!isRecording\">Start Recording</span> -->\n            </button>\n          </p>\n        </div>\n      </div>\n      <video class=\"block flipped\" v-else controls :src=\"recordedObjectUrl\"></video>\n      <div class=\"block\" v-if=\"state === 'Review'\">\n        <div class=\"field is-grouped is-grouped-centered\">\n          <p class=\"control\">\n            <button class=\"button\" :disabled=\"isUploading\" @click=\"rerecord\">\n              Rerecord\n              <!-- <span class=\"icon is-medium\" :class=\"{'has-text-danger': isRecording}\">\n                <FAIcon icon=\"record-vinyl\" />\n              </span> -->\n              <!-- <span v-if=\"!isRecording\">Start Recording</span> -->\n            </button>\n          </p>\n          <p class=\"control\">\n            <button class=\"button is-primary\"\n              :disabled=\"isUploading\"\n              :class=\"{'is-loading': isUploading}\"\n              @click=\"uploadVideo\">\n              Upload Video\n            </button>\n          </p>\n        </div>\n\n        <div class=\"notification\" v-if=\"uploadError\">\n          <strong>Error Uploading Video:</strong>\n          {{uploadError}}\n        </div>\n      </div>\n      <div class=\"block has-text-centered\" v-if=\"state === 'Success'\">\n        <span class=\"icon\"><i class=\"fas fa-check\"></i></span> Upload Successful\n      </div>\n\n      <div class=\"block buttons is-right\" >\n        <!-- {{successfullyUploaded}} -->\n        <button v-show=\"!successfullyUploaded\" class=\"is-outlined button is-danger\" @click=\"$emit('upload-canceled')\">Cancel</button>\n        <button :disabled=\"!successfullyUploaded\" class=\"button is-primary\" @click=\"$emit('upload-completed')\">Done</button>\n      </div>\n\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport AzureUploader from '@/services/AzureUploader';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\n\nexport default defineComponent({\n  name: 'UploadScreen',\n  components: { WebcamBox },\n  emits: ['upload-canceled', 'upload-completed'],\n  props: {\n    title: {\n      type: String,\n      default: 'Video Upload',\n    },\n    subtitle: {\n      type: String,\n      default: null,\n    },\n    prompt: {\n      type: String,\n      default: 'Upload your video here',\n    },\n    uploadFilename: {\n      type: String,\n      default: null,\n    },\n  },\n  setup() {\n\n    const state = ref('Record' as 'Record' | 'Review' | 'Success');\n\n    const lastRecordedBlob = ref(null as Blob | null);\n    const recordedObjectUrl = ref('');\n    const isUploading = ref(false);\n    const uploadError = ref(null as null | any);\n    const successfullyUploaded = computed(() => state.value === 'Success');\n\n    return {\n      state,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n      lastRecordedBlob,\n      recordedObjectUrl,\n      isUploading,\n      uploadError,\n      successfullyUploaded,\n    };\n  },\n  methods: {\n    async toggleRecording() {\n      if (!webcamProvider.isRecording.value) {\n        await webcamProvider.startWebcam();\n        await webcamProvider.startRecording();\n      } else {\n        this.lastRecordedBlob = await webcamProvider.stopRecording();\n        this.recordedObjectUrl = URL.createObjectURL(this.lastRecordedBlob);\n        this.state = 'Review';\n        await webcamProvider.stopWebcam();\n      }\n    },\n    async rerecord() {\n      this.successfullyUploaded = false;\n      this.lastRecordedBlob = null;\n      this.recordedObjectUrl = '';\n      this.uploadError = null;\n      this.state = 'Record';\n      await webcamProvider.startWebcam();\n    },\n    async uploadVideo() {\n      if (!this.lastRecordedBlob) return;\n      if (this.isUploading) return;\n\n      this.isUploading = true;\n      this.uploadError = null;\n      const blobName = `${this.$props.uploadFilename}.webm`;\n\n      try {\n        await AzureUploader.upload(this.lastRecordedBlob, blobName);\n      } catch (e) {\n        console.error('Error uploading video', e);\n        this.uploadError = e;\n      }\n\n      if (this.uploadError === null) {\n        this.state = 'Success';\n      }\n\n      this.isUploading = false;\n    },\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n\n@import \"@/assets/main.scss\";\n\n.animate-width {\n  transition: width 0.2s ease;\n}\n\n.record-icon {\n  display: block;\n  width: 1.5rem;\n  height: 1.5rem;\n  border-radius: 1rem;\n  background-color: $dark;\n  transition: background-color 0.2s ease;\n\n  &.is-recording {\n    background-color: $red;\n  }\n}\n\n.control .record-icon {\n  margin-top: 8px;\n}\n</style>\n","// import { DefaultAzureCredential } from '@azure/identity';\nimport { BlobServiceClient } from '@azure/storage-blob';\n\n// const credential = new DefaultAzureCredential();\n\nconst blobServiceClient = new BlobServiceClient(\n  'https://dartrobotlabstorage.blob.core.windows.net/study-video-uploads?sp=acw&st=2021-04-07T02:19:35Z&se=2022-04-07T10:19:35Z&sv=2020-02-10&sr=c&sig=9fpKagbOjUqAjHF579%2FW7KiM4U8YcBrbI8J70tH35Y4%3D',\n  // credential,\n);\n\nexport default class AzureUploader {\n  public static async upload(data: Blob, blobName: string): Promise<void> {\n    const client = blobServiceClient.getContainerClient('study-video-uploads');\n\n    const blockBlobClient = client.getBlockBlobClient(blobName);\n\n    await blockBlobClient.uploadData(data);\n  }\n}\n","\nimport { computed, defineComponent, ref } from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport AzureUploader from '@/services/AzureUploader';\nimport WebcamBox from '@/components/elements/WebcamBox.vue';\n\nexport default defineComponent({\n  name: 'UploadScreen',\n  components: { WebcamBox },\n  emits: ['upload-canceled', 'upload-completed'],\n  props: {\n    title: {\n      type: String,\n      default: 'Video Upload',\n    },\n    subtitle: {\n      type: String,\n      default: null,\n    },\n    prompt: {\n      type: String,\n      default: 'Upload your video here',\n    },\n    uploadFilename: {\n      type: String,\n      default: null,\n    },\n  },\n  setup() {\n\n    const state = ref('Record' as 'Record' | 'Review' | 'Success');\n\n    const lastRecordedBlob = ref(null as Blob | null);\n    const recordedObjectUrl = ref('');\n    const isUploading = ref(false);\n    const uploadError = ref(null as null | any);\n    const successfullyUploaded = computed(() => state.value === 'Success');\n\n    return {\n      state,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n      lastRecordedBlob,\n      recordedObjectUrl,\n      isUploading,\n      uploadError,\n      successfullyUploaded,\n    };\n  },\n  methods: {\n    async toggleRecording() {\n      if (!webcamProvider.isRecording.value) {\n        await webcamProvider.startWebcam();\n        await webcamProvider.startRecording();\n      } else {\n        this.lastRecordedBlob = await webcamProvider.stopRecording();\n        this.recordedObjectUrl = URL.createObjectURL(this.lastRecordedBlob);\n        this.state = 'Review';\n        await webcamProvider.stopWebcam();\n      }\n    },\n    async rerecord() {\n      this.successfullyUploaded = false;\n      this.lastRecordedBlob = null;\n      this.recordedObjectUrl = '';\n      this.uploadError = null;\n      this.state = 'Record';\n      await webcamProvider.startWebcam();\n    },\n    async uploadVideo() {\n      if (!this.lastRecordedBlob) return;\n      if (this.isUploading) return;\n\n      this.isUploading = true;\n      this.uploadError = null;\n      const blobName = `${this.$props.uploadFilename}.webm`;\n\n      try {\n        await AzureUploader.upload(this.lastRecordedBlob, blobName);\n      } catch (e) {\n        console.error('Error uploading video', e);\n        this.uploadError = e;\n      }\n\n      if (this.uploadError === null) {\n        this.state = 'Success';\n      }\n\n      this.isUploading = false;\n    },\n  },\n});\n\n","import { render } from \"./FeedbackUploadScreen.vue?vue&type=template&id=663b38c1\"\nimport script from \"./FeedbackUploadScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./FeedbackUploadScreen.vue?vue&type=script&lang=ts\"\n\nimport \"./FeedbackUploadScreen.vue?vue&type=style&index=0&id=663b38c1&lang=scss\"\nscript.render = render\n\nexport default script","import { ref } from 'vue';\n\nclass OptionsManager {\n\n  public workflowId = ref(null as string | null);\n\n  public participantId = ref(null as string | null);\n\n  public participantIdWasSet = ref(false);\n\n  constructor() {\n    this.parsePath();\n    window.addEventListener('hashchange', this.parsePath);\n  }\n\n  parsePath() {\n    const urlParams = new URLSearchParams(window.location.search);\n\n    console.log('Parsing path....', urlParams);\n\n    this.workflowId.value = urlParams.get('workflowId');\n    this.participantId.value = urlParams.get('participantId');\n    if (this.participantId.value) {\n      this.participantIdWasSet.value = true;\n    }\n  }\n}\n\nconst optionsManager = new OptionsManager();\nexport default optionsManager;\n","import { DatabaseEntry } from '@/services/MotionDatabase';\nimport Utils from '@/services/Utils';\nimport VideoLesson from './VideoLesson';\n\n/**\n * Userflow.ts\n *\n * Data types that represent a specific workflow in the app\n */\nexport interface Instructions {\n  heading: string;\n  text: string;\n}\n\nexport interface WorkflowStep {\n  type: 'InstructionOnly' | 'VideoLessonReference' | 'VideoLessonEmbedded' | 'UploadTask';\n  title: string;\n  instructions?: Instructions;\n  videoLessonReference?: {\n    clipName: string;\n    lessonId: string;\n  };\n  videoLessonEmbedded?: VideoLesson;\n  upload?: {\n    identifier: string;\n    prompt: string;\n  };\n}\n\nexport interface WorkflowStage {\n  title: string;\n  steps: WorkflowStep[];\n  shuffle?: {\n    startIndex: number;\n    endIndex: number;\n  };\n}\n\nexport interface Workflow {\n  title: string;\n  // instructions?: Instructions;\n  id: string;\n  stages: WorkflowStage[];\n}\n\nexport function CreateBlankWorkflow() {\n  return {\n    title: 'New Workflow',\n    id: Utils.uuidv4(),\n    stages: [],\n  } as Workflow;\n}\n\nexport function IsVideoLessonStep(step: WorkflowStep) {\n  return step.type === 'VideoLessonReference' || step.type === 'VideoLessonEmbedded';\n}\nexport function GetWorkflowStepVideoClipName(step: WorkflowStep) {\n  return IsVideoLessonStep(step)\n    ? (step.type === 'VideoLessonReference'\n      ? step.videoLessonReference?.clipName ?? null\n      : step.videoLessonEmbedded?.header.clipName) ?? null\n    : null;\n}\nexport function GetVideoEntryForWorkflowStep(db: any, step: WorkflowStep): DatabaseEntry | null{\n  if (!IsVideoLessonStep(step)) return null;\n  return db.motionsMap.get(GetWorkflowStepVideoClipName(step));\n}\n","\nimport {\n  computed, defineComponent, ref, toRefs, watch, watchEffect,\n} from 'vue';\nimport VideoLessonPlayer from '@/components/elements/VideoLessonPlayer.vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport VideoLesson from '@/model/VideoLesson';\nimport workflowManager, { TrackingWorkflowStage, TrackingWorkflowStep } from '@/services/WorkflowManager';\nimport FeedbackUploadScreen from '@/components/screens/FeedbackUploadScreen.vue';\nimport optionsManager from '@/services/OptionsManager';\nimport { GetVideoEntryForWorkflowStep, IsVideoLessonStep } from '@/model/Workflow';\n\nexport default defineComponent({\n  name: 'WorkflowMenu',\n  props: {\n    showHeader: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  emits: [\n    'back-selected',\n  ],\n  components: {\n    VideoLessonPlayer,\n    FeedbackUploadScreen,\n  },\n  computed: {\n    stages() { return ((this as any).workflow?.stages ?? []) as TrackingWorkflowStage[]; },\n    nextStep() {\n      for (let i = 0; i < this.stages.length; i += 1) {\n        const stage = (this as any).stages[i];\n        for (let j = 0; j < stage.steps.length; j += 1) {\n          const step = stage.steps[j];\n          if (step.status !== 'completed') return step as TrackingWorkflowStep;\n        }\n      }\n      return null;\n    },\n    currentVideoEntry(): DatabaseEntry | null {\n      if (this.currentStep?.type === 'VideoLessonReference' && this.currentStep?.videoLessonReference) {\n        return db.motionsMap.get(this.currentStep.videoLessonReference.clipName) ?? null;\n      }\n      if (this.currentStep?.type === 'VideoLessonEmbedded' && this.currentStep?.videoLessonEmbedded?.header.clipName) {\n        return db.motionsMap.get(this.currentStep.videoLessonEmbedded.header.clipName) ?? null;\n      }\n      return null;\n    },\n    currentLesson(): VideoLesson | null {\n      if (this.currentStep?.type === 'VideoLessonReference' && this.currentStep?.videoLessonReference) {\n        return db.lessonsById.get(this.currentStep.videoLessonReference.lessonId) ?? null;\n      }\n      if (this.currentStep?.type === 'VideoLessonEmbedded' && this.currentStep?.videoLessonEmbedded) {\n        return this.currentStep.videoLessonEmbedded;\n      }\n      return null;\n    },\n    uploadFilename(): string {\n      const uploadId = this.currentStep?.upload?.identifier ?? 'NoIdentifier';\n      const participantId = optionsManager.participantId.value ?? 'Anonomous';\n      const workflowId = this.workflow?.id ?? 'NullWorkflow';\n\n      return `${workflowId}-${participantId}-${uploadId}`;\n    },\n  },\n  setup(props, ctx) {\n    const currentStep = ref(null as null | TrackingWorkflowStep);\n    const instructionsActive = ref(false);\n    const lessonActive = ref(false);\n    const uploadActive = ref(false);\n\n    watch(workflowManager.activeFlow, () => {\n      currentStep.value = null;\n    });\n\n    return {\n      currentStep,\n      instructionsActive,\n      lessonActive,\n      uploadActive,\n      workflow: workflowManager.activeFlow,\n    };\n  },\n  methods: {\n    getStepInfo(stage: TrackingWorkflowStage) {\n\n      return stage.steps.map((step) => ({\n        step,\n        dbEntry: GetVideoEntryForWorkflowStep(db, step),\n      }));\n    },\n    instructionsFinished() {\n      this.instructionsActive = false;\n      const step = this.currentStep;\n      if (!step) return;\n      step.status = 'inprogress';\n      this.continueWorkflowStep(step);\n    },\n    isClickable(step: TrackingWorkflowStep) {\n      return this.nextStep === step\n      || (step.type === 'InstructionOnly' && step.status === 'completed');\n    },\n    startWorkflowStep(item: TrackingWorkflowStep) {\n      if (!this.isClickable(item)) return;\n      this.currentStep = item;\n      if (item.type === 'InstructionOnly') {\n        this.instructionsActive = true;\n        return;\n      }\n      this.continueWorkflowStep(item);\n    },\n    continueWorkflowStep(item: TrackingWorkflowStep) {\n      if (item.type === 'InstructionOnly') {\n        // Instructions only - there's nothing else to do. Move to next activity!\n        item.status = 'completed';\n      } else if (item.type === 'VideoLessonReference' || item.type === 'VideoLessonEmbedded') {\n        this.lessonActive = true;\n      } else if (item.type === 'UploadTask') {\n        this.uploadActive = true;\n      } else {\n        console.error(`Item type ${item.type} not supported`);\n      }\n    },\n    lessonCompleted() {\n      this.lessonActive = false;\n      if (this.currentStep) this.currentStep.status = 'completed';\n    },\n    uploadComplete() {\n      this.uploadActive = false;\n      if (this.currentStep) this.currentStep.status = 'completed';\n    },\n    isStageCompleted(stage: TrackingWorkflowStage) {\n      return stage.steps.reduce((wasTrue: boolean, thisStep: TrackingWorkflowStep) => wasTrue && thisStep.status === 'completed', true);\n    },\n  },\n});\n","import { render } from \"./WorkflowMenu.vue?vue&type=template&id=31b1c0df\"\nimport script from \"./WorkflowMenu.vue?vue&type=script&lang=ts\"\nexport * from \"./WorkflowMenu.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <section class=\"section create-workflow-screen\" :class=\"{\n      'is-clipped': editLessonActive,\n    }\" :style=\"{\n      'max-height:100vh': editLessonActive,\n    }\">\n    <div class=\"hero is-primary block\">\n      <div class=\"hero-body\">\n        <div class=\"container\">\n          <p class=\"title\">\n            Workflow Creation\n          </p>\n          <p class=\"subtitle\">\n            <span v-if=\"activeWorkflow\">{{activeWorkflow.title}}</span>\n            <span v-else>Select a starting point...</span>\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"container block\">\n      <div class=\"buttons is-centered\">\n        <button class=\"button\" :class=\"{\n          'is-success': !isDirty && activeWorkflow,\n        }\"\n        @click=\"goBack()\">&lt; Back</button>\n        <button v-if=\"activeWorkflow && workflowInDatabase\" class=\"button is-danger\" @click=\"deleteWorkflow\">\n          Delete\n        </button>\n        <button v-if=\"activeWorkflow\" class=\"button\" @click=\"exportWorkflow\">Export</button>\n        <button v-if=\"activeWorkflow\" class=\"button\"\n                :class=\"{\n                  'is-primary': isDirty\n                }\"\n                :disabled=\"!isDirty\"\n                @click=\"saveWorkflow\">\n          <span v-if=\"workflowInDatabase\">Update</span>\n          <span v-else>Save</span>\n        </button>\n      </div>\n    </div>\n\n    <div class=\"container block has-text-centered\" v-if=\"!activeWorkflow\">\n      <div class=\"card block center-block has-text-left is-inline-block\">\n          <!-- <div class=\"card-header\">\n            <h4 class=\"card-header-title\">Pick a template:</h4>\n          </div> -->\n          <div class=\"card-content menu\">\n            <ul class=\"menu-list\">\n              <li>\n                <a @click=\"selectingWorkflowIndex = -1\"\n                  :class=\"{'is-active': selectingWorkflowIndex === -1}\">(start from scratch)</a>\n              </li>\n              <li v-for=\"(workflow, i) in availableWorkflows\" :key=\"workflow.id\">\n                <a @click=\"selectingWorkflowIndex = i\" :class=\"{'is-active': selectingWorkflowIndex === i}\">\n                  <strong>#{{i+1}}</strong>&nbsp;{{workflow.title}}\n                </a>\n              </li>\n            </ul>\n          </div>\n          <div class=\"card-footer\" v-if=\"canEditWorkflow\">\n            <a class=\"card-footer-item\" @click=\"canEditWorkflow && startCreation(false)\">Edit</a>\n          </div><div class=\"card-footer\">\n            <a class=\"card-footer-item\" @click=\"startCreation(true)\">\n              <span v-if=\"selectingWorkflowIndex === -1\">Start New</span>\n              <span v-else>Use as Template</span>\n            </a>\n          </div>\n        </div>\n    </div>\n    <div class=\"block columns is-multiline\" v-else>\n\n      <div class=\"column is-narrow\">\n        <div class=\"box\">\n          <p class=\"title is-5\">Workflow</p>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">ID</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" disabled type=\"text\" :value=\"activeWorkflow.id\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeWorkflow.title\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label\">\n              <label class=\"label\">Stages</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <ul class=\"menu-list\">\n                    <li v-for=\"(stage, i) in activeWorkflow.stages\" :key=\"i\">\n                      <a :class=\"{'is-active': selectedStageIndex === i}\" @click=\"selectStage(i)\"><strong>{{i+1}}&nbsp;</strong>&nbsp;{{stage.title}}</a>\n                    </li>\n                    <li v-if=\"activeStage\"><a @click=\"duplicateStage()\"><span class=\"icon\"><i class=\"far fa-copy\"></i></span><span>Duplicate</span></a></li>\n                    <li><a @click=\"addStage()\"><span class=\"icon\">&plus;</span><span>Add Stage</span></a></li>\n                    <li v-if=\"activeWorkflow.stages.length === 0\">No Stages</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"column is-narrow\" v-if=\"activeStage\">\n        <div class=\"box\">\n          <div class=\"title is-5\">Stage #{{selectedStageIndex + 1}}: <code>{{activeStage.title}}</code></div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Order</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field has-addons\">\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStage(-1)\" @click=\"reorderStage(-1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-down\"></i></div>\n                  </button>\n                </div>\n                <div class=\"control is-expanded\">\n                  <input class=\"input\" type=\"text\" disabled :value=\"selectedStageIndex + 1\">\n                </div>\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStage(1)\" @click=\"reorderStage(1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-up\"></i></div>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeStage.title\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label\">\n              <label class=\"label\">Steps</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <ul class=\"menu-list\">\n                    <li v-for=\"(step, i) in activeStage.steps\" :key=\"i\">\n                      <a :class=\"{'is-active': selectedStepIndex === i}\" @click=\"selectStep(i)\"><strong>{{i+1}}&nbsp;</strong>&nbsp;{{step.title}}</a>\n                    </li>\n                    <li v-if=\"activeStep\"><a @click=\"duplicateStep()\"><span class=\"icon\"><i class=\"far fa-copy\"></i></span><span>Duplicate</span></a></li>\n                    <li><a @click=\"addStep()\">&plus; Add Step</a></li>\n                    <li v-if=\"activeStage.steps.length === 0\">No Steps</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n          <hr>\n          <div class=\"buttons is-right\">\n            <button class=\"button is-danger is-outlined\" @click=\"deleteStage\">Delete</button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"column is-narrow\" v-if=\"activeStep\">\n        <div class=\"box\">\n          <div class=\"title is-5\">Step #{{selectedStepIndex + 1}}: <code>{{activeStep.title}}</code></div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Order</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field has-addons\">\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStep(-1)\" @click=\"reorderStep(-1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-down\"></i></div>\n                  </button>\n                </div>\n                <div class=\"control is-expanded\">\n                  <input class=\"input\" type=\"text\" disabled :value=\"selectedStepIndex + 1\">\n                </div>\n                <div class=\"control\">\n                  <button class=\"button\" :disabled=\"!canReorderStep(1)\" @click=\"reorderStep(1)\">\n                    <div class=\"icon\"><i class=\"fas fa-chevron-up\"></i></div>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label is-normal\">\n              <label class=\"label\">Title</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <input class=\"input\" type=\"text\" v-model=\"activeStep.title\">\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"field is-horizontal\">\n            <div class=\"field-label\">\n              <label class=\"label\">Type</label>\n            </div>\n            <div class=\"field-body\">\n              <div class=\"field\">\n                <div class=\"control\">\n                  <div class=\"select\">\n                    <select v-model=\"activeStep.type\">\n                      <option :value=\"'InstructionOnly'\">Instruction</option>\n                      <option :value=\"'VideoLessonReference'\">Mini Lesson (Reference)</option>\n                      <option :value=\"'VideoLessonEmbedded'\">Mini Lesson (Embedded)</option>\n                      <option :value=\"'UploadTask'\">Video Upload</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <hr>\n\n          <div v-if=\"isInstructionStep\" class=\"block\">\n              <div class=\"field is-horizontal\">\n              <div class=\"field-label is-normal\">\n                <label class=\"label\">Heading</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <input class=\"input\" type=\"text\" v-model=\"activeStep.instructions.heading\">\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"field is-horizontal\">\n              <div class=\"field-label is-normal\">\n                <label class=\"label\">Text</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <textarea class=\"textarea\" v-model=\"activeStep.instructions.text\"></textarea>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div v-if=\"isLessonEmbeddedStep\" class=\"block\">\n            <div v-if=\"activeStep.videoLessonEmbedded\" class=\"card\">\n              <header class=\"card-header\">\n                <p class=\"card-header-title\">{{activeStep.videoLessonEmbedded.header.lessonTitle}}</p>\n              </header>\n              <div class=\"card-content\">\n                <div class=\"content\" v-if=\"activeStepLesson.activities\">\n                  <ol v-if=\"activeStepLesson.activities.length <= 6\">\n                    <li v-for=\"(activity, i) in activeStepLesson.activities\" :key=\"i\">\n                      {{activity.title}}\n                    </li>\n                  </ol>\n                  <ol v-else>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(0, 3)\" :key=\"i\">{{activity.title}}</li>\n                      <li style=\"list-style:none;\">&hellip;</li>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(-3)\" :key=\"i\" :value=\"activeStepLesson.activities.length - 2 + i\">{{activity.title}}</li>\n                  </ol>\n                </div>\n              </div>\n              <div class=\"card-footer\">\n                <a class=\"card-footer-item has-text-danger\" @click=\"removeEmbeddedLesson\">Remove</a>\n                <a class=\"card-footer-item\" @click=\"convertEmbeddedLessonToReference\">Make Reference</a>\n                <a class=\"card-footer-item\" @click=\"editWorkflowStepLesson\">Edit</a>\n              </div>\n            </div>\n            <div v-else class=\"has-text-centered\">\n              <p>No Embedded Lesson</p>\n\n              <div class=\"field has-addons\">\n                <div class=\"control is-expanded\">\n                  <div class=\"select is-fullwidth\">\n                    <select class=\"select\" v-model=\"newEmbeddedLessonClipName\">\n                      <option disabled value=\"\">Select a clip</option>\n                      <option v-for=\"clipName in availableClips\" :key=\"clipName\">{{clipName}}</option>\n                    </select>\n                  </div>\n                </div>\n                <div class=\"control\">\n                  <button class=\"button is-primary\" :disabled=\"!canCreateEmbeddedLesson\" @click=\"startCreateEmbeddedLesson\">Create</button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div v-if=\"isLessonReferenceStep\" class=\"block\">\n            <div class=\"field is-horizontal\">\n              <div class=\"field-label\">\n                <label class=\"label\">Clip</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <div class=\"select\" v-if=\"activeStep.videoLessonReference\">\n                      <select v-model=\"activeStep.videoLessonReference.clipName\">\n                        <option disabled value=\"\">Select a clip</option>\n                        <option v-for=\"clipName in availableClips\" :key=\"clipName\">{{clipName}}</option>\n                      </select>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\"field is-horizontal\">\n              <div class=\"field-label\">\n                <label class=\"label\">Lesson</label>\n              </div>\n              <div class=\"field-body\">\n                <div class=\"field\">\n                  <div class=\"control\">\n                    <div class=\"select\">\n                      <select v-model=\"activeStep.videoLessonReference.lessonId\">\n                        <option value=\"\">&plus; Create New</option>\n                        <option disabled>──────────</option>\n                        <option v-for=\"lesson in availableReferenceLessons\" :key=\"lesson._id\" :value=\"lesson._id\">{{lesson.header.lessonTitle}}</option>\n                      </select>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <hr>\n            <div v-if=\"activeStepLesson\" class=\"card\">\n              <header class=\"card-header\">\n                <p class=\"card-header-title\">{{activeStepLesson.header.lessonTitle}}</p>\n              </header>\n              <div class=\"card-content\">\n                <div class=\"content\">\n                  <ol v-if=\"activeStepLesson.activities.length <= 6\">\n                    <li v-for=\"(activity, i) in activeStepLesson.activities\" :key=\"i\">\n                      {{activity.title}}\n                    </li>\n                  </ol>\n                  <ol v-else>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(0, 3)\" :key=\"i\">{{activity.title}}</li>\n                      <li style=\"list-style:none;\">&hellip;</li>\n                      <li v-for=\"(activity, i) in activeStepLesson.activities.slice(-3)\" :key=\"i\" :value=\"activeStepLesson.activities.length - 2 + i\">{{activity.title}}</li>\n                  </ol>\n                </div>\n              </div>\n              <div class=\"card-footer\">\n                <a v-if=\"canEditActiveStepLessonReference\" class=\"card-footer-item\" @click=\"editWorkflowStepLesson\">Edit Referenced Lesson</a>\n                <p v-else class=\"card-footer-item\">Unable to edit a built-in lesson</p>\n              </div>\n            </div>\n            <div v-else class=\"buttons is-centered\">\n              <button class=\"button is-outlined is-primary\" @click=\"createReferencedLesson\"><span class=\"icon is-small\"><i class=\"fa fa-plus\"></i></span><span>Create Referenced Lesson</span></button>\n            </div>\n          </div>\n\n          <div v-if=\"isVideoUploadStep\" class=\"block\"></div>\n\n          <hr>\n\n          <div class=\"buttons is-right\">\n            <button class=\"button is-danger is-outlined\" @click=\"deleteStep\">Delete</button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"column\">\n        <div class=\"box\">\n          <div class=\"title is-5\">Demo</div>\n        </div>\n        <WorkflowMenu :showHeader=\"true\" :showBackButton=\"false\"/>\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': editLessonActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\" style=\"width: 96%; height: 100vh;\">\n        <div class=\"box\">\n          <CreateLessonScreen v-if=\"editLessonActive\"\n            :motion=\"embeddedLessonMotion\"\n            :lessonToEdit=\"activeStepLesson\"\n            @back-selected=\"editLessonActive = false\"\n            @lesson-saved=\"updateWorkflowStepLesson\"\n            :saveToDatabase=\"isLessonReferenceStep\"\n            :showBackButton=\"false\"\n            :showCloseButton=\"true\"\n            :showExportButton=\"isLessonReferenceStep\"\n            :disableEditingExisting=\"true\"\n          />\n        </div>\n        <!-- <UploadCard\n          v-if=\"uploadUIActive\"\n          @cancelled=\"uploadUIActive = false\"\n          :uploadAccept=\"'*.json'\"\n          :onFilesSelected=\"uploadFiles\"\n          :savingText=\"'Loading lessons...'\"\n          :successText=\"'Lessons loaded successfully'\"\n        /> -->\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  CreateBlankWorkflow, GetVideoEntryForWorkflowStep, Instructions, Workflow, WorkflowStage, WorkflowStep,\n} from '@/model/Workflow';\nimport Utils from '@/services/Utils';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport {\n  computed, defineComponent, nextTick, ref, watch, watchEffect,\n} from 'vue';\nimport motionDb, { createBlankLesson } from '@/services/MotionDatabase';\nimport VideoLesson from '@/model/VideoLesson';\nimport CreateLessonScreen from '@/components/screens/CreateLessonScreen.vue';\n\nexport default defineComponent({\n  name: 'CreateWorkflowScreen',\n  emits: ['back-selected', 'workflow-created'],\n  components: {\n    WorkflowMenu,\n    CreateLessonScreen,\n  },\n  setup() {\n\n    const isDirty = ref(false);\n\n    const activeWorkflow = ref(null as null | Workflow);\n    const selectingWorkflowIndex = ref(-1);\n    const canEditWorkflow = computed(() => {\n      const workflow = workflowManager.allWorkflows.value[selectingWorkflowIndex.value];\n      return workflow && workflowManager.isCustomWorkflow(workflow.id);\n    });\n    const workflowInDatabase = computed(() => activeWorkflow.value?.id && WorkflowManager.hasSavedCustomLesson(activeWorkflow.value.id));\n    const selectedStageIndex = ref(0);\n    const activeStage = computed(() => activeWorkflow.value?.stages[selectedStageIndex.value] ?? null);\n    const selectedStepIndex = ref(0);\n    const activeStep = computed(() => activeStage.value?.steps[selectedStepIndex.value] ?? null);\n    const isVideoUploadStep = computed(() => activeStep.value?.type === 'UploadTask');\n    const isLessonReferenceStep = computed(() => activeStep.value?.type === 'VideoLessonReference');\n    const isLessonEmbeddedStep = computed(() => activeStep.value?.type === 'VideoLessonEmbedded');\n    const isInstructionStep = computed(() => activeStep.value?.type === 'InstructionOnly');\n    const availableReferenceLessons = computed(() => {\n      if (!activeStep.value) return [] as VideoLesson[];\n      if (!activeStep.value.videoLessonReference?.clipName) return [] as VideoLesson[];\n      return motionDb.lessonsByVideo.get(activeStep.value.videoLessonReference.clipName) ?? [];\n    });\n    const activeStepLesson = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonReferenceStep.value && activeStep.value.videoLessonReference?.lessonId) return motionDb.lessonsById.get(activeStep.value.videoLessonReference.lessonId) ?? null;\n      if (isLessonEmbeddedStep.value) return activeStep.value.videoLessonEmbedded ?? null;\n      return null;\n    });\n    const canEditActiveStepLessonReference = computed(() => activeStepLesson.value?.source === 'custom');\n    const newEmbeddedLessonClipName = ref('');\n    const newEmbeddedLessonMotion = computed(() => motionDb.motionsMap.get(newEmbeddedLessonClipName.value) ?? null);\n    const canCreateEmbeddedLesson = computed(() => newEmbeddedLessonMotion.value !== null);\n    const editLessonActive = ref(false);\n    const embeddedLessonMotion = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonEmbeddedStep.value && activeStep.value.videoLessonEmbedded) return GetVideoEntryForWorkflowStep(motionDb, activeStep.value);\n      if (isLessonEmbeddedStep.value) return newEmbeddedLessonMotion.value;\n      if (isLessonReferenceStep.value) return GetVideoEntryForWorkflowStep(motionDb, activeStep.value);\n      return null;\n    });\n\n    watchEffect(() => {\n      if (activeWorkflow.value) {\n        workflowManager.setActiveFlow(activeWorkflow.value.id);\n        workflowManager.completeActivitesPriorToStageAndStep(selectedStageIndex.value, selectedStepIndex.value);\n        // TODO: improve logic to keep status of intra-stage workflow steps.\n      }\n    });\n\n    watchEffect(() => {\n      if (!activeStep.value) return;\n      if (isInstructionStep.value) {\n        activeStep.value.instructions = activeStep.value.instructions ?? {\n          heading: 'Instructions Heading',\n          text: '',\n        } as Instructions;\n      } else if (isLessonReferenceStep.value) {\n        activeStep.value.videoLessonReference = activeStep.value.videoLessonReference ?? {} as any;\n        //  ?? {\n\n        // };\n      } else if (isLessonEmbeddedStep.value) {\n        // activeStep.value.videoLessonEmbedded = activeStep.value.videoLessonEmbedded;\n        //  ?? {\n\n        // };\n      } else if (isVideoUploadStep.value) {\n        activeStep.value.upload = activeStep.value.upload ?? {\n          identifier: activeStep.value.title,\n          prompt: 'Upload your video here',\n        };\n      }\n    });\n\n    return {\n      selectingWorkflowIndex,\n      activeWorkflow,\n      canEditWorkflow,\n      workflowInDatabase,\n      availableWorkflows: workflowManager.allWorkflows,\n      selectedStageIndex,\n      activeStage,\n\n      selectedStepIndex,\n      activeStep,\n      isVideoUploadStep,\n      isLessonReferenceStep,\n      isLessonEmbeddedStep,\n      isInstructionStep,\n      availableClips: motionDb.motionNames,\n      availableReferenceLessons,\n      newEmbeddedLessonClipName,\n      newEmbeddedLessonMotion,\n      embeddedLessonMotion,\n      canCreateEmbeddedLesson,\n      editLessonActive,\n      activeStepLesson,\n      canEditActiveStepLessonReference,\n\n      isDirty,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  watch: {\n    activeWorkflow: {\n      handler(newVal) {\n        this.isDirty = !!newVal;\n      },\n      deep: true,\n    },\n  },\n  computed: {\n  },\n  methods: {\n    goBack(skipPrompt?: boolean) {\n      if (!this.activeWorkflow) {\n        this.$emit('back-selected');\n        return;\n      }\n\n      if (skipPrompt || !this.isDirty) {\n        this.activeWorkflow = null;\n        return;\n      }\n\n      // eslint-disable-next-line no-alert\n      if (window.confirm('Go back without saving changes?')) {\n        workflowManager.reloadCustomWorkflow(this.activeWorkflow.id);\n        this.activeWorkflow = null;\n      }\n    },\n    deleteWorkflow() {\n      if (!this.activeWorkflow) return;\n\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      workflowManager.deleteCustomWorkflow(this.activeWorkflow.id);\n      this.goBack(true);\n    },\n    exportWorkflow() {\n      if (!this.activeWorkflow) return;\n      Utils.PromptDownloadFile(`${this.activeWorkflow.title}.workflow.json`, JSON.stringify(this.activeWorkflow));\n    },\n    saveWorkflow() {\n      if (!this.activeWorkflow) return;\n      workflowManager.upsertCustomWorkflow(this.activeWorkflow);\n      this.isDirty = false;\n    },\n    startCreation(asTemplate: boolean) {\n      const existingWorkflow = this.availableWorkflows[this.selectingWorkflowIndex];\n      if (existingWorkflow && asTemplate) {\n        this.activeWorkflow = Utils.deepCopy(existingWorkflow);\n        this.activeWorkflow.id = Utils.uuidv4();\n      } else if (existingWorkflow && !asTemplate) {\n        this.activeWorkflow = existingWorkflow;\n        nextTick(() => {\n          this.isDirty = false;\n        });\n\n      } else {\n        this.activeWorkflow = CreateBlankWorkflow();\n      }\n\n      workflowManager.addSessionWorkflow(this.activeWorkflow);\n      workflowManager.setActiveFlow(this.activeWorkflow.id);\n    },\n    selectStage(stageIndex: number) {\n\n      // Clear selection if this stage was already selected\n      if (stageIndex === this.selectedStageIndex) {\n        this.selectedStageIndex = -1;\n        this.selectedStepIndex = -1;\n        return;\n      }\n\n      this.selectedStageIndex = stageIndex;\n      this.selectedStepIndex = -1;\n      workflowManager.completeActivitesPriorToStageAndStep(stageIndex, this.selectedStepIndex);\n    },\n    canReorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      const swapStage = stages[this.selectedStageIndex + increment];\n      return (curStage !== undefined) && (swapStage !== undefined);\n    },\n    reorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const swapIndex = this.selectedStageIndex + increment;\n      const curSelected = stages[this.selectedStageIndex];\n      const toSwap = stages[swapIndex];\n      if ((curSelected === undefined) || (toSwap === undefined)) {\n        console.warn(`Unable to swap stages ${this.selectedStageIndex} and ${swapIndex}`);\n        return;\n      }\n      stages[this.selectedStageIndex] = toSwap;\n      stages[swapIndex] = curSelected;\n      this.selectedStageIndex = swapIndex;\n      workflow.stages = stages;\n    },\n    addStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n\n      workflow.stages.push({\n        title: `New-Stage-${workflow.stages.length + 1}`,\n        steps: [],\n      } as WorkflowStage);\n      this.selectStage(workflow.stages.length - 1);\n    },\n    duplicateStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      if (!curStage) return;\n      stages.splice(this.selectedStageIndex, 0, Utils.deepCopy(curStage));\n      workflow.stages = stages;\n      this.selectedStageIndex += 1;\n    },\n    deleteStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Stage #${this.selectedStageIndex + 1}?`)) return;\n\n      const { stages } = workflow;\n      stages.splice(this.selectedStageIndex, 1);\n      workflow.stages = stages;\n      this.selectedStageIndex = Math.min(this.selectedStageIndex, stages.length - 1);\n    },\n    selectStep(stepIndex: number) {\n\n      // Clear selectedStep if already selected\n      if (this.selectedStepIndex === stepIndex) {\n        this.selectedStepIndex = -1;\n        return;\n      }\n      this.selectedStepIndex = stepIndex;\n\n      workflowManager.completeActivitesPriorToStageAndStep(this.selectedStageIndex, this.selectedStepIndex);\n    },\n    canReorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return false;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[this.selectedStepIndex + increment];\n      return (curStep !== undefined) && (swapStep !== undefined);\n    },\n    reorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return;\n      const swapIndex = this.selectedStepIndex + increment;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[swapIndex];\n      if ((curStep === undefined) || (swapStep === undefined)) {\n        console.warn(`Unable to swap steps ${this.selectedStepIndex} and ${swapIndex}`);\n        return;\n      }\n      steps[this.selectedStageIndex] = swapStep;\n      steps[swapIndex] = curStep;\n      this.selectedStepIndex = swapIndex;\n      workflow.stages[this.selectedStageIndex].steps = steps;\n    },\n    addStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n\n      stage.steps.push({\n        title: `New-Step-${stage.steps.length + 1}`,\n        type: 'InstructionOnly',\n      } as WorkflowStep);\n      this.selectStep(stage.steps.length - 1);\n    },\n    duplicateStep() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const curStep = this.activeWorkflow?.stages[this.selectedStageIndex]?.steps[this.selectedStepIndex];\n      if (!curStep) return;\n      const { steps } = workflow.stages[this.selectedStageIndex];\n      steps.splice(this.selectedStepIndex, 0, Utils.deepCopy(curStep));\n      workflow.stages[this.selectedStageIndex].steps = steps;\n      this.selectedStepIndex += 1;\n    },\n    deleteStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Step #${this.selectedStepIndex + 1}?`)) return;\n\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      this.selectedStepIndex = Math.min(this.selectedStepIndex, steps.length - 1);\n    },\n    updateWorkflowStepLesson(lesson: VideoLesson) {\n      if (!this.activeStep) return;\n      if (this.isLessonEmbeddedStep) {\n        this.activeStep.videoLessonEmbedded = lesson;\n        console.log('Updated embedded lesson', lesson.header.lessonTitle);\n      }\n      if (this.isLessonReferenceStep && this.activeStep.videoLessonReference) {\n        this.activeStep.videoLessonReference.lessonId = lesson._id;\n        console.log('Updated reference lesson', lesson);\n      }\n    },\n    startCreateEmbeddedLesson() {\n      if (!this.activeStep) return;\n      if (!this.newEmbeddedLessonMotion) return;\n      // this.activeStep.videoLessonEmbedded = createBlankLesson(this.newEmbeddedLessonMotion);\n      // this.activeStep.videoLessonEmbedded.header.lessonTitle = this.activeStep.title;\n      this.editLessonActive = true;\n    },\n    createReferencedLesson() {\n      if (!this.isLessonReferenceStep) return;\n      if (this.activeStep?.videoLessonReference?.lessonId === '') {\n        this.editLessonActive = true;\n      }\n    },\n    editWorkflowStepLesson() {\n      if (!this.activeStepLesson) return;\n      this.editLessonActive = true;\n    },\n    removeEmbeddedLesson() {\n      if (!this.activeStep?.videoLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (window.confirm(`Are you sure you want to delete the embedded lesson ${this.activeStep.videoLessonEmbedded.header.lessonTitle}?`)) {\n        this.activeStep.videoLessonEmbedded = undefined;\n      }\n    },\n    convertEmbeddedLessonToReference() {\n      if (!this.activeStep?.videoLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to save this lesson into a new file and convert this to a reference?'\n                         + '\\n\\nNote: be sure to save the lesson.json!')\n      ) return;\n\n      motionDb.saveCustomLesson(this.activeStep.videoLessonEmbedded);\n      this.activeStep.videoLessonReference = {\n        clipName: this.activeStep.videoLessonEmbedded.header.clipName,\n        lessonId: this.activeStep.videoLessonEmbedded._id,\n      };\n      const exportLessonData = this.activeStep.videoLessonEmbedded;\n      this.activeStep.type = 'VideoLessonReference';\n      this.activeStep.videoLessonEmbedded = undefined;\n      Utils.PromptDownloadFile(`${exportLessonData.header.lessonTitle}.lesson.json`, JSON.stringify(exportLessonData));\n    },\n  },\n});\n</script>\n\n<style lang=\"sass\">\n\n</style>\n","<template>\n    <teleport to=\"#topbarLeft\">\n\n    </teleport>\n\n    <section class=\"section create-lesson-screen\">\n      <div class=\"hero is-primary block\">\n        <div class=\"hero-body\">\n          <div class=\"container\">\n            <p class=\"title\">\n              Lesson Creation\n            </p>\n            <p class=\"subtitle\">\n              <span v-if=\"state === LessonCreationState.SelectOpenLesson\">Template Selection</span>\n              <span v-else>Editing &quot;{{lessonUnderConstruction.header.lessonTitle}}&quot;</span>\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"container block\">\n        <div class=\"buttons is-centered has-addons\">\n          <button v-if=\"showBackButton\" class=\"button\" :class=\"{'is-danger': isDirty, 'is-outlined': isDirty, 'is-primary': !isDirty}\" @click=\"goBack\">&lt; Back</button>\n          <button v-if=\"showCloseButton\" class=\"button\" :class=\"{'is-danger': isDirty, 'is-outlined': isDirty, 'is-primary': !isDirty}\" @click=\"goBack\"><i class=\"fa fa-close\"></i> Close</button>\n          <button v-if=\"state === LessonCreationState.ModifyLesson && canDeleteLesson\" class=\"button is-danger is-outlined\" @click=\"deleteLesson\">\n            Delete\n          </button>\n          <button v-if=\"state === LessonCreationState.ModifyLesson && showExportButton\" class=\"button\" @click=\"exportLesson\">Export</button>\n          <button v-if=\"state === LessonCreationState.ModifyLesson\" class=\"button\" :class=\"{'is-primary': isDirty}\" :disabled=\"!isDirty\" @click=\"saveLesson\">\n            <span v-if=\"lessonInDatabase\">Update</span>\n            <span v-else>Save</span>\n          </button>\n        </div>\n      </div>\n\n      <div v-if=\"state === LessonCreationState.SelectOpenLesson\" class=\"container has-text-centered\">\n        <div class=\"card block center-block has-text-left\">\n          <div class=\"card-header\">\n            <h4 class=\"card-header-title\">Pick a template:</h4>\n          </div>\n          <div class=\"card-content menu\">\n            <ul class=\"menu-list\">\n              <li>\n                <a @click=\"activeLessonSelectionIndex = -1\"\n                  :class=\"{'is-active': activeLessonSelectionIndex === -1}\">(start from scratch)</a>\n              </li>\n              <li v-for=\"(lesson, i) in lessons\" :key=\"lesson._id\">\n                <a @click=\"activeLessonSelectionIndex = i\" :class=\"{'is-active': activeLessonSelectionIndex === i}\">\n                  <strong>#{{i+1}}</strong>&nbsp;{{lesson.header.lessonTitle}}\n                </a>\n              </li>\n            </ul>\n          </div>\n          <div class=\"card-footer\" v-if=\"canEditActiveLesson && !disableEditingExisting\">\n            <p v-if=\"disableEditingExisting\" class=\"card-footer-item\">Editing disabled</p>\n            <a v-else class=\"card-footer-item\" @click=\"startCreation(false)\">Edit</a>\n          </div><div class=\"card-footer\">\n            <a class=\"card-footer-item\" @click=\"startCreation(true)\">\n              <span v-if=\"activeLessonSelectionIndex === -1\">Start New</span>\n              <span v-else>Use as Template</span>\n            </a>\n          </div>\n        </div>\n      </div>\n\n      <div v-if=\"state === LessonCreationState.ModifyLesson\" class=\"block\">\n        <div class=\"columns is-multiline is-centered\">\n          <div class=\"column is-narrow\">\n            <div class=\"box\">\n              <h5 class=\"title is-5\">Lesson</h5>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Clip</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" disabled type=\"text\" :value=\"motion.title\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Title</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input class=\"input\" type=\"text\" v-model=\"lessonUnderConstruction.header.lessonTitle\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field\">\n                <label class=\"label\">Segments</label>\n                <div class=\"control block\">\n                  <SegmentedProgressBar\n                  :segments=\"progressSegments\"\n                    :progress=\"motion.duration\"\n                    :enableAll=\"true\"/>\n                  </div>\n                  <div class=\"control block\">\n                    <div class=\"block\">\n                      <span class=\"m-1\" v-for=\"(segBreak, i) in lessonUnderConstruction.segmentBreaks\" :key=\"i\">\n                        <input\n                            class=\"input narrow-number-input\"\n                            :key=\"i\"\n                            type=\"number\"\n                            v-model=\"lessonUnderConstruction.segmentBreaks[i]\"\n                            :min=\"lessonUnderConstruction.segmentBreaks[i - 1] ?? 0\"\n                            :step=\"0.01\"\n                            :max=\"lessonUnderConstruction.segmentBreaks[i + 1] ?? motion.duration\" />\n                      </span>\n                    </div>\n                    <div class=\"block has-text-right\">\n                      <!-- <span>Add New</span> -->\n                      <input\n                          class=\"input narrow-number-input is-info\"\n                          type=\"number\"\n                          v-model=\"newSegmentVal\"\n                          :min=\"0\"\n                          :step=\"0.01\"\n                          :max=\"motion.duration\" />\n                      <button class=\"ml-1 button is-info is-light\" @click=\"addSegmentBreak(newSegmentVal)\">Add Segment</button>\n                    </div>\n                  </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Activities</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(activity, i) in lessonUnderConstruction.activities\" :key=\"i\">\n                          <a :class=\"{'is-active': activeActivityIndex === i}\" @click=\"selectActivity(i)\"><strong>{{i+1}}&nbsp;</strong>&nbsp;{{activity.title}}</a>\n                        </li>\n                        <li><a @click=\"addActivity()\">&plus; Add Activity</a></li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Activities</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"column is-narrow\">\n            <div class=\"box\">\n              <h5 class=\"title is-5\">Activity</h5>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label is-normal\">\n                  <label class=\"label\">Order</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field has-addons\">\n                    <div class=\"control\">\n                      <button class=\"button\" :disabled=\"!canReorderActivity(activeActivityIndex, -1)\" @click=\"reorderActivity(activeActivityIndex, -1)\">\n                        <div class=\"icon\"><i class=\"fas fa-chevron-down\"></i></div>\n                      </button>\n                    </div>\n                    <div class=\"control is-expanded\">\n                      <input class=\"input\" type=\"text\" disabled :value=\"activeActivityIndex + 1\">\n                    </div>\n                    <div class=\"control\">\n                      <button class=\"button\" :disabled=\"!canReorderActivity(activeActivityIndex, 1)\" @click=\"reorderActivity(activeActivityIndex, 1)\">\n                        <div class=\"icon\"><i class=\"fas fa-chevron-up\"></i></div>\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Title</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.title\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Playback Speed</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeActivity.practiceSpeed\" min=\"0\" step=\"0.01\" :max=\"2\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Start Time</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeActivity.startTime\" min=\"0\" step=\"0.01\" :max=\"motion.duration\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeActivity.startTime\" min=\"0\" step=\"0.01\" :max=\"motion.duration\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">End Time</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeActivity.endTime\" :min=\"0\" step=\"0.01\" :max=\"motion.duration\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeActivity.endTime\" :min=\"0\" step=\"0.01\" :max=\"motion.duration\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Start Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.startInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Playing Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.playingInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">End Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.endInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Static Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeActivity.staticInstruction\" />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Pauses</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(pause, i) in activeActivity.pauses ?? []\" :key=\"i\">\n                          <a :class=\"{'is-active': activePauseIndex === i}\" @click=\"selectPause(i)\">\n                            <strong>#{{i+1}}</strong>\n                            at <span class=\"is-underlined\">{{pause.time}}</span>\n                            for <span class=\"is-underlined\">{{pause.pauseDuration ?? Constants.DefaultPauseDuration}}</span>s\n                            <small v-if=\"pause.instruction\">&nbsp; : &nbsp;<span>&quot;{{pause.instruction}}&quot;</span></small>\n                          </a>\n                        </li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Pauses</li>\n                        <li><a @click=\"addPause()\">&plus; Add Pause</a></li>\n                        <li v-show=\"(activeActivity.pauses?.length ?? 0) >= 2\"><a @click=\"sortPauses()\">Sort Pauses</a></li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Timed Instructions</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <ul class=\"menu-list\">\n                        <li v-for=\"(ti, i) in activeActivity.timedInstructions ?? []\" :key=\"i\">\n                          <a :class=\"{'is-active': activeTimedInstructionIndex === i}\" @click=\"selectTimedInstruction(i)\">\n                            <strong>#{{i+1}}</strong>&nbsp;\n                            <small>&quot;{{ti.text}}&quot;</small>\n                            from <span class=\"is-underlined\">{{ti.startTime}}</span>s\n                            to <span class=\"is-underlined\">{{ti.endTime}}</span>s\n                          </a>\n                        </li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Timed Instructions</li>\n                        <li><a @click=\"addTimedInstruction()\">&plus; Add Timed Instruction</a></li>\n                        <li v-show=\"(activeActivity.timedInstructions?.length ?? 0) >= 2\"><a @click=\"sortTimedInstructions()\">Sort Timed Instructions</a></li>\n                        <li v-if=\"lessonUnderConstruction.activities.length === 0\">No Timed Instructions</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"block buttons is-right\">\n                <button class=\"button is-outlined is-danger\" :disabled=\"!canDeleteActivity(activeActivityIndex)\" @click=\"deleteActivity(activeActivityIndex)\">Delete Activity #{{activeActivityIndex + 1}}</button>\n              </div>\n            </div>\n          </div>\n          <div class=\"column is-narrow\">\n\n            <div v-if=\"activePause\" class=\"box\">\n              <h6 class=\"title is-5\">Pause {{activePauseIndex + 1}} Details</h6>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\"><label class=\"label\">Time</label></div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activePause.time\" min=\"0\" step=\"0.01\" :max=\"motion.duration\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activePause.time\" min=\"0\" step=\"0.01\" :max=\"motion.duration\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Duration</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activePause.pauseDuration\" min=\"0\" step=\"0.01\" :max=\"10\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Instruction</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activePause.instruction\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field\">\n                <div class=\"control\">\n                  <button class=\"button is-danger is-outlined\" @click=\"deletePause(activePause)\">Remove Pause {{activePauseIndex + 1}}</button>\n                </div>\n              </div>\n            </div> <!-- End pause detail section-->\n\n            <div v-if=\"activeTimedInstruction\" class=\"box\">\n              <h6 class=\"title is-5\">Timed Instruction {{activeTimedInstructionIndex + 1}} Details</h6>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\"><label class=\"label\">Start Time</label></div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeTimedInstruction.startTime\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeTimedInstruction.endTime\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeTimedInstruction.startTime\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\"><label class=\"label\">End Time</label></div>\n                <div class=\"field-body\">\n                  <div class=\"field is-narrow\">\n                    <div class=\"control\">\n                      <input type=\"number\" class=\"input narrow-number-input\" v-model.number=\"activeTimedInstruction.endTime\" :min=\"activeTimedInstruction.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\">\n                    </div>\n                  </div>\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"range\" class=\"input slider mt-0 mb-0\" v-model.number=\"activeTimedInstruction.endTime\" :min=\"activeActivity.startTime\" step=\"0.01\" :max=\"activeActivity.endTime\"/>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field is-horizontal\">\n                <div class=\"field-label\">\n                  <label class=\"label\">Text</label>\n                </div>\n                <div class=\"field-body\">\n                  <div class=\"field\">\n                    <div class=\"control\">\n                      <input type=\"text\" class=\"input\" v-model=\"activeTimedInstruction.text\">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"field\">\n                <div class=\"control\">\n                  <button class=\"button is-danger is-outlined\" @click=\"deleteTimedInstruction(activeTimedInstruction)\">Remove Timed Instruction {{activeTimedInstructionIndex + 1}}</button>\n                </div>\n              </div>\n            </div> <!-- End timed instruction detail section-->\n          </div>\n\n          <div class=\"column is-narrow\">\n            <div class=\"box\">\n              <h5 class=\"title is-5\">Demo</h5>\n\n              <ActivityVideoPlayer\n                class=\"block\"\n                ref=\"activityVideoPlayer\"\n                :motion=\"motion\"\n                :lesson=\"lessonUnderConstruction\"\n                :activity=\"activeActivity\"\n                :maxHeight=\"'400px'\"\n                @progress=\"onProgress\" />\n\n              <SegmentedProgressBar\n                class=\"block\"\n                :segments=\"progressSegments\"\n                :progress=\"activityProgress\"/>\n\n              <div class=\"buttons is-centered has-addons\">\n                <button class=\"button\" :disabled=\"!hasPreviousActivity\" @click=\"activeActivityIndex -= 1\">&lt;</button>\n                <button class=\"button is-primary\" :disabled=\"!($refs.activityVideoPlayer?.awaitingStart ?? false)\" @click=\"playDemo\">Play Activity</button>\n                <button class=\"button\" :disabled=\"!($refs.activityVideoPlayer?.activityFinished ?? false)\" @click=\"$refs.activityVideoPlayer?.reset()\">Reset</button>\n                <button class=\"button\" :disabled=\"!hasNextActivity\" @click=\"activeActivityIndex += 1\">&gt;</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </section>\n\n    <teleport to='#belowSurface'>\n    </teleport>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  computed,\n  defineComponent, nextTick, ref, toRefs, watchEffect,\n} from 'vue';\n\nimport Constants from '@/services/Constants';\nimport ActivityVideoPlayer from '@/components/elements/ActivityVideoPlayer.vue';\nimport db, { createBlankActivity, createBlankLesson, DatabaseEntry } from '@/services/MotionDatabase';\nimport VideoLesson, { Activity, PauseInfo, TimedInstruction } from '@/model/VideoLesson';\nimport Utils from '@/services/Utils';\nimport SegmentedProgressBar, { ProgressSegmentData, calculateProgressSegments } from '@/components/elements/SegmentedProgressBar.vue';\n\nconst LessonCreationState = Object.freeze({\n  SelectOpenLesson: 'SelectOpenLesson',\n  ModifyLesson: 'ModifyLesson',\n});\n\nexport default defineComponent({\n  name: 'CreateLessonScreen',\n  components: {\n    ActivityVideoPlayer,\n    SegmentedProgressBar,\n    // VideoPlayer,\n    // ActivityVideoPlayer,\n    // VideoPlayer,\n  },\n  props: {\n    motion: {\n      type: Object,\n      required: true,\n    },\n    saveReference: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    showCloseButton: {\n      type: Boolean,\n      default: false,\n    },\n    showExportButton: {\n      type: Boolean,\n      default: true,\n    },\n    lessonToEdit: {\n      type: Object,\n      default: null,\n    },\n    saveToDatabase: {\n      type: Boolean,\n      default: true,\n    },\n    disableEditingExisting: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['back-selected', 'lesson-saved'],\n  data() {\n    return {\n      newPauseTime: 0,\n      newSegmentVal: 0,\n      activeLessonSelectionIndex: -1,\n      activePauseIndex: 0,\n      activeTimedInstructionIndex: 0,\n      activityProgress: 0,\n    };\n  },\n  computed: {\n    activeLessonSelection(): VideoLesson | null {\n      return this.lessons[this.activeLessonSelectionIndex] ?? null;\n    },\n    lessonInDatabase(): boolean {\n      return db.hasLesson(this.lessonUnderConstruction);\n    },\n    canDeleteLesson(): boolean {\n      return this.lessonInDatabase && this.lessonUnderConstruction.source === 'custom';\n    },\n    lessonStartTime(): number {\n      return this.lessonUnderConstruction?.segmentBreaks[0] ?? 0;\n    },\n    lessonEndTime(): number {\n      return this.lessonUnderConstruction.segmentBreaks[this.lessonUnderConstruction.segmentBreaks.length - 1] ?? this.motion?.duration ?? 1;\n    },\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      const lessons = db.getLessons(motion);\n      return lessons ?? [];\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lessonUnderConstruction) return calculateProgressSegments(this.lessonUnderConstruction, this.activeActivity);\n      return [];\n    },\n    activePause(): null | PauseInfo {\n      return ((this as any).activeActivity.pauses ?? [])[(this as any).activePauseIndex] ?? null;\n    },\n    activeTimedInstruction(): null | TimedInstruction {\n      return ((this as any).activeActivity.timedInstructions ?? [])[(this as any).activeTimedInstructionIndex] ?? null;\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < this.lessonUnderConstruction.activities.length;\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    canEditActiveLesson() {\n      const acLes = this.activeLessonSelection as VideoLesson;\n      return acLes?.source === 'custom';\n    },\n  },\n  mounted() {\n    const passedInLesson = this.$props.lessonToEdit as VideoLesson | null;\n    if (passedInLesson) {\n      console.log('CreateLessonScreen:: using passed in lesson', passedInLesson);\n      this.startCreation(false, Utils.deepCopy(passedInLesson));\n      nextTick(() => { this.isDirty = false; });\n    } else if (this.lessons.length === 0) {\n      console.log('CreateLessonScreen:: creating blank lesson (no templates available)');\n      this.startCreation(true);\n    }\n  },\n  setup(props) {\n    const { motion } = toRefs(props);\n    const isDirty = ref(false);\n    const typedMotion = computed(() => motion.value as unknown as DatabaseEntry);\n    const state = ref(LessonCreationState.SelectOpenLesson);\n    const lessonUnderConstruction = ref(createBlankLesson(typedMotion.value));\n    const activeActivityIndex = ref(0);\n    const activeActivity = computed(() => lessonUnderConstruction.value.activities[activeActivityIndex.value]);\n\n    watchEffect(() => {\n      if (activeActivity.value.startTime < 0) activeActivity.value.startTime = 0;\n      if (activeActivity.value.endTime > motion.value.duration) activeActivity.value.endTime = motion.value.duration;\n      if (+activeActivity.value.endTime < +activeActivity.value.startTime) activeActivity.value.endTime = activeActivity.value.startTime;\n    });\n\n    return {\n      isDirty,\n      state,\n      typedMotion,\n      LessonCreationState,\n      lessonUnderConstruction,\n      activeActivityIndex,\n      activeActivity,\n      Constants,\n    };\n  },\n  watch: {\n    lessonUnderConstruction: {\n      handler() {\n        this.isDirty = true;\n      },\n      deep: true,\n    },\n    'activePause.time': {\n      handler() {\n        this.sortPauses();\n      },\n    },\n    'activeTimedInstruction.startTime': {\n      handler() {\n        this.sortTimedInstructions();\n      },\n    },\n  },\n  methods: {\n    goBack() {\n      // eslint-disable-next-line no-alert\n      if (!this.isDirty || window.confirm('Are you sure you want to go back without saving?')) {\n        this.$emit('back-selected');\n      }\n    },\n    startCreation(asTemplate: boolean, sourceLesson?: VideoLesson) {\n      const existingLesson = sourceLesson ?? this.activeLessonSelection;\n      if (existingLesson && asTemplate) {\n        console.log('Creating new lesson from template');\n        this.lessonUnderConstruction = Utils.deepCopy(existingLesson);\n        this.lessonUnderConstruction._id = Utils.uuidv4();\n      } else if (existingLesson && !asTemplate) {\n        console.log('Editing existing lesson');\n        this.lessonUnderConstruction = existingLesson;\n        nextTick(() => { this.isDirty = false; });\n      } else {\n        console.log('Creating new lesson from scratch');\n        this.lessonUnderConstruction = createBlankLesson(this.typedMotion);\n      }\n      this.state = LessonCreationState.ModifyLesson;\n    },\n    addActivity(targetIndex?: number) {\n      const newActivity: Activity = createBlankActivity(this.typedMotion, `Activity ${this.lessonUnderConstruction.activities.length + 1}`);\n\n      if (targetIndex === undefined) {\n        this.lessonUnderConstruction.activities.push(newActivity);\n        this.activeActivityIndex = this.lessonUnderConstruction.activities.length - 1;\n      } else {\n        this.lessonUnderConstruction.activities.splice(targetIndex, 0, newActivity);\n        this.activeActivityIndex = targetIndex;\n      }\n    },\n    selectActivity(targetIndex: number) {\n      this.activeActivityIndex = targetIndex;\n    },\n    canDeleteActivity(targetIndex: number) {\n      return this.lessonUnderConstruction.activities.length > 1;\n    },\n    canReorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapActivity = this.lessonUnderConstruction.activities[targetIndex + indexDelta];\n      return (curActivity !== undefined && swapActivity !== undefined);\n    },\n    reorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapIndex = targetIndex + indexDelta;\n      const swapActivity = this.lessonUnderConstruction.activities[swapIndex];\n      if (curActivity === undefined || swapActivity === undefined) {\n        console.error(`Cannot reorder activities ${targetIndex} and ${swapIndex}`);\n        return;\n      }\n\n      this.lessonUnderConstruction.activities[swapIndex] = curActivity;\n      this.lessonUnderConstruction.activities[targetIndex] = swapActivity;\n      if (this.activeActivityIndex === targetIndex) {\n        this.activeActivityIndex = swapIndex;\n      }\n    },\n    deleteActivity(targetIndex: number) {\n      const indexToDelete = targetIndex ?? this.activeActivityIndex;\n      const activities = this.lessonUnderConstruction.activities ?? [];\n      if (activities.length < 2) {\n        console.error(\"Can't delete activity - no activities would be left\");\n        return;\n      }\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this activity?')) return;\n      console.log('Deleting activity at index', indexToDelete);\n      activities.splice(indexToDelete, 1);\n      this.lessonUnderConstruction.activities = activities;\n      this.activeActivityIndex = Math.max(Math.min(activities.length - 1, this.activeActivityIndex), 0);\n    },\n    addPause(targetIndex?: number) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const newPause: PauseInfo = {\n        time: this.activeActivity.startTime,\n        pauseDuration: Constants.DefaultPauseDuration,\n      };\n      if (targetIndex === undefined) {\n        pauses.push(newPause);\n        this.activePauseIndex = pauses.length - 1;\n      } else {\n        pauses.splice(targetIndex, 0, newPause);\n        this.activePauseIndex = targetIndex;\n      }\n      this.sortPauses();\n      this.activeActivity.pauses = pauses;\n    },\n    selectPause(targetIndex: number) {\n      if (targetIndex === this.activePauseIndex) this.activePauseIndex = -1;\n      else this.activePauseIndex = targetIndex;\n    },\n    sortPauses() {\n      const pauses = this.activeActivity.pauses ?? [];\n      const selectedPause = pauses[this.activePauseIndex];\n      pauses.sort((a, b) => a.time - b.time);\n      const newIndex = pauses.indexOf(selectedPause);\n      if (newIndex >= 0) this.activePauseIndex = newIndex;\n      this.activeActivity.pauses = pauses;\n    },\n    deletePause(pauseObj: PauseInfo) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const pauseIndex = pauses.indexOf(pauseObj);\n      // eslint-disable-next-line no-alert\n      if (pauseIndex >= 0 && window.confirm('Are you sure you want to delete this pause?')) pauses.splice(pauseIndex, 1);\n      this.activeActivity.pauses = pauses;\n    },\n    addTimedInstruction(targetIndex?: number) {\n      const timedInstructions = this.activeActivity.timedInstructions ?? [];\n      const newInstruction: TimedInstruction = {\n        startTime: 0,\n        endTime: 1,\n        text: 'Do XYZ',\n      };\n      if (targetIndex === undefined) {\n        timedInstructions.push(newInstruction);\n        this.activeTimedInstructionIndex = timedInstructions.length - 1;\n      } else {\n        timedInstructions.splice(targetIndex, 0, newInstruction);\n        this.activeTimedInstructionIndex = targetIndex;\n      }\n      this.sortTimedInstructions();\n\n      this.activeActivity.timedInstructions = timedInstructions;\n    },\n    selectTimedInstruction(targetIndex: number) {\n      if (targetIndex === this.activeTimedInstructionIndex) this.activeTimedInstructionIndex = -1;\n      else this.activeTimedInstructionIndex = targetIndex;\n    },\n    sortTimedInstructions() {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const selectedTimedInstruc = timedInstructs[this.activeTimedInstructionIndex];\n      timedInstructs.sort((a, b) => a.startTime - b.startTime);\n      const newIndex = timedInstructs.indexOf(selectedTimedInstruc);\n      if (newIndex >= 0) this.activeTimedInstructionIndex = newIndex;\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    deleteTimedInstruction(timedInstruction: TimedInstruction) {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const tiIndex = timedInstructs.indexOf(timedInstruction);\n      // eslint-disable-next-line no-restricted-globals, no-alert\n      if (tiIndex >= 0 && window.confirm('Are you sure you want to delete this timed instruction?')) timedInstructs.splice(tiIndex, 1);\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    addSegmentBreak(breakTime: number) {\n      breakTime = +breakTime;\n      if (Number.isNaN(breakTime) || breakTime < 0 || breakTime > this.motion.duration) return;\n      this.lessonUnderConstruction.segmentBreaks.push(breakTime);\n      const newList = this.lessonUnderConstruction.segmentBreaks.sort();\n      this.lessonUnderConstruction.segmentBreaks = newList;\n      this.newSegmentVal = 0;\n    },\n    playDemo() {\n      (this.$refs.activityVideoPlayer as any).play();\n    },\n    onProgress(progress: number) {\n      this.activityProgress = progress;\n    },\n    saveLesson() {\n      if (this.$props.saveToDatabase) {\n        db.saveCustomLesson(this.lessonUnderConstruction);\n      }\n      this.$emit('lesson-saved', this.lessonUnderConstruction);\n      this.isDirty = false;\n    },\n    deleteLesson() {\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      db.deleteCustomLesson(this.lessonUnderConstruction);\n      this.$emit('back-selected');\n    },\n    exportLesson() {\n      Utils.PromptDownloadFile(`${this.lessonUnderConstruction.header.lessonTitle}.lesson.json`, JSON.stringify(this.lessonUnderConstruction));\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.create-lesson-screen {\n  .center-block {\n    display: inline-block;\n    margin-left: auto;\n    margin-right: auto;\n  }\n\n  .narrow-number-input {\n    max-width: 5.5rem;\n  }\n\n  .seg-break {\n    background: white;\n  }\n}\n\n</style>\n","\n\nimport {\n  computed,\n  defineComponent, nextTick, ref, toRefs, watchEffect,\n} from 'vue';\n\nimport Constants from '@/services/Constants';\nimport ActivityVideoPlayer from '@/components/elements/ActivityVideoPlayer.vue';\nimport db, { createBlankActivity, createBlankLesson, DatabaseEntry } from '@/services/MotionDatabase';\nimport VideoLesson, { Activity, PauseInfo, TimedInstruction } from '@/model/VideoLesson';\nimport Utils from '@/services/Utils';\nimport SegmentedProgressBar, { ProgressSegmentData, calculateProgressSegments } from '@/components/elements/SegmentedProgressBar.vue';\n\nconst LessonCreationState = Object.freeze({\n  SelectOpenLesson: 'SelectOpenLesson',\n  ModifyLesson: 'ModifyLesson',\n});\n\nexport default defineComponent({\n  name: 'CreateLessonScreen',\n  components: {\n    ActivityVideoPlayer,\n    SegmentedProgressBar,\n    // VideoPlayer,\n    // ActivityVideoPlayer,\n    // VideoPlayer,\n  },\n  props: {\n    motion: {\n      type: Object,\n      required: true,\n    },\n    saveReference: {\n      type: Boolean,\n      default: true,\n    },\n    showBackButton: {\n      type: Boolean,\n      default: true,\n    },\n    showCloseButton: {\n      type: Boolean,\n      default: false,\n    },\n    showExportButton: {\n      type: Boolean,\n      default: true,\n    },\n    lessonToEdit: {\n      type: Object,\n      default: null,\n    },\n    saveToDatabase: {\n      type: Boolean,\n      default: true,\n    },\n    disableEditingExisting: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['back-selected', 'lesson-saved'],\n  data() {\n    return {\n      newPauseTime: 0,\n      newSegmentVal: 0,\n      activeLessonSelectionIndex: -1,\n      activePauseIndex: 0,\n      activeTimedInstructionIndex: 0,\n      activityProgress: 0,\n    };\n  },\n  computed: {\n    activeLessonSelection(): VideoLesson | null {\n      return this.lessons[this.activeLessonSelectionIndex] ?? null;\n    },\n    lessonInDatabase(): boolean {\n      return db.hasLesson(this.lessonUnderConstruction);\n    },\n    canDeleteLesson(): boolean {\n      return this.lessonInDatabase && this.lessonUnderConstruction.source === 'custom';\n    },\n    lessonStartTime(): number {\n      return this.lessonUnderConstruction?.segmentBreaks[0] ?? 0;\n    },\n    lessonEndTime(): number {\n      return this.lessonUnderConstruction.segmentBreaks[this.lessonUnderConstruction.segmentBreaks.length - 1] ?? this.motion?.duration ?? 1;\n    },\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      const lessons = db.getLessons(motion);\n      return lessons ?? [];\n    },\n    progressSegments(): ProgressSegmentData[] {\n      if (this.activeActivity && this.lessonUnderConstruction) return calculateProgressSegments(this.lessonUnderConstruction, this.activeActivity);\n      return [];\n    },\n    activePause(): null | PauseInfo {\n      return ((this as any).activeActivity.pauses ?? [])[(this as any).activePauseIndex] ?? null;\n    },\n    activeTimedInstruction(): null | TimedInstruction {\n      return ((this as any).activeActivity.timedInstructions ?? [])[(this as any).activeTimedInstructionIndex] ?? null;\n    },\n    hasNextActivity(): boolean {\n      return this.activeActivityIndex + 1 < this.lessonUnderConstruction.activities.length;\n    },\n    hasPreviousActivity(): boolean {\n      return this.activeActivityIndex > 0;\n    },\n    canEditActiveLesson() {\n      const acLes = this.activeLessonSelection as VideoLesson;\n      return acLes?.source === 'custom';\n    },\n  },\n  mounted() {\n    const passedInLesson = this.$props.lessonToEdit as VideoLesson | null;\n    if (passedInLesson) {\n      console.log('CreateLessonScreen:: using passed in lesson', passedInLesson);\n      this.startCreation(false, Utils.deepCopy(passedInLesson));\n      nextTick(() => { this.isDirty = false; });\n    } else if (this.lessons.length === 0) {\n      console.log('CreateLessonScreen:: creating blank lesson (no templates available)');\n      this.startCreation(true);\n    }\n  },\n  setup(props) {\n    const { motion } = toRefs(props);\n    const isDirty = ref(false);\n    const typedMotion = computed(() => motion.value as unknown as DatabaseEntry);\n    const state = ref(LessonCreationState.SelectOpenLesson);\n    const lessonUnderConstruction = ref(createBlankLesson(typedMotion.value));\n    const activeActivityIndex = ref(0);\n    const activeActivity = computed(() => lessonUnderConstruction.value.activities[activeActivityIndex.value]);\n\n    watchEffect(() => {\n      if (activeActivity.value.startTime < 0) activeActivity.value.startTime = 0;\n      if (activeActivity.value.endTime > motion.value.duration) activeActivity.value.endTime = motion.value.duration;\n      if (+activeActivity.value.endTime < +activeActivity.value.startTime) activeActivity.value.endTime = activeActivity.value.startTime;\n    });\n\n    return {\n      isDirty,\n      state,\n      typedMotion,\n      LessonCreationState,\n      lessonUnderConstruction,\n      activeActivityIndex,\n      activeActivity,\n      Constants,\n    };\n  },\n  watch: {\n    lessonUnderConstruction: {\n      handler() {\n        this.isDirty = true;\n      },\n      deep: true,\n    },\n    'activePause.time': {\n      handler() {\n        this.sortPauses();\n      },\n    },\n    'activeTimedInstruction.startTime': {\n      handler() {\n        this.sortTimedInstructions();\n      },\n    },\n  },\n  methods: {\n    goBack() {\n      // eslint-disable-next-line no-alert\n      if (!this.isDirty || window.confirm('Are you sure you want to go back without saving?')) {\n        this.$emit('back-selected');\n      }\n    },\n    startCreation(asTemplate: boolean, sourceLesson?: VideoLesson) {\n      const existingLesson = sourceLesson ?? this.activeLessonSelection;\n      if (existingLesson && asTemplate) {\n        console.log('Creating new lesson from template');\n        this.lessonUnderConstruction = Utils.deepCopy(existingLesson);\n        this.lessonUnderConstruction._id = Utils.uuidv4();\n      } else if (existingLesson && !asTemplate) {\n        console.log('Editing existing lesson');\n        this.lessonUnderConstruction = existingLesson;\n        nextTick(() => { this.isDirty = false; });\n      } else {\n        console.log('Creating new lesson from scratch');\n        this.lessonUnderConstruction = createBlankLesson(this.typedMotion);\n      }\n      this.state = LessonCreationState.ModifyLesson;\n    },\n    addActivity(targetIndex?: number) {\n      const newActivity: Activity = createBlankActivity(this.typedMotion, `Activity ${this.lessonUnderConstruction.activities.length + 1}`);\n\n      if (targetIndex === undefined) {\n        this.lessonUnderConstruction.activities.push(newActivity);\n        this.activeActivityIndex = this.lessonUnderConstruction.activities.length - 1;\n      } else {\n        this.lessonUnderConstruction.activities.splice(targetIndex, 0, newActivity);\n        this.activeActivityIndex = targetIndex;\n      }\n    },\n    selectActivity(targetIndex: number) {\n      this.activeActivityIndex = targetIndex;\n    },\n    canDeleteActivity(targetIndex: number) {\n      return this.lessonUnderConstruction.activities.length > 1;\n    },\n    canReorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapActivity = this.lessonUnderConstruction.activities[targetIndex + indexDelta];\n      return (curActivity !== undefined && swapActivity !== undefined);\n    },\n    reorderActivity(targetIndex: number, indexDelta: number) {\n      const curActivity = this.lessonUnderConstruction.activities[targetIndex];\n      const swapIndex = targetIndex + indexDelta;\n      const swapActivity = this.lessonUnderConstruction.activities[swapIndex];\n      if (curActivity === undefined || swapActivity === undefined) {\n        console.error(`Cannot reorder activities ${targetIndex} and ${swapIndex}`);\n        return;\n      }\n\n      this.lessonUnderConstruction.activities[swapIndex] = curActivity;\n      this.lessonUnderConstruction.activities[targetIndex] = swapActivity;\n      if (this.activeActivityIndex === targetIndex) {\n        this.activeActivityIndex = swapIndex;\n      }\n    },\n    deleteActivity(targetIndex: number) {\n      const indexToDelete = targetIndex ?? this.activeActivityIndex;\n      const activities = this.lessonUnderConstruction.activities ?? [];\n      if (activities.length < 2) {\n        console.error(\"Can't delete activity - no activities would be left\");\n        return;\n      }\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this activity?')) return;\n      console.log('Deleting activity at index', indexToDelete);\n      activities.splice(indexToDelete, 1);\n      this.lessonUnderConstruction.activities = activities;\n      this.activeActivityIndex = Math.max(Math.min(activities.length - 1, this.activeActivityIndex), 0);\n    },\n    addPause(targetIndex?: number) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const newPause: PauseInfo = {\n        time: this.activeActivity.startTime,\n        pauseDuration: Constants.DefaultPauseDuration,\n      };\n      if (targetIndex === undefined) {\n        pauses.push(newPause);\n        this.activePauseIndex = pauses.length - 1;\n      } else {\n        pauses.splice(targetIndex, 0, newPause);\n        this.activePauseIndex = targetIndex;\n      }\n      this.sortPauses();\n      this.activeActivity.pauses = pauses;\n    },\n    selectPause(targetIndex: number) {\n      if (targetIndex === this.activePauseIndex) this.activePauseIndex = -1;\n      else this.activePauseIndex = targetIndex;\n    },\n    sortPauses() {\n      const pauses = this.activeActivity.pauses ?? [];\n      const selectedPause = pauses[this.activePauseIndex];\n      pauses.sort((a, b) => a.time - b.time);\n      const newIndex = pauses.indexOf(selectedPause);\n      if (newIndex >= 0) this.activePauseIndex = newIndex;\n      this.activeActivity.pauses = pauses;\n    },\n    deletePause(pauseObj: PauseInfo) {\n      const pauses = this.activeActivity.pauses ?? [];\n      const pauseIndex = pauses.indexOf(pauseObj);\n      // eslint-disable-next-line no-alert\n      if (pauseIndex >= 0 && window.confirm('Are you sure you want to delete this pause?')) pauses.splice(pauseIndex, 1);\n      this.activeActivity.pauses = pauses;\n    },\n    addTimedInstruction(targetIndex?: number) {\n      const timedInstructions = this.activeActivity.timedInstructions ?? [];\n      const newInstruction: TimedInstruction = {\n        startTime: 0,\n        endTime: 1,\n        text: 'Do XYZ',\n      };\n      if (targetIndex === undefined) {\n        timedInstructions.push(newInstruction);\n        this.activeTimedInstructionIndex = timedInstructions.length - 1;\n      } else {\n        timedInstructions.splice(targetIndex, 0, newInstruction);\n        this.activeTimedInstructionIndex = targetIndex;\n      }\n      this.sortTimedInstructions();\n\n      this.activeActivity.timedInstructions = timedInstructions;\n    },\n    selectTimedInstruction(targetIndex: number) {\n      if (targetIndex === this.activeTimedInstructionIndex) this.activeTimedInstructionIndex = -1;\n      else this.activeTimedInstructionIndex = targetIndex;\n    },\n    sortTimedInstructions() {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const selectedTimedInstruc = timedInstructs[this.activeTimedInstructionIndex];\n      timedInstructs.sort((a, b) => a.startTime - b.startTime);\n      const newIndex = timedInstructs.indexOf(selectedTimedInstruc);\n      if (newIndex >= 0) this.activeTimedInstructionIndex = newIndex;\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    deleteTimedInstruction(timedInstruction: TimedInstruction) {\n      const timedInstructs = this.activeActivity.timedInstructions ?? [];\n      const tiIndex = timedInstructs.indexOf(timedInstruction);\n      // eslint-disable-next-line no-restricted-globals, no-alert\n      if (tiIndex >= 0 && window.confirm('Are you sure you want to delete this timed instruction?')) timedInstructs.splice(tiIndex, 1);\n      this.activeActivity.timedInstructions = timedInstructs;\n    },\n    addSegmentBreak(breakTime: number) {\n      breakTime = +breakTime;\n      if (Number.isNaN(breakTime) || breakTime < 0 || breakTime > this.motion.duration) return;\n      this.lessonUnderConstruction.segmentBreaks.push(breakTime);\n      const newList = this.lessonUnderConstruction.segmentBreaks.sort();\n      this.lessonUnderConstruction.segmentBreaks = newList;\n      this.newSegmentVal = 0;\n    },\n    playDemo() {\n      (this.$refs.activityVideoPlayer as any).play();\n    },\n    onProgress(progress: number) {\n      this.activityProgress = progress;\n    },\n    saveLesson() {\n      if (this.$props.saveToDatabase) {\n        db.saveCustomLesson(this.lessonUnderConstruction);\n      }\n      this.$emit('lesson-saved', this.lessonUnderConstruction);\n      this.isDirty = false;\n    },\n    deleteLesson() {\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      db.deleteCustomLesson(this.lessonUnderConstruction);\n      this.$emit('back-selected');\n    },\n    exportLesson() {\n      Utils.PromptDownloadFile(`${this.lessonUnderConstruction.header.lessonTitle}.lesson.json`, JSON.stringify(this.lessonUnderConstruction));\n    },\n  },\n});\n","import { render } from \"./CreateLessonScreen.vue?vue&type=template&id=04173f9d\"\nimport script from \"./CreateLessonScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./CreateLessonScreen.vue?vue&type=script&lang=ts\"\n\nimport \"./CreateLessonScreen.vue?vue&type=style&index=0&id=04173f9d&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  CreateBlankWorkflow, GetVideoEntryForWorkflowStep, Instructions, Workflow, WorkflowStage, WorkflowStep,\n} from '@/model/Workflow';\nimport Utils from '@/services/Utils';\nimport workflowManager, { WorkflowManager } from '@/services/WorkflowManager';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport {\n  computed, defineComponent, nextTick, ref, watch, watchEffect,\n} from 'vue';\nimport motionDb, { createBlankLesson } from '@/services/MotionDatabase';\nimport VideoLesson from '@/model/VideoLesson';\nimport CreateLessonScreen from '@/components/screens/CreateLessonScreen.vue';\n\nexport default defineComponent({\n  name: 'CreateWorkflowScreen',\n  emits: ['back-selected', 'workflow-created'],\n  components: {\n    WorkflowMenu,\n    CreateLessonScreen,\n  },\n  setup() {\n\n    const isDirty = ref(false);\n\n    const activeWorkflow = ref(null as null | Workflow);\n    const selectingWorkflowIndex = ref(-1);\n    const canEditWorkflow = computed(() => {\n      const workflow = workflowManager.allWorkflows.value[selectingWorkflowIndex.value];\n      return workflow && workflowManager.isCustomWorkflow(workflow.id);\n    });\n    const workflowInDatabase = computed(() => activeWorkflow.value?.id && WorkflowManager.hasSavedCustomLesson(activeWorkflow.value.id));\n    const selectedStageIndex = ref(0);\n    const activeStage = computed(() => activeWorkflow.value?.stages[selectedStageIndex.value] ?? null);\n    const selectedStepIndex = ref(0);\n    const activeStep = computed(() => activeStage.value?.steps[selectedStepIndex.value] ?? null);\n    const isVideoUploadStep = computed(() => activeStep.value?.type === 'UploadTask');\n    const isLessonReferenceStep = computed(() => activeStep.value?.type === 'VideoLessonReference');\n    const isLessonEmbeddedStep = computed(() => activeStep.value?.type === 'VideoLessonEmbedded');\n    const isInstructionStep = computed(() => activeStep.value?.type === 'InstructionOnly');\n    const availableReferenceLessons = computed(() => {\n      if (!activeStep.value) return [] as VideoLesson[];\n      if (!activeStep.value.videoLessonReference?.clipName) return [] as VideoLesson[];\n      return motionDb.lessonsByVideo.get(activeStep.value.videoLessonReference.clipName) ?? [];\n    });\n    const activeStepLesson = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonReferenceStep.value && activeStep.value.videoLessonReference?.lessonId) return motionDb.lessonsById.get(activeStep.value.videoLessonReference.lessonId) ?? null;\n      if (isLessonEmbeddedStep.value) return activeStep.value.videoLessonEmbedded ?? null;\n      return null;\n    });\n    const canEditActiveStepLessonReference = computed(() => activeStepLesson.value?.source === 'custom');\n    const newEmbeddedLessonClipName = ref('');\n    const newEmbeddedLessonMotion = computed(() => motionDb.motionsMap.get(newEmbeddedLessonClipName.value) ?? null);\n    const canCreateEmbeddedLesson = computed(() => newEmbeddedLessonMotion.value !== null);\n    const editLessonActive = ref(false);\n    const embeddedLessonMotion = computed(() => {\n      if (!activeStep.value) return null;\n      if (isLessonEmbeddedStep.value && activeStep.value.videoLessonEmbedded) return GetVideoEntryForWorkflowStep(motionDb, activeStep.value);\n      if (isLessonEmbeddedStep.value) return newEmbeddedLessonMotion.value;\n      if (isLessonReferenceStep.value) return GetVideoEntryForWorkflowStep(motionDb, activeStep.value);\n      return null;\n    });\n\n    watchEffect(() => {\n      if (activeWorkflow.value) {\n        workflowManager.setActiveFlow(activeWorkflow.value.id);\n        workflowManager.completeActivitesPriorToStageAndStep(selectedStageIndex.value, selectedStepIndex.value);\n        // TODO: improve logic to keep status of intra-stage workflow steps.\n      }\n    });\n\n    watchEffect(() => {\n      if (!activeStep.value) return;\n      if (isInstructionStep.value) {\n        activeStep.value.instructions = activeStep.value.instructions ?? {\n          heading: 'Instructions Heading',\n          text: '',\n        } as Instructions;\n      } else if (isLessonReferenceStep.value) {\n        activeStep.value.videoLessonReference = activeStep.value.videoLessonReference ?? {} as any;\n        //  ?? {\n\n        // };\n      } else if (isLessonEmbeddedStep.value) {\n        // activeStep.value.videoLessonEmbedded = activeStep.value.videoLessonEmbedded;\n        //  ?? {\n\n        // };\n      } else if (isVideoUploadStep.value) {\n        activeStep.value.upload = activeStep.value.upload ?? {\n          identifier: activeStep.value.title,\n          prompt: 'Upload your video here',\n        };\n      }\n    });\n\n    return {\n      selectingWorkflowIndex,\n      activeWorkflow,\n      canEditWorkflow,\n      workflowInDatabase,\n      availableWorkflows: workflowManager.allWorkflows,\n      selectedStageIndex,\n      activeStage,\n\n      selectedStepIndex,\n      activeStep,\n      isVideoUploadStep,\n      isLessonReferenceStep,\n      isLessonEmbeddedStep,\n      isInstructionStep,\n      availableClips: motionDb.motionNames,\n      availableReferenceLessons,\n      newEmbeddedLessonClipName,\n      newEmbeddedLessonMotion,\n      embeddedLessonMotion,\n      canCreateEmbeddedLesson,\n      editLessonActive,\n      activeStepLesson,\n      canEditActiveStepLessonReference,\n\n      isDirty,\n    };\n  },\n  data() {\n    return {\n    };\n  },\n  watch: {\n    activeWorkflow: {\n      handler(newVal) {\n        this.isDirty = !!newVal;\n      },\n      deep: true,\n    },\n  },\n  computed: {\n  },\n  methods: {\n    goBack(skipPrompt?: boolean) {\n      if (!this.activeWorkflow) {\n        this.$emit('back-selected');\n        return;\n      }\n\n      if (skipPrompt || !this.isDirty) {\n        this.activeWorkflow = null;\n        return;\n      }\n\n      // eslint-disable-next-line no-alert\n      if (window.confirm('Go back without saving changes?')) {\n        workflowManager.reloadCustomWorkflow(this.activeWorkflow.id);\n        this.activeWorkflow = null;\n      }\n    },\n    deleteWorkflow() {\n      if (!this.activeWorkflow) return;\n\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to delete this lesson?')) {\n        return;\n      }\n\n      workflowManager.deleteCustomWorkflow(this.activeWorkflow.id);\n      this.goBack(true);\n    },\n    exportWorkflow() {\n      if (!this.activeWorkflow) return;\n      Utils.PromptDownloadFile(`${this.activeWorkflow.title}.workflow.json`, JSON.stringify(this.activeWorkflow));\n    },\n    saveWorkflow() {\n      if (!this.activeWorkflow) return;\n      workflowManager.upsertCustomWorkflow(this.activeWorkflow);\n      this.isDirty = false;\n    },\n    startCreation(asTemplate: boolean) {\n      const existingWorkflow = this.availableWorkflows[this.selectingWorkflowIndex];\n      if (existingWorkflow && asTemplate) {\n        this.activeWorkflow = Utils.deepCopy(existingWorkflow);\n        this.activeWorkflow.id = Utils.uuidv4();\n      } else if (existingWorkflow && !asTemplate) {\n        this.activeWorkflow = existingWorkflow;\n        nextTick(() => {\n          this.isDirty = false;\n        });\n\n      } else {\n        this.activeWorkflow = CreateBlankWorkflow();\n      }\n\n      workflowManager.addSessionWorkflow(this.activeWorkflow);\n      workflowManager.setActiveFlow(this.activeWorkflow.id);\n    },\n    selectStage(stageIndex: number) {\n\n      // Clear selection if this stage was already selected\n      if (stageIndex === this.selectedStageIndex) {\n        this.selectedStageIndex = -1;\n        this.selectedStepIndex = -1;\n        return;\n      }\n\n      this.selectedStageIndex = stageIndex;\n      this.selectedStepIndex = -1;\n      workflowManager.completeActivitesPriorToStageAndStep(stageIndex, this.selectedStepIndex);\n    },\n    canReorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      const swapStage = stages[this.selectedStageIndex + increment];\n      return (curStage !== undefined) && (swapStage !== undefined);\n    },\n    reorderStage(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const swapIndex = this.selectedStageIndex + increment;\n      const curSelected = stages[this.selectedStageIndex];\n      const toSwap = stages[swapIndex];\n      if ((curSelected === undefined) || (toSwap === undefined)) {\n        console.warn(`Unable to swap stages ${this.selectedStageIndex} and ${swapIndex}`);\n        return;\n      }\n      stages[this.selectedStageIndex] = toSwap;\n      stages[swapIndex] = curSelected;\n      this.selectedStageIndex = swapIndex;\n      workflow.stages = stages;\n    },\n    addStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n\n      workflow.stages.push({\n        title: `New-Stage-${workflow.stages.length + 1}`,\n        steps: [],\n      } as WorkflowStage);\n      this.selectStage(workflow.stages.length - 1);\n    },\n    duplicateStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const { stages } = workflow;\n      const curStage = stages[this.selectedStageIndex];\n      if (!curStage) return;\n      stages.splice(this.selectedStageIndex, 0, Utils.deepCopy(curStage));\n      workflow.stages = stages;\n      this.selectedStageIndex += 1;\n    },\n    deleteStage() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Stage #${this.selectedStageIndex + 1}?`)) return;\n\n      const { stages } = workflow;\n      stages.splice(this.selectedStageIndex, 1);\n      workflow.stages = stages;\n      this.selectedStageIndex = Math.min(this.selectedStageIndex, stages.length - 1);\n    },\n    selectStep(stepIndex: number) {\n\n      // Clear selectedStep if already selected\n      if (this.selectedStepIndex === stepIndex) {\n        this.selectedStepIndex = -1;\n        return;\n      }\n      this.selectedStepIndex = stepIndex;\n\n      workflowManager.completeActivitesPriorToStageAndStep(this.selectedStageIndex, this.selectedStepIndex);\n    },\n    canReorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return false;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return false;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[this.selectedStepIndex + increment];\n      return (curStep !== undefined) && (swapStep !== undefined);\n    },\n    reorderStep(increment: number) {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const steps = workflow.stages[this.selectedStageIndex]?.steps;\n      if (!steps) return;\n      const swapIndex = this.selectedStepIndex + increment;\n      const curStep = steps[this.selectedStepIndex];\n      const swapStep = steps[swapIndex];\n      if ((curStep === undefined) || (swapStep === undefined)) {\n        console.warn(`Unable to swap steps ${this.selectedStepIndex} and ${swapIndex}`);\n        return;\n      }\n      steps[this.selectedStageIndex] = swapStep;\n      steps[swapIndex] = curStep;\n      this.selectedStepIndex = swapIndex;\n      workflow.stages[this.selectedStageIndex].steps = steps;\n    },\n    addStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n\n      stage.steps.push({\n        title: `New-Step-${stage.steps.length + 1}`,\n        type: 'InstructionOnly',\n      } as WorkflowStep);\n      this.selectStep(stage.steps.length - 1);\n    },\n    duplicateStep() {\n      const workflow = this.activeWorkflow;\n      if (!workflow) return;\n      const curStep = this.activeWorkflow?.stages[this.selectedStageIndex]?.steps[this.selectedStepIndex];\n      if (!curStep) return;\n      const { steps } = workflow.stages[this.selectedStageIndex];\n      steps.splice(this.selectedStepIndex, 0, Utils.deepCopy(curStep));\n      workflow.stages[this.selectedStageIndex].steps = steps;\n      this.selectedStepIndex += 1;\n    },\n    deleteStep() {\n      const stage = this.activeStage;\n      if (!stage) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm(`Are you sure you want to delete Step #${this.selectedStepIndex + 1}?`)) return;\n\n      const { steps } = stage;\n      steps.splice(this.selectedStepIndex, 1);\n      stage.steps = steps;\n      this.selectedStepIndex = Math.min(this.selectedStepIndex, steps.length - 1);\n    },\n    updateWorkflowStepLesson(lesson: VideoLesson) {\n      if (!this.activeStep) return;\n      if (this.isLessonEmbeddedStep) {\n        this.activeStep.videoLessonEmbedded = lesson;\n        console.log('Updated embedded lesson', lesson.header.lessonTitle);\n      }\n      if (this.isLessonReferenceStep && this.activeStep.videoLessonReference) {\n        this.activeStep.videoLessonReference.lessonId = lesson._id;\n        console.log('Updated reference lesson', lesson);\n      }\n    },\n    startCreateEmbeddedLesson() {\n      if (!this.activeStep) return;\n      if (!this.newEmbeddedLessonMotion) return;\n      // this.activeStep.videoLessonEmbedded = createBlankLesson(this.newEmbeddedLessonMotion);\n      // this.activeStep.videoLessonEmbedded.header.lessonTitle = this.activeStep.title;\n      this.editLessonActive = true;\n    },\n    createReferencedLesson() {\n      if (!this.isLessonReferenceStep) return;\n      if (this.activeStep?.videoLessonReference?.lessonId === '') {\n        this.editLessonActive = true;\n      }\n    },\n    editWorkflowStepLesson() {\n      if (!this.activeStepLesson) return;\n      this.editLessonActive = true;\n    },\n    removeEmbeddedLesson() {\n      if (!this.activeStep?.videoLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (window.confirm(`Are you sure you want to delete the embedded lesson ${this.activeStep.videoLessonEmbedded.header.lessonTitle}?`)) {\n        this.activeStep.videoLessonEmbedded = undefined;\n      }\n    },\n    convertEmbeddedLessonToReference() {\n      if (!this.activeStep?.videoLessonEmbedded) return;\n      // eslint-disable-next-line no-alert\n      if (!window.confirm('Are you sure you want to save this lesson into a new file and convert this to a reference?'\n                         + '\\n\\nNote: be sure to save the lesson.json!')\n      ) return;\n\n      motionDb.saveCustomLesson(this.activeStep.videoLessonEmbedded);\n      this.activeStep.videoLessonReference = {\n        clipName: this.activeStep.videoLessonEmbedded.header.clipName,\n        lessonId: this.activeStep.videoLessonEmbedded._id,\n      };\n      const exportLessonData = this.activeStep.videoLessonEmbedded;\n      this.activeStep.type = 'VideoLessonReference';\n      this.activeStep.videoLessonEmbedded = undefined;\n      Utils.PromptDownloadFile(`${exportLessonData.header.lessonTitle}.lesson.json`, JSON.stringify(exportLessonData));\n    },\n  },\n});\n","import { render } from \"./CreateWorkflowScreen.vue?vue&type=template&id=77e8f6c6\"\nimport script from \"./CreateWorkflowScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./CreateWorkflowScreen.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div ref=\"canvasBackground\" class=\"surface-container is-slightly-rounded\">\n\n    <div class=\"overlay overlay-background\">\n      <slot name=\"background\"></slot>\n    </div>\n\n    <video\n      class=\"mirrored is-slightly-rounded\"\n      ref=\"videoE\"\n      muted\n      :style=\"{\n        height: '720px',\n        width: '1280px',\n      }\"\n    ></video>\n\n    <div class=\"overlay\">\n      <slot name=\"ui\"></slot>\n    </div>\n\n    <DrawingSurface\n      :enableDrawing=\"isActivelyTracking\"\n      ref=\"drawingSurface\"\n      class=\"overlay\"/>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, onUpdated, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { setupMediaPipeListening } from '@/services/EventHub';\nimport { MpHolisticResults } from '@/services/MediaPipeTypes';\nimport DrawingSurface from './DrawingSurface.vue';\nimport { isTracking as mpIsTracking, StartTracking } from '../services/MediaPipe';\n\nexport default defineComponent({\n  name: 'CameraSurface',\n  components: {\n    DrawingSurface,\n  },\n  data() {\n    return {\n      trackingIntervalId: -1,\n    };\n  },\n  setup(props, { emit }) {\n    // const { enableDrawing } = toRefs(props);\n    const hasStartedTracking = ref(false);\n    const isActivelyTracking = ref(false);\n    const hasResults = ref(false);\n    const trackingResults = ref({});\n\n    let timerId = -1;\n    onMounted(() => {\n      timerId = window.setInterval(() => {\n        isActivelyTracking.value = mpIsTracking();\n      }, 500);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(timerId);\n    });\n\n    function onResults(results: MpHolisticResults) {\n      if (!hasResults.value) {\n        emit('tracking-attained');\n        console.log('Got Results', results);\n        hasResults.value = true;\n      }\n      trackingResults.value = results;\n      // this.$refs.drawingSurface.draw(results, canvasCtx);\n    }\n\n    setupMediaPipeListening(onResults);\n\n    return {\n      hasStartedTracking,\n      isActivelyTracking,\n      hasResults,\n      trackingResults,\n    };\n  },\n  methods: {\n    startTracking() {\n      if (this.trackingIntervalId !== -1) return;\n\n      const videoE = this.$refs.videoE as HTMLVideoElement;\n      const whenReady = () => {\n        if (this.hasStartedTracking) return;\n        this.hasStartedTracking = true;\n        console.log('Video loaded. Starting tracking...');\n\n        StartTracking(\n            this.$refs.videoE as HTMLVideoElement,\n        );\n\n        videoE.onloadedmetadata = null;\n      };\n\n      this.trackingIntervalId = window.setInterval(() => {\n\n        if (this.hasStartedTracking) {\n          clearInterval(this.trackingIntervalId);\n          this.trackingIntervalId = -1;\n        }\n\n        if (videoE.readyState === 4) {\n          whenReady();\n          return;\n        }\n\n        console.log('Video not ready, will start tracking when loaded.');\n      }, 100);\n\n      webcamProvider.connectVideoElement(videoE);\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.surface-container {\n  position: relative;\n  margin: auto;\n  width: 1280px;\n  height: 720px;\n  box-sizing: content-box;\n  text-align: center;\n\n  background: rgba(0, 0, 0, 0.3);\n\n  .overlay {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n  }\n\n  .overlay.overlay-bottom {\n    top: auto;\n  }\n  .overlay.overlay-left {\n    right: auto;\n  }\n  .overlay.overlay-right {\n    left: auto;\n  }\n  .overlay.overlay-top {\n    bottom: auto;\n  }\n}\n\n.mirrored {\n  transform: scaleX(-1);\n}\n\n// .overlay-background {\n//   z-index: -1;\n// }\n\n</style>\n","<template>\n  <canvas ref=\"canvasE\" width=\"1280\" height=\"720\" class=\"drawCanvas\"></canvas>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  ref, defineComponent, watch, toRefs, onMounted, Ref,\n} from 'vue';\nimport { WEBCAM_DIMENSIONS } from '@/services/WebcamProvider';\nimport { GestureNames, setupGestureListening } from '../services/EventHub';\n\nimport { MpHolisticResults } from '../services/MediaPipeTypes';\nimport {\n  HAND_LANDMARK_CONNECTIONS, DrawConnections, DrawPose,\n} from '../services/MediaPipe';\n\nfunction drawHandShape(results: MpHolisticResults, canvasCtx: CanvasRenderingContext2D) {\n  if (!results.rightHandLandmarks) {\n    return;\n  }\n\n  canvasCtx.save();\n\n  /* eslint-disable no-param-reassign */\n  canvasCtx.strokeStyle = 'white';\n  canvasCtx.lineWidth = 3.0;\n  canvasCtx.lineCap = 'round';\n\n  DrawConnections(canvasCtx, results.rightHandLandmarks, HAND_LANDMARK_CONNECTIONS);\n  canvasCtx.restore();\n}\n\nfunction drawTrackingResults(\n  enabled: boolean,\n  detectedGesture: string,\n  results: MpHolisticResults,\n  fadeTimeMs: number,\n  canvasCtx: CanvasRenderingContext2D,\n) {\n  if (!enabled) return;\n\n  const sourceAR = (results.image?.width ?? WEBCAM_DIMENSIONS.width)\n                   / (results.image?.height ?? WEBCAM_DIMENSIONS.height);\n\n  canvasCtx.save();\n  const trackingTimestamp = results.timestamp ?? Date.now();\n  canvasCtx.globalAlpha = 1 - (Date.now() - trackingTimestamp) / fadeTimeMs;\n\n  if (results.poseLandmarks) {\n    DrawPose(canvasCtx, results.poseLandmarks, {\n      sourceAspectRatio: sourceAR,\n    });\n  }\n  if (detectedGesture !== GestureNames.none) drawHandShape(results, canvasCtx);\n  canvasCtx.restore();\n}\n\nexport default defineComponent({\n  name: 'DrawingSurface',\n  props: {\n    enableDrawing: {\n      type: Boolean,\n      default: true,\n    },\n    fadeTimeMs: {\n      type: Number,\n      default: 1000,\n    },\n  },\n  setup(props) {\n    const { enableDrawing, fadeTimeMs } = toRefs(props);\n\n    const canvasE = ref(null) as unknown as Ref<HTMLCanvasElement>;\n    const gesture = ref(GestureNames.none);\n    const mpResults = ref({} as MpHolisticResults);\n\n    setupGestureListening({},\n      (ges, trackingResults) => {\n        gesture.value = ges;\n        mpResults.value = trackingResults;\n        // console.log('Drawing surface: recvived tracking results', ges, trackingResults);\n      });\n\n    onMounted(() => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.strokeStyle = 'rgba(200, 250, 200, 0.75)';\n      canvasCtx.lineWidth = 6;\n      canvasCtx.lineCap = 'round';\n    });\n\n    watch([enableDrawing, mpResults, gesture], (newVals) => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.clearRect(0, 0, canvas.width, canvas.height);\n\n      const isEnabled = newVals[0];\n      const holisticResults = newVals[1];\n      const detectedGesture = newVals[2];\n\n      drawTrackingResults(\n        isEnabled as unknown as boolean,\n        detectedGesture as unknown as string,\n        holisticResults as unknown as MpHolisticResults,\n        fadeTimeMs.value,\n        canvasCtx,\n      );\n    });\n\n    return {\n      canvasE,\n      gesture,\n      mpResults,\n    };\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n\n$pointer-size: 64px;\n\n.drawCanvas {\n  transform: scaleX(-1);\n  pointer-events: none;\n}\n\n.pointer-container {\n  position: fixed;\n  // transition: top .1s, left .1s;\n\n  img {\n    position: relative;\n    left: -$pointer-size / 2;\n    top: -32px;\n    width: 64px;\n    height: 64px;\n  }\n}\n\n</style>\n","\n\nimport {\n  ref, defineComponent, watch, toRefs, onMounted, Ref,\n} from 'vue';\nimport { WEBCAM_DIMENSIONS } from '@/services/WebcamProvider';\nimport { GestureNames, setupGestureListening } from '../services/EventHub';\n\nimport { MpHolisticResults } from '../services/MediaPipeTypes';\nimport {\n  HAND_LANDMARK_CONNECTIONS, DrawConnections, DrawPose,\n} from '../services/MediaPipe';\n\nfunction drawHandShape(results: MpHolisticResults, canvasCtx: CanvasRenderingContext2D) {\n  if (!results.rightHandLandmarks) {\n    return;\n  }\n\n  canvasCtx.save();\n\n  /* eslint-disable no-param-reassign */\n  canvasCtx.strokeStyle = 'white';\n  canvasCtx.lineWidth = 3.0;\n  canvasCtx.lineCap = 'round';\n\n  DrawConnections(canvasCtx, results.rightHandLandmarks, HAND_LANDMARK_CONNECTIONS);\n  canvasCtx.restore();\n}\n\nfunction drawTrackingResults(\n  enabled: boolean,\n  detectedGesture: string,\n  results: MpHolisticResults,\n  fadeTimeMs: number,\n  canvasCtx: CanvasRenderingContext2D,\n) {\n  if (!enabled) return;\n\n  const sourceAR = (results.image?.width ?? WEBCAM_DIMENSIONS.width)\n                   / (results.image?.height ?? WEBCAM_DIMENSIONS.height);\n\n  canvasCtx.save();\n  const trackingTimestamp = results.timestamp ?? Date.now();\n  canvasCtx.globalAlpha = 1 - (Date.now() - trackingTimestamp) / fadeTimeMs;\n\n  if (results.poseLandmarks) {\n    DrawPose(canvasCtx, results.poseLandmarks, {\n      sourceAspectRatio: sourceAR,\n    });\n  }\n  if (detectedGesture !== GestureNames.none) drawHandShape(results, canvasCtx);\n  canvasCtx.restore();\n}\n\nexport default defineComponent({\n  name: 'DrawingSurface',\n  props: {\n    enableDrawing: {\n      type: Boolean,\n      default: true,\n    },\n    fadeTimeMs: {\n      type: Number,\n      default: 1000,\n    },\n  },\n  setup(props) {\n    const { enableDrawing, fadeTimeMs } = toRefs(props);\n\n    const canvasE = ref(null) as unknown as Ref<HTMLCanvasElement>;\n    const gesture = ref(GestureNames.none);\n    const mpResults = ref({} as MpHolisticResults);\n\n    setupGestureListening({},\n      (ges, trackingResults) => {\n        gesture.value = ges;\n        mpResults.value = trackingResults;\n        // console.log('Drawing surface: recvived tracking results', ges, trackingResults);\n      });\n\n    onMounted(() => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.strokeStyle = 'rgba(200, 250, 200, 0.75)';\n      canvasCtx.lineWidth = 6;\n      canvasCtx.lineCap = 'round';\n    });\n\n    watch([enableDrawing, mpResults, gesture], (newVals) => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.clearRect(0, 0, canvas.width, canvas.height);\n\n      const isEnabled = newVals[0];\n      const holisticResults = newVals[1];\n      const detectedGesture = newVals[2];\n\n      drawTrackingResults(\n        isEnabled as unknown as boolean,\n        detectedGesture as unknown as string,\n        holisticResults as unknown as MpHolisticResults,\n        fadeTimeMs.value,\n        canvasCtx,\n      );\n    });\n\n    return {\n      canvasE,\n      gesture,\n      mpResults,\n    };\n  },\n});\n\n","import { render } from \"./DrawingSurface.vue?vue&type=template&id=002e5f90\"\nimport script from \"./DrawingSurface.vue?vue&type=script&lang=ts\"\nexport * from \"./DrawingSurface.vue?vue&type=script&lang=ts\"\n\nimport \"./DrawingSurface.vue?vue&type=style&index=0&id=002e5f90&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, onUpdated, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { setupMediaPipeListening } from '@/services/EventHub';\nimport { MpHolisticResults } from '@/services/MediaPipeTypes';\nimport DrawingSurface from './DrawingSurface.vue';\nimport { isTracking as mpIsTracking, StartTracking } from '../services/MediaPipe';\n\nexport default defineComponent({\n  name: 'CameraSurface',\n  components: {\n    DrawingSurface,\n  },\n  data() {\n    return {\n      trackingIntervalId: -1,\n    };\n  },\n  setup(props, { emit }) {\n    // const { enableDrawing } = toRefs(props);\n    const hasStartedTracking = ref(false);\n    const isActivelyTracking = ref(false);\n    const hasResults = ref(false);\n    const trackingResults = ref({});\n\n    let timerId = -1;\n    onMounted(() => {\n      timerId = window.setInterval(() => {\n        isActivelyTracking.value = mpIsTracking();\n      }, 500);\n    });\n    onBeforeUnmount(() => {\n      clearInterval(timerId);\n    });\n\n    function onResults(results: MpHolisticResults) {\n      if (!hasResults.value) {\n        emit('tracking-attained');\n        console.log('Got Results', results);\n        hasResults.value = true;\n      }\n      trackingResults.value = results;\n      // this.$refs.drawingSurface.draw(results, canvasCtx);\n    }\n\n    setupMediaPipeListening(onResults);\n\n    return {\n      hasStartedTracking,\n      isActivelyTracking,\n      hasResults,\n      trackingResults,\n    };\n  },\n  methods: {\n    startTracking() {\n      if (this.trackingIntervalId !== -1) return;\n\n      const videoE = this.$refs.videoE as HTMLVideoElement;\n      const whenReady = () => {\n        if (this.hasStartedTracking) return;\n        this.hasStartedTracking = true;\n        console.log('Video loaded. Starting tracking...');\n\n        StartTracking(\n            this.$refs.videoE as HTMLVideoElement,\n        );\n\n        videoE.onloadedmetadata = null;\n      };\n\n      this.trackingIntervalId = window.setInterval(() => {\n\n        if (this.hasStartedTracking) {\n          clearInterval(this.trackingIntervalId);\n          this.trackingIntervalId = -1;\n        }\n\n        if (videoE.readyState === 4) {\n          whenReady();\n          return;\n        }\n\n        console.log('Video not ready, will start tracking when loaded.');\n      }, 100);\n\n      webcamProvider.connectVideoElement(videoE);\n    },\n  },\n});\n","import { render } from \"./CameraSurface.vue?vue&type=template&id=72ad0b54\"\nimport script from \"./CameraSurface.vue?vue&type=script&lang=ts\"\nexport * from \"./CameraSurface.vue?vue&type=script&lang=ts\"\n\nimport \"./CameraSurface.vue?vue&type=style&index=0&id=72ad0b54&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"onboardingUI\">\n    <div class=\"overlay instructions-overlay mb-4\">\n       <InstructionCarousel :instructions=\"instructions\" class=\"\"/>\n       <!-- <InstructionCarousel v-show=\"stage !== OnboardingStage.done\" :instructions=\"[{id: 0, text: 'How to use this app'}]\" class=\"m-2\"/> -->\n    </div>\n    <div class=\"vcenter-parent\" v-show=\"stage !== OnboardingStage.done\">\n      <div class=\"content translucent-text is-rounded p-6\">\n        <GestureIcon :gesture=\"gestureIcon\" />\n      </div>\n    </div>\n    <div class=\"overlay overlay-top overlay-right mt-4 mr-4\" v-show=\"stage !== OnboardingStage.done\">\n      <button class=\"button\" @click=\"skipOnboarding\">Skip</button>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport { usingHolistic } from '@/services/MediaPipe';\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref,\n} from 'vue';\n\nimport { setupGestureListening, GestureNames, TrackingActions } from '../services/EventHub';\nimport InstructionCarousel, { Instruction } from './elements/InstructionCarousel.vue';\nimport GestureIcon, { GestureIcons } from './elements/GestureIcon.vue';\n\nconst OnboardingStage = {\n  trySelectNext: 0,\n  trySelectPrevious: 1,\n  tryPerformPlay: 2,\n  done: 3,\n};\n\nexport default defineComponent({\n  name: 'OnboardingUI',\n  components: { InstructionCarousel, GestureIcon },\n  setup(props, ctx) {\n    const stage = ref(OnboardingStage.trySelectNext);\n    const output = ref('');\n\n    const instructions = computed(() => {\n      const instructs: Instruction[] = [];\n      if (stage.value === OnboardingStage.trySelectNext) {\n        instructs.push({\n          id: 0,\n          text:\n            usingHolistic\n              ? 'Point to the right with a flat hand to proceed'\n              : 'Point your left forearm to the right to proceed',\n        });\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        instructs.push({\n          id: 1,\n          text:\n          usingHolistic\n            ? 'Point to the left with a flat hand to repeat an activity'\n            : 'Point your right forearm to the left to repeat an activity',\n        });\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        instructs.push({\n          id: 2,\n          text: 'Put your hands together in a Namaste greeting to play a video',\n        });\n      } else {\n        instructs.push({\n          id: 3,\n          text: 'You got it!',\n        });\n      }\n      return instructs;\n    });\n\n    onMounted(() => {\n      TrackingActions.requestTracking('onboarding');\n    });\n    onBeforeUnmount(() => {\n      TrackingActions.endTrackingRequest('onboarding');\n    });\n\n    function advanceStage() {\n      if (stage.value === OnboardingStage.trySelectNext) {\n        stage.value = OnboardingStage.trySelectPrevious;\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        stage.value = OnboardingStage.tryPerformPlay;\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        stage.value = OnboardingStage.done;\n        TrackingActions.endTrackingRequest('onboarding');\n        setTimeout(() => {\n          ctx.emit('onboarding-complete');\n        }, 1500);\n      }\n    }\n    setupGestureListening({\n      [GestureNames.pointRight]: () => {\n        if (stage.value === OnboardingStage.trySelectNext) {\n          advanceStage();\n        }\n      },\n      [GestureNames.pointLeft]: () => {\n        if (stage.value === OnboardingStage.trySelectPrevious) {\n          advanceStage();\n        }\n      },\n      [GestureNames.namaste]: () => {\n        if (stage.value === OnboardingStage.tryPerformPlay) {\n          advanceStage();\n        }\n      },\n    });\n\n    function skipOnboarding() {\n      advanceStage();\n    }\n\n    const gestureIcon = computed(() => {\n      switch (stage.value) {\n        case OnboardingStage.trySelectNext:\n          return GestureIcons.forward;\n        case OnboardingStage.trySelectPrevious:\n          return GestureIcons.backward;\n        case OnboardingStage.tryPerformPlay:\n          return GestureIcons.play;\n        default:\n          return '';\n      }\n    });\n\n    return {\n      stage,\n      output,\n      instructions,\n      OnboardingStage,\n      skipOnboarding,\n      gestureIcon,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.onboardingUI {\n  width: 100%;\n  height: 100%;\n}\n\n</style>\n","<template>\n  <span class=\"icon is-large\" :class=\"iconClass\" v-if=\"showIcon\">\n    <i class=\"fas fa-2x fa-hand-paper fa-rotate-90\"></i>\n  </span>\n  <span v-else>\n    <img :src=\"gestureImgSrc\" :alt=\"gesture\">\n  </span>\n</template>\n\n<script lang=\"ts\">\nimport { usingHolistic } from '@/services/MediaPipe';\nimport { computed, defineComponent, toRefs } from 'vue';\n\nexport const GestureIcons = Object.freeze({\n  forward: 'forward',\n  backward: 'backward',\n  play: 'play',\n});\n\nexport default defineComponent({\n  props: {\n    gesture: {\n      type: String,\n      default: 'foward',\n    },\n  },\n  setup(props) {\n\n    const { gesture } = toRefs(props);\n\n    const showIcon = computed(() => usingHolistic);\n    const iconClass = computed(() => {\n      switch (gesture.value) {\n        case 'backward': return ['fa-flip-horizontal'];\n        case 'forward': return [];\n        default:\n          return [];\n      }\n    });\n    /* eslint-disable global-require */\n    /* eslint-disable import/no-dynamic-require */\n    const gestureImgSrc = computed(() => {\n      try {\n        return require(`../../assets/gestures/${gesture.value}.svg`);\n      } catch {\n        return '';\n      }\n    });\n\n    return {\n      showIcon,\n      iconClass,\n      gestureImgSrc,\n    };\n  },\n});\n</script>\n\n<style>\n</style>\n","\nimport { usingHolistic } from '@/services/MediaPipe';\nimport { computed, defineComponent, toRefs } from 'vue';\n\nexport const GestureIcons = Object.freeze({\n  forward: 'forward',\n  backward: 'backward',\n  play: 'play',\n});\n\nexport default defineComponent({\n  props: {\n    gesture: {\n      type: String,\n      default: 'foward',\n    },\n  },\n  setup(props) {\n\n    const { gesture } = toRefs(props);\n\n    const showIcon = computed(() => usingHolistic);\n    const iconClass = computed(() => {\n      switch (gesture.value) {\n        case 'backward': return ['fa-flip-horizontal'];\n        case 'forward': return [];\n        default:\n          return [];\n      }\n    });\n    /* eslint-disable global-require */\n    /* eslint-disable import/no-dynamic-require */\n    const gestureImgSrc = computed(() => {\n      try {\n        return require(`../../assets/gestures/${gesture.value}.svg`);\n      } catch {\n        return '';\n      }\n    });\n\n    return {\n      showIcon,\n      iconClass,\n      gestureImgSrc,\n    };\n  },\n});\n","import { render } from \"./GestureIcon.vue?vue&type=template&id=35fcd4fc\"\nimport script from \"./GestureIcon.vue?vue&type=script&lang=ts\"\nexport * from \"./GestureIcon.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\n\nimport { usingHolistic } from '@/services/MediaPipe';\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref,\n} from 'vue';\n\nimport { setupGestureListening, GestureNames, TrackingActions } from '../services/EventHub';\nimport InstructionCarousel, { Instruction } from './elements/InstructionCarousel.vue';\nimport GestureIcon, { GestureIcons } from './elements/GestureIcon.vue';\n\nconst OnboardingStage = {\n  trySelectNext: 0,\n  trySelectPrevious: 1,\n  tryPerformPlay: 2,\n  done: 3,\n};\n\nexport default defineComponent({\n  name: 'OnboardingUI',\n  components: { InstructionCarousel, GestureIcon },\n  setup(props, ctx) {\n    const stage = ref(OnboardingStage.trySelectNext);\n    const output = ref('');\n\n    const instructions = computed(() => {\n      const instructs: Instruction[] = [];\n      if (stage.value === OnboardingStage.trySelectNext) {\n        instructs.push({\n          id: 0,\n          text:\n            usingHolistic\n              ? 'Point to the right with a flat hand to proceed'\n              : 'Point your left forearm to the right to proceed',\n        });\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        instructs.push({\n          id: 1,\n          text:\n          usingHolistic\n            ? 'Point to the left with a flat hand to repeat an activity'\n            : 'Point your right forearm to the left to repeat an activity',\n        });\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        instructs.push({\n          id: 2,\n          text: 'Put your hands together in a Namaste greeting to play a video',\n        });\n      } else {\n        instructs.push({\n          id: 3,\n          text: 'You got it!',\n        });\n      }\n      return instructs;\n    });\n\n    onMounted(() => {\n      TrackingActions.requestTracking('onboarding');\n    });\n    onBeforeUnmount(() => {\n      TrackingActions.endTrackingRequest('onboarding');\n    });\n\n    function advanceStage() {\n      if (stage.value === OnboardingStage.trySelectNext) {\n        stage.value = OnboardingStage.trySelectPrevious;\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        stage.value = OnboardingStage.tryPerformPlay;\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        stage.value = OnboardingStage.done;\n        TrackingActions.endTrackingRequest('onboarding');\n        setTimeout(() => {\n          ctx.emit('onboarding-complete');\n        }, 1500);\n      }\n    }\n    setupGestureListening({\n      [GestureNames.pointRight]: () => {\n        if (stage.value === OnboardingStage.trySelectNext) {\n          advanceStage();\n        }\n      },\n      [GestureNames.pointLeft]: () => {\n        if (stage.value === OnboardingStage.trySelectPrevious) {\n          advanceStage();\n        }\n      },\n      [GestureNames.namaste]: () => {\n        if (stage.value === OnboardingStage.tryPerformPlay) {\n          advanceStage();\n        }\n      },\n    });\n\n    function skipOnboarding() {\n      advanceStage();\n    }\n\n    const gestureIcon = computed(() => {\n      switch (stage.value) {\n        case OnboardingStage.trySelectNext:\n          return GestureIcons.forward;\n        case OnboardingStage.trySelectPrevious:\n          return GestureIcons.backward;\n        case OnboardingStage.tryPerformPlay:\n          return GestureIcons.play;\n        default:\n          return '';\n      }\n    });\n\n    return {\n      stage,\n      output,\n      instructions,\n      OnboardingStage,\n      skipOnboarding,\n      gestureIcon,\n    };\n  },\n});\n","import { render } from \"./OnboardingUI.vue?vue&type=template&id=69ed9ac4\"\nimport script from \"./OnboardingUI.vue?vue&type=script&lang=ts\"\nexport * from \"./OnboardingUI.vue?vue&type=script&lang=ts\"\n\nimport \"./OnboardingUI.vue?vue&type=style&index=0&id=69ed9ac4&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <section class=\"section dance-menu\">\n\n    <div class=\"hero is-primary block\">\n      <div class=\"hero-body\">\n        <div class=\"container\">\n          <p class=\"title\">\n            Main Menu\n          </p>\n          <p class=\"subtitle mb-0\">\n            What do you want to learn?\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"tabs is-centered is-medium-desktop is-small-mobile is-toggle is-toggle-rounded\">\n      <ul>\n        <li v-for=\"(tab, i) in TabList\" :key=\"i\" :class=\"{'is-active': currentTab===tab}\">\n          <a @click=\"setTab(tab)\">{{tab}}</a>\n        </li>\n      </ul>\n    </div>\n\n    <div class=\"grid-menu container block\" v-show=\"currentTab === Tabs.Workflows\">\n      <div class=\"box m-4 hover-expand is-clickable\"\n        v-for=\"workflow in workflows\"\n        :key=\"workflow.id\"\n        @click=\"$emit('workflow-selected', workflow.id)\">{{workflow.title}}\n      </div>\n    </div>\n\n    <div class=\"grid-menu container block\"\n      v-show=\"currentTab === Tabs.Videos\"\n    >\n      <div\n        class=\"video-card card hover-expand\"\n        v-for=\"dance in motionList\"\n        :key=\"dance.title\"\n        @mouseover=\"dance.hovering = true\"\n        @mouseleave=\"dance.hovering = false\"\n        @click = \"dance.clicked = !dance.clicked\"\n      >\n        <div class=\"card-image\">\n          <figure class=\"image is-2by3\" v-if=\"(!dance.hovering) && (!dance.clicked)\">\n            <img :src=\"dance.thumbnailSrc\" class=\"is-contain\" />\n          </figure>\n          <figure class=\"image is-2by3\" v-else><video controls :src=\"dance.videoSrc\" @playing=\"dance.clicked=True\"></video></figure>\n        </div>\n        <div class=\"card-content\" >\n          <div class=\"level\">\n            <div class=\"level-item\">\n              {{ dance.title }}\n            </div>\n            <!-- <transition name=\"expand-down\" appear> -->\n              <div class=\"level-item\">\n                <button\n                  class=\"button is-small transition-all is-primary\"\n                  :class=\"{\n                    'is-outlined': !(dance.clicked || dance.hovering)\n                  }\"\n                  @click=\"selectedDance = dance\">\n                  <span>Go</span>\n                  <span class=\"icon is-small\">\n                    <i class=\"fas fa-arrow-right\"></i>\n                  </span>\n                  </button>\n              </div>\n            <!-- </transition> -->\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"grid-menu container block\" v-show=\"currentTab === Tabs.Tools\">\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"uploadUIActive = true\">\n        Upload Custom Lesson\n      </div>\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"$emit('pose-drawer-selected')\">\n        Pose Drawer Test\n      </div>\n      <div class=\"box hover-expand is-clickable m-4\" @click=\"$emit('create-workflow-selected')\">\n        Workflow Editor\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': selectedDance }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <LessonCard\n          :motion=\"selectedDance\"\n          @closed=\"selectedDance = null\"\n          @lesson-selected=\"onLessonSelected\"\n          @create-lesson-selected=\"createLessonSelected\"\n        />\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': uploadUIActive }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <UploadCard\n          v-if=\"uploadUIActive\"\n          @cancelled=\"uploadUIActive = false\"\n          :uploadAccept=\"'*.json'\"\n          :onFilesSelected=\"uploadFiles\"\n          :savingText=\"'Loading lessons...'\"\n          :successText=\"'Lessons loaded successfully'\"\n        />\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport LessonCard from '@/components/elements/LessonCard.vue';\nimport UploadCard from '@/components/elements/UploadCard.vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport VideoLesson from '@/model/VideoLesson';\nimport workflowManager from '@/services/WorkflowManager';\n\nconst Tabs = Object.freeze({\n  Workflows: 'Workflows',\n  Videos: 'Videos',\n  Tools: 'Tools',\n});\nconst TabSet = Object.freeze(new Set(Object.values(Tabs)));\nconst TabList = Object.freeze(new Array(...Object.values(Tabs)));\n\nexport default defineComponent({\n  name: 'MainMenu',\n  emits: [\n    'lesson-selected',\n    'pose-drawer-selected',\n    'create-lesson-selected',\n    'workflow-selected',\n    'create-workflow-selected',\n  ],\n  components: {\n    LessonCard,\n    UploadCard,\n  },\n  setup(props, ctx) {\n    const motionList = db.motions;\n    const selectedDance = ref(null as DatabaseEntry | null);\n    const uploadUIActive = ref(false);\n    const currentTab = ref(Tabs.Tools);\n\n    function onLessonSelected(\n      videoEntry: DatabaseEntry,\n      lesson: VideoLesson,\n    ) {\n      ctx.emit('lesson-selected', videoEntry, lesson);\n      selectedDance.value = null;\n    }\n\n    function createLessonSelected(videoEntry: DatabaseEntry) {\n      ctx.emit('create-lesson-selected', videoEntry);\n      selectedDance.value = null;\n    }\n\n    return {\n      workflows: workflowManager.allWorkflows,\n      selectedDance,\n      motionList,\n      onLessonSelected,\n      createLessonSelected,\n      uploadUIActive,\n      workflowManager,\n\n      TabList,\n      Tabs,\n      currentTab,\n    };\n  },\n  methods: {\n    setTab(tab: string) {\n      console.log('Switching to tab:', tab);\n      if (!TabSet.has(tab)) {\n        console.error(`Tab ${tab} not recognized!`);\n        return;\n      }\n      this.currentTab = tab;\n    },\n    async uploadFiles(files: FileList) {\n      console.log('Upload files', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const lesson = JSON.parse(text);\n        db.validateLesson(lesson);\n\n        // TODO: validate lesson\n        db.saveCustomLesson(lesson);\n      }\n      return true;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n// .dance-menu {\n// backdrop-filter: blur(4px);\n// background: rgba(0, 0, 0, 0.2);\n// }\n\n.video-card {\n  width: 210px;\n  flex-grow: 1;\n  max-width: 300px;\n  margin: 1em;\n\n  img {\n    object-fit: cover;\n  }\n\n  .subtitle {\n    margin: 2rem 1rem 2em;\n    color: white;\n  }\n\n  .section {\n    padding: 1.5rem;\n  }\n\n  .image video {\n    bottom: 0;\n    left: 0;\n    right: 0;\n    top: 0;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n}\n\n/* Enter and leave animations can use different */\n/* durations and timing functions.              */\n.expand-down-enter-active {\n  transition: all .3s ease;\n}\n.expand-down-leave-active {\n  transition: all .8s cubic-bezier(1.0, 0.5, 0.8, 1.0);\n}\n.expand-down-enter, .expand-down-leave-to\n/* .slide-fade-leave-active below version 2.1.8 */ {\n  transform: scaleY(0);\n  height: 0;\n  opacity: 0;\n}\n.collapsed {\n  transform: scaleY(0);\n  height: 0;\n}\n.animate-height {\n  transition: transform 0.15s ease;\n}\n\n.transition-all {\n  transition: all 0.15s ease;\n}\n</style>\n","<template>\n  <div class=\"card lesson-card\" v-if=\"motion\">\n    <div class=\"card-header\">\n      <h4 class=\"card-header-title\">\n        {{ motion.title }}\n      </h4>\n\n      <a class=\"card-header-icon\" @click=\"$emit('closed')\">\n        <i class=\"fas fa-times\"></i>\n      </a>\n    </div>\n    <div class=\"card-content\">\n      <div class=\"columns\">\n        <div class=\"column is-narrow is-hidden-mobile\">\n          <video :src=\"motion.videoSrc\" autoplay=\"true\" muted=\"true\" width=\"180\" />\n        </div>\n        <div class=\"column\">\n          <div class=\"menu\">\n            <p class=\"menu-label\">\n              Pick a lesson\n            </p>\n            <ul class=\"menu-list\">\n              <li v-for=\"lesson in lessons\" :key=\"lesson._id\">\n                <a @click=\"$emit('lesson-selected', motion, lesson)\">\n                  {{ lesson.header.lessonTitle }}\n                </a>\n              </li>\n              <li v-if=\"canCreateLesson\">\n                <a @click=\"$emit('create-lesson-selected', motion)\">Create Lesson</a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\n\nexport default defineComponent({\n  name: 'LessonCard',\n  props: {\n    motion: {\n      type: Object,\n    },\n    canCreateLesson: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  computed: {\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      const lessons = db.getLessons(motion);\n      return lessons ?? [];\n    },\n  },\n  emits: ['lesson-selected', 'create-lesson-selected', 'closed'],\n});\n</script>\n\n<style lang=\"scss\">\n\n.lesson-card .dance-image {\n  max-height: 50vh;\n}\n\n</style>\n","\nimport { defineComponent } from 'vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\n\nexport default defineComponent({\n  name: 'LessonCard',\n  props: {\n    motion: {\n      type: Object,\n    },\n    canCreateLesson: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  computed: {\n    lessons() {\n      if (!this.motion) return [];\n      const motion = this.motion as DatabaseEntry;\n      const lessons = db.getLessons(motion);\n      return lessons ?? [];\n    },\n  },\n  emits: ['lesson-selected', 'create-lesson-selected', 'closed'],\n});\n","import { render } from \"./LessonCard.vue?vue&type=template&id=0310a410\"\nimport script from \"./LessonCard.vue?vue&type=script&lang=ts\"\nexport * from \"./LessonCard.vue?vue&type=script&lang=ts\"\n\nimport \"./LessonCard.vue?vue&type=style&index=0&id=0310a410&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"card upload-card\">\n    <div class=\"card-header\">\n      <h4 class=\"card-header-title\">Upload File</h4>\n\n      <a class=\"card-header-icon\" @click=\"$emit('cancelled')\">\n        <i class=\"fas fa-times\"></i>\n      </a>\n    </div>\n    <div class=\"card-content\">\n      <form\n        enctype=\"multipart/form-data\"\n        novalidate\n        v-if=\"isInitial || isSaving || isFailed\"\n      >\n        <div class=\"field\">\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <div class=\"dropbox is-rounded\">\n              <input\n                type=\"file\"\n                :name=\"uploadFieldName\"\n                :disabled=\"isSaving\"\n                @change=\"\n                  save($event.target.files, $event.target);\n                  fileCount = $event.target.files.length;\n                \"\n                :accept=\"uploadAccept\"\n                class=\"file-input\"\n              />\n              <p class=\"is-size-7\" v-if=\"isInitial\">\n                {{uploadInstructions}}\n              </p>\n              <p class=\"is-size-7\" v-if=\"isSaving\">\n                {{savingText}}\n              </p>\n              <div class=\"is-size-7 has-text-centered\" v-if=\"isFailed\">\n                <p>Error saving:</p>\n                <p style=\"max-width:60ch;\" class=\"has-text-danger\">{{uploadError}}</p>\n                <p><strong>Please try again.</strong></p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </form>\n      <div class=\"has-text-success\" v-if=\"isSuccess\">{{successText}}</div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nconst Status = Object.freeze({\n  Initial: 'Initial',\n  Saving: 'Saving',\n  Success: 'Success',\n  Failed: 'Failed',\n});\n\nexport default defineComponent({\n  name: 'UploadCard',\n  props: {\n    uploadAccept: {\n      type: String,\n      default: '*',\n    },\n    uploadInstructions: {\n      type: String,\n      default: 'Click here or drag your file(s) over this area',\n    },\n    savingText: {\n      type: String,\n      default: 'Processing File(s)...',\n    },\n    onFilesSelected: {\n      type: Function,\n      default: () => {},\n    },\n    successText: {\n      type: String,\n      default: 'Files uploaded successfully',\n    },\n  },\n  data() {\n    return {\n      uploadError: null,\n      currentStatus: null as null | string,\n      uploadFieldName: 'files',\n    };\n  },\n  emits: ['cancelled', 'done'],\n  computed: {\n    isInitial() { return (this as any).currentStatus === Status.Initial; },\n    isSaving() { return (this as any).currentStatus === Status.Saving; },\n    isSuccess() { return (this as any).currentStatus === Status.Success; },\n    isFailed() { return (this as any).currentStatus === Status.Failed; },\n  },\n  methods: {\n    reset() {\n      // reset form to initial state\n      this.currentStatus = Status.Initial;\n      this.uploadError = null;\n    },\n    async save(fileList: FileList) {\n      // upload data to the server\n      this.currentStatus = Status.Saving;\n\n      try {\n        const result = await this.onFilesSelected(fileList);\n        if (result) {\n          this.$emit('done');\n          this.currentStatus = Status.Success;\n        } else {\n          this.currentStatus = Status.Initial;\n        }\n      } catch (e) {\n        this.currentStatus = Status.Failed;\n        this.uploadError = e;\n      }\n    },\n  },\n  mounted() {\n    this.reset();\n  },\n});\n</script>\n\n<style lang=\"scss\">\n.upload-card {\n  .file-input {\n    opacity: 0;\n    width: 100%;\n    height: 160px;\n    position: absolute;\n    cursor: pointer;\n  }\n\n  .dropbox {\n    outline: 2px dashed gray;\n    outline-offset: -1rem;\n    min-height: 160px;\n    min-width: 320px;\n    color: dimgray;\n    padding: 1.5rem;\n    position: relative;\n    cursor: pointer;\n\n    &:hover {\n      background: lightblue;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent } from 'vue';\n\nconst Status = Object.freeze({\n  Initial: 'Initial',\n  Saving: 'Saving',\n  Success: 'Success',\n  Failed: 'Failed',\n});\n\nexport default defineComponent({\n  name: 'UploadCard',\n  props: {\n    uploadAccept: {\n      type: String,\n      default: '*',\n    },\n    uploadInstructions: {\n      type: String,\n      default: 'Click here or drag your file(s) over this area',\n    },\n    savingText: {\n      type: String,\n      default: 'Processing File(s)...',\n    },\n    onFilesSelected: {\n      type: Function,\n      default: () => {},\n    },\n    successText: {\n      type: String,\n      default: 'Files uploaded successfully',\n    },\n  },\n  data() {\n    return {\n      uploadError: null,\n      currentStatus: null as null | string,\n      uploadFieldName: 'files',\n    };\n  },\n  emits: ['cancelled', 'done'],\n  computed: {\n    isInitial() { return (this as any).currentStatus === Status.Initial; },\n    isSaving() { return (this as any).currentStatus === Status.Saving; },\n    isSuccess() { return (this as any).currentStatus === Status.Success; },\n    isFailed() { return (this as any).currentStatus === Status.Failed; },\n  },\n  methods: {\n    reset() {\n      // reset form to initial state\n      this.currentStatus = Status.Initial;\n      this.uploadError = null;\n    },\n    async save(fileList: FileList) {\n      // upload data to the server\n      this.currentStatus = Status.Saving;\n\n      try {\n        const result = await this.onFilesSelected(fileList);\n        if (result) {\n          this.$emit('done');\n          this.currentStatus = Status.Success;\n        } else {\n          this.currentStatus = Status.Initial;\n        }\n      } catch (e) {\n        this.currentStatus = Status.Failed;\n        this.uploadError = e;\n      }\n    },\n  },\n  mounted() {\n    this.reset();\n  },\n});\n","import { render } from \"./UploadCard.vue?vue&type=template&id=4565a82c\"\nimport script from \"./UploadCard.vue?vue&type=script&lang=ts\"\nexport * from \"./UploadCard.vue?vue&type=script&lang=ts\"\n\nimport \"./UploadCard.vue?vue&type=style&index=0&id=4565a82c&lang=scss\"\nscript.render = render\n\nexport default script","\nimport { computed, defineComponent, ref } from 'vue';\nimport LessonCard from '@/components/elements/LessonCard.vue';\nimport UploadCard from '@/components/elements/UploadCard.vue';\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport VideoLesson from '@/model/VideoLesson';\nimport workflowManager from '@/services/WorkflowManager';\n\nconst Tabs = Object.freeze({\n  Workflows: 'Workflows',\n  Videos: 'Videos',\n  Tools: 'Tools',\n});\nconst TabSet = Object.freeze(new Set(Object.values(Tabs)));\nconst TabList = Object.freeze(new Array(...Object.values(Tabs)));\n\nexport default defineComponent({\n  name: 'MainMenu',\n  emits: [\n    'lesson-selected',\n    'pose-drawer-selected',\n    'create-lesson-selected',\n    'workflow-selected',\n    'create-workflow-selected',\n  ],\n  components: {\n    LessonCard,\n    UploadCard,\n  },\n  setup(props, ctx) {\n    const motionList = db.motions;\n    const selectedDance = ref(null as DatabaseEntry | null);\n    const uploadUIActive = ref(false);\n    const currentTab = ref(Tabs.Tools);\n\n    function onLessonSelected(\n      videoEntry: DatabaseEntry,\n      lesson: VideoLesson,\n    ) {\n      ctx.emit('lesson-selected', videoEntry, lesson);\n      selectedDance.value = null;\n    }\n\n    function createLessonSelected(videoEntry: DatabaseEntry) {\n      ctx.emit('create-lesson-selected', videoEntry);\n      selectedDance.value = null;\n    }\n\n    return {\n      workflows: workflowManager.allWorkflows,\n      selectedDance,\n      motionList,\n      onLessonSelected,\n      createLessonSelected,\n      uploadUIActive,\n      workflowManager,\n\n      TabList,\n      Tabs,\n      currentTab,\n    };\n  },\n  methods: {\n    setTab(tab: string) {\n      console.log('Switching to tab:', tab);\n      if (!TabSet.has(tab)) {\n        console.error(`Tab ${tab} not recognized!`);\n        return;\n      }\n      this.currentTab = tab;\n    },\n    async uploadFiles(files: FileList) {\n      console.log('Upload files', files);\n\n      for (let i = 0; i < files.length; i += 1) {\n        const file = files.item(i);\n        if (!file) continue;\n        // eslint-disable-next-line no-await-in-loop\n        const text = await file.text();\n        const lesson = JSON.parse(text);\n        db.validateLesson(lesson);\n\n        // TODO: validate lesson\n        db.saveCustomLesson(lesson);\n      }\n      return true;\n    },\n  },\n});\n","import { render } from \"./MainMenu.vue?vue&type=template&id=4b6f86b5\"\nimport script from \"./MainMenu.vue?vue&type=script&lang=ts\"\nexport * from \"./MainMenu.vue?vue&type=script&lang=ts\"\n\nimport \"./MainMenu.vue?vue&type=style&index=0&id=4b6f86b5&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n   <div class=\"webcam-prompt-card vcenter-parent\" >\n        <div class=\"card\">\n          <div class=\"card-header\">\n            <h3 class=\"card-header-title\">\n            Webcam Access Needed\n            </h3>\n          </div>\n          <div class=\"card-content\">\n            <div class=\"content\">\n              <p>\n                During the lesson, you'll step back from your computer\n                and control this app with gestures. Later on, we'll also\n                use your webcam to give you tips on your technique.\n              </p>\n              <p class=\"notification is-warning\">\n                Please <strong>stop other programs that are using your webcam</strong>. On most computers, only one app is able to use the webcam at a time.\n              </p>\n              <p>\n                <strong>To continue, please grant access to your webcam.</strong>\n              </p>\n            </div>\n          </div>\n          <div class=\"card-content\">\n            <div class=\"buttons is-right\">\n              <a @click=\"$emit('cancelSelected')\" class=\"is-inverted button is-danger\">\n                Cancel\n              </a>\n              <a @click=\"$emit('startWebcamSelected')\" class=\"button is-primary\">\n                Start Webcam\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n</template>\n\n<script>\n\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n  name: 'WebcamPromptCard',\n});\n</script>\n\n<style lang=\"scss\">\n\n.webcam-prompt-card .content {\n  max-width: 60ch;\n  text-align: left;\n}\n</style>\n","import { render } from \"./WebcamPromptCard.vue?vue&type=template&id=07a96404\"\nimport script from \"./WebcamPromptCard.vue?vue&type=script&lang=js\"\nexport * from \"./WebcamPromptCard.vue?vue&type=script&lang=js\"\n\nimport \"./WebcamPromptCard.vue?vue&type=style&index=0&id=07a96404&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"pose-drawer p-4 content\">\n    <teleport to=\"#topbarLeft\">\n      <button class=\"button\" @click=\"$emit('back-selected')\">&lt; Back</button>\n    </teleport>\n\n    <teleport to='#belowSurface'>\n      <span class=\"is-pulled-right mt-4\">\n        <button class=\"button mr-2\"  @click=\"playVideo\">Play</button>\n        <button class=\"button\" @click=\"pauseVideo\">Pause</button>\n      </span>\n    </teleport>\n    <h3>Pose Drawer Test</h3>\n\n    <div class=\"dropdown\" :class=\"{ 'is-active': dropdownOpen}\">\n      <div class=\"dropdown-trigger\">\n        <button class=\"button\" @click=\"dropdownOpen = !dropdownOpen\">\n          <span>Select a dance</span>\n          <span class=\"icon is-small\">\n            <i class=\"fas fa-angle-down\" aria-hidden=\"true\"></i>\n          </span>\n        </button>\n      </div>\n      <div class=\"dropdown-menu\">\n        <div class=\"dropdown-content\">\n          <a v-for=\"motion in motions\"\n                  :key=\"motion.title\"\n                  class=\"dropdown-item\"\n            @click=\"loadMotion(motion)\">\n            {{motion.title}}\n          </a>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"columns\">\n      <div class=\"column\">\n        <h4 class=\"mt-4\">{{clipName}}</h4>\n\n        <div class=\"notification is-danger\" v-show=\"error\">\n          {{error}}\n        </div>\n\n        <div class=\"table-container\" style=\"overflow:auto auto; max-height: 500px;\">\n          <table class=\"table is-fullwidth is-hoverable is-bordered\" v-if=\"videoPlayer && videoPlayer.cPose\">\n            <thead>\n              <tr>\n                <th>id</th>\n                <th>x</th>\n                <th>y</th>\n                <th>vis</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr v-for=\"(lm, index) in videoPlayer.cPose\" :key=\"index\">\n                <td>{{index}}</td>\n                <td>{{lm.x}}</td>\n                <td>{{lm.y}}</td>\n                <td>{{lm.visibility}}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n      <div class=\"column is-one-third\">\n        <VideoPlayer\n        :videoBaseUrl=\"videoSrc\"\n        :height=\"'500px'\"\n        ref=\"videoPlayer\"\n        :drawPoseLandmarks=\"true\"\n        @progress=\"onProgress\"/>\n      </div>\n    </div>\n\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport {\n  computed, defineComponent, ref,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'PoseDrawerTest',\n  components: { VideoPlayer },\n  setup() {\n    const { motions } = db;\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n    const dropdownOpen = ref(false);\n    const clipName = ref('');\n    const videoSrc = computed(() => (clipName.value ? (`dances/${clipName.value}.mp4`) : ''));\n    const videoTime = ref(0);\n    const fps = ref(30);\n    const error = ref(null as string | null);\n\n    async function loadMotion(motion: DatabaseEntry) {\n      error.value = null;\n      dropdownOpen.value = false;\n      clipName.value = motion.clipName;\n      fps.value = motion.fps;\n    }\n\n    function playVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.playVideo(0, 1000, 0.5);\n    }\n    function pauseVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.pauseVideo();\n    }\n\n    function onProgress(time: number) {\n      videoTime.value = time;\n    }\n\n    return {\n      motions,\n      videoPlayer,\n      error,\n      loadMotion,\n      dropdownOpen,\n      clipName,\n      videoSrc,\n      playVideo,\n      pauseVideo,\n      onProgress,\n    };\n  },\n});\n</script>\n\n<style>\n\n.pose-drawer {\n  margin: auto;\n  width: 1280px;\n  height: 720px;\n  position: relative;\n  background: white;\n  box-sizing: border-box;\n}\n</style>\n","\nimport db, { DatabaseEntry } from '@/services/MotionDatabase';\nimport {\n  computed, defineComponent, ref,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'PoseDrawerTest',\n  components: { VideoPlayer },\n  setup() {\n    const { motions } = db;\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n    const dropdownOpen = ref(false);\n    const clipName = ref('');\n    const videoSrc = computed(() => (clipName.value ? (`dances/${clipName.value}.mp4`) : ''));\n    const videoTime = ref(0);\n    const fps = ref(30);\n    const error = ref(null as string | null);\n\n    async function loadMotion(motion: DatabaseEntry) {\n      error.value = null;\n      dropdownOpen.value = false;\n      clipName.value = motion.clipName;\n      fps.value = motion.fps;\n    }\n\n    function playVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.playVideo(0, 1000, 0.5);\n    }\n    function pauseVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.pauseVideo();\n    }\n\n    function onProgress(time: number) {\n      videoTime.value = time;\n    }\n\n    return {\n      motions,\n      videoPlayer,\n      error,\n      loadMotion,\n      dropdownOpen,\n      clipName,\n      videoSrc,\n      playVideo,\n      pauseVideo,\n      onProgress,\n    };\n  },\n});\n","import { render } from \"./PoseDrawerTest.vue?vue&type=template&id=9399757c\"\nimport script from \"./PoseDrawerTest.vue?vue&type=script&lang=ts\"\nexport * from \"./PoseDrawerTest.vue?vue&type=script&lang=ts\"\n\nimport \"./PoseDrawerTest.vue?vue&type=style&index=0&id=9399757c&lang=css\"\nscript.render = render\n\nexport default script","\nimport {\n  computed, defineComponent, nextTick, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { DatabaseEntry } from '@/services/MotionDatabase';\nimport WorkflowMenu from '@/components/screens/WorkflowMenu.vue';\nimport CreateWorkflowScreen from '@/components/screens/CreateWorkflowScreen.vue';\nimport VideoLessonPlayer from '@/components/elements/VideoLessonPlayer.vue';\nimport CameraSurface from './components/CameraSurface.vue';\nimport OnboardingUI from './components/OnboardingUI.vue';\nimport MainMenu from './components/screens/MainMenu.vue';\n// import LearningScreen from './components/screens/LearningScreen.vue';\nimport VideoLesson from './model/VideoLesson';\nimport WebcamPromptCard from './components/elements/WebcamPromptCard.vue';\n\nimport PoseDrawerTest from './components/screens/PoseDrawerTest.vue';\nimport CreateLessonScreen from './components/screens/CreateLessonScreen.vue';\nimport workflowManager from './services/WorkflowManager';\nimport optionsManager from './services/OptionsManager';\n\nconst State = {\n  MainMenu: 'MainMenu',\n  PromptStartWebcam: 'PromptStartWebcam',\n  StartingWebcam: 'StartingWebcam',\n  LoadingTracking: 'LoadingTracking',\n  Onboarding: 'Onboarding',\n  LessonActive: 'LessonActive',\n  WorkflowActive: 'WorkflowActive',\n  PoseDrawingTester: 'PoseDrawingTester',\n  CreateLesson: 'CreateLesson',\n  CreateWorkflow: 'CreateWorkflow',\n};\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    CameraSurface,\n    OnboardingUI,\n    MainMenu,\n    WorkflowMenu,\n    // LearningScreen,\n    WebcamPromptCard,\n    PoseDrawerTest,\n    CreateLessonScreen,\n    CreateWorkflowScreen,\n    VideoLessonPlayer,\n  },\n  setup() {\n    const state = ref(State.MainMenu);\n    const cameraSurface = ref(null as typeof CameraSurface | null);\n    const hasCompletedOnboarding = ref(false);\n\n    const currentVideo = ref(null as DatabaseEntry | null);\n    const currentLesson = ref(null as VideoLesson | null);\n\n    const showCameraSurface = computed(() => [\n      State.PromptStartWebcam,\n      State.StartingWebcam,\n      State.LoadingTracking,\n      State.Onboarding,\n      // State.LessonActive,\n    ].indexOf(state.value) !== -1);\n\n    function lessonSelected(videoEntry: DatabaseEntry, lesson: VideoLesson) {\n      currentVideo.value = videoEntry;\n      currentLesson.value = lesson;\n\n      state.value = State.LessonActive;\n      // if (webcamProvider.webcamStatus.value === 'running') state.value = State.LessonActive;\n      // else state.value = State.PromptStartWebcam;\n    }\n\n    function goHome() {\n      state.value = State.MainMenu;\n      currentVideo.value = null;\n      currentLesson.value = null;\n    }\n\n    async function startTracking() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      nextTick(() => {\n        const camSurface: any = cameraSurface.value;\n        state.value = State.LoadingTracking;\n        camSurface.startTracking();\n      });\n    }\n\n    async function startWebcam() {\n      console.log('Starting Webcam');\n\n      if (webcamProvider.webcamStatus.value !== 'running') {\n        state.value = State.StartingWebcam;\n\n        try {\n          await webcamProvider.startWebcam();\n        } catch (e) {\n          console.error('Error starting webcam: ', e);\n          // eslint-disable-next-line no-alert\n          alert('Failed to start the webcam\\n\\nPlease ensure this is the only app using the camera and that you\\'ve allowed camera access in your browser.');\n          state.value = State.MainMenu;\n          return;\n        }\n      }\n\n      state.value = State.LoadingTracking;\n      try {\n        await startTracking();\n      } catch (e) {\n        console.error(\"Couldn't start tracking\", e);\n      }\n    }\n\n    function onTrackingAttained() {\n      console.log('Tracking attained');\n      if (hasCompletedOnboarding.value) {\n        state.value = State.LessonActive;\n      } else state.value = State.Onboarding;\n    }\n\n    return {\n      showCameraSurface,\n      currentVideo,\n      currentLesson,\n      lessonSelected,\n      goHome,\n      startWebcam,\n      onTrackingAttained,\n      state,\n      cameraSurface,\n      State,\n      startedWithWorkflow: ref(false),\n    };\n  },\n  mounted() {\n    // If app was launched with a workflowId, skip straight\n    // to that workflow\n    if (optionsManager.workflowId.value) {\n      if (this.startWorkflow(optionsManager.workflowId.value)) {\n        this.startedWithWorkflow = true;\n      }\n    }\n  },\n  methods: {\n    poseDrawerSelected() {\n      this.state = State.PoseDrawingTester;\n    },\n    createLessonSelected(dance: DatabaseEntry) {\n      this.currentVideo = dance;\n      this.state = State.CreateLesson;\n    },\n    startWorkflow(workflowId: string) {\n      console.log('Starting workflow', workflowId);\n      if (workflowManager.setActiveFlow(workflowId)) {\n        this.state = State.WorkflowActive;\n        return true;\n      }\n      return false;\n    },\n  },\n});\n","import { render } from \"./App.vue?vue&type=template&id=f7dea538\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=f7dea538&lang=scss\"\nscript.render = render\n\nexport default script","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker';\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready() {\n      console.log(\n        'App is being served from cache by a service worker.\\n'\n        + 'For more details, visit https://goo.gl/AFskqB',\n      );\n    },\n    registered() {\n      console.log('Service worker has been registered.');\n    },\n    cached() {\n      console.log('Content has been cached for offline use.');\n    },\n    updatefound() {\n      console.log('New content is downloading.');\n    },\n    updated() {\n      console.log('New content is available; please refresh.');\n    },\n    offline() {\n      console.log('No internet connection found. App is running in offline mode.');\n    },\n    error(error) {\n      console.error('Error during service worker registration:', error);\n    },\n  });\n}\n","import { Landmark, MpHolisticResults, PoseLandmarks } from './MediaPipeTypes';\nimport eventHub, { EventNames, GestureNames } from './EventHub';\nimport {\n  HAND, usingHolistic,\n} from './MediaPipe';\n\nconst minDetectionVisibility = 0.85;\n\nfunction getAngle(lm0: Landmark, lm1: Landmark, aspectRatio: number) {\n  return Math.atan2(lm1.y - lm0.y, aspectRatio * (lm1.x - lm0.x));\n}\nfunction dist(lm0: Landmark, lm1: Landmark, aspectRatio: number) {\n  return Math.sqrt((aspectRatio * (lm1.x - lm0.x)) ** 2 + (lm1.y - lm0.y) ** 2);\n}\nconst getSum = (input: Array<number>) => input.reduce((a, b) => a + b, 0);\n\nfunction midPoint(lm0: Landmark, lm1: Landmark): Landmark {\n  return {\n    x: (0.5) * (lm0.x + lm1.x),\n    y: (0.5) * (lm0.y + lm1.y),\n  };\n}\n\nfunction averageAngle(input: Array<Landmark>, aspectRatio: number): number {\n  if (input.length < 2) return 0;\n\n  const angles = input.map(\n    (val, i, arr) => (arr[i + 1] === undefined ? 0 : getAngle(arr[i], arr[i + 1], aspectRatio)),\n  );\n  angles.pop();\n\n  const y = getSum(angles.map(Math.sin));\n  const x = getSum(angles.map(Math.cos));\n\n  return Math.atan2(y, x);\n}\n\nfunction isLine(input: Array<Landmark>, angleTolerance: number | undefined, aspectRatio: number): boolean {\n  if (input.length < 2) { return false; } // Single point: not a line\n\n  // Default the tolerance to 15 deg (on either side)\n  const tolerance = angleTolerance ?? Math.PI / 12;\n  let lastAngle = getAngle(input[0], input[1], aspectRatio);\n\n  // Make sure the angle is about correct\n  for (let i = 1; i < input.length - 1; i += 1) {\n    const thisAngle = getAngle(input[i], input[i + 1], aspectRatio);\n    if (Math.abs(thisAngle - lastAngle) >= tolerance) { return false; }\n\n    lastAngle = thisAngle;\n  }\n  return true;\n}\n\nfunction detectHandPointingGestures(handLandmarks: Landmark[] | undefined, aspectRatio: number): string {\n  if (!handLandmarks) return GestureNames.none;\n\n  const FINGERS = [\n    HAND.INDEX_FINGER,\n    HAND.MIDDLE_FINGER,\n    HAND.RING_FINGER,\n    HAND.PINKY_FINGER,\n  ];\n\n  const FINGER_LANDMARKS = FINGERS.map((indices) => indices.map((lm) => handLandmarks[lm]));\n\n  let areLines = true;\n  FINGER_LANDMARKS.forEach((finger) => {\n    if (!isLine(finger, undefined, aspectRatio)) areLines = false;\n  });\n\n  const avgAngle = averageAngle(FINGER_LANDMARKS[0], aspectRatio);\n  const avgAngleDeg = (avgAngle * 180) / Math.PI;\n\n  const tolerance = 30;\n  if (Math.abs(avgAngleDeg) < tolerance && areLines) return GestureNames.pointLeft;\n  if (Math.abs(avgAngleDeg) > 180 - tolerance && areLines) return GestureNames.pointRight;\n\n  return GestureNames.none;\n}\n\nfunction detectPosePointingGestures(poseLandmarks: Landmark[] | undefined, aspectRatio: number): string {\n  if (!poseLandmarks) return GestureNames.none;\n\n  const TOLERANCE = 20;\n  const TOLERANCE_RADS = TOLERANCE / (180 * Math.PI);\n\n  const left = [PoseLandmarks.leftElbow, PoseLandmarks.leftWrist].map((i) => poseLandmarks[i]);\n  const lelb = left[0];\n  const lwrist = left[1];\n  if (lelb.visibility && lelb.visibility > minDetectionVisibility && lwrist.visibility && lwrist.visibility > minDetectionVisibility) {\n    const ang = getAngle(lelb, lwrist, aspectRatio);\n    if (Math.abs(ang) > Math.PI - TOLERANCE_RADS) return GestureNames.pointRight;\n  }\n\n  const right = [PoseLandmarks.rightElbow, PoseLandmarks.rightWrist].map((i) => poseLandmarks[i]);\n  const relb = right[0];\n  const rwrist = right[1];\n  if (relb.visibility && relb.visibility > minDetectionVisibility && rwrist.visibility && rwrist.visibility > minDetectionVisibility) {\n    const ang = getAngle(relb, rwrist, aspectRatio);\n    if (Math.abs(ang) < TOLERANCE_RADS) return GestureNames.pointLeft;\n  }\n\n  return GestureNames.none;\n}\n\nfunction isNamasteGesture(results: MpHolisticResults, aspectRatio: number): boolean {\n  /* eslint-disable operator-linebreak, no-multi-spaces */\n  const IDs = PoseLandmarks;\n  const poseLMs = results.poseLandmarks;\n  if (!poseLMs) return false;\n\n  const areArmLandmarksVisible =\n    (poseLMs[IDs.leftShoulder].visibility  ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.leftElbow].visibility     ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.leftWrist].visibility     ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightShoulder].visibility ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightElbow].visibility    ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightWrist].visibility    ?? 0) > minDetectionVisibility;\n\n  // See if elbows are down, against the stomach\n  const downwards = -Math.PI / 2; // -90 deg\n  const leftForearmTargetAngle = downwards;\n  const rightForearmTargetAngle = downwards;\n  const elbowAngleTolerance = Math.PI / 9; // 20 deg\n\n  const leftForearmAngle = getAngle(poseLMs[IDs.leftShoulder], poseLMs[IDs.leftElbow], aspectRatio);\n  const rightForearmAngle = getAngle(poseLMs[IDs.rightShoulder], poseLMs[IDs.rightElbow], aspectRatio);\n\n  const areElbowsNearChest =\n    Math.abs(leftForearmAngle - leftForearmTargetAngle) < elbowAngleTolerance / 2 &&\n    Math.abs(rightForearmAngle - rightForearmTargetAngle) < elbowAngleTolerance / 2;\n\n  // See if hands are up and together, near base of neck\n  const handNeckMinRelativeDist = 0.8;\n  const shoulderDist = dist(poseLMs[IDs.leftShoulder], poseLMs[IDs.rightShoulder], aspectRatio);\n  const neckCenter = midPoint(poseLMs[IDs.leftShoulder], poseLMs[IDs.rightShoulder]);\n  const leftWristNeckDist = dist(neckCenter, poseLMs[IDs.leftWrist], aspectRatio) / shoulderDist;\n  const rightWristNeckDist = dist(neckCenter, poseLMs[IDs.rightWrist], aspectRatio) / shoulderDist;\n\n  const areHandsNearNeckBase =\n    leftWristNeckDist  < handNeckMinRelativeDist &&\n    rightWristNeckDist < handNeckMinRelativeDist;\n\n  // console.log('areArmLandmarksVisible', areArmLandmarksVisible);\n  // console.log('areElbowsNearChest', areElbowsNearChest);\n  // console.log('areHandsNearNeckBase', areHandsNearNeckBase);\n  // console.log('  leftWristNeckDist', leftWristNeckDist);\n  // console.log('  rightWristNeckDist', rightWristNeckDist);\n  return areArmLandmarksVisible &&\n  //  areElbowsNearChest &&\n         areHandsNearNeckBase;\n\n  /* eslint-enable operator-linebreak, no-multi-spaces */\n}\n\nexport default function detectGesture(mpResults?: MpHolisticResults): string {\n\n  const aspectRatio = (mpResults?.image?.width ?? 1) / (mpResults?.image?.height ?? 1);\n\n  if (!mpResults) return GestureNames.none;\n  let detectedGesture = GestureNames.none;\n\n  if (usingHolistic) {\n    if (detectedGesture === GestureNames.none) detectedGesture = detectHandPointingGestures(mpResults.rightHandLandmarks, aspectRatio);\n    if (detectedGesture === GestureNames.none) detectedGesture = detectHandPointingGestures(mpResults.leftHandLandmarks, aspectRatio);\n  } else detectedGesture = detectPosePointingGestures(mpResults.poseLandmarks, aspectRatio);\n\n  if (detectedGesture === GestureNames.none && isNamasteGesture(mpResults, aspectRatio)) {\n    detectedGesture = GestureNames.namaste;\n  }\n\n  return detectedGesture;\n}\n\nexport function startGestureDetection() {\n  eventHub.on(EventNames.trackingResults, (results: MpHolisticResults) => {\n    const detectedGesture = detectGesture(results);\n    eventHub.emit(EventNames.gesture, detectedGesture, results);\n  });\n}\n","import { createApp } from 'vue';\n\nimport App from './App.vue';\n\nimport './registerServiceWorker';\nimport { startGestureDetection } from './services/GestureDetection';\n\nrequire('bulma-slider');\n\nrequire('@/assets/main.scss');\n\nconst app = createApp(App);\napp.mount('#app');\n\nstartGestureDetection();\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./ActivityVideoPlayer.vue?vue&type=style&index=0&id=69bd566a&lang=scss\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./OnboardingUI.vue?vue&type=style&index=0&id=69ed9ac4&lang=scss\""],"sourceRoot":""}