{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/elements/VideoPlayer.vue?3241","webpack:///./src/assets/stickfigure.png","webpack:///./src/assets/gestures sync ^\\.\\/.*\\.svg$","webpack:///./src/components/DrawingSurface.vue?9aeb","webpack:///./src/components/elements/SegmentedProgressBar.vue?49dd","webpack:///./src/assets/gestures/forward.svg","webpack:///./src/components/elements/WebcamPromptCard.vue?02bc","webpack:///./src/components/screens/DanceMenu.vue?5986","webpack:///./src/components/OnboardingUI.vue?30c5","webpack:///./src/assets/gestures/play.svg","webpack:///./src/assets/gestures/backward.svg","webpack:///./src/assets/tiktokdances.jpg","webpack:///./src/components/CameraSurface.vue?e08a","webpack:///./src/components/elements/LessonCard.vue?a62f","webpack:///./src/components/screens/LearningScreen.vue?af6e","webpack:///./src/components/screens/PoseDrawerTest.vue?5fe7","webpack:///./src/App.vue","webpack:///./src/services/WebcamProvider.ts","webpack:///./src/components/CameraSurface.vue","webpack:///./src/services/EventHub.ts","webpack:///./src/components/DrawingSurface.vue","webpack:///./src/services/MediaPipeTypes.ts","webpack:///./src/services/Utils.ts","webpack:///./src/services/MediaPipe.ts","webpack:///./src/components/DrawingSurface.vue?0145","webpack:///./src/components/DrawingSurface.vue?3b98","webpack:///./src/components/CameraSurface.vue?7f23","webpack:///./src/components/CameraSurface.vue?8fa7","webpack:///./src/components/OnboardingUI.vue","webpack:///./src/components/elements/InstructionCarousel.vue","webpack:///./src/components/elements/InstructionCarousel.vue?eae7","webpack:///./src/components/elements/InstructionCarousel.vue?3dde","webpack:///./src/components/elements/GestureIcon.vue","webpack:///./src/components/elements/GestureIcon.vue?548f","webpack:///./src/components/elements/GestureIcon.vue?1324","webpack:///./src/components/OnboardingUI.vue?b3c5","webpack:///./src/components/OnboardingUI.vue?fcd3","webpack:///./src/components/screens/DanceMenu.vue","webpack:///./src/components/elements/LessonCard.vue","webpack:///./src/components/elements/LessonCard.vue?090b","webpack:///./src/components/elements/LessonCard.vue?8b6b","webpack:///./src/services/MotionDatabase.ts","webpack:///./src/components/screens/DanceMenu.vue?3ac9","webpack:///./src/components/screens/DanceMenu.vue?9623","webpack:///./src/components/screens/LearningScreen.vue","webpack:///./src/model/DanceLesson.ts","webpack:///./src/services/ScreenRecorder.ts","webpack:///./src/services/MotionRecorder.ts","webpack:///./src/components/elements/SegmentedProgressBar.vue","webpack:///./src/components/elements/SegmentedProgressBar.vue?1c88","webpack:///./src/components/elements/SegmentedProgressBar.vue?1b9d","webpack:///./src/components/elements/PausingVideoPlayer.vue","webpack:///./src/components/elements/VideoPlayer.vue","webpack:///./src/services/PoseProvider.ts","webpack:///./src/components/elements/VideoPlayer.vue?e7d3","webpack:///./src/components/elements/VideoPlayer.vue?b67d","webpack:///./src/components/elements/PausingVideoPlayer.vue?fe03","webpack:///./src/components/elements/PausingVideoPlayer.vue?8e8a","webpack:///./src/components/elements/WebcamBox.vue","webpack:///./src/components/elements/WebcamBox.vue?0a4a","webpack:///./src/components/elements/WebcamBox.vue?e390","webpack:///./src/components/screens/LearningScreen.vue?7818","webpack:///./src/components/screens/LearningScreen.vue?9387","webpack:///./src/components/elements/WebcamPromptCard.vue","webpack:///./src/components/elements/WebcamPromptCard.vue?a879","webpack:///./src/components/screens/PoseDrawerTest.vue","webpack:///./src/components/screens/PoseDrawerTest.vue?af42","webpack:///./src/components/screens/PoseDrawerTest.vue?bc96","webpack:///./src/App.vue?3acc","webpack:///./src/App.vue?eabf","webpack:///./src/registerServiceWorker.ts","webpack:///./src/services/GestureDetection.ts","webpack:///./src/main.ts","webpack:///./src/components/elements/InstructionCarousel.vue?646b","webpack:///./src/App.vue?17f8","webpack:///./src/components/elements/WebcamBox.vue?0f67"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","map","webpackContext","req","id","webpackContextResolve","e","Error","code","keys","resolve","class","src","alt","state","State","DanceMenu","danceSelected","poseDrawerSelected","ref","onTrackingAttained","background","OnboardingLoading","ui","LessonActive","target-dance","currentDance","target-lesson","currentLesson","goHome","PoseDrawingTester","PromptStartWebcam","startWebcam","StartingWebcam","LoadingTracking","Onboarding","WEBCAM_DIMENSIONS","freeze","width","height","recorder","mediaStream","activeConnections","Set","permissionState","isWebcamLoading","webcamError","isRecording","webcamStatus","this","readPermissionStatus","navigator","permissions","query","constraints","video","facingMode","aspectRatio","frameRate","audio","mediaDevices","getUserMedia","videoE","add","console","log","srcObject","onloadedmetadata","play","delete","size","stopWebcam","stopRecording","getTracks","forEach","x","stop","rtc","type","startRecording","Promise","res","getBlob","saveBlob","defaultProvider","muted","style","enableDrawing","isActivelyTracking","mpResults","trackingResults","EventNames","gesture","trackingProcessingStarted","trackingRequested","trackingRequestFinished","GestureNames","none","pointLeft","pointRight","namaste","eventHub","setupGestureListening","callbacks","fallback","onGesture","cb","on","off","setupMediaPipeListening","callback","onFrameProcessingStarted","TrackingActions","requestTracking","emit","endTrackingRequest","PoseLandmarks","nose","leftEyeInner","leftEye","leftEyeOuter","rightEyeInner","rightEye","rightEyeOuter","leftEar","rightEar","mouthLeft","mouthRight","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftPinky","rightPinky","leftIndex","rightIndex","leftThumb","rightThumb","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle","leftHeel","rightHeel","leftFootIndex","rightFootIndex","secs","setTimeout","filename","text","element","document","createElement","setAttribute","encodeURIComponent","display","body","appendChild","click","removeChild","onFrame","shouldRun","undefined","requestAnimationFrame","then","Utils","DoEveryFrame","usingHolistic","mp","HAND_LANDMARK_CONNECTIONS","HAND","THUMB_FINGER","INDEX_FINGER","MIDDLE_FINGER","RING_FINGER","PINKY_FINGER","CONNECTIONS_TO_DRAW","v0","v1","trackingStarted","DrawConnections","canvasCtx","landmarks","connections","w","canvas","h","beginPath","connection","p1","p2","moveTo","y","lineTo","stroke","restore","DrawPose","poseLandmarks","options","jointsWithEmphasis","emphasizedJoints","save","sourceAR","sourceAspectRatio","canvasAR","adjustedHeight","pixelsTaller","translate","adjustedWidth","pixelsWider","visibility","emphasized","indexOf","emphasisStroke","strokeStyle","lineWidth","p1a","p1b","trackingRequests","trackingCount","filter","StartTracking","initial","mpInstance","Holistic","locateFile","file","Pose","setOptions","upperBodyOnly","smoothLandmarks","minDetectionConfidence","minTrackingConfidence","frameId","onResults","send","image","isTracking","drawHandShape","results","rightHandLandmarks","lineCap","drawTrackingResults","enabled","detectedGesture","clearRect","props","Boolean","default","setup","canvasE","ges","getContext","isEnabledNow","render","components","DrawingSurface","trackingIntervalId","hasStartedTracking","hasResults","methods","startTracking","$refs","whenReady","setInterval","clearInterval","readyState","connectVideoElement","instructions","gestureIcon","stage","OnboardingStage","done","skipOnboarding","tag","inst","sizeClass","Array","String","showIcon","iconClass","gestureImgSrc","GestureIcons","forward","backward","trySelectNext","trySelectPrevious","tryPerformPlay","InstructionCarousel","GestureIcon","ctx","output","instructs","motionList","dance","title","hover","hovering","selectedDance","videoSrc","$emit","danceLessonSelected","autoplay","lessons","lesson","_id","header","lessonTitle","__scopeId","dances","emits","LessonCard","sel","to","activityId","activityCount","max","activityTitle","videoTime","activity","userVisual","targetDance","onTimeChanged","onActivityFinished","onPauseHit","onPauseEnded","drawPoseLandmarks","demoVisual","videoOpacity","showPlayGestureIcon","activityFinished","timedInstructions","staticInstruction","segments","progressSegments","progress","gotoPreviousActivity","gotoNextActivity","isSavingFrames","startSaveFrames","disabled","canSaveFrame","startInstruction","getDisplayMedia","captureStream","rej","recordingSessions","recordingSessionNextId","screenRecorder","userDims","demoDims","frameTimestamps","userDimension","userFrames","demoDimension","demoFrames","sessionId","timestamp","userFrame","demoFrame","session","start","end","endRecording","recordedBlob","mSession","startTime","endTime","PromptDownloadFile","JSON","stringify","motionRecorder","segmentsData","seg","cssClass","min","cssClassOptions","Number","videoBaseUrl","onProgress","onSegmentPlaybackCompleted","setDrawStyle","emphasizedJointStyle","videoUrl","scheduleCanvasResizing","poseFiles","Map","videoName","poseFilename","replace","cached","stored","localStorage","getItem","parse","set","PoseProvider","getPoseFile","poseFile","poses","convertToPoseList","setItem","url","fetch","response","ok","statusText","csv","temp","row","convertRow","startsWith","lms","parseFloat","poseProvider","onResize","modified","offsetWidth","offsetHeight","setupCanvasResizing","videoElement","canvasElement","resizeCanvas","addEventListener","removeEventListener","setupVideoPlaying","startProgressUpdating","playVideo","from","speed","pause","playbackRate","currentTime","error","pauseVideo","fps","Function","canvasModified","currentPose","frame","Math","floor","pose","prevTime","timerId","onTimeUpdated","vidElement","time","clearDrawing","drawCtx","drawPose","GetPose","getVideoDimensions","setTime","DEFAULT_PAUSE_DURATION","computePlaySegments","pauses","segs","nextPauseIndex","prevIndex","pTime","pauseIndex","pi","segStartTime","VideoPlayer","videoPlayer","playTimeoutId","vidPlayer","playSegment","delaySecs","emitResume","onPlayStart","clearTimeout","playingSegments","playingSegmentIndex","playDelaySecs","nextSeg","manualResume","pauseDuration","disablePictureInPicture","webcamStartError","enableRecordButton","status","disconnectVideoElement","webcamProvider","DefaultPauseDuration","ActivityPlayState","AwaitingPlayGesture","PendingStart","Playing","ActivityEnded","calculateProgressSegments","last","segmentBreaks","segData","focusedSegments","TRACKING_ID","setupFrameRecording","playActivity","recordingSessionId","lastPose","saveMotionFrame","warn","startRecordingSession","concludeSaveFrames","sleep","endRecordingSession","SegmentedProgressBar","PausingVideoPlayer","WebcamBox","targetLesson","activityState","activities","hasNextActivity","nextActivityTitle","nextActivity","pauseInstructs","instruction","mActivity","playingInstruction","endInstruction","activeTimedInstructions","ti","curActivity","vidActivity","practiceSpeeds","forcePlay","shouldPauseBeforeActivity","gotoActivity","delta","isTrackingUser","val","aria-hidden","dropdownOpen","loadDance","clipName","cPose","lm","index","CameraSurface","OnboardingUI","LearningScreen","WebcamPromptCard","PoseDrawerTest","cameraSurface","hasCompletedOnboarding","camSurface","alert","ready","registered","updatefound","updated","offline","minDetectionVisibility","getAngle","lm0","lm1","atan2","dist","sqrt","getSum","input","reduce","a","b","midPoint","averageAngle","angles","arr","pop","sin","cos","isLine","angleTolerance","tolerance","PI","lastAngle","thisAngle","abs","detectHandPointingGestures","handLandmarks","FINGERS","FINGER_LANDMARKS","indices","areLines","finger","avgAngle","avgAngleDeg","detectPosePointingGestures","TOLERANCE","TOLERANCE_RADS","left","lelb","lwrist","ang","right","relb","rwrist","isNamasteGesture","IDs","poseLMs","areArmLandmarksVisible","downwards","leftForearmTargetAngle","rightForearmTargetAngle","elbowAngleTolerance","leftForearmAngle","rightForearmAngle","handNeckMinRelativeDist","shoulderDist","neckCenter","leftWristNeckDist","rightWristNeckDist","areHandsNearNeckBase","detectGesture","leftHandLandmarks","startGestureDetection","app","App","mount"],"mappings":"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","file":"js/app.c92037ce.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./VideoPlayer.vue?vue&type=style&index=0&id=6b67d402&lang=scss\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOQAAADdCAMAAACc/C7aAAAAdVBMVEX///8AAAD8/PxwcHChoaH5+fna2trp6emsrKzw8PDKysri4uJsbGyNjY15eXnf39+/v7+ysrJeXl4/Pz8SEhJISEhkZGSampolJSUgICBQUFDQ0NA6OjpXV1d+fn6GhoYzMzMNDQ08PDwYGBgkJCSvr6+VlZVDZ31HAAAGZUlEQVR4nO2diXLiMAyGLRMHEiCc4T5CaXn/R1zLJpSFHKZLFuTq25k2k6Qz/teXJMuOEAzDMAzDMAzDMAzDMAzDMAzDME0hLa8uRgPkmoKgA5ZOEJ0f+aFXy0AlUTxGdfvdbpckO7zsxZF5+OoCPgMrYp4BTPaD8Hwz7CaTBWw6kR8ajcpuolvo8PqOJgoAFvNXlerp6IZ6Mhe31XbSjfb/F+fJGFGDFgSqpFlGfdh178UTQ4oYoC/KdegxaE1bpESNk5GRWChE3+wsISx6RIkxBEZfWWVJ0QVQ/7NEz6cHteOn1P2SdLecwb62/FIkkBAWOYBU1No0+vESCA+xiR5Tau1x/TR2qPB3pQ1J2bD6N2pGc+zBVtoD1/pRuiop1qQUKk1dS65S7JXk0OpC6Dj3tDm0my1PI0icGdrOTnHb2H7U0OKy5QP9DFYNFqYppIiOvQfmhdUmarI4TfFlJ0nHt2MY1r/0fozQh3LUKMWQsEjnt0mKlEaku0rCIt37JEmR2uU3A4/r2yQHHpwns3o/6wLJeVKzWDzQJ2mKlCLAkceRWLvX9NC9MYQv505J1EAXontw9icjOFIUiXW4cxbZPq8jEMPEWmGj8utqMIZAlROM8vXJSjroXlNFwQZ/1UbrplNFNlonRB/GDm+lZimBqEhd7AC2dYkBKsVGTVUjEk3tmlWFiBiWhAUa2nDcibIOh3dbACQDH99IVGlabNnjFA7kNaK4AMZlRux6ZTws0s1V2h8BwKrIauumYCdI0iJz4g+AxEaP5SU/Kexp7e5+CgFMPtbqKzdsgtEGc7LWvuSdyXPdqbkeR2Fh0VetjqqcWWjxbbyuw3CZTSHLskGYZ3x4IhK5ktIi7HA4wyJ9gUX6Aov0BRbpCyzSF1ikL7BIX2CRvsAifUGLdEtMJ8l5W8EMhC+ByDLWM3BOJCCJlrbGfb6pxxq1yi0sIlwcIL/NrhDTB0cTCCI98HSmMCK516WeaA9pLOwUksLSmy3b1wyn5/1YZp7cAySvLtHTafcB4nz5HG/EKfRJJpqVE+qKyweb3OJpQZ4yQZzznL+FY3C5dzHrgqNNf6F/FIjEXQXQu2qZ37Zruwfj0APrRwo1huXcXlouIvWN+RSGlBPODBLnxkyJ6yXlXKRdfs7sY7pIzK27S9G+cbX68Gm3EZBstZi6vIHWXSbSrT85TOHUPv8BQfpTiNXd/pcbkRIzeg9UN6drp2o3EOJud/pfIu2jAJwyRt8OpSeOvwbVC0Xhj0EPepQ8EzuMRhNYluzELo7xnIDQZGLb5hdAUJb7WBLIGi7gg4pIBJM/49I5oSxap/qwobInTWqNh5Yor5RCkaaRa8OBxpFZEn3FytTHqrjrmMjWCXn5UUJlcDmIn1uahpD2X7lMDyLo57zPiqosF0nHs5R1awBVIglNIdV40FzrYZG+wCJ9gUX6Aov0hV8gUv4Gkb+iJsUQ/BeJ6R+jVxeiSdCPgixaQVD3JmWkbKHA7YL2QlYNoUmHWJ/PPfGTNthjh0dEQo8/AqZ2WV1lFI82qwcHndMld0eZY7+ohK2ckUoEVx9b6Hvw4YUios0lB1RirXa9Cc3lSBEtIc4bKJ4IcoCBdyrF/MbQGUDrRSVpjiFMbubGGR5wRiZm7kK74IBB+IworbrWorZ3EyN+SWQa+TSNjArP3huSPBa8EHOopDZ1bqpMXk4A8wGp7ZusKBlb3/FoY8FO+1f3bgf2xg5mvHpBYkzW2yqzi5GPHAH7vmAyyLTkiSZaeKASNVZ+UaoNMw8sgqTmq1n4KSbSGqW0Z0lWQvSM3itik+NZXlMSLXWgXZUqcxhX1nQjPmaKOLnEcuTMBGIp1qY0n8f4cIo9YoiSokZUGcLEpejoj2zIuiMzbKz1ZTfnn9IMUUqx0v6VU/VIuoHYUNsyzijYUmyua5zknQw2kxzZIRmITSGqznv9xvxXVJu470kCVXnoBUQHYivQ2Poe/grhgNYuZ+1ffT74+Q9ssXtiX5roYQd7pCaNEQgLSoeFz2H18Ektxh85NlWi54LChj/dQzdDf4TCfKnLOPnhbCDl2H5f5M3RJVQTbaL9qKAYoU0p+CPyHPz/SUkl/vGKQFXqYv5Dlo4Uk4RCrzQLcr4zp7Fv7l+o3cTkCQTGDYZhGIZhGIZhGIZhGIZhGIZhGIZhGIZhGIZhXswfm14q+rTiKjIAAAAASUVORK5CYII=\"","var map = {\n\t\"./backward.svg\": \"6218\",\n\t\"./forward.svg\": \"3b9e\",\n\t\"./play.svg\": \"5cd5\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"1942\";","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./DrawingSurface.vue?vue&type=style&index=0&id=70cfc891&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./SegmentedProgressBar.vue?vue&type=style&index=0&id=c8d89964&lang=scss\"","module.exports = __webpack_public_path__ + \"img/forward.e257a03f.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./WebcamPromptCard.vue?vue&type=style&index=0&id=07a96404&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./DanceMenu.vue?vue&type=style&index=0&id=729dce3c&lang=scss\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./OnboardingUI.vue?vue&type=style&index=0&id=66b15206&lang=scss\"","module.exports = __webpack_public_path__ + \"img/play.8c9e21c7.svg\";","module.exports = __webpack_public_path__ + \"img/backward.434f566c.svg\";","module.exports = __webpack_public_path__ + \"img/tiktokdances.589b3b61.jpg\";","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CameraSurface.vue?vue&type=style&index=0&id=182e86da&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./LessonCard.vue?vue&type=style&index=0&id=3a8204fa&lang=scss&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./LearningScreen.vue?vue&type=style&index=0&id=d6a33c42&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./PoseDrawerTest.vue?vue&type=style&index=0&id=5ad1df51&lang=css\"","<template>\n<div class=\"app\">\n   <div id=\"aboveSurface\" class=\"pb-4 pt-4\">\n     <span id=\"topbarLeft\"></span>\n     <span class=\"spacer\"></span>\n     <span id=\"topbarCenter\"></span>\n     <span class=\"spacer\"></span>\n     <span id=\"topbarRight\"></span>\n\n  </div>\n\n  <DanceMenu\n        v-on:dance-selected=\"danceSelected\"\n        v-if=\"state === State.DanceMenu\"\n        @pose-drawer-selected=\"poseDrawerSelected\"\n      />\n\n  <CameraSurface\n    ref=\"cameraSurface\"\n    @tracking-attained=\"onTrackingAttained()\"\n    v-show=\"state !== State.DanceMenu\">\n\n    <template v-slot:background>\n      <img v-show=\"state == State.OnboardingLoading\"\n      src=\"./assets/tiktokdances.jpg\"\n      alt=\"Background Image\">\n    </template>\n\n    <template v-slot:ui>\n\n      <LearningScreen v-if=\"state == State.LessonActive\"\n        :target-dance=\"currentDance\"\n        :target-lesson=\"currentLesson\"\n        @lesson-completed=\"goHome\"\n        @back-selected=\"goHome\"\n      />\n\n      <PoseDrawerTest\n        v-if=\"state === State.PoseDrawingTester\"\n        @back-selected=\"goHome\" />\n\n     <WebcamPromptCard v-if=\"state === State.PromptStartWebcam\"\n      @cancel-selected=\"state = State.DanceMenu\"\n      @startWebcamSelected=\"startWebcam\"\n     />\n\n      <div class=\"vcenter-parent\" v-if=\"state === State.StartingWebcam\">\n        <div class=\"translucent-text is-rounded has-text-centered\">\n          <div class=\"content\">\n            <h3 class=\"has-text-white m-2\">Starting Webcam...</h3>\n          </div>\n          <div class=\"loader-progress loader is-loading mt-5 mb-5\"></div>\n        </div>\n      </div>\n\n      <div class=\"vcenter-parent\" v-if=\"state === State.LoadingTracking\">\n        <div class=\"translucent-text is-rounded has-text-centered\">\n          <div class=\"content has-text-white m-2 has-text-centered\">\n            <h3 class=\"has-text-white\">Starting Gestures...</h3>\n          </div>\n          <div class=\"loader-progress loader is-loading mt-5 mb-5\"></div>\n        </div>\n      </div>\n\n      <OnboardingUI v-if=\"state == State.Onboarding\"\n        @onboarding-complete=\"state= State.LessonActive \"/>\n    </template>\n\n  </CameraSurface>\n  <div id=\"belowSurface\"></div>\n</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, nextTick, ref } from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport CameraSurface from './components/CameraSurface.vue';\nimport OnboardingUI from './components/OnboardingUI.vue';\nimport DanceMenu from './components/screens/DanceMenu.vue';\nimport LearningScreen from './components/screens/LearningScreen.vue';\nimport DanceEntry, { LessonSelection } from './model/DanceEntry';\nimport DanceLesson from './model/DanceLesson';\nimport WebcamPromptCard from './components/elements/WebcamPromptCard.vue';\n\nimport PoseDrawerTest from './components/screens/PoseDrawerTest.vue';\n\nconst State = {\n  DanceMenu: 'DanceMenu',\n  PromptStartWebcam: 'PromptStartWebcam',\n  StartingWebcam: 'StartingWebcam',\n  LoadingTracking: 'LoadingTracking',\n  Onboarding: 'Onboarding',\n  LessonActive: 'LessonActive',\n  PoseDrawingTester: 'PoseDrawingTester',\n};\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    CameraSurface,\n    OnboardingUI,\n    DanceMenu,\n    LearningScreen,\n    WebcamPromptCard,\n    PoseDrawerTest,\n  },\n  setup() {\n    const state = ref(State.DanceMenu);\n    const cameraSurface = ref(null as typeof CameraSurface | null);\n    const hasCompletedOnboarding = ref(false);\n\n    const currentDance = ref(null as DanceEntry | null);\n    const currentLesson = ref(null as DanceLesson | null);\n\n    function danceSelected(sel: LessonSelection) {\n      currentDance.value = sel.dance;\n      currentLesson.value = sel.lesson;\n\n      if (webcamProvider.webcamStatus.value === 'running') state.value = State.LessonActive;\n      else state.value = State.PromptStartWebcam;\n    }\n\n    function goHome() {\n      state.value = State.DanceMenu;\n      currentDance.value = null;\n      currentLesson.value = null;\n    }\n\n    async function startTracking() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      nextTick(() => {\n        const camSurface: any = cameraSurface.value;\n        state.value = State.LoadingTracking;\n        camSurface.startTracking();\n      });\n    }\n\n    async function startWebcam() {\n      console.log('Starting Webcam');\n\n      if (webcamProvider.webcamStatus.value !== 'running') {\n        state.value = State.StartingWebcam;\n\n        try {\n          await webcamProvider.startWebcam();\n        } catch (e) {\n          console.error('Error starting webcam: ', e);\n          // eslint-disable-next-line no-alert\n          alert('Failed to start the webcam\\n\\nPlease ensure this is the only app using the camera and that you\\'ve allowed camera access in your browser.');\n          state.value = State.DanceMenu;\n          return;\n        }\n      }\n\n      state.value = State.LoadingTracking;\n      try {\n        await startTracking();\n      } catch (e) {\n        console.error(\"Couldn't start tracking\", e);\n      }\n    }\n\n    function onTrackingAttained() {\n      console.log('Tracking attained');\n      if (hasCompletedOnboarding.value) {\n        state.value = State.LessonActive;\n      } else state.value = State.Onboarding;\n    }\n\n    return {\n      currentDance,\n      currentLesson,\n      danceSelected,\n      goHome,\n      startWebcam,\n      onTrackingAttained,\n      state,\n      cameraSurface,\n      State,\n    };\n  },\n  methods: {\n    poseDrawerSelected() {\n      this.state = State.PoseDrawingTester;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\nbody, html {\n  margin: 0;\n  padding: 0;\n  width: 100%;\n  background-color: #00d1b2;\n  // background-image: linear-gradient(45deg, #00d1b2 0%, #3475da 100%);\n\n  // background-color: #FF9A8B;\n  // background-image: linear-gradient(135deg, #B721FF 0%, #145eb3 100%);\n\n  background-image: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);\n\n  background-size: 100vw 100vh;\n  background-attachment: fixed;\n}\n\n.card {\n  display: inline-block;\n  max-width: 90%;\n}\n\n.vcenter-parent {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n}\n\n.loader-progress {\n  width: 100px;\n  height: 100px;\n  margin: auto;\n}\n\n#aboveSurface {\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n\n  span {\n    flex: 0 0 auto;\n  }\n  .spacer {\n    flex: 1 1 0;\n  }\n\n  width: 1280px;\n  margin: auto;\n}\n\n#belowSurface {\n  width: 1280px;\n  margin: auto;\n}\n\n#topbarLeft, #topbarRight, #topbarCenter {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n.background-blur {\n  backdrop-filter: blur(4px);\n  background: rgba(0, 0, 0, 0.75);\n}\n\n.translucent-text {\n  backdrop-filter: blur(4px);\n  color: white;\n  padding: 10px 20px;\n  background: rgba(0, 0, 0, 0.55);\n}\n\n.translucent-text.is-rounded {\n  border-radius: 0.25rem;\n}\n\n.is-slightly-rounded {\n  border-radius: 0.25rem;\n}\n\n</style>\n","import RecordRTC, { invokeSaveAsDialog } from 'recordrtc';\n\nimport { computed, ref, Ref } from 'vue';\n\nexport const WEBCAM_DIMENSIONS = Object.freeze({\n  width: 640,\n  height: 480,\n});\n\nexport class WebcamProvider {\n\n  // Recorder class\n  private recorder = ref(null as null | RecordRTC);\n\n  // The actual media stream\n  private mediaStream = ref(null as null | MediaStream);\n\n  // List of active connections. Used so we know when to pause the webcam\n  private activeConnections: Set<HTMLVideoElement> = new Set();\n\n  private permissionState: Ref<PermissionState> = ref('prompt');\n\n  private isWebcamLoading = ref(false);\n\n  public webcamError = ref(null as any);\n\n  public isRecording = ref(false);\n\n  constructor() {\n    this.readPermissionStatus();\n  }\n\n  private async readPermissionStatus(): Promise<void> {\n    if (navigator.permissions) {\n      try {\n        const result = await navigator.permissions.query({ name: 'camera' });\n        this.permissionState.value = result.state;\n\n        // eslint-disable-next-line no-empty\n      } catch { }\n    }\n  }\n\n  public permissionStatus(): Ref<PermissionState> {\n    return this.permissionState;\n  }\n\n  public async startWebcam(): Promise<void> {\n    if (this.mediaStream.value || this.isWebcamLoading.value) {\n      return;\n    }\n    this.isWebcamLoading.value = true;\n\n    try {\n      const constraints: MediaStreamConstraints = {\n        video: {\n          facingMode: 'user',\n          width: WEBCAM_DIMENSIONS.width,\n          height: WEBCAM_DIMENSIONS.height,\n          aspectRatio: 1.777777778,\n          frameRate: 30,\n        },\n        audio: true,\n      };\n\n      if (!navigator.mediaDevices?.getUserMedia) throw new Error(\"Browser doesn't support webcam\");\n\n      this.mediaStream.value = await navigator.mediaDevices.getUserMedia(constraints);\n\n      this.permissionState.value = 'granted';\n    } finally {\n      this.isWebcamLoading.value = false;\n    }\n  }\n\n  public webcamStatus = computed(() => {\n    if (this.mediaStream.value) return 'running';\n    if (this.isWebcamLoading.value) return 'loading';\n    return 'stopped';\n  });\n\n  public async connectVideoElement(videoE: HTMLVideoElement): Promise<void> {\n\n    if (this.permissionState.value !== 'granted') throw new Error(\"Doesn't have permissions yet!\");\n\n    this.activeConnections.add(videoE);\n\n    // eslint-disable-next-line no-param-reassign\n    console.log('Connecting media stream to video');\n    videoE.srcObject = this.mediaStream.value;\n    videoE.onloadedmetadata = () => {\n      videoE.play();\n      console.log('Connected media stream to video');\n    };\n  }\n\n  public disconnectVideoElement(videoE: HTMLVideoElement): void {\n    this.activeConnections.delete(videoE);\n\n    videoE.srcObject = null;\n\n    if (this.activeConnections.size === 0 && !this.recorder) {\n      this.stopWebcam();\n    }\n  }\n\n  public async stopWebcam(): Promise<void> {\n    if (this.recorder) {\n      try {\n        await this.stopRecording();\n        // eslint-disable-next-line no-empty\n      } catch { }\n    }\n\n    if (this.mediaStream.value) {\n      this.mediaStream.value.getTracks().forEach((x) => x.stop());\n    }\n    this.mediaStream.value = null;\n  }\n\n  public async startRecording(): Promise<void> {\n    if (this.recorder.value || this.isRecording.value) {\n      return;\n    }\n\n    if (!this.mediaStream.value) {\n      throw new Error('Webcam must be started before recording can happen');\n    }\n\n    this.isRecording.value = true;\n\n    const rtc = new RecordRTC(this.mediaStream.value, {\n      type: 'video',\n    });\n    rtc.startRecording();\n    this.recorder.value = rtc;\n  }\n\n  public async stopRecording(): Promise<Blob> {\n\n    return new Promise((res) => {\n      if (!this.recorder.value) throw new Error(\"Haven't started recording\");\n      this.isRecording.value = false;\n      const recorder = this.recorder.value;\n      this.recorder.value.stopRecording(() => {\n        res(recorder.getBlob());\n        this.recorder.value = null;\n      });\n    });\n  }\n\n  public async clearRecording(): Promise<void> {\n    // TODO: pay attention to status of recording\n    // this.recorder?.stopRecording();\n    this.recorder.value = null;\n  }\n\n  // public async postFiles(url: string, filename: string): Promise<void> {\n  //   if (!this.recorder) throw new Error('Nothing to post');\n\n  //   const blob = this.recorder.getBlob();\n  //   invokeSaveAsDialog(blob, filename);\n\n  //   const fname = `${filename}.webm`;\n\n  //   const file = new File([blob], fname, {\n  //     type: 'video/webm',\n  //   });\n\n  // videoElement.src = '';\n  // videoElement.srcObject = null;\n\n  // if (mediaStream) { mediaStream.stop(); }\n  // }\n}\n\nexport const saveBlob = invokeSaveAsDialog;\n\nconst defaultProvider = new WebcamProvider();\n\nexport default defaultProvider;\n","<template>\n  <div ref=\"canvasBackground\" class=\"surface-container is-slightly-rounded\">\n\n    <div class=\"overlay overlay-background\">\n      <slot name=\"background\"></slot>\n    </div>\n\n    <video\n      class=\"mirrored is-slightly-rounded\"\n      ref=\"videoE\"\n      muted\n      :style=\"{\n        height: '720px',\n        width: '1280px',\n      }\"\n    ></video>\n\n    <div class=\"overlay\">\n      <slot name=\"ui\"></slot>\n    </div>\n\n    <DrawingSurface\n    :enableDrawing=\"isActivelyTracking\"\n    :mpResults=\"trackingResults\" ref=\"drawingSurface\" class=\"overlay\"/>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  defineComponent, onUpdated, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { setupMediaPipeListening } from '@/services/EventHub';\nimport { MpHolisticResults } from '@/services/MediaPipeTypes';\nimport DrawingSurface from './DrawingSurface.vue';\nimport { isTracking as mpIsTracking, StartTracking } from '../services/MediaPipe';\n\nexport default defineComponent({\n  name: 'CameraSurface',\n  components: {\n    DrawingSurface,\n  },\n  data() {\n    return {\n      trackingIntervalId: -1,\n    };\n  },\n  setup(props, { emit }) {\n    // const { enableDrawing } = toRefs(props);\n    const hasStartedTracking = ref(false);\n    const isActivelyTracking = ref(false);\n    const hasResults = ref(false);\n    const trackingResults = ref({});\n\n    onUpdated(() => {\n      isActivelyTracking.value = mpIsTracking();\n    });\n\n    function onResults(results: MpHolisticResults) {\n      if (!hasResults.value) {\n        emit('tracking-attained');\n        console.log('Got Results', results);\n      }\n      hasResults.value = true;\n      trackingResults.value = results;\n      // this.$refs.drawingSurface.draw(results, canvasCtx);\n    }\n\n    setupMediaPipeListening(onResults);\n\n    return {\n      hasStartedTracking,\n      isActivelyTracking,\n      hasResults,\n      trackingResults,\n    };\n  },\n  methods: {\n    startTracking() {\n      if (this.trackingIntervalId !== -1) return;\n\n      const videoE = this.$refs.videoE as HTMLVideoElement;\n      const whenReady = () => {\n        if (this.hasStartedTracking) return;\n        this.hasStartedTracking = true;\n        console.log('Video loaded. Starting tracking...');\n\n        StartTracking(\n            this.$refs.videoE as HTMLVideoElement,\n        );\n\n        videoE.onloadedmetadata = null;\n      };\n\n      this.trackingIntervalId = setInterval(() => {\n\n        if (this.hasStartedTracking) {\n          clearInterval(this.trackingIntervalId);\n          this.trackingIntervalId = -1;\n        }\n\n        if (videoE.readyState === 4) {\n          whenReady();\n          return;\n        }\n\n        console.log('Video not ready, will start tracking when loaded.');\n      }, 100);\n\n      webcamProvider.connectVideoElement(videoE);\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.surface-container {\n  position: relative;\n  margin: auto;\n  width: 1280px;\n  height: 720px;\n  box-sizing: content-box;\n  text-align: center;\n\n  background: rgba(0, 0, 0, 0.3);\n\n  .overlay {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n  }\n\n  .overlay.overlay-bottom {\n    top: auto;\n  }\n  .overlay.overlay-left {\n    right: auto;\n  }\n  .overlay.overlay-right {\n    left: auto;\n  }\n  .overlay.overlay-top {\n    bottom: auto;\n  }\n}\n\n.mirrored {\n  transform: scaleX(-1);\n}\n\n// .overlay-background {\n//   z-index: -1;\n// }\n\n</style>\n","import { TinyEmitter } from 'tiny-emitter';\nimport { onMounted, onBeforeUnmount } from 'vue';\nimport { MpHolisticResults } from './MediaPipeTypes';\n\nexport const EventNames = Object.freeze({\n  gesture: 'gesture',\n  trackingProcessingStarted: 'trackingProcessingStarted',\n  trackingResults: 'trackingResults',\n  trackingRequested: 'trackingRequested',\n  trackingRequestFinished: 'trackingRequestFinished',\n});\n\nexport const GestureNames = Object.freeze({\n  none: 'none',\n  pointLeft: 'point-left',\n  pointRight: 'point-right',\n  namaste: 'namaste',\n});\n\nconst eventHub = new TinyEmitter();\n\nexport function setupGestureListening(callbacks: Record<string, (trackingResults?: MpHolisticResults | undefined) => void>, fallback?: undefined | ((gesture: string, trackingResults: MpHolisticResults) => void)) {\n  function onGesture(gesture: string, trackingResults: MpHolisticResults) {\n    const cb = callbacks[gesture];\n    if (cb) cb(trackingResults);\n\n    if (!cb && fallback) fallback(gesture, trackingResults);\n  }\n  onMounted(() => {\n    eventHub.on(EventNames.gesture, onGesture);\n  });\n  onBeforeUnmount(() => {\n    eventHub.off(EventNames.gesture, onGesture);\n  });\n}\n\nexport function setupMediaPipeListening(\n  callback: (res: MpHolisticResults, frameId?: number) => void,\n  onFrameProcessingStarted?: (frameId: number) => void,\n) {\n\n  onMounted(() => {\n    eventHub.on(EventNames.trackingResults, callback);\n    if (onFrameProcessingStarted) eventHub.on(EventNames.trackingProcessingStarted, onFrameProcessingStarted);\n  });\n  onBeforeUnmount(() => {\n    eventHub.off(EventNames.trackingResults, callback);\n    if (onFrameProcessingStarted) eventHub.off(EventNames.trackingProcessingStarted, onFrameProcessingStarted);\n  });\n}\n\nexport const TrackingActions = Object.freeze({\n  requestTracking: (id: string) => {\n    eventHub.emit(EventNames.trackingRequested, id);\n  },\n  endTrackingRequest: (id: string) => {\n    eventHub.emit(EventNames.trackingRequestFinished, id);\n  },\n});\n\nexport default eventHub;\n","<template>\n  <canvas ref=\"canvasE\" width=\"1280\" height=\"720\" class=\"drawCanvas\"></canvas>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  ref, defineComponent, watch, toRefs, onMounted, Ref,\n} from 'vue';\nimport { WEBCAM_DIMENSIONS } from '@/services/WebcamProvider';\nimport { GestureNames, setupGestureListening } from '../services/EventHub';\n\nimport { MpHolisticResults } from '../services/MediaPipeTypes';\nimport {\n  HAND_LANDMARK_CONNECTIONS, DrawConnections, DrawPose,\n} from '../services/MediaPipe';\n\nfunction drawHandShape(results: MpHolisticResults, canvasCtx: CanvasRenderingContext2D) {\n  if (!results.rightHandLandmarks) {\n    return;\n  }\n\n  canvasCtx.save();\n\n  /* eslint-disable no-param-reassign */\n  canvasCtx.strokeStyle = 'white';\n  canvasCtx.lineWidth = 3.0;\n  canvasCtx.lineCap = 'round';\n\n  DrawConnections(canvasCtx, results.rightHandLandmarks, HAND_LANDMARK_CONNECTIONS);\n  canvasCtx.restore();\n}\n\nfunction drawTrackingResults(\n  enabled: boolean,\n  detectedGesture: string,\n  results: MpHolisticResults,\n  canvasCtx: CanvasRenderingContext2D,\n) {\n  const { canvas } = canvasCtx;\n  canvasCtx.clearRect(0, 0, canvas.width, canvas.height);\n\n  if (!enabled) return;\n\n  canvasCtx.save();\n\n  const sourceAR = WEBCAM_DIMENSIONS.width / WEBCAM_DIMENSIONS.height;\n\n  if (results.poseLandmarks) {\n    DrawPose(canvasCtx, results.poseLandmarks, {\n      sourceAspectRatio: sourceAR,\n    });\n  }\n  if (detectedGesture !== GestureNames.none) drawHandShape(results, canvasCtx);\n\n  canvasCtx.restore();\n}\n\nexport default defineComponent({\n  name: 'DrawingSurface',\n  props: {\n    enableDrawing: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  setup(props) {\n    const { enableDrawing } = toRefs(props);\n\n    const canvasE = ref(null) as unknown as Ref<HTMLCanvasElement>;\n    const gesture = ref(GestureNames.none);\n    const mpResults = ref(null as MpHolisticResults | null);\n\n    setupGestureListening({},\n      (ges, trackingResults) => {\n        gesture.value = ges;\n        mpResults.value = trackingResults;\n      });\n\n    onMounted(() => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.strokeStyle = 'rgba(200, 250, 200, 0.75)';\n      canvasCtx.lineWidth = 6;\n      canvasCtx.lineCap = 'round';\n    });\n\n    watch([enableDrawing, mpResults, gesture], (isEnabledNow, results, ges) => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n      drawTrackingResults(\n        isEnabledNow as unknown as boolean,\n        ges as unknown as string,\n        results as MpHolisticResults,\n        canvasCtx,\n      );\n    });\n\n    return {\n      canvasE,\n      gesture,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n$pointer-size: 64px;\n\n.drawCanvas {\n  transform: scaleX(-1);\n  pointer-events: none;\n}\n\n.pointer-container {\n  position: fixed;\n  // transition: top .1s, left .1s;\n\n  img {\n    position: relative;\n    left: -$pointer-size / 2;\n    top: -32px;\n    width: 64px;\n    height: 64px;\n  }\n}\n\n</style>\n","// Inspired from https://gist.github.com/TheJLifeX/74958cc59db477a91837244ff598ef4a\n\nexport type Landmark = {\n  x: number;\n  y: number;\n  z?: number;\n  visibility?: number;\n}\n\nexport type MpHolisticResults = {\n  image?: any;\n  faceLandmarks?: Array<Landmark>;\n  poseLandmarks?: Array<Landmark>;\n  rightHandLandmarks?: Array<Landmark>;\n  leftHandLandmarks?: Array<Landmark>;\n}\nexport const HandLandmarks = {\n  wrist: 0,\n  thumbCMC: 1,\n  thumbMCP: 2,\n  thumbIP: 3,\n  thumbTIP: 4,\n  indexMCP: 5,\n  indexPIP: 6,\n  indexDIP: 7,\n  indexTIP: 8,\n  middleMCP: 9,\n  middlePIP: 10,\n  middleDIP: 11,\n  middleTIP: 12,\n  ringMCP: 13,\n  ringPIP: 14,\n  ringDIP: 15,\n  ringTIP: 16,\n  pinkyMCP: 17,\n  pinkyPIP: 18,\n  pinkyDIP: 19,\n  pinkyTIP: 20,\n};\n\nexport const PoseLandmarks = {\n  nose: 0,\n  leftEyeInner: 1,\n  leftEye: 2,\n  leftEyeOuter: 3,\n  rightEyeInner: 4,\n  rightEye: 5,\n  rightEyeOuter: 6,\n  leftEar: 7,\n  rightEar: 8,\n  mouthLeft: 9,\n  mouthRight: 10,\n  leftShoulder: 11,\n  rightShoulder: 12,\n  leftElbow: 13,\n  rightElbow: 14,\n  leftWrist: 15,\n  rightWrist: 16,\n  leftPinky: 17,\n  rightPinky: 18,\n  leftIndex: 19,\n  rightIndex: 20,\n  leftThumb: 21,\n  rightThumb: 22,\n  leftHip: 23,\n  rightHip: 24,\n  leftKnee: 25,\n  rightKnee: 26,\n  leftAnkle: 27,\n  rightAnkle: 28,\n  leftHeel: 29,\n  rightHeel: 30,\n  leftFootIndex: 31,\n  rightFootIndex: 32,\n};\n","//\n// Utils.ts\n//\n\nexport default class Utils {\n\n  static sleep(secs: number): Promise<void> {\n    return new Promise((res) => setTimeout(res, secs * 1000));\n  }\n\n  static PromptDownloadFile(filename: string, text: string) {\n    const element = document.createElement('a');\n    element.setAttribute('href', `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`);\n    element.setAttribute('download', filename);\n    element.style.display = 'none';\n\n    document.body.appendChild(element);\n    element.click();\n\n    document.body.removeChild(element);\n  }\n\n  // static CaptureVideoImage(videoE: HTMLVideoElement) {\n  //   const canvas = document.createElement('canvas');\n  //   canvas.style.display = 'none';\n  //   document.appendChild(canvas);\n  //   canvas.width = videoE.width;\n  //   canvas.height = videoE.height;\n  //   const ctx = canvas.getContext('2d')!;\n\n  //   ctx.drawImage(videoE, 0, 0, videoE.width, videoE.height);\n  // }\n\n  static DoEveryFrame(\n    onFrame: () => Promise<void>,\n    shouldRun?: () => boolean,\n  ) {\n\n    if (shouldRun !== undefined && !shouldRun()) {\n      requestAnimationFrame(() => {\n        Utils.DoEveryFrame(onFrame);\n      });\n    } else {\n      requestAnimationFrame(() => {\n        onFrame().then(() => {\n          Utils.DoEveryFrame(onFrame);\n        });\n      });\n    }\n  }\n\n}\n","/* eslint-disable no-multi-spaces */\n/* eslint-disable @typescript-eslint/no-var-requires */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable import/prefer-default-export */\nimport { Landmark, MpHolisticResults, PoseLandmarks } from './MediaPipeTypes';\nimport eventHub, { EventNames } from './EventHub';\nimport Utils from './Utils';\n\nexport const usingHolistic = false;\n\nlet mp: any = null;\n// eslint-disable-next-line global-require\nif (usingHolistic) mp = require('@mediapipe/holistic/holistic');\n// eslint-disable-next-line global-require\nelse mp = require('@mediapipe/pose/pose');\n\nexport const HAND_LANDMARK_CONNECTIONS = [\n  [0, 1], [1, 2], [2, 3], [3, 4], // Thumb\n  [0, 5], [5, 6], [6, 7], [7, 8], // Index\n  [5, 9], [9, 10], [10, 11], [11, 12], // Middle\n  [9, 13], [13, 14], [14, 15], [15, 16], // Ring\n  [0, 17], [13, 17], [17, 18], [18, 19], [19, 20], // Pinky\n];\n\nexport const HAND = {\n  THUMB_FINGER: [1, 2, 3, 4],\n  INDEX_FINGER: [5, 6, 7, 8],\n  MIDDLE_FINGER: [9, 10, 11, 12],\n  RING_FINGER: [13, 14, 15, 16],\n  PINKY_FINGER: [17, 18, 19, 20],\n};\n\nconst CONNECTIONS_TO_DRAW = [\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftPinky,      size: 1.0 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightPinky,     size: 1.0 },\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftThumb,      size: 1.0 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightThumb,     size: 1.0 },\n  { v0: PoseLandmarks.leftIndex,    v1: PoseLandmarks.leftWrist,      size: 1.0 },\n  { v0: PoseLandmarks.rightIndex,   v1: PoseLandmarks.rightWrist,     size: 1.0 },\n  { v0: PoseLandmarks.leftWrist,    v1: PoseLandmarks.leftElbow,      size: 1.1 },\n  { v0: PoseLandmarks.rightWrist,   v1: PoseLandmarks.rightElbow,     size: 1.1 },\n  { v0: PoseLandmarks.leftElbow,    v1: PoseLandmarks.leftShoulder,   size: 1.3 },\n  { v0: PoseLandmarks.rightElbow,   v1: PoseLandmarks.rightShoulder,  size: 1.3 },\n  { v0: PoseLandmarks.leftShoulder, v1: PoseLandmarks.rightShoulder,  size: 2.0 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.leftShoulder,   size: 1.7 },\n  { v0: PoseLandmarks.rightHip,     v1: PoseLandmarks.rightShoulder,  size: 1.7 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.rightHip,       size: 1.7 },\n  { v0: PoseLandmarks.leftHip,      v1: PoseLandmarks.leftKnee,       size: 1.5 },\n  { v0: PoseLandmarks.rightHip,     v1: PoseLandmarks.rightKnee,      size: 1.5 },\n  { v0: PoseLandmarks.leftKnee,     v1: PoseLandmarks.leftAnkle,      size: 1.4 },\n  { v0: PoseLandmarks.rightKnee,    v1: PoseLandmarks.rightAnkle,     size: 1.4 },\n  { v0: PoseLandmarks.leftAnkle,    v1: PoseLandmarks.leftHeel,       size: 1.0 },\n  { v0: PoseLandmarks.rightAnkle,   v1: PoseLandmarks.rightHeel,      size: 1.0 },\n  { v0: PoseLandmarks.leftHeel,     v1: PoseLandmarks.leftFootIndex,  size: 1.0 },\n  { v0: PoseLandmarks.rightHeel,    v1: PoseLandmarks.rightFootIndex, size: 1.0 },\n  { v0: PoseLandmarks.leftAnkle,    v1: PoseLandmarks.leftFootIndex,  size: 1.0 },\n  { v0: PoseLandmarks.rightAnkle,   v1: PoseLandmarks.rightFootIndex, size: 1.0 },\n  { v0: PoseLandmarks.nose,         v1: PoseLandmarks.rightEye,       size: 1.0 },\n  { v0: PoseLandmarks.nose,         v1: PoseLandmarks.leftEye,        size: 1.0 },\n];\n\nlet trackingStarted = false;\n\nexport function DrawConnections(\n  canvasCtx: CanvasRenderingContext2D,\n  landmarks: Array<Landmark>,\n  connections: Array<Array<number>>,\n) {\n  const w = canvasCtx.canvas.width;\n  const h = canvasCtx.canvas.height;\n\n  canvasCtx.beginPath();\n  connections.forEach((connection) => {\n    const p1 = landmarks[connection[0]];\n    const p2 = landmarks[connection[1]];\n\n    if (!p1 || !p2) return;\n\n    canvasCtx.moveTo(p1.x * w, p1.y * h);\n    canvasCtx.lineTo(p2.x * w, p2.y * h);\n  });\n\n  canvasCtx.stroke();\n  canvasCtx.restore();\n}\n\nexport function DrawPose(\n  canvasCtx: CanvasRenderingContext2D,\n  poseLandmarks: Landmark[],\n  options?: {\n    sourceAspectRatio?: number;\n    emphasizedJoints?: number[];\n    emphasisStroke? : string;\n  },\n) {\n\n  if (poseLandmarks.length === 0) {\n    return;\n  }\n\n  const jointsWithEmphasis = options?.emphasizedJoints;\n\n  canvasCtx.save();\n  let w = canvasCtx.canvas.width;\n  let h = canvasCtx.canvas.height;\n\n  const sourceAR = options?.sourceAspectRatio;\n  if (sourceAR) {\n    const canvasAR = canvasCtx.canvas.width / canvasCtx.canvas.height;\n\n    if (sourceAR > canvasAR) {\n      // video source is wider than canvas\n      const adjustedHeight = w / sourceAR;\n      const pixelsTaller = h - adjustedHeight;\n      canvasCtx.translate(0, pixelsTaller / 2);\n      h = adjustedHeight;\n\n    } else if (sourceAR < canvasAR) {\n      // video source is taller than canvas\n      const adjustedWidth = sourceAR * h;\n      const pixelsWider = w - adjustedWidth;\n      canvasCtx.translate(pixelsWider / 2, 0);\n      w = adjustedWidth;\n    }\n  }\n\n  CONNECTIONS_TO_DRAW.forEach((connection) => {\n    const p1 = poseLandmarks[connection.v0];\n    const p2 = poseLandmarks[connection.v1];\n\n    if (!p1 || !p2) return;\n    if ((p1.visibility ?? 1) < 0.5 || (p2.visibility ?? 1) < 0.5) {\n      // console.log('skipping b/c of insufficient visibility');\n      return;\n    }\n\n    const emphasized = jointsWithEmphasis\n    && jointsWithEmphasis.indexOf(connection.v0) !== -1\n    && jointsWithEmphasis.indexOf(connection.v1) !== -1;\n\n    canvasCtx.save();\n    if (emphasized && options?.emphasisStroke) {\n      canvasCtx.strokeStyle = options.emphasisStroke;\n    }\n    canvasCtx.lineWidth *= connection.size;\n    canvasCtx.beginPath();\n    canvasCtx.moveTo(p1.x * w, p1.y * h);\n    canvasCtx.lineTo(p2.x * w, p2.y * h);\n    canvasCtx.stroke();\n    canvasCtx.restore();\n  });\n\n  const p1a = poseLandmarks[PoseLandmarks.leftShoulder];\n  const p1b = poseLandmarks[PoseLandmarks.rightShoulder];\n  const p2 = poseLandmarks[PoseLandmarks.nose];\n  if (!p1a || !p1b || !p2) {\n    canvasCtx.beginPath();\n    canvasCtx.moveTo(w * 0.5 * (p1a.x + p1b.x), h * 0.5 * (p1a.y + p1b.y));\n    canvasCtx.lineTo(w * p2.x, h * p2.y);\n    canvasCtx.stroke();\n  }\n\n  canvasCtx.restore();\n}\n\nconst trackingRequests: Record<string, boolean> = {};\nconst trackingCount = () => Object\n  .keys(trackingRequests)\n  .map((id) => trackingRequests[id])\n  .filter((x) => x).length;\n\nlet latestResults: MpHolisticResults | null = null;\nexport function GetLatestResults() {\n  return Object.freeze(latestResults);\n}\n\nexport function StartTracking(videoE: HTMLVideoElement): void {\n  if (trackingStarted) { throw Error('Tracking alread started'); }\n\n  trackingStarted = true;\n  trackingRequests.initial = true;\n\n  let mpInstance: any = null;\n  if (usingHolistic) mpInstance = new mp.Holistic({ locateFile: (file: any) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}` });\n  else mpInstance = new mp.Pose({ locateFile: (file: any) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}` });\n\n  mpInstance.setOptions({\n    upperBodyOnly: false,\n    smoothLandmarks: true,\n    minDetectionConfidence: 0.5,\n    minTrackingConfidence: 0.5,\n  });\n\n  let frameId = 0;\n  mpInstance.onResults((res: MpHolisticResults) => {\n    trackingRequests.initial = false;\n    latestResults = res;\n    eventHub.emit(EventNames.trackingResults, res, frameId);\n  });\n\n  eventHub.on(EventNames.trackingRequested, (id: string) => {\n    trackingRequests[id] = true;\n  });\n  eventHub.on(EventNames.trackingRequestFinished, (id: string) => {\n    trackingRequests[id] = false;\n  });\n\n  Utils.DoEveryFrame(\n    async () => {\n      frameId += 1;\n      eventHub.emit(EventNames.trackingProcessingStarted, frameId);\n      if (trackingCount() > 0) await mpInstance.send({ image: videoE });\n    },\n    () => true,\n  );\n}\n\nexport function isTracking() {\n  return trackingCount() > 0;\n}\n","\n\nimport {\n  ref, defineComponent, watch, toRefs, onMounted, Ref,\n} from 'vue';\nimport { WEBCAM_DIMENSIONS } from '@/services/WebcamProvider';\nimport { GestureNames, setupGestureListening } from '../services/EventHub';\n\nimport { MpHolisticResults } from '../services/MediaPipeTypes';\nimport {\n  HAND_LANDMARK_CONNECTIONS, DrawConnections, DrawPose,\n} from '../services/MediaPipe';\n\nfunction drawHandShape(results: MpHolisticResults, canvasCtx: CanvasRenderingContext2D) {\n  if (!results.rightHandLandmarks) {\n    return;\n  }\n\n  canvasCtx.save();\n\n  /* eslint-disable no-param-reassign */\n  canvasCtx.strokeStyle = 'white';\n  canvasCtx.lineWidth = 3.0;\n  canvasCtx.lineCap = 'round';\n\n  DrawConnections(canvasCtx, results.rightHandLandmarks, HAND_LANDMARK_CONNECTIONS);\n  canvasCtx.restore();\n}\n\nfunction drawTrackingResults(\n  enabled: boolean,\n  detectedGesture: string,\n  results: MpHolisticResults,\n  canvasCtx: CanvasRenderingContext2D,\n) {\n  const { canvas } = canvasCtx;\n  canvasCtx.clearRect(0, 0, canvas.width, canvas.height);\n\n  if (!enabled) return;\n\n  canvasCtx.save();\n\n  const sourceAR = WEBCAM_DIMENSIONS.width / WEBCAM_DIMENSIONS.height;\n\n  if (results.poseLandmarks) {\n    DrawPose(canvasCtx, results.poseLandmarks, {\n      sourceAspectRatio: sourceAR,\n    });\n  }\n  if (detectedGesture !== GestureNames.none) drawHandShape(results, canvasCtx);\n\n  canvasCtx.restore();\n}\n\nexport default defineComponent({\n  name: 'DrawingSurface',\n  props: {\n    enableDrawing: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  setup(props) {\n    const { enableDrawing } = toRefs(props);\n\n    const canvasE = ref(null) as unknown as Ref<HTMLCanvasElement>;\n    const gesture = ref(GestureNames.none);\n    const mpResults = ref(null as MpHolisticResults | null);\n\n    setupGestureListening({},\n      (ges, trackingResults) => {\n        gesture.value = ges;\n        mpResults.value = trackingResults;\n      });\n\n    onMounted(() => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n      canvasCtx.strokeStyle = 'rgba(200, 250, 200, 0.75)';\n      canvasCtx.lineWidth = 6;\n      canvasCtx.lineCap = 'round';\n    });\n\n    watch([enableDrawing, mpResults, gesture], (isEnabledNow, results, ges) => {\n      const canvas = canvasE.value;\n      const canvasCtx = canvas.getContext('2d') as CanvasRenderingContext2D;\n      drawTrackingResults(\n        isEnabledNow as unknown as boolean,\n        ges as unknown as string,\n        results as MpHolisticResults,\n        canvasCtx,\n      );\n    });\n\n    return {\n      canvasE,\n      gesture,\n    };\n  },\n});\n","import { render } from \"./DrawingSurface.vue?vue&type=template&id=70cfc891\"\nimport script from \"./DrawingSurface.vue?vue&type=script&lang=ts\"\nexport * from \"./DrawingSurface.vue?vue&type=script&lang=ts\"\n\nimport \"./DrawingSurface.vue?vue&type=style&index=0&id=70cfc891&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport {\n  defineComponent, onUpdated, ref,\n} from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport { setupMediaPipeListening } from '@/services/EventHub';\nimport { MpHolisticResults } from '@/services/MediaPipeTypes';\nimport DrawingSurface from './DrawingSurface.vue';\nimport { isTracking as mpIsTracking, StartTracking } from '../services/MediaPipe';\n\nexport default defineComponent({\n  name: 'CameraSurface',\n  components: {\n    DrawingSurface,\n  },\n  data() {\n    return {\n      trackingIntervalId: -1,\n    };\n  },\n  setup(props, { emit }) {\n    // const { enableDrawing } = toRefs(props);\n    const hasStartedTracking = ref(false);\n    const isActivelyTracking = ref(false);\n    const hasResults = ref(false);\n    const trackingResults = ref({});\n\n    onUpdated(() => {\n      isActivelyTracking.value = mpIsTracking();\n    });\n\n    function onResults(results: MpHolisticResults) {\n      if (!hasResults.value) {\n        emit('tracking-attained');\n        console.log('Got Results', results);\n      }\n      hasResults.value = true;\n      trackingResults.value = results;\n      // this.$refs.drawingSurface.draw(results, canvasCtx);\n    }\n\n    setupMediaPipeListening(onResults);\n\n    return {\n      hasStartedTracking,\n      isActivelyTracking,\n      hasResults,\n      trackingResults,\n    };\n  },\n  methods: {\n    startTracking() {\n      if (this.trackingIntervalId !== -1) return;\n\n      const videoE = this.$refs.videoE as HTMLVideoElement;\n      const whenReady = () => {\n        if (this.hasStartedTracking) return;\n        this.hasStartedTracking = true;\n        console.log('Video loaded. Starting tracking...');\n\n        StartTracking(\n            this.$refs.videoE as HTMLVideoElement,\n        );\n\n        videoE.onloadedmetadata = null;\n      };\n\n      this.trackingIntervalId = setInterval(() => {\n\n        if (this.hasStartedTracking) {\n          clearInterval(this.trackingIntervalId);\n          this.trackingIntervalId = -1;\n        }\n\n        if (videoE.readyState === 4) {\n          whenReady();\n          return;\n        }\n\n        console.log('Video not ready, will start tracking when loaded.');\n      }, 100);\n\n      webcamProvider.connectVideoElement(videoE);\n    },\n  },\n});\n","import { render } from \"./CameraSurface.vue?vue&type=template&id=182e86da\"\nimport script from \"./CameraSurface.vue?vue&type=script&lang=ts\"\nexport * from \"./CameraSurface.vue?vue&type=script&lang=ts\"\n\nimport \"./CameraSurface.vue?vue&type=style&index=0&id=182e86da&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"onboardingUI\">\n    <div class=\"overlay instructions-overlay mb-4\">\n       <InstructionCarousel :instructions=\"instructions\" class=\"m-2\"/>\n       <!-- <InstructionCarousel v-show=\"stage !== OnboardingStage.done\" :instructions=\"[{id: 0, text: 'How to use this app'}]\" class=\"m-2\"/> -->\n    </div>\n    <div class=\"vcenter-parent\" v-show=\"stage !== OnboardingStage.done\">\n      <div class=\"content translucent-text is-rounded p-6\">\n        <GestureIcon :gesture=\"gestureIcon\" />\n      </div>\n    </div>\n    <div class=\"overlay overlay-top overlay-right mt-4 mr-4\">\n      <button class=\"button\" @click=\"skipOnboarding\">Skip</button>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport { usingHolistic } from '@/services/MediaPipe';\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref,\n} from 'vue';\n\nimport { setupGestureListening, GestureNames, TrackingActions } from '../services/EventHub';\nimport InstructionCarousel, { Instruction } from './elements/InstructionCarousel.vue';\nimport GestureIcon, { GestureIcons } from './elements/GestureIcon.vue';\n\nconst OnboardingStage = {\n  trySelectNext: 0,\n  trySelectPrevious: 1,\n  tryPerformPlay: 2,\n  done: 3,\n};\n\nexport default defineComponent({\n  name: 'OnboardingUI',\n  components: { InstructionCarousel, GestureIcon },\n  setup(props, ctx) {\n    const stage = ref(OnboardingStage.trySelectNext);\n    const output = ref('');\n\n    const instructions = computed(() => {\n      const instructs: Instruction[] = [];\n      if (stage.value === OnboardingStage.trySelectNext) {\n        instructs.push({\n          id: 0,\n          text:\n            usingHolistic\n              ? 'Point to the right with a flat hand to proceed'\n              : 'Point your left forearm to the right to proceed',\n        });\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        instructs.push({\n          id: 1,\n          text:\n          usingHolistic\n            ? 'Point to the left with a flat hand to repeat an activity'\n            : 'Point your right forearm to the left to repeat an activity',\n        });\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        instructs.push({\n          id: 2,\n          text: 'Put your hands together in a Namaste greeting to play a video',\n        });\n      } else {\n        instructs.push({\n          id: 3,\n          text: 'You got it!',\n        });\n      }\n      return instructs;\n    });\n\n    onMounted(() => {\n      TrackingActions.requestTracking('onboarding');\n    });\n    onBeforeUnmount(() => {\n      TrackingActions.endTrackingRequest('onboarding');\n    });\n\n    setupGestureListening({\n      [GestureNames.pointRight]: () => {\n        if (stage.value === OnboardingStage.trySelectNext) {\n          stage.value = OnboardingStage.trySelectPrevious;\n        }\n      },\n      [GestureNames.pointLeft]: () => {\n        if (stage.value === OnboardingStage.trySelectPrevious) {\n          stage.value = OnboardingStage.tryPerformPlay;\n        }\n      },\n      [GestureNames.namaste]: () => {\n        if (stage.value === OnboardingStage.tryPerformPlay) {\n          stage.value = OnboardingStage.done;\n          TrackingActions.endTrackingRequest('onboarding');\n          setTimeout(() => {\n            ctx.emit('onboarding-complete');\n          }, 1500);\n        }\n      },\n    });\n\n    function skipOnboarding() {\n      if (stage.value === OnboardingStage.trySelectNext) {\n        stage.value = OnboardingStage.trySelectPrevious;\n        return;\n      }\n      TrackingActions.endTrackingRequest('onboarding');\n      stage.value = OnboardingStage.done;\n      ctx.emit('onboarding-complete');\n    }\n\n    const gestureIcon = computed(() => {\n      switch (stage.value) {\n        case OnboardingStage.trySelectNext:\n          return GestureIcons.forward;\n        case OnboardingStage.trySelectPrevious:\n          return GestureIcons.backward;\n        case OnboardingStage.tryPerformPlay:\n          return GestureIcons.play;\n        default:\n          return '';\n      }\n    });\n\n    return {\n      stage,\n      output,\n      instructions,\n      OnboardingStage,\n      skipOnboarding,\n      gestureIcon,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.onboardingUI {\n  width: 100%;\n  height: 100%;\n}\n\n</style>\n","<template>\n  <transition-group name=\"slide-fade\" tag=\"div\" class=\"instructionCarousel\">\n    <p\n      class=\"tag is-dark\"\n      :class=\"[sizeClass]\"\n      v-for=\"inst in instructions\"\n      :key=\"inst.id\">{{inst.text}}</p>\n  </transition-group>\n</template>\n\n<script lang=\"ts\">\n\nimport { defineComponent } from 'vue';\n\nexport type Instruction = {\n  id: number;\n  text: string;\n}\n\nexport default defineComponent({\n  props: {\n    instructions: {\n      type: Array,\n      default: Array,\n    },\n    sizeClass: {\n      type: String,\n      default: 'is-size-4',\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.instructionCarousel {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Enter and leave animations can use different */\n/* durations and timing functions.              */\n.slide-fade-enter-active {\n  transition: all .15s ease;\n  overflow: hidden;\n  // transform: translateX(-100%);\n}\n.slide-fade-leave-active {\n  transition: all .15s ease;\n  overflow: clip;\n  // transform: translateX(-100%);\n}\n.slide-fade-enter, .slide-fade-leave-to\n/* .slide-fade-leave-active below version 2.1.8 */ {\n  transform: translateX(10px) scaleX(0);\n  opacity: 0;\n}\n\n</style>\n","\n\nimport { defineComponent } from 'vue';\n\nexport type Instruction = {\n  id: number;\n  text: string;\n}\n\nexport default defineComponent({\n  props: {\n    instructions: {\n      type: Array,\n      default: Array,\n    },\n    sizeClass: {\n      type: String,\n      default: 'is-size-4',\n    },\n  },\n});\n","import { render } from \"./InstructionCarousel.vue?vue&type=template&id=1819acf3\"\nimport script from \"./InstructionCarousel.vue?vue&type=script&lang=ts\"\nexport * from \"./InstructionCarousel.vue?vue&type=script&lang=ts\"\n\nimport \"./InstructionCarousel.vue?vue&type=style&index=0&id=1819acf3&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <span class=\"icon is-large\" :class=\"iconClass\" v-if=\"showIcon\">\n    <i class=\"fas fa-2x fa-hand-paper fa-rotate-90\"></i>\n  </span>\n  <span v-else>\n    <img :src=\"gestureImgSrc\" :alt=\"gesture\">\n  </span>\n</template>\n\n<script lang=\"ts\">\nimport { usingHolistic } from '@/services/MediaPipe';\nimport { computed, defineComponent, toRefs } from 'vue';\n\nexport const GestureIcons = Object.freeze({\n  forward: 'forward',\n  backward: 'backward',\n  play: 'play',\n});\n\nexport default defineComponent({\n  props: {\n    gesture: {\n      type: String,\n      default: 'foward',\n    },\n  },\n  setup(props) {\n\n    const { gesture } = toRefs(props);\n\n    const showIcon = computed(() => usingHolistic);\n    const iconClass = computed(() => {\n      switch (gesture.value) {\n        case 'backward': return ['fa-flip-horizontal'];\n        case 'forward': return [];\n        default:\n          return [];\n      }\n    });\n    /* eslint-disable global-require */\n    /* eslint-disable import/no-dynamic-require */\n    const gestureImgSrc = computed(() => {\n      try {\n        return require(`../../assets/gestures/${gesture.value}.svg`);\n      } catch {\n        return '';\n      }\n    });\n\n    return {\n      showIcon,\n      iconClass,\n      gestureImgSrc,\n    };\n  },\n});\n</script>\n\n<style>\n</style>\n","\nimport { usingHolistic } from '@/services/MediaPipe';\nimport { computed, defineComponent, toRefs } from 'vue';\n\nexport const GestureIcons = Object.freeze({\n  forward: 'forward',\n  backward: 'backward',\n  play: 'play',\n});\n\nexport default defineComponent({\n  props: {\n    gesture: {\n      type: String,\n      default: 'foward',\n    },\n  },\n  setup(props) {\n\n    const { gesture } = toRefs(props);\n\n    const showIcon = computed(() => usingHolistic);\n    const iconClass = computed(() => {\n      switch (gesture.value) {\n        case 'backward': return ['fa-flip-horizontal'];\n        case 'forward': return [];\n        default:\n          return [];\n      }\n    });\n    /* eslint-disable global-require */\n    /* eslint-disable import/no-dynamic-require */\n    const gestureImgSrc = computed(() => {\n      try {\n        return require(`../../assets/gestures/${gesture.value}.svg`);\n      } catch {\n        return '';\n      }\n    });\n\n    return {\n      showIcon,\n      iconClass,\n      gestureImgSrc,\n    };\n  },\n});\n","import { render } from \"./GestureIcon.vue?vue&type=template&id=35fcd4fc\"\nimport script from \"./GestureIcon.vue?vue&type=script&lang=ts\"\nexport * from \"./GestureIcon.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\n\nimport { usingHolistic } from '@/services/MediaPipe';\nimport {\n  computed,\n  defineComponent, onBeforeUnmount, onMounted, ref,\n} from 'vue';\n\nimport { setupGestureListening, GestureNames, TrackingActions } from '../services/EventHub';\nimport InstructionCarousel, { Instruction } from './elements/InstructionCarousel.vue';\nimport GestureIcon, { GestureIcons } from './elements/GestureIcon.vue';\n\nconst OnboardingStage = {\n  trySelectNext: 0,\n  trySelectPrevious: 1,\n  tryPerformPlay: 2,\n  done: 3,\n};\n\nexport default defineComponent({\n  name: 'OnboardingUI',\n  components: { InstructionCarousel, GestureIcon },\n  setup(props, ctx) {\n    const stage = ref(OnboardingStage.trySelectNext);\n    const output = ref('');\n\n    const instructions = computed(() => {\n      const instructs: Instruction[] = [];\n      if (stage.value === OnboardingStage.trySelectNext) {\n        instructs.push({\n          id: 0,\n          text:\n            usingHolistic\n              ? 'Point to the right with a flat hand to proceed'\n              : 'Point your left forearm to the right to proceed',\n        });\n      } else if (stage.value === OnboardingStage.trySelectPrevious) {\n        instructs.push({\n          id: 1,\n          text:\n          usingHolistic\n            ? 'Point to the left with a flat hand to repeat an activity'\n            : 'Point your right forearm to the left to repeat an activity',\n        });\n      } else if (stage.value === OnboardingStage.tryPerformPlay) {\n        instructs.push({\n          id: 2,\n          text: 'Put your hands together in a Namaste greeting to play a video',\n        });\n      } else {\n        instructs.push({\n          id: 3,\n          text: 'You got it!',\n        });\n      }\n      return instructs;\n    });\n\n    onMounted(() => {\n      TrackingActions.requestTracking('onboarding');\n    });\n    onBeforeUnmount(() => {\n      TrackingActions.endTrackingRequest('onboarding');\n    });\n\n    setupGestureListening({\n      [GestureNames.pointRight]: () => {\n        if (stage.value === OnboardingStage.trySelectNext) {\n          stage.value = OnboardingStage.trySelectPrevious;\n        }\n      },\n      [GestureNames.pointLeft]: () => {\n        if (stage.value === OnboardingStage.trySelectPrevious) {\n          stage.value = OnboardingStage.tryPerformPlay;\n        }\n      },\n      [GestureNames.namaste]: () => {\n        if (stage.value === OnboardingStage.tryPerformPlay) {\n          stage.value = OnboardingStage.done;\n          TrackingActions.endTrackingRequest('onboarding');\n          setTimeout(() => {\n            ctx.emit('onboarding-complete');\n          }, 1500);\n        }\n      },\n    });\n\n    function skipOnboarding() {\n      if (stage.value === OnboardingStage.trySelectNext) {\n        stage.value = OnboardingStage.trySelectPrevious;\n        return;\n      }\n      TrackingActions.endTrackingRequest('onboarding');\n      stage.value = OnboardingStage.done;\n      ctx.emit('onboarding-complete');\n    }\n\n    const gestureIcon = computed(() => {\n      switch (stage.value) {\n        case OnboardingStage.trySelectNext:\n          return GestureIcons.forward;\n        case OnboardingStage.trySelectPrevious:\n          return GestureIcons.backward;\n        case OnboardingStage.tryPerformPlay:\n          return GestureIcons.play;\n        default:\n          return '';\n      }\n    });\n\n    return {\n      stage,\n      output,\n      instructions,\n      OnboardingStage,\n      skipOnboarding,\n      gestureIcon,\n    };\n  },\n});\n","import { render } from \"./OnboardingUI.vue?vue&type=template&id=66b15206\"\nimport script from \"./OnboardingUI.vue?vue&type=script&lang=ts\"\nexport * from \"./OnboardingUI.vue?vue&type=script&lang=ts\"\n\nimport \"./OnboardingUI.vue?vue&type=style&index=0&id=66b15206&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <section class=\"section dance-menu\">\n    <div class=\"container content has-text-centered is-hidden-mobile\">\n      <h2 class=\"subtitle\">Which dance would you like to learn?</h2>\n    </div>\n    <div class=\"menu container padded\">\n      <div\n        class=\"dance-card card is-clickable\"\n        v-for=\"dance in motionList\"\n        :key=\"dance.title\"\n        @mouseover=\"hover = dance.hovering = true\"\n        @mouseleave=\"hover = dance.hovering = false\"\n        @click=\"selectedDance = dance\"\n      >\n        <div class=\"card-image\">\n          <figure class=\"image is-2by3\">\n            <video :src=\"dance.videoSrc\" />\n          </figure>\n        </div>\n        <div class=\"card-content\">\n          {{ dance.title }}\n        </div>\n      </div>\n      <div class=\"dance-card card is-clickable\"\n        @click=\"$emit('pose-drawer-selected')\">\n        <div class=\"card-image\">\n          <figure class=\"image is-2by3\">\n            <img src=\"../../assets/stickfigure.png\" alt=\"\">\n          </figure>\n        </div>\n        <div class=\"card-content\">\n          Pose Drawer Test\n        </div>\n      </div>\n    </div>\n\n    <div v-bind:class=\"{ 'is-active': selectedDance }\" class=\"modal\">\n      <div class=\"modal-background\"></div>\n      <div class=\"modal-content\">\n        <LessonCard\n          v-bind:dance=\"selectedDance\"\n          v-on:closed=\"selectedDance = null\"\n          v-on:lesson-selected=\"danceLessonSelected\"\n        />\n      </div>\n    </div>\n  </section>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref } from 'vue';\nimport DanceEntry, { LessonSelection } from '../../model/DanceEntry';\nimport LessonCard from '../elements/LessonCard.vue';\nimport motions from '../../services/MotionDatabase';\n\nexport default defineComponent({\n  name: 'DanceMenu',\n  emits: ['dance-selected', 'pose-drawer-selected'],\n  components: {\n    LessonCard,\n  },\n  setup(props, ctx) {\n    const motionList = ref(motions);\n    const selectedDance = ref(null as DanceEntry | null);\n\n    function danceLessonSelected(sel: LessonSelection) {\n      ctx.emit('dance-selected', sel);\n      selectedDance.value = null;\n    }\n\n    return {\n      selectedDance,\n      motionList,\n      danceLessonSelected,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n// .dance-menu {\n  // backdrop-filter: blur(4px);\n  // background: rgba(0, 0, 0, 0.2);\n// }\n\n.dance-menu {\n\n  .menu {\n    text-align: left;\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));\n    grid-gap: 0.5em;\n  }\n  .menu .card {\n    display: block;\n  }\n  .dance-card {\n    height: max-content;\n    transition: transform 0.2s, box-shadow 0.2s;\n\n    &:hover {\n      box-shadow: 0 0.5em 1em -0.125em rgba(10, 10, 10, 0.3),\n        0 0 0 2px rgba(10, 10, 10, 0.05);\n      transform: scale(0.98);\n    }\n  }\n\n  img {\n    object-fit: fill;\n  }\n\n  .subtitle {\n    margin: 2rem 1rem 2em;\n    color: white;\n  }\n\n  .section {\n    padding: 1.5rem;\n  }\n\n  .image video {\n    bottom: 0;\n    left: 0;\n    right: 0;\n    top: 0;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n  }\n</style>\n","<template>\n  <div class=\"card\" v-if=\"dance\">\n    <div class=\"card-header\">\n      <h4 class=\"card-header-title\">\n        {{ dance.title }}\n      </h4>\n\n      <a class=\"card-header-icon\" @click=\"$emit('closed')\">\n        <i class=\"fas fa-times\"></i>\n      </a>\n    </div>\n    <div class=\"card-content\">\n      <div class=\"columns\">\n        <div class=\"column is-narrow is-hidden-mobile\">\n          <video :src=\"dance.videoSrc\" autoplay=\"true\" muted=\"true\" width=\"180\" />\n        </div>\n        <div class=\"column\">\n          <div class=\"menu\">\n            <p class=\"menu-label\">\n              Pick a lesson\n            </p>\n            <ul class=\"menu-list\">\n              <li v-for=\"lesson in dance.lessons\" :key=\"lesson._id\">\n                <a @click=\"$emit('lesson-selected', {dance: dance, lesson: lesson})\">\n                  {{ lesson.header.lessonTitle }}\n                </a>\n              </li>\n            </ul>\n            <p v-if=\"dance.lessons.length == 0\">No lessons available.</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n  name: 'LessonCard',\n  props: ['dance'],\n});\n</script>\n\n<style lang=\"scss\" scoped>\n\n.dance-image {\n  max-height: 50vh;\n}\n\n</style>\n","\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n  name: 'LessonCard',\n  props: ['dance'],\n});\n","import { render } from \"./LessonCard.vue?vue&type=template&id=3a8204fa&scoped=true\"\nimport script from \"./LessonCard.vue?vue&type=script&lang=ts\"\nexport * from \"./LessonCard.vue?vue&type=script&lang=ts\"\n\nimport \"./LessonCard.vue?vue&type=style&index=0&id=3a8204fa&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-3a8204fa\"\n\nexport default script","import DanceEntry from '@/model/DanceEntry';\nimport DanceLesson from '@/model/DanceLesson';\n\nimport renegadeLesson from '@/model/lessons/renegade.lesson.json';\nimport itsafitLesson from '@/model/lessons/itsafit.lesson.json';\nimport deruloLesson from '@/model/lessons/derulo.lesson.json';\nimport unhhunhLesson from '@/model/lessons/unhhunh.lesson.json';\n\nimport aslCoconutLesson from '@/model/lessons/asl/COCONUT.lesson.json';\nimport aslFlipFlopsLesson from '@/model/lessons/asl/flipflops.lesson.json';\nimport aslOceanLesson from '@/model/lessons/asl/ocean.lesson.json';\nimport aslSailboatLesson from '@/model/lessons/asl/sailboat.lesson.json';\nimport aslTurtleLesson from '@/model/lessons/asl/TURTLE.lesson.json';\nimport aslUmbrellaLesson from '@/model/lessons/asl/UMBRELLA.lesson.json';\n\nconst dances: Array<DanceEntry> = [\n  {\n    title: 'Renegade',\n    videoSrc: 'dances/renegade.mp4',\n    hovering: false,\n    lessons: [\n      renegadeLesson as DanceLesson,\n    ],\n  },\n  {\n    title: 'Unh Hunhh',\n    videoSrc: 'dances/unhhunh.mp4',\n    hovering: false,\n    lessons: [\n      unhhunhLesson as DanceLesson,\n    ],\n  },\n  {\n    title: 'Derulo',\n    videoSrc: 'dances/derulo.mp4',\n    hovering: false,\n    lessons: [\n      deruloLesson as DanceLesson,\n    ],\n  },\n  {\n    title: \"It's a fit\",\n    videoSrc: 'dances/itsafit.mp4',\n    hovering: false,\n    lessons: [\n      itsafitLesson as DanceLesson,\n    ],\n  },\n\n  {\n    title: 'ASL: Coconut',\n    videoSrc: 'dances/asl/COCONUT.mov',\n    hovering: false,\n    lessons: [aslCoconutLesson as DanceLesson],\n  },\n  {\n    title: 'ASL: Flip Flips',\n    videoSrc: 'dances/asl/flipflops.mp4',\n    hovering: false,\n    lessons: [aslFlipFlopsLesson as DanceLesson],\n  },\n  {\n    title: 'ASL: Ocean',\n    videoSrc: 'dances/asl/ocean.mp4',\n    hovering: false,\n    lessons: [aslOceanLesson as DanceLesson],\n  },\n  {\n    title: 'ASL: Sailboat',\n    videoSrc: 'dances/asl/sailboat.mp4',\n    hovering: false,\n    lessons: [aslSailboatLesson as DanceLesson],\n  },\n  {\n    title: 'ASL: Turtle',\n    videoSrc: 'dances/asl/TURTLE.mp4',\n    hovering: false,\n    lessons: [aslTurtleLesson as DanceLesson],\n  },\n  {\n    title: 'ASL: Umbrella',\n    videoSrc: 'dances/asl/UMBRELLA.mp4',\n    hovering: false,\n    lessons: [aslUmbrellaLesson as DanceLesson],\n  },\n];\n\nexport default dances;\n","\nimport { defineComponent, ref } from 'vue';\nimport DanceEntry, { LessonSelection } from '../../model/DanceEntry';\nimport LessonCard from '../elements/LessonCard.vue';\nimport motions from '../../services/MotionDatabase';\n\nexport default defineComponent({\n  name: 'DanceMenu',\n  emits: ['dance-selected', 'pose-drawer-selected'],\n  components: {\n    LessonCard,\n  },\n  setup(props, ctx) {\n    const motionList = ref(motions);\n    const selectedDance = ref(null as DanceEntry | null);\n\n    function danceLessonSelected(sel: LessonSelection) {\n      ctx.emit('dance-selected', sel);\n      selectedDance.value = null;\n    }\n\n    return {\n      selectedDance,\n      motionList,\n      danceLessonSelected,\n    };\n  },\n});\n","import { render } from \"./DanceMenu.vue?vue&type=template&id=729dce3c\"\nimport script from \"./DanceMenu.vue?vue&type=script&lang=ts\"\nexport * from \"./DanceMenu.vue?vue&type=script&lang=ts\"\n\nimport \"./DanceMenu.vue?vue&type=style&index=0&id=729dce3c&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"learning-screen background-blur\"\n    >\n    <teleport to=\"#topbarLeft\">\n      <button class=\"button\" @click=\"$emit('back-selected')\">&lt; Back</button>\n    </teleport>\n    <teleport to=\"#topbarRight\">\n      <span class=\"tag\">{{activityId}} / {{activityCount}}</span>\n      <progress class=\"lessonProgress progress ml-2\" :max=\"activityCount\" :value=\"activityId\">\n      </progress>\n    </teleport>\n    <teleport to=\"#topbarCenter\">\n        <h3>{{activityTitle}}</h3>\n        <span class=\"tag\">Time: {{videoTime}}</span>\n    </teleport>\n\n    <div class=\"overlay\" v-show=\"activity && activity.userVisual !== 'none'\">\n      <WebcamBox style=\"width:1280px;height:720px;\"/>\n    </div>\n\n    <div class=\"overlay\">\n      <PausingVideoPlayer\n        :videoSrc=\"targetDance.videoSrc\"\n        :height=\"'720px'\"\n        ref=\"videoPlayer\"\n        @progress=\"onTimeChanged\"\n        @playback-completed=\"onActivityFinished\"\n        @pause-hit=\"onPauseHit\"\n        @pause-end=\"onPauseEnded\"\n        :drawPoseLandmarks=\"activity?.demoVisual === 'skeleton'\"\n        :videoOpacity=\"activity?.demoVisual === 'video' ? 1 : 0\"\n        :emphasizedJoints=\"emphasizedJoints\"\n      />\n    </div>\n\n    <div class=\"overlay instructions-overlay mb-4\">\n      <div class=\"content translucent-text activityGestureCard mb-1 is-rounded\" v-show=\"showPlayGestureIcon\">\n        <GestureIcon :gesture=\"'play'\" />\n      </div>\n      <InstructionCarousel v-show=\"showPlayGestureIcon\" :sizeClass=\"'is-size-6'\" :instructions=\"[{id:0, text:'Do the play gesture when you\\'re ready'}]\" class=\"mb-4\"/>\n      <InstructionCarousel v-show=\"activityFinished\" :sizeClass=\"'is-size-6'\" :instructions=\"[{id:0, text:'Use a gesture to proceed'}]\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"!activityFinished && timedInstructions.length > 0\" :instructions=\"timedInstructions\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"instructions.length > 0\" :instructions=\"instructions\" class=\"m-2\"/>\n      <InstructionCarousel v-show=\"activity.staticInstruction\" :instructions=\"[{id:0, text:activity.staticInstruction}]\" class=\"m-2\"/>\n    </div>\n\n    <div class=\"overlay overlay-left\" v-show=\"activityFinished\">\n      <div class=\"vcenter-parent\">\n        <div class=\"content translucent-text p-5 is-size-5 is-rounded activityGestureCard\">\n          <GestureIcon :gesture=\"'backward'\" />\n          <br />\n          Repeat\n        </div>\n      </div>\n    </div>\n    <div class=\"overlay overlay-right\" v-show=\"activityFinished\">\n      <div class=\"vcenter-parent\">\n        <div class=\"content translucent-text p-5 is-size-5 is-rounded activityGestureCard\">\n          <GestureIcon :gesture=\"'forward'\" />\n          <br />\n          Next\n        </div>\n      </div>\n    </div>\n\n    <teleport to=\"#belowSurface\">\n      <div>\n        <div class=\"master-bar mt-4\">\n          <SegmentedProgressBar\n            :segments=\"progressSegments\"\n            :progress=\"videoTime\"\n          />\n        </div>\n        <div class=\"mt-4 mb-4 buttons is-centered\">\n          <button class=\"button\" @click=\"gotoPreviousActivity\">Previous</button>\n          <button class=\"button\" @click=\"gotoNextActivity\">Next</button>\n          <button class=\"button\"\n            @click=\"startSaveFrames\"\n            :disabled=\"!canSaveFrame\"\n            :class=\"{'is-loading': isSavingFrames}\">Save Frames</button>\n        </div>\n      </div>\n    </teleport>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport DanceLesson, { Activity, PauseInfo, DanceUtils } from '@/model/DanceLesson';\nimport {\n  computed, ComputedRef, defineComponent, onBeforeUnmount, onMounted, Ref, ref, toRefs, watch,\n} from 'vue';\nimport {\n  GestureNames, setupGestureListening, setupMediaPipeListening, TrackingActions,\n} from '@/services/EventHub';\nimport DanceEntry from '@/model/DanceEntry';\nimport motionRecorder from '@/services/MotionRecorder';\nimport InstructionCarousel, { Instruction } from '@/components/elements/InstructionCarousel.vue';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport Utils from '@/services/Utils';\nimport SegmentedProgressBar, { ProgressSegmentData } from '../elements/SegmentedProgressBar.vue';\nimport PausingVideoPlayer from '../elements/PausingVideoPlayer.vue';\nimport WebcamBox from '../elements/WebcamBox.vue';\nimport GestureIcon from '../elements/GestureIcon.vue';\n\nconst DefaultPauseDuration = 1.5; // 1.5 seconds\n\nconst ActivityPlayState = Object.freeze({\n  AwaitingPlayGesture: 'AwaitingPlayGesture',\n  PendingStart: 'PendingStart',\n  Playing: 'Playing',\n  ActivityEnded: 'ActivityEnded',\n});\n\n//\n// TODO!\n//   * Update segment breaks in activity to have the first activity\n//     start time and the last activity end time.\n//\n\nfunction calculateProgressSegments(dance: DanceEntry, lesson: DanceLesson, activity: Activity) {\n  if (!lesson) return [];\n\n  let last = undefined as undefined | number;\n  const segs = lesson.segmentBreaks.map((timestamp, i) => {\n    let segData = undefined as undefined | ProgressSegmentData;\n    if (last !== undefined) {\n      segData = {\n        min: last,\n        max: timestamp,\n        enabled: activity.focusedSegments ? activity.focusedSegments.indexOf(i - 1) !== -1 : true,\n      };\n    }\n    last = timestamp;\n    return segData;\n  }).filter((x) => x !== undefined);\n\n  return segs;\n}\n\nconst TRACKING_ID = 'LearningScreen';\n\nfunction setupFrameRecording(activity: ComputedRef<Activity | null>, videoTime: Ref<number>, videoPlayer: Ref<null | typeof PausingVideoPlayer>, playActivity: Function) {\n  const isSavingFrames = ref(false);\n  let recordingSessionId = -1;\n\n  const lastPose = {\n    frameId: -1,\n    pose: null as null | Landmark[],\n    timestamp: 0,\n  };\n\n  setupMediaPipeListening(\n    (mpResults, frameId) => {\n      // console.log('Got mp result');\n      if (frameId !== lastPose.frameId) {\n        console.warn(`Skipping motion recording frame -- proceesed frameId ${frameId} doesn't match stored pose with id: ${lastPose.frameId}`);\n        return;\n      }\n      if (isSavingFrames.value) {\n        motionRecorder.saveMotionFrame(\n          recordingSessionId,\n          lastPose.timestamp,\n          mpResults,\n          { poseLandmarks: lastPose.pose ?? undefined },\n        );\n      }\n    },\n    (frameId) => {\n      lastPose.frameId = frameId;\n      lastPose.pose = videoPlayer.value?.currentPose ?? null;\n      lastPose.timestamp = videoTime.value;\n    },\n  );\n  const canSaveFrame = computed(() => {\n    if (isSavingFrames.value) return false;\n    if (!activity.value) return false;\n    // if (!activityFinished.value) return false;\n    return activity.value.demoVisual === 'skeleton' && activity.value.userVisual !== 'none';\n  });\n  async function startSaveFrames() {\n    recordingSessionId = await motionRecorder.startRecordingSession(\n      { width: 640, height: 480 },\n      videoPlayer.value?.getVideoDimensions(),\n    );\n\n    isSavingFrames.value = true;\n\n    playActivity(5, true);\n  }\n  async function concludeSaveFrames() {\n\n    await Utils.sleep(1.5);\n\n    isSavingFrames.value = false;\n\n    await motionRecorder.endRecordingSession(\n      recordingSessionId,\n      activity.value?.startTime ?? -1,\n      activity.value?.endTime ?? -1,\n    );\n  }\n\n  return {\n    isSavingFrames, canSaveFrame, startSaveFrames, concludeSaveFrames,\n  };\n}\n\nexport default defineComponent({\n  components: {\n    SegmentedProgressBar,\n    PausingVideoPlayer,\n    InstructionCarousel,\n    WebcamBox,\n    GestureIcon,\n  },\n  props: {\n    targetDance: Object,\n    targetLesson: Object,\n  },\n  setup(props, { emit }) {\n\n    const { targetLesson, targetDance } = toRefs(props);\n\n    const activityState = ref(ActivityPlayState.AwaitingPlayGesture);\n    const showPlayGestureIcon = computed(() => activityState.value === ActivityPlayState.AwaitingPlayGesture);\n\n    const videoPlayer = ref(null as null | typeof PausingVideoPlayer);\n    const videoTime = ref(0);\n\n    const activityId = ref(0);\n    const activity = computed(() => {\n      const lesson = targetLesson?.value as unknown as DanceLesson | null;\n      return lesson?.activities[activityId.value] ?? null;\n    });\n\n    const emphasizedJoints = computed(() => activity.value?.emphasizedJoints ?? []);\n    const activityTitle = computed(() => activity.value?.title ?? '');\n    const activityCount = computed(() => {\n      const lesson = targetLesson?.value as unknown as DanceLesson | null;\n      return lesson?.activities?.length ?? 0;\n    });\n    const hasNextActivity = computed(() => activityCount.value > activityId.value + 1);\n    // eslint-disable-next-line max-len\n    const activityFinished = computed(() => activityState.value === ActivityPlayState.ActivityEnded);\n    const nextActivityTitle = computed(() => {\n      if (!hasNextActivity.value) return 'Finish Lesson';\n      const lesson = targetLesson?.value as unknown as DanceLesson | null;\n\n      const nextActivity = lesson?.activities[activityId.value + 1];\n      return nextActivity?.title ?? 'Unknown';\n    });\n\n    const pauseInstructs = ref([] as Instruction[]);\n    function onPauseHit(pause: PauseInfo) {\n      if (pause.instruction) {\n        pauseInstructs.value.push({\n          id: pause.time,\n          text: pause.instruction,\n        });\n      }\n    }\n    function onPauseEnded() {\n      // Remove all pause instructions\n      pauseInstructs.value.splice(0);\n    }\n\n    const instructions = computed(() => {\n      const mActivity = activity.value;\n      const state = activityState.value;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if (state === ActivityPlayState.AwaitingPlayGesture && mActivity.startInstruction) {\n        instructs.push({\n          id: 1,\n          text: mActivity.startInstruction,\n        });\n      } else if (state === ActivityPlayState.Playing && mActivity.playingInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.playingInstruction,\n        });\n      } else if (state === ActivityPlayState.ActivityEnded && mActivity.endInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.endInstruction,\n        });\n      }\n\n      return instructs;\n    });\n    const timedInstructions = computed(() => {\n      const mActivity = activity.value;\n      const time = videoTime.value;\n      if (!mActivity) return [];\n\n      const activeTimedInstructions = mActivity.timedInstructions?.map(\n        (ti, i) => ({\n          id: i,\n          text: ti.text,\n          start: ti.startTime,\n          end: ti.endTime,\n        })\n      ).filter((ti) => ti.start <= time && time < ti.end) ?? [];\n\n      return activeTimedInstructions;\n    });\n\n    const progressSegments = computed(() => {\n      const lesson = targetLesson?.value as DanceLesson | undefined;\n      const dance = targetDance?.value as DanceEntry | undefined;\n      const curActivity = activity.value;\n      if (lesson && dance && curActivity) return calculateProgressSegments(dance, lesson, curActivity);\n      return [];\n    });\n\n    function playVideo(vidActivity: Activity, pause?: number | undefined) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer is null');\n        return;\n      }\n\n      activityState.value = ActivityPlayState.PendingStart;\n\n      vidPlayer.play(\n        vidActivity.startTime,\n        vidActivity.endTime,\n        (vidActivity.practiceSpeeds ?? [1])[0] ?? 1,\n        vidActivity.pauses ?? [],\n        pause ?? DefaultPauseDuration,\n        () => {\n          activityState.value = ActivityPlayState.Playing;\n        },\n      );\n    }\n\n    function playActivity(pause?: number | undefined, forcePlay?: boolean | undefined) {\n      console.log(`LEARNING SCREEN:: Starting playback (activityId: ${activityId.value})`);\n      pauseInstructs.value.splice(0);\n      activityState.value = ActivityPlayState.AwaitingPlayGesture;\n      const vidActivity = activity.value;\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer || !vidActivity) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer or lessonActivity is null', vidPlayer, vidActivity);\n        return;\n      }\n\n      vidPlayer.setTime(vidActivity.startTime);\n\n      if (!forcePlay && activityId.value !== 0 && !DanceUtils.shouldPauseBeforeActivity(vidActivity)) {\n        playVideo(vidActivity, pause);\n      }\n    }\n\n    function gotoActivity(delta: number) {\n      activityState.value = ActivityPlayState.AwaitingPlayGesture;\n      if (!hasNextActivity.value) {\n        emit('lesson-completed');\n        return;\n      }\n      if (activityId.value === 0 && delta < 0) {\n        // Don't adjust activityId - we can't go back (simply repeat).\n        playActivity();\n        return;\n      }\n      activityId.value += delta;\n      playActivity();\n    }\n    function gotoPreviousActivity() {\n      gotoActivity(-1);\n    }\n\n    function gotoNextActivity() {\n      gotoActivity(1);\n    }\n\n    const {\n      isSavingFrames, canSaveFrame, startSaveFrames, concludeSaveFrames,\n    } = setupFrameRecording(activity, videoTime, videoPlayer, playActivity);\n\n    function onActivityFinished() {\n      activityState.value = ActivityPlayState.ActivityEnded;\n      console.log('LEARNING SCREEN:: Activity finished');\n\n      if (isSavingFrames.value) concludeSaveFrames();\n    }\n\n    const isTrackingUser = computed(() => {\n      if (activity.value?.userVisual === 'skeleton') return true;\n      if (activityState.value === ActivityPlayState.ActivityEnded || activityState.value === ActivityPlayState.AwaitingPlayGesture) return true;\n      if (isSavingFrames.value) return true;\n      return false;\n    });\n    watch(isTrackingUser, (val) => {\n      if (val) TrackingActions.requestTracking(TRACKING_ID);\n      else TrackingActions.endTrackingRequest(TRACKING_ID);\n    });\n\n    setupGestureListening({\n      [GestureNames.pointRight]: () => {\n        if (!activityFinished.value) return;\n        gotoNextActivity();\n      },\n      [GestureNames.pointLeft]: () => {\n        if (!activityFinished.value) return;\n        playActivity();\n      },\n    });\n    onBeforeUnmount(() => {\n      TrackingActions.endTrackingRequest(TRACKING_ID);\n    });\n\n    onMounted(() => {\n      playActivity();\n    });\n\n    return {\n      activityState,\n      showPlayGestureIcon,\n      progressSegments,\n      activity,\n      activityId,\n      activityCount,\n      activityTitle,\n      emphasizedJoints,\n      nextActivityTitle,\n      instructions,\n      timedInstructions,\n      videoPlayer,\n      activityFinished,\n      videoTime,\n      onActivityFinished,\n\n      onPauseHit,\n      onPauseEnded,\n\n      gotoPreviousActivity,\n      gotoNextActivity,\n\n      canSaveFrame,\n      isSavingFrames,\n      startSaveFrames,\n    };\n  },\n  methods: {\n    onTimeChanged(time: number) {\n      this.videoTime = time;\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.learning-screen {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n.master-bar {\n  width: 1280px;\n  // margin: 0 auto;\n  // padding: 1rem 1rem 1rem 1rem;\n  // border-radius: 0 0 0.5rem 0.5rem;\n}\n\n.instructions-overlay {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: flex-end;\n}\n\n.lessonProgress {\n  width: 128px;\n}\n\n.activityGestureCard {\n  max-width: 4rem;\n}\n</style>\n","export interface TimedInstruction {\n  startTime: number;\n  endTime: number;\n  text: string;\n}\n\nexport interface PauseInfo {\n    time: number;\n    pauseDuration?: number;\n    instruction?: string;\n    manualResume?: boolean;\n}\n\nexport interface Activity {\n  title: string;\n  startTime: number;\n  endTime: number;\n  demoVisual: 'video' | 'skeleton' | 'none';\n  userVisual: 'video' | 'skeleton' | 'none'; // If the user's webcam should be on\n  emphasizedJoints?: number[];\n  focusedSegments?: number[];\n  pauses?: Array<PauseInfo>;\n  practiceSpeeds?: Array<number>;\n  startInstruction?: string;\n  playingInstruction?: string;\n  staticInstruction?: string;\n  timedInstructions?: Array<TimedInstruction>;\n  endInstruction?: string;\n}\n\nexport default interface DanceLesson {\n  _id: string;\n  header: {\n    clipName: string;\n    lessonTitle: string;\n  };\n  segmentBreaks: number[];\n  activities: Array<Activity>;\n  fps: number;\n  poseScope: 'all' | 'upperBody';\n  // eslint-disable-next-line\n}\n\nexport class DanceUtils {\n  static shouldPauseBeforeActivity(activity: Activity) {\n    return !!activity.startInstruction;\n  }\n}\n","import RecordRTC, { invokeSaveAsDialog } from 'recordrtc';\n\nexport default class ScreenRecorder {\n\n  private recorder: RecordRTC | null = null;\n\n  async startRecording() {\n\n    const captureStream = await (navigator.mediaDevices as any).getDisplayMedia({});\n\n    this.recorder = new RecordRTC(captureStream);\n    this.recorder.startRecording();\n  }\n\n  async endRecording(): Promise<Blob> {\n    if (!this.recorder) throw new Error('Recording not started!');\n    const { recorder } = this;\n\n    return new Promise((res, rej) => {\n      try {\n        recorder.stopRecording(() => {\n          res(recorder.getBlob());\n        });\n      } catch (e) {\n        rej(e);\n      }\n    });\n  }\n\n}\n","import { MpHolisticResults } from './MediaPipeTypes';\nimport Utils from './Utils';\nimport { saveBlob } from './WebcamProvider';\nimport ScreenRecorder from './ScreenRecorder';\n\nexport interface Dimensions {\n  width: number;\n  height: number;\n}\n\ninterface RecordingSession {\n  frameTimestamps: number[];\n  userDimension: Dimensions;\n  userFrames: MpHolisticResults[];\n  demoDimension: Dimensions;\n  demoFrames: MpHolisticResults[];\n}\n\nexport class MotionRecorder {\n\n  private recordingSessions: Record<number, RecordingSession> = {};\n\n  private recordingSessionNextId = 0;\n\n  private screenRecorder = new ScreenRecorder();\n\n  async startRecordingSession(userDims: Dimensions, demoDims: Dimensions): Promise<number> {\n    this.recordingSessions[this.recordingSessionNextId] = {\n      frameTimestamps: [],\n      userDimension: userDims,\n      userFrames: [],\n      demoDimension: demoDims,\n      demoFrames: [],\n    };\n    this.recordingSessionNextId += 1;\n\n    await this.screenRecorder.startRecording();\n    return this.recordingSessionNextId - 1;\n  }\n\n  saveMotionFrame(sessionId: number, timestamp: number, userFrame: MpHolisticResults, demoFrame: MpHolisticResults) {\n    const session = this.recordingSessions[sessionId];\n    if (!session) throw new Error(`Recording session ${sessionId} wasn't found!`);\n\n    debugger;\n    if (userFrame.image) delete userFrame.image;\n    session.frameTimestamps.push(timestamp);\n    session.userFrames.push(userFrame);\n    session.demoFrames.push(demoFrame);\n  }\n\n  async endRecordingSession(sessionId: number, start: number, end: number) {\n    const session = this.recordingSessions[sessionId];\n    if (!session) throw new Error(`Recording session ${sessionId} wasn't found!`);\n\n    const recordedBlob = await this.screenRecorder.endRecording();\n    saveBlob(recordedBlob, 'recording.webm');\n\n    const mSession = { startTime: start, endTime: end, ...session };\n\n    Utils.PromptDownloadFile(`RecordedSession-${sessionId}.json`, JSON.stringify(mSession));\n  }\n}\n\nconst motionRecorder = new MotionRecorder();\n\nexport default motionRecorder;\n","<template>\n  <div class=\"segmented-progress-bar\">\n    <progress\n      v-for=\"seg in segmentsData\"\n      :key=\"seg.id\"\n      :class=\"[{ 'is-disabled': !seg.enabled, [seg.cssClass]: seg.enabled, 'is-dark': !seg.enabled}, ]\"\n      class=\"progress is-large\"\n      :max=\"seg.max - seg.min\"\n      :value=\"progress - seg.min\"\n      :style=\"{ 'flex-grow': (seg.max - seg.min) }\"\n    ></progress>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, toRefs } from 'vue';\n\nexport interface ProgressSegmentData {\n  min: number;\n  max: number;\n  enabled: boolean;\n}\n\nconst cssClassOptions = [\n  'is-info',\n  'is-success',\n  'is-warning',\n  'is-primary',\n  'is-danger',\n];\n\nexport default defineComponent({\n  name: 'SegmentedProgressBar',\n  props: {\n    segments: {\n      default: Array,\n      type: Array,\n    },\n    progress: {\n      default: 0,\n      type: Number,\n    },\n  },\n  setup(props) {\n    const {\n      segments,\n    } = toRefs(props);\n\n    const segmentsData = computed(\n      () => segments.value.map(\n        (seg, i) => ({\n          id: i,\n          cssClass: cssClassOptions[i % cssClassOptions.length],\n          ...(seg as ProgressSegmentData),\n        }),\n      ),\n    );\n\n    return {\n      segmentsData,\n    };\n  },\n});\n\n</script>\n\n<style lang=\"scss\">\n.segmented-progress-bar {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n\n  progress.progress {\n    border-radius: 0.5rem;\n    flex-basis: 10px;\n    margin-bottom: auto;\n    // border: 2px solid #BBB;\n\n    -webkit-appearance: none;\n    appearance: none;\n\n    &.is-disabled::-webkit-progress-bar,\n    &.is-disabled {\n      background: #888;\n    }\n\n    &.is-disabled::-moz-progress-bar,\n    &.is-disabled::-webkit-progress-value,\n    &.is-disabled::-ms-fill {\n      background: #888;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent, computed, toRefs } from 'vue';\n\nexport interface ProgressSegmentData {\n  min: number;\n  max: number;\n  enabled: boolean;\n}\n\nconst cssClassOptions = [\n  'is-info',\n  'is-success',\n  'is-warning',\n  'is-primary',\n  'is-danger',\n];\n\nexport default defineComponent({\n  name: 'SegmentedProgressBar',\n  props: {\n    segments: {\n      default: Array,\n      type: Array,\n    },\n    progress: {\n      default: 0,\n      type: Number,\n    },\n  },\n  setup(props) {\n    const {\n      segments,\n    } = toRefs(props);\n\n    const segmentsData = computed(\n      () => segments.value.map(\n        (seg, i) => ({\n          id: i,\n          cssClass: cssClassOptions[i % cssClassOptions.length],\n          ...(seg as ProgressSegmentData),\n        }),\n      ),\n    );\n\n    return {\n      segmentsData,\n    };\n  },\n});\n\n","import { render } from \"./SegmentedProgressBar.vue?vue&type=template&id=c8d89964\"\nimport script from \"./SegmentedProgressBar.vue?vue&type=script&lang=ts\"\nexport * from \"./SegmentedProgressBar.vue?vue&type=script&lang=ts\"\n\nimport \"./SegmentedProgressBar.vue?vue&type=style&index=0&id=c8d89964&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <VideoPlayer\n    ref=\"videoPlayer\"\n    :videoBaseUrl=\"videoSrc\"\n    @progress=\"onProgress\"\n    @playback-completed=\"onSegmentPlaybackCompleted\"\n    :videoOpacity=\"videoOpacity\"\n    :drawPoseLandmarks=\"drawPoseLandmarks\"\n    :setDrawStyle=\"setDrawStyle\"\n    :style=\"{\n      height: '720px',\n    }\"\n    :emphasizedJoints=\"emphasizedJoints\"\n    :emphasizedJointStyle=\"emphasizedJointStyle\"\n    />\n</template>\n\n<script lang=\"ts\">\n\nimport { PauseInfo } from '@/model/DanceLesson';\nimport {\n  computed, defineComponent, onBeforeUnmount, ref,\n} from 'vue';\nimport VideoPlayer from './VideoPlayer.vue';\n\nconst DEFAULT_PAUSE_DURATION = 1.5;\n\ntype PlaySegment = {\n  from: number;\n  to: number;\n  speed: number;\n  pause: PauseInfo | null;\n}\nfunction computePlaySegments(from: number, to: number, speed: number, pauses: PauseInfo[]) {\n  const segs: PlaySegment[] = [];\n\n  function nextPauseIndex(prevIndex: number): number {\n    const pTime = Math.max((pauses[prevIndex]?.time ?? 0), from);\n    let pauseIndex = prevIndex + 1;\n    for (; pauseIndex < pauses.length; pauseIndex += 1) {\n      const pi = pauses[pauseIndex];\n      if (pi.time > pTime) break;\n    }\n    return pauseIndex;\n  }\n\n  let segStartTime = from;\n  let pauseIndex = nextPauseIndex(-1);\n  while (pauseIndex < pauses.length) {\n    segs.push({\n      from: segStartTime,\n      to: pauses[pauseIndex].time,\n      speed,\n      pause: pauses[pauseIndex],\n    });\n    segStartTime = pauses[pauseIndex].time;\n    pauseIndex = nextPauseIndex(pauseIndex);\n  }\n  segs.push({\n    from: segStartTime,\n    to,\n    speed,\n    pause: null,\n  });\n\n  return segs;\n}\n\nexport default defineComponent({\n  name: 'PausingVideoPlayer',\n  components: { VideoPlayer },\n  props: {\n    videoSrc: {\n      default: '',\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: (canvasCtx: CanvasRenderingContext2D) => {\n        if (!canvasCtx) return;\n\n        /* eslint-disable no-param-reassign */\n        canvasCtx.strokeStyle = 'rgba(250, 200, 250, 0.95)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n        /* eslint-enable no-param-reassign */\n      },\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n  },\n  emits: ['playback-completed', 'progress', 'pause-hit', 'pause-end'],\n  setup(props, { emit }) {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n\n    let playTimeoutId = undefined as undefined | number;\n\n    function setTime(time: number) {\n      const vidPlayer = videoPlayer.value;\n      if (vidPlayer) vidPlayer.setTime(time);\n      emit('progress', time);\n    }\n\n    function onProgress(time: number) {\n      emit('progress', time);\n    }\n\n    function playSegment(seg: PlaySegment, delaySecs: number, emitResume?: boolean, onPlayStart?: () => void) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n\n      clearTimeout(playTimeoutId);\n      vidPlayer.setTime(seg.from);\n      playTimeoutId = setTimeout(() => {\n        if (emitResume ?? false) {\n          emit('pause-end');\n        }\n        vidPlayer.playVideo(seg.from, seg.to, seg.speed);\n        if (onPlayStart) onPlayStart();\n      }, 1000 * delaySecs);\n    }\n    onBeforeUnmount(() => {\n      clearTimeout(playTimeoutId);\n    });\n\n    let playingSegments: PlaySegment[] = [];\n    let playingSegmentIndex = 0;\n\n    function play(\n      from: number,\n      to: number,\n      speed: number,\n      pauses: Array<PauseInfo>,\n      playDelaySecs: number,\n      onPlayStart?: () => void,\n    ) {\n      clearTimeout(playTimeoutId);\n      setTime(from);\n      playingSegments = computePlaySegments(from, to, speed, pauses);\n      playingSegmentIndex = 0;\n\n      playSegment(playingSegments[playingSegmentIndex], playDelaySecs, false, onPlayStart);\n    }\n    function onSegmentPlaybackCompleted() {\n      const { pause } = playingSegments[playingSegmentIndex];\n      playingSegmentIndex += 1;\n      if (playingSegmentIndex >= playingSegments.length) {\n        emit('playback-completed');\n        return;\n      }\n\n      if (!pause) throw new Error('Expected there to be a pause obj');\n      const nextSeg = playingSegments[playingSegmentIndex];\n\n      emit('pause-hit', pause);\n      const manualResume = pause.manualResume ?? false;\n      if (!manualResume) {\n        playSegment(nextSeg, pause.pauseDuration ?? DEFAULT_PAUSE_DURATION, true);\n      }\n    }\n\n    const currentPose = computed(() => videoPlayer.value?.currentPose ?? null);\n\n    return {\n      videoPlayer,\n      setTime,\n      onProgress,\n      onSegmentPlaybackCompleted,\n      play,\n      currentPose,\n    };\n  },\n  methods: {\n    getVideoDimensions() {\n      return (this.$refs.videoPlayer as typeof VideoPlayer)?.getVideoDimensions();\n    },\n  },\n});\n</script>\n\n<style>\n\n</style>\n","<template>\n  <div\n    class=\"is-relative video-player-container\"\n    :style=\"{\n      width: width,\n      height: height,\n    }\"\n  >\n    <video\n      :src=\"videoUrl\"\n      :style=\"{\n        width: width,\n        height: height,\n        opacity: '' + videoOpacity,\n      }\"\n      ref=\"videoElement\"\n      @loadedmetadata=\"scheduleCanvasResizing\"\n    ></video>\n    <canvas class=\"is-overlay\" ref=\"canvasElement\"> </canvas>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { DrawPose } from '@/services/MediaPipe';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport poseProvider from '@/services/PoseProvider';\nimport {\n  computed,\n  defineComponent,\n  toRefs,\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  nextTick,\n  Ref,\n  watch,\n} from 'vue';\n\nfunction onResize(canvasE: HTMLCanvasElement, videoE: HTMLVideoElement, modified: Ref<boolean>) {\n  nextTick(() => {\n    if (!canvasE || !videoE) return;\n\n    if (canvasE.width !== videoE.offsetWidth) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.width = videoE.offsetWidth;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    if (canvasE.height !== videoE.offsetHeight) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.height = videoE.offsetHeight;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n  });\n}\n\nfunction setupCanvasResizing(\n  videoElement: Ref<null | HTMLVideoElement>,\n  canvasElement: Ref<null | HTMLCanvasElement>,\n  modified: Ref<boolean>,\n) {\n  function resizeCanvas() {\n    const videoE = videoElement.value;\n    const canvasE = canvasElement.value;\n    if (videoE && canvasE) onResize(canvasE, videoE, modified);\n  }\n  onMounted(() => {\n    window.addEventListener('resize', resizeCanvas);\n    nextTick(resizeCanvas);\n  });\n  onBeforeUnmount(() => {\n    window.removeEventListener('resize', resizeCanvas);\n  });\n  return resizeCanvas;\n}\n\nfunction setupVideoPlaying(\n  videoElement: Ref<HTMLVideoElement | null>,\n  startTime: Ref<number>,\n  endTime: Ref<number>,\n  startProgressUpdating: () => void,\n) {\n  function playVideo(\n    from: number,\n    to: number,\n    speed: number,\n  ) {\n    // console.log(`VideoPlayer :: Starting playback from ${from} to ${to} @ ${speed.toPrecision(2)}`);\n\n    // eslint-disable-next-line no-param-reassign\n    startTime.value = from;\n    // eslint-disable-next-line no-param-reassign\n    endTime.value = to;\n\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n\n    videoE.pause();\n    videoE.playbackRate = speed;\n    videoE.currentTime = from;\n\n    nextTick(() => {\n      startProgressUpdating();\n      videoE.play();\n    });\n  }\n\n  function pauseVideo() {\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n    videoE.pause();\n  }\n\n  return { playVideo, pauseVideo };\n}\n\nexport default defineComponent({\n  name: 'VideoPlayer',\n  props: {\n    videoBaseUrl: String,\n    width: String,\n    height: String,\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    fps: {\n      type: Number,\n      default: 30,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: () => {},\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n  },\n  emits: [\n    'playback-completed',\n    'progress',\n  ],\n  setup(props, ctx) {\n    const {\n      videoBaseUrl, drawPoseLandmarks, fps, setDrawStyle, emphasizedJoints, emphasizedJointStyle,\n    } = toRefs(props);\n\n    const videoElement = ref(null as null | HTMLVideoElement);\n    const canvasElement = ref(null as null | HTMLCanvasElement);\n    const canvasCtx = computed(() => canvasElement.value?.getContext('2d') as CanvasRenderingContext2D | null);\n\n    const startTime = ref(0);\n    const endTime = ref(0);\n    const videoUrl = computed(() => videoBaseUrl?.value ?? '');\n    const currentTime = ref(0);\n    const canvasModified = ref(false);\n\n    const resizeCanvas = setupCanvasResizing(videoElement, canvasElement, canvasModified);\n\n    const poses = ref([] as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>);\n    const currentPose = computed(() => {\n      const frame = Math.floor(currentTime.value * fps.value);\n      const pose = poses.value[frame] ?? [];\n      return pose;\n    });\n\n    let prevTime = -1;\n    let timerId = -1;\n    function onTimeUpdated() {\n      const vidElement = videoElement.value;\n      if (!vidElement) return;\n\n      const time = vidElement.currentTime;\n      if (time === prevTime) return;\n      prevTime = time;\n\n      currentTime.value = time;\n      ctx.emit('progress', time);\n\n      if (time + 1 / 60 >= endTime.value) {\n        vidElement.pause();\n        console.log('VideoPlayer :: playback-completed');\n        ctx.emit('playback-completed');\n        clearInterval(timerId);\n        timerId = -1;\n      }\n    }\n\n    const startProgressUpdating = () => {\n      if (timerId !== -1) clearInterval(timerId);\n      timerId = setInterval(onTimeUpdated, 1000 / 30);\n    };\n\n    const { playVideo, pauseVideo } = setupVideoPlaying(\n      videoElement,\n      startTime,\n      endTime,\n      startProgressUpdating,\n    );\n\n    function scheduleCanvasResizing() {\n      setTimeout(() => {\n        nextTick(resizeCanvas);\n      }, 100);\n    }\n\n    // Update pose drawing\n    function clearDrawing() {\n      const canvasE = canvasElement.value;\n      const drawCtx = canvasCtx.value;\n      if (!canvasE || !drawCtx) return;\n      drawCtx.clearRect(0, 0, canvasE.width, canvasE.height);\n    }\n    function drawPose(lms: Landmark[]) {\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n      setDrawStyle.value(drawCtx);\n      DrawPose(drawCtx, lms, {\n        emphasizedJoints: emphasizedJoints.value as number[],\n        emphasisStroke: emphasizedJointStyle.value,\n      });\n    }\n\n    watch([videoBaseUrl, drawPoseLandmarks], async () => {\n      if (!drawPoseLandmarks.value) {\n        poses.value = [];\n        return;\n      }\n\n      poses.value = await poseProvider.GetPose(videoBaseUrl?.value ?? '');\n    });\n    watch([canvasModified, currentPose, drawPoseLandmarks], () => {\n      canvasModified.value = false;\n      clearDrawing();\n\n      if (drawPoseLandmarks.value) {\n        drawPose(currentPose.value as any);\n      }\n    });\n\n    return {\n      videoUrl,\n      resizeCanvas,\n      videoElement,\n      canvasElement,\n      playVideo,\n      pauseVideo,\n      endTime,\n      scheduleCanvasResizing,\n      poses,\n      currentTime,\n      currentPose,\n\n      getVideoDimensions: () => ({\n        height: videoElement.value?.height ?? 0,\n        width: videoElement.value?.width ?? 0,\n      }),\n    };\n  },\n  methods: {\n    setTime(time: number) {\n      const videoE = this.videoElement;\n      if (videoE) {\n        videoE.currentTime = time;\n      }\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n.video-player-container {\n  canvas {\n    margin: auto;\n  }\n\n  video {\n    border-radius: 0.25rem;\n  }\n}\n</style>\n","// import parse from 'csv-parse';\n\nimport Parser, { Row } from '@gregoranders/csv';\nimport { Landmark } from '@/services/MediaPipeTypes';\n\nexport class PoseProvider {\n\n  private poseFiles: Map<string, Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>> = new Map();\n\n  async GetPose(videoName: string) {\n    if (videoName.length < 4) return [];\n\n    const poseFilename = videoName.replace('dances', 'poses').replace('.mp4', '.poses.csv')\n    const cached = this.poseFiles.get(poseFilename);\n    if (cached !== undefined) return cached;\n\n    const stored = localStorage.getItem(poseFilename);\n    if (stored !== null) {\n      const poses = JSON.parse(stored) as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>;\n      this.poseFiles.set(poseFilename, Object.freeze(poses));\n      return poses;\n    }\n\n    const poseFile = await PoseProvider.getPoseFile(poseFilename);\n    const poses = PoseProvider.convertToPoseList(poseFile);\n    this.poseFiles.set(poseFilename, poses);\n\n    localStorage.setItem(poseFilename, JSON.stringify(poses));\n\n    return poses;\n  }\n\n  private static async getPoseFile(url: string) {\n\n    const response = await fetch(url);\n    if (!response.ok) throw new Error(`Error fetching pose file: ${response.statusText}`);\n\n    const text = await response.text();\n\n    return new Parser().parse(text);\n  }\n\n  private static convertToPoseList(csv: readonly Row[]) {\n    const temp = csv.map((row) => PoseProvider.convertRow(row));\n    return Object.freeze(temp.filter((x) => x.length > 0));\n  }\n\n  private static convertRow(row: Row) {\n    if (row.length === 0) return [];\n    if (row[0].startsWith('#')) return [];\n\n    const lms = [] as Array<Readonly<Landmark>>;\n    for (let i = 0; i + 2 < row.length; i += 3) {\n      lms.push(\n        Object.freeze({\n          x: Number.parseFloat(row[i]),\n          y: Number.parseFloat(row[i + 1]),\n          visibility: Number.parseFloat(row[i + 2]),\n        }),\n      );\n    }\n\n    return Object.freeze(lms);\n  }\n}\n\nconst poseProvider = new PoseProvider();\n\nexport default poseProvider;\n","\nimport { DrawPose } from '@/services/MediaPipe';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport poseProvider from '@/services/PoseProvider';\nimport {\n  computed,\n  defineComponent,\n  toRefs,\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  nextTick,\n  Ref,\n  watch,\n} from 'vue';\n\nfunction onResize(canvasE: HTMLCanvasElement, videoE: HTMLVideoElement, modified: Ref<boolean>) {\n  nextTick(() => {\n    if (!canvasE || !videoE) return;\n\n    if (canvasE.width !== videoE.offsetWidth) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.width = videoE.offsetWidth;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n    if (canvasE.height !== videoE.offsetHeight) {\n      // eslint-disable-next-line no-param-reassign\n      canvasE.height = videoE.offsetHeight;\n      // eslint-disable-next-line no-param-reassign\n      modified.value = true;\n    }\n  });\n}\n\nfunction setupCanvasResizing(\n  videoElement: Ref<null | HTMLVideoElement>,\n  canvasElement: Ref<null | HTMLCanvasElement>,\n  modified: Ref<boolean>,\n) {\n  function resizeCanvas() {\n    const videoE = videoElement.value;\n    const canvasE = canvasElement.value;\n    if (videoE && canvasE) onResize(canvasE, videoE, modified);\n  }\n  onMounted(() => {\n    window.addEventListener('resize', resizeCanvas);\n    nextTick(resizeCanvas);\n  });\n  onBeforeUnmount(() => {\n    window.removeEventListener('resize', resizeCanvas);\n  });\n  return resizeCanvas;\n}\n\nfunction setupVideoPlaying(\n  videoElement: Ref<HTMLVideoElement | null>,\n  startTime: Ref<number>,\n  endTime: Ref<number>,\n  startProgressUpdating: () => void,\n) {\n  function playVideo(\n    from: number,\n    to: number,\n    speed: number,\n  ) {\n    // console.log(`VideoPlayer :: Starting playback from ${from} to ${to} @ ${speed.toPrecision(2)}`);\n\n    // eslint-disable-next-line no-param-reassign\n    startTime.value = from;\n    // eslint-disable-next-line no-param-reassign\n    endTime.value = to;\n\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n\n    videoE.pause();\n    videoE.playbackRate = speed;\n    videoE.currentTime = from;\n\n    nextTick(() => {\n      startProgressUpdating();\n      videoE.play();\n    });\n  }\n\n  function pauseVideo() {\n    const videoE = videoElement.value;\n    if (!videoE) {\n      console.error(\"VideoE is null - can't start playback\");\n      return;\n    }\n    videoE.pause();\n  }\n\n  return { playVideo, pauseVideo };\n}\n\nexport default defineComponent({\n  name: 'VideoPlayer',\n  props: {\n    videoBaseUrl: String,\n    width: String,\n    height: String,\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    fps: {\n      type: Number,\n      default: 30,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: () => {},\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n  },\n  emits: [\n    'playback-completed',\n    'progress',\n  ],\n  setup(props, ctx) {\n    const {\n      videoBaseUrl, drawPoseLandmarks, fps, setDrawStyle, emphasizedJoints, emphasizedJointStyle,\n    } = toRefs(props);\n\n    const videoElement = ref(null as null | HTMLVideoElement);\n    const canvasElement = ref(null as null | HTMLCanvasElement);\n    const canvasCtx = computed(() => canvasElement.value?.getContext('2d') as CanvasRenderingContext2D | null);\n\n    const startTime = ref(0);\n    const endTime = ref(0);\n    const videoUrl = computed(() => videoBaseUrl?.value ?? '');\n    const currentTime = ref(0);\n    const canvasModified = ref(false);\n\n    const resizeCanvas = setupCanvasResizing(videoElement, canvasElement, canvasModified);\n\n    const poses = ref([] as Readonly<Array<Readonly<Array<Readonly<Landmark>>>>>);\n    const currentPose = computed(() => {\n      const frame = Math.floor(currentTime.value * fps.value);\n      const pose = poses.value[frame] ?? [];\n      return pose;\n    });\n\n    let prevTime = -1;\n    let timerId = -1;\n    function onTimeUpdated() {\n      const vidElement = videoElement.value;\n      if (!vidElement) return;\n\n      const time = vidElement.currentTime;\n      if (time === prevTime) return;\n      prevTime = time;\n\n      currentTime.value = time;\n      ctx.emit('progress', time);\n\n      if (time + 1 / 60 >= endTime.value) {\n        vidElement.pause();\n        console.log('VideoPlayer :: playback-completed');\n        ctx.emit('playback-completed');\n        clearInterval(timerId);\n        timerId = -1;\n      }\n    }\n\n    const startProgressUpdating = () => {\n      if (timerId !== -1) clearInterval(timerId);\n      timerId = setInterval(onTimeUpdated, 1000 / 30);\n    };\n\n    const { playVideo, pauseVideo } = setupVideoPlaying(\n      videoElement,\n      startTime,\n      endTime,\n      startProgressUpdating,\n    );\n\n    function scheduleCanvasResizing() {\n      setTimeout(() => {\n        nextTick(resizeCanvas);\n      }, 100);\n    }\n\n    // Update pose drawing\n    function clearDrawing() {\n      const canvasE = canvasElement.value;\n      const drawCtx = canvasCtx.value;\n      if (!canvasE || !drawCtx) return;\n      drawCtx.clearRect(0, 0, canvasE.width, canvasE.height);\n    }\n    function drawPose(lms: Landmark[]) {\n      const drawCtx = canvasCtx.value;\n      if (!drawCtx) return;\n      setDrawStyle.value(drawCtx);\n      DrawPose(drawCtx, lms, {\n        emphasizedJoints: emphasizedJoints.value as number[],\n        emphasisStroke: emphasizedJointStyle.value,\n      });\n    }\n\n    watch([videoBaseUrl, drawPoseLandmarks], async () => {\n      if (!drawPoseLandmarks.value) {\n        poses.value = [];\n        return;\n      }\n\n      poses.value = await poseProvider.GetPose(videoBaseUrl?.value ?? '');\n    });\n    watch([canvasModified, currentPose, drawPoseLandmarks], () => {\n      canvasModified.value = false;\n      clearDrawing();\n\n      if (drawPoseLandmarks.value) {\n        drawPose(currentPose.value as any);\n      }\n    });\n\n    return {\n      videoUrl,\n      resizeCanvas,\n      videoElement,\n      canvasElement,\n      playVideo,\n      pauseVideo,\n      endTime,\n      scheduleCanvasResizing,\n      poses,\n      currentTime,\n      currentPose,\n\n      getVideoDimensions: () => ({\n        height: videoElement.value?.height ?? 0,\n        width: videoElement.value?.width ?? 0,\n      }),\n    };\n  },\n  methods: {\n    setTime(time: number) {\n      const videoE = this.videoElement;\n      if (videoE) {\n        videoE.currentTime = time;\n      }\n    },\n  },\n});\n","import { render } from \"./VideoPlayer.vue?vue&type=template&id=6b67d402\"\nimport script from \"./VideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./VideoPlayer.vue?vue&type=script&lang=ts\"\n\nimport \"./VideoPlayer.vue?vue&type=style&index=0&id=6b67d402&lang=scss\"\nscript.render = render\n\nexport default script","\n\nimport { PauseInfo } from '@/model/DanceLesson';\nimport {\n  computed, defineComponent, onBeforeUnmount, ref,\n} from 'vue';\nimport VideoPlayer from './VideoPlayer.vue';\n\nconst DEFAULT_PAUSE_DURATION = 1.5;\n\ntype PlaySegment = {\n  from: number;\n  to: number;\n  speed: number;\n  pause: PauseInfo | null;\n}\nfunction computePlaySegments(from: number, to: number, speed: number, pauses: PauseInfo[]) {\n  const segs: PlaySegment[] = [];\n\n  function nextPauseIndex(prevIndex: number): number {\n    const pTime = Math.max((pauses[prevIndex]?.time ?? 0), from);\n    let pauseIndex = prevIndex + 1;\n    for (; pauseIndex < pauses.length; pauseIndex += 1) {\n      const pi = pauses[pauseIndex];\n      if (pi.time > pTime) break;\n    }\n    return pauseIndex;\n  }\n\n  let segStartTime = from;\n  let pauseIndex = nextPauseIndex(-1);\n  while (pauseIndex < pauses.length) {\n    segs.push({\n      from: segStartTime,\n      to: pauses[pauseIndex].time,\n      speed,\n      pause: pauses[pauseIndex],\n    });\n    segStartTime = pauses[pauseIndex].time;\n    pauseIndex = nextPauseIndex(pauseIndex);\n  }\n  segs.push({\n    from: segStartTime,\n    to,\n    speed,\n    pause: null,\n  });\n\n  return segs;\n}\n\nexport default defineComponent({\n  name: 'PausingVideoPlayer',\n  components: { VideoPlayer },\n  props: {\n    videoSrc: {\n      default: '',\n    },\n    drawPoseLandmarks: {\n      type: Boolean,\n      default: false,\n    },\n    videoOpacity: {\n      type: Number,\n      default: 1,\n    },\n    setDrawStyle: {\n      type: Function,\n      default: (canvasCtx: CanvasRenderingContext2D) => {\n        if (!canvasCtx) return;\n\n        /* eslint-disable no-param-reassign */\n        canvasCtx.strokeStyle = 'rgba(250, 200, 250, 0.95)';\n        canvasCtx.lineWidth = 7;\n        canvasCtx.lineCap = 'round';\n        /* eslint-enable no-param-reassign */\n      },\n    },\n    emphasizedJoints: {\n      type: Array,\n      default: Array,\n    },\n    emphasizedJointStyle: {\n      type: String,\n      default: 'red',\n    },\n  },\n  emits: ['playback-completed', 'progress', 'pause-hit', 'pause-end'],\n  setup(props, { emit }) {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n\n    let playTimeoutId = undefined as undefined | number;\n\n    function setTime(time: number) {\n      const vidPlayer = videoPlayer.value;\n      if (vidPlayer) vidPlayer.setTime(time);\n      emit('progress', time);\n    }\n\n    function onProgress(time: number) {\n      emit('progress', time);\n    }\n\n    function playSegment(seg: PlaySegment, delaySecs: number, emitResume?: boolean, onPlayStart?: () => void) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n\n      clearTimeout(playTimeoutId);\n      vidPlayer.setTime(seg.from);\n      playTimeoutId = setTimeout(() => {\n        if (emitResume ?? false) {\n          emit('pause-end');\n        }\n        vidPlayer.playVideo(seg.from, seg.to, seg.speed);\n        if (onPlayStart) onPlayStart();\n      }, 1000 * delaySecs);\n    }\n    onBeforeUnmount(() => {\n      clearTimeout(playTimeoutId);\n    });\n\n    let playingSegments: PlaySegment[] = [];\n    let playingSegmentIndex = 0;\n\n    function play(\n      from: number,\n      to: number,\n      speed: number,\n      pauses: Array<PauseInfo>,\n      playDelaySecs: number,\n      onPlayStart?: () => void,\n    ) {\n      clearTimeout(playTimeoutId);\n      setTime(from);\n      playingSegments = computePlaySegments(from, to, speed, pauses);\n      playingSegmentIndex = 0;\n\n      playSegment(playingSegments[playingSegmentIndex], playDelaySecs, false, onPlayStart);\n    }\n    function onSegmentPlaybackCompleted() {\n      const { pause } = playingSegments[playingSegmentIndex];\n      playingSegmentIndex += 1;\n      if (playingSegmentIndex >= playingSegments.length) {\n        emit('playback-completed');\n        return;\n      }\n\n      if (!pause) throw new Error('Expected there to be a pause obj');\n      const nextSeg = playingSegments[playingSegmentIndex];\n\n      emit('pause-hit', pause);\n      const manualResume = pause.manualResume ?? false;\n      if (!manualResume) {\n        playSegment(nextSeg, pause.pauseDuration ?? DEFAULT_PAUSE_DURATION, true);\n      }\n    }\n\n    const currentPose = computed(() => videoPlayer.value?.currentPose ?? null);\n\n    return {\n      videoPlayer,\n      setTime,\n      onProgress,\n      onSegmentPlaybackCompleted,\n      play,\n      currentPose,\n    };\n  },\n  methods: {\n    getVideoDimensions() {\n      return (this.$refs.videoPlayer as typeof VideoPlayer)?.getVideoDimensions();\n    },\n  },\n});\n","import { render } from \"./PausingVideoPlayer.vue?vue&type=template&id=5036afb4\"\nimport script from \"./PausingVideoPlayer.vue?vue&type=script&lang=ts\"\nexport * from \"./PausingVideoPlayer.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"is-relative webcam-box\">\n    <video ref=\"videoE\" muted disablePictureInPicture\n    ></video>\n    <div class=\"is-overlay\" v-if=\"webcamStatus !== 'running'\">\n      <div class=\"vcenter-parent\">\n        <div class=\"notification\" v-if=\"this.webcamStartError !== null\">\n          {{this.webcamStartError}}\n        </div>\n        <button\n          @click=\"startWebcam\"\n          class=\"button is-primary\"\n          v-show=\"webcamStatus !== 'running'\"\n          :class=\"{'is-loading': webcamStatus==='loading'}\">\n          Start Webcam\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, ref, watch,\n} from 'vue';\n\nimport webcamProvider from '@/services/WebcamProvider';\n\nexport default defineComponent({\n  name: 'WebcamBox',\n  props: {\n    enableRecordButton: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  setup() {\n    // const enableRecordButton = toRefs(props);\n\n    const videoE = ref(null as null | HTMLVideoElement);\n    const webcamStartError = ref(null as null | any);\n\n    onMounted(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      if (webcamProvider.webcamStatus.value === 'running') {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    watch(webcamProvider.webcamStatus, (status) => {\n      if (status === 'running' && videoE.value) {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    onBeforeUnmount(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      webcamProvider.disconnectVideoElement(videoE.value);\n    });\n\n    return {\n      videoE,\n      webcamStartError,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n    };\n  },\n  methods: {\n    async startWebcam() {\n      this.webcamStartError = null;\n\n      try {\n        await webcamProvider.startWebcam();\n      } catch (e) {\n        this.webcamStartError = e;\n      }\n\n      if (!this.videoE) throw new Error('videoE is null');\n      await webcamProvider.connectVideoElement(this.videoE);\n    },\n    playVideo() {\n      if (!this.videoE) throw new Error('videoE is null');\n      this.videoE.play();\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n\n.webcam-box {\n\n  max-width: 100%;\n  max-height: 100%;\n\n  video {\n    background: rgba(128, 128, 128, 0.5);\n    width: 1280px;\n    // height: 720px;\n    max-height: 100%;\n    max-width: 100%;\n\n    transform: scaleX(-1);\n  }\n}\n</style>\n","\n\nimport {\n  defineComponent, onBeforeUnmount, onMounted, ref, watch,\n} from 'vue';\n\nimport webcamProvider from '@/services/WebcamProvider';\n\nexport default defineComponent({\n  name: 'WebcamBox',\n  props: {\n    enableRecordButton: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  setup() {\n    // const enableRecordButton = toRefs(props);\n\n    const videoE = ref(null as null | HTMLVideoElement);\n    const webcamStartError = ref(null as null | any);\n\n    onMounted(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      if (webcamProvider.webcamStatus.value === 'running') {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    watch(webcamProvider.webcamStatus, (status) => {\n      if (status === 'running' && videoE.value) {\n        webcamProvider.connectVideoElement(videoE.value);\n      }\n    });\n    onBeforeUnmount(() => {\n      if (!videoE.value) throw new Error('videoE is null');\n      webcamProvider.disconnectVideoElement(videoE.value);\n    });\n\n    return {\n      videoE,\n      webcamStartError,\n      webcamProvider,\n      webcamStatus: webcamProvider.webcamStatus,\n      isRecording: webcamProvider.isRecording,\n    };\n  },\n  methods: {\n    async startWebcam() {\n      this.webcamStartError = null;\n\n      try {\n        await webcamProvider.startWebcam();\n      } catch (e) {\n        this.webcamStartError = e;\n      }\n\n      if (!this.videoE) throw new Error('videoE is null');\n      await webcamProvider.connectVideoElement(this.videoE);\n    },\n    playVideo() {\n      if (!this.videoE) throw new Error('videoE is null');\n      this.videoE.play();\n    },\n  },\n});\n","import { render } from \"./WebcamBox.vue?vue&type=template&id=a34b8f5c\"\nimport script from \"./WebcamBox.vue?vue&type=script&lang=ts\"\nexport * from \"./WebcamBox.vue?vue&type=script&lang=ts\"\n\nimport \"./WebcamBox.vue?vue&type=style&index=0&id=a34b8f5c&lang=scss\"\nscript.render = render\n\nexport default script","\nimport DanceLesson, { Activity, PauseInfo, DanceUtils } from '@/model/DanceLesson';\nimport {\n  computed, ComputedRef, defineComponent, onBeforeUnmount, onMounted, Ref, ref, toRefs, watch,\n} from 'vue';\nimport {\n  GestureNames, setupGestureListening, setupMediaPipeListening, TrackingActions,\n} from '@/services/EventHub';\nimport DanceEntry from '@/model/DanceEntry';\nimport motionRecorder from '@/services/MotionRecorder';\nimport InstructionCarousel, { Instruction } from '@/components/elements/InstructionCarousel.vue';\nimport { Landmark } from '@/services/MediaPipeTypes';\nimport Utils from '@/services/Utils';\nimport SegmentedProgressBar, { ProgressSegmentData } from '../elements/SegmentedProgressBar.vue';\nimport PausingVideoPlayer from '../elements/PausingVideoPlayer.vue';\nimport WebcamBox from '../elements/WebcamBox.vue';\nimport GestureIcon from '../elements/GestureIcon.vue';\n\nconst DefaultPauseDuration = 1.5; // 1.5 seconds\n\nconst ActivityPlayState = Object.freeze({\n  AwaitingPlayGesture: 'AwaitingPlayGesture',\n  PendingStart: 'PendingStart',\n  Playing: 'Playing',\n  ActivityEnded: 'ActivityEnded',\n});\n\n//\n// TODO!\n//   * Update segment breaks in activity to have the first activity\n//     start time and the last activity end time.\n//\n\nfunction calculateProgressSegments(dance: DanceEntry, lesson: DanceLesson, activity: Activity) {\n  if (!lesson) return [];\n\n  let last = undefined as undefined | number;\n  const segs = lesson.segmentBreaks.map((timestamp, i) => {\n    let segData = undefined as undefined | ProgressSegmentData;\n    if (last !== undefined) {\n      segData = {\n        min: last,\n        max: timestamp,\n        enabled: activity.focusedSegments ? activity.focusedSegments.indexOf(i - 1) !== -1 : true,\n      };\n    }\n    last = timestamp;\n    return segData;\n  }).filter((x) => x !== undefined);\n\n  return segs;\n}\n\nconst TRACKING_ID = 'LearningScreen';\n\nfunction setupFrameRecording(activity: ComputedRef<Activity | null>, videoTime: Ref<number>, videoPlayer: Ref<null | typeof PausingVideoPlayer>, playActivity: Function) {\n  const isSavingFrames = ref(false);\n  let recordingSessionId = -1;\n\n  const lastPose = {\n    frameId: -1,\n    pose: null as null | Landmark[],\n    timestamp: 0,\n  };\n\n  setupMediaPipeListening(\n    (mpResults, frameId) => {\n      // console.log('Got mp result');\n      if (frameId !== lastPose.frameId) {\n        console.warn(`Skipping motion recording frame -- proceesed frameId ${frameId} doesn't match stored pose with id: ${lastPose.frameId}`);\n        return;\n      }\n      if (isSavingFrames.value) {\n        motionRecorder.saveMotionFrame(\n          recordingSessionId,\n          lastPose.timestamp,\n          mpResults,\n          { poseLandmarks: lastPose.pose ?? undefined },\n        );\n      }\n    },\n    (frameId) => {\n      lastPose.frameId = frameId;\n      lastPose.pose = videoPlayer.value?.currentPose ?? null;\n      lastPose.timestamp = videoTime.value;\n    },\n  );\n  const canSaveFrame = computed(() => {\n    if (isSavingFrames.value) return false;\n    if (!activity.value) return false;\n    // if (!activityFinished.value) return false;\n    return activity.value.demoVisual === 'skeleton' && activity.value.userVisual !== 'none';\n  });\n  async function startSaveFrames() {\n    recordingSessionId = await motionRecorder.startRecordingSession(\n      { width: 640, height: 480 },\n      videoPlayer.value?.getVideoDimensions(),\n    );\n\n    isSavingFrames.value = true;\n\n    playActivity(5, true);\n  }\n  async function concludeSaveFrames() {\n\n    await Utils.sleep(1.5);\n\n    isSavingFrames.value = false;\n\n    await motionRecorder.endRecordingSession(\n      recordingSessionId,\n      activity.value?.startTime ?? -1,\n      activity.value?.endTime ?? -1,\n    );\n  }\n\n  return {\n    isSavingFrames, canSaveFrame, startSaveFrames, concludeSaveFrames,\n  };\n}\n\nexport default defineComponent({\n  components: {\n    SegmentedProgressBar,\n    PausingVideoPlayer,\n    InstructionCarousel,\n    WebcamBox,\n    GestureIcon,\n  },\n  props: {\n    targetDance: Object,\n    targetLesson: Object,\n  },\n  setup(props, { emit }) {\n\n    const { targetLesson, targetDance } = toRefs(props);\n\n    const activityState = ref(ActivityPlayState.AwaitingPlayGesture);\n    const showPlayGestureIcon = computed(() => activityState.value === ActivityPlayState.AwaitingPlayGesture);\n\n    const videoPlayer = ref(null as null | typeof PausingVideoPlayer);\n    const videoTime = ref(0);\n\n    const activityId = ref(0);\n    const activity = computed(() => {\n      const lesson = targetLesson?.value as unknown as DanceLesson | null;\n      return lesson?.activities[activityId.value] ?? null;\n    });\n\n    const emphasizedJoints = computed(() => activity.value?.emphasizedJoints ?? []);\n    const activityTitle = computed(() => activity.value?.title ?? '');\n    const activityCount = computed(() => {\n      const lesson = targetLesson?.value as unknown as DanceLesson | null;\n      return lesson?.activities?.length ?? 0;\n    });\n    const hasNextActivity = computed(() => activityCount.value > activityId.value + 1);\n    // eslint-disable-next-line max-len\n    const activityFinished = computed(() => activityState.value === ActivityPlayState.ActivityEnded);\n    const nextActivityTitle = computed(() => {\n      if (!hasNextActivity.value) return 'Finish Lesson';\n      const lesson = targetLesson?.value as unknown as DanceLesson | null;\n\n      const nextActivity = lesson?.activities[activityId.value + 1];\n      return nextActivity?.title ?? 'Unknown';\n    });\n\n    const pauseInstructs = ref([] as Instruction[]);\n    function onPauseHit(pause: PauseInfo) {\n      if (pause.instruction) {\n        pauseInstructs.value.push({\n          id: pause.time,\n          text: pause.instruction,\n        });\n      }\n    }\n    function onPauseEnded() {\n      // Remove all pause instructions\n      pauseInstructs.value.splice(0);\n    }\n\n    const instructions = computed(() => {\n      const mActivity = activity.value;\n      const state = activityState.value;\n      if (!mActivity) return [];\n\n      const instructs: Instruction[] = [];\n\n      if (state === ActivityPlayState.AwaitingPlayGesture && mActivity.startInstruction) {\n        instructs.push({\n          id: 1,\n          text: mActivity.startInstruction,\n        });\n      } else if (state === ActivityPlayState.Playing && mActivity.playingInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.playingInstruction,\n        });\n      } else if (state === ActivityPlayState.ActivityEnded && mActivity.endInstruction) {\n        instructs.push({\n          id: 2,\n          text: mActivity.endInstruction,\n        });\n      }\n\n      return instructs;\n    });\n    const timedInstructions = computed(() => {\n      const mActivity = activity.value;\n      const time = videoTime.value;\n      if (!mActivity) return [];\n\n      const activeTimedInstructions = mActivity.timedInstructions?.map(\n        (ti, i) => ({\n          id: i,\n          text: ti.text,\n          start: ti.startTime,\n          end: ti.endTime,\n        })\n      ).filter((ti) => ti.start <= time && time < ti.end) ?? [];\n\n      return activeTimedInstructions;\n    });\n\n    const progressSegments = computed(() => {\n      const lesson = targetLesson?.value as DanceLesson | undefined;\n      const dance = targetDance?.value as DanceEntry | undefined;\n      const curActivity = activity.value;\n      if (lesson && dance && curActivity) return calculateProgressSegments(dance, lesson, curActivity);\n      return [];\n    });\n\n    function playVideo(vidActivity: Activity, pause?: number | undefined) {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer is null');\n        return;\n      }\n\n      activityState.value = ActivityPlayState.PendingStart;\n\n      vidPlayer.play(\n        vidActivity.startTime,\n        vidActivity.endTime,\n        (vidActivity.practiceSpeeds ?? [1])[0] ?? 1,\n        vidActivity.pauses ?? [],\n        pause ?? DefaultPauseDuration,\n        () => {\n          activityState.value = ActivityPlayState.Playing;\n        },\n      );\n    }\n\n    function playActivity(pause?: number | undefined, forcePlay?: boolean | undefined) {\n      console.log(`LEARNING SCREEN:: Starting playback (activityId: ${activityId.value})`);\n      pauseInstructs.value.splice(0);\n      activityState.value = ActivityPlayState.AwaitingPlayGesture;\n      const vidActivity = activity.value;\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer || !vidActivity) {\n        console.error('LEARNING SCREEN:: Aborting video playback: vidPlayer or lessonActivity is null', vidPlayer, vidActivity);\n        return;\n      }\n\n      vidPlayer.setTime(vidActivity.startTime);\n\n      if (!forcePlay && activityId.value !== 0 && !DanceUtils.shouldPauseBeforeActivity(vidActivity)) {\n        playVideo(vidActivity, pause);\n      }\n    }\n\n    function gotoActivity(delta: number) {\n      activityState.value = ActivityPlayState.AwaitingPlayGesture;\n      if (!hasNextActivity.value) {\n        emit('lesson-completed');\n        return;\n      }\n      if (activityId.value === 0 && delta < 0) {\n        // Don't adjust activityId - we can't go back (simply repeat).\n        playActivity();\n        return;\n      }\n      activityId.value += delta;\n      playActivity();\n    }\n    function gotoPreviousActivity() {\n      gotoActivity(-1);\n    }\n\n    function gotoNextActivity() {\n      gotoActivity(1);\n    }\n\n    const {\n      isSavingFrames, canSaveFrame, startSaveFrames, concludeSaveFrames,\n    } = setupFrameRecording(activity, videoTime, videoPlayer, playActivity);\n\n    function onActivityFinished() {\n      activityState.value = ActivityPlayState.ActivityEnded;\n      console.log('LEARNING SCREEN:: Activity finished');\n\n      if (isSavingFrames.value) concludeSaveFrames();\n    }\n\n    const isTrackingUser = computed(() => {\n      if (activity.value?.userVisual === 'skeleton') return true;\n      if (activityState.value === ActivityPlayState.ActivityEnded || activityState.value === ActivityPlayState.AwaitingPlayGesture) return true;\n      if (isSavingFrames.value) return true;\n      return false;\n    });\n    watch(isTrackingUser, (val) => {\n      if (val) TrackingActions.requestTracking(TRACKING_ID);\n      else TrackingActions.endTrackingRequest(TRACKING_ID);\n    });\n\n    setupGestureListening({\n      [GestureNames.pointRight]: () => {\n        if (!activityFinished.value) return;\n        gotoNextActivity();\n      },\n      [GestureNames.pointLeft]: () => {\n        if (!activityFinished.value) return;\n        playActivity();\n      },\n    });\n    onBeforeUnmount(() => {\n      TrackingActions.endTrackingRequest(TRACKING_ID);\n    });\n\n    onMounted(() => {\n      playActivity();\n    });\n\n    return {\n      activityState,\n      showPlayGestureIcon,\n      progressSegments,\n      activity,\n      activityId,\n      activityCount,\n      activityTitle,\n      emphasizedJoints,\n      nextActivityTitle,\n      instructions,\n      timedInstructions,\n      videoPlayer,\n      activityFinished,\n      videoTime,\n      onActivityFinished,\n\n      onPauseHit,\n      onPauseEnded,\n\n      gotoPreviousActivity,\n      gotoNextActivity,\n\n      canSaveFrame,\n      isSavingFrames,\n      startSaveFrames,\n    };\n  },\n  methods: {\n    onTimeChanged(time: number) {\n      this.videoTime = time;\n    },\n  },\n});\n","import { render } from \"./LearningScreen.vue?vue&type=template&id=d6a33c42\"\nimport script from \"./LearningScreen.vue?vue&type=script&lang=ts\"\nexport * from \"./LearningScreen.vue?vue&type=script&lang=ts\"\n\nimport \"./LearningScreen.vue?vue&type=style&index=0&id=d6a33c42&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n   <div class=\"webcam-prompt-card vcenter-parent\" >\n        <div class=\"card\">\n          <div class=\"card-header\">\n            <h3 class=\"card-header-title\">\n            Webcam Access Needed\n            </h3>\n          </div>\n          <div class=\"card-content\">\n            <div class=\"content\">\n              <p>\n                During the lesson, you'll step back from your computer\n                and control this app with gestures. Later on, we'll also\n                use your webcam to give you tips on your technique.\n              </p>\n              <p class=\"notification is-warning\">\n                Please <strong>stop other programs that are using your webcam</strong>. On most computers, only one app is able to use the webcam at a time.\n              </p>\n              <p>\n                <strong>To continue, please grant access to your webcam.</strong>\n              </p>\n            </div>\n          </div>\n          <div class=\"card-content\">\n            <div class=\"buttons is-right\">\n              <a @click=\"$emit('cancelSelected')\" class=\"is-inverted button is-danger\">\n                Cancel\n              </a>\n              <a @click=\"$emit('startWebcamSelected')\" class=\"button is-primary\">\n                Start Webcam\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n</template>\n\n<script>\n\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n  name: 'WebcamPromptCard',\n});\n</script>\n\n<style lang=\"scss\">\n\n.webcam-prompt-card .content {\n  max-width: 60ch;\n  text-align: left;\n}\n</style>\n","import { render } from \"./WebcamPromptCard.vue?vue&type=template&id=07a96404\"\nimport script from \"./WebcamPromptCard.vue?vue&type=script&lang=js\"\nexport * from \"./WebcamPromptCard.vue?vue&type=script&lang=js\"\n\nimport \"./WebcamPromptCard.vue?vue&type=style&index=0&id=07a96404&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n  <div class=\"pose-drawer p-4 content\">\n    <teleport to=\"#topbarLeft\">\n      <button class=\"button\" @click=\"$emit('back-selected')\">&lt; Back</button>\n    </teleport>\n\n    <teleport to='#belowSurface'>\n      <span class=\"is-pulled-right mt-4\">\n        <button class=\"button mr-2\"  @click=\"playVideo\">Play</button>\n        <button class=\"button\" @click=\"pauseVideo\">Pause</button>\n      </span>\n    </teleport>\n    <h3>Pose Drawer Test</h3>\n\n    <div class=\"dropdown\" :class=\"{ 'is-active': dropdownOpen}\">\n      <div class=\"dropdown-trigger\">\n        <button class=\"button\" @click=\"dropdownOpen = !dropdownOpen\">\n          <span>Select a dance</span>\n          <span class=\"icon is-small\">\n            <i class=\"fas fa-angle-down\" aria-hidden=\"true\"></i>\n          </span>\n        </button>\n      </div>\n      <div class=\"dropdown-menu\">\n        <div class=\"dropdown-content\">\n          <a v-for=\"dance in dances\"\n                  :key=\"dance.title\"\n                  class=\"dropdown-item\"\n            @click=\"loadDance(dance)\">\n            {{dance.title}}\n          </a>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"columns\">\n      <div class=\"column\">\n        <h4 class=\"mt-4\">{{clipName}}</h4>\n\n        <div class=\"notification is-danger\" v-show=\"error\">\n          {{error}}\n        </div>\n\n        <div class=\"table-container\" style=\"overflow:auto auto; max-height: 500px;\">\n          <table class=\"table is-fullwidth is-hoverable is-bordered\" v-if=\"videoPlayer && videoPlayer.cPose\">\n            <thead>\n              <tr>\n                <th>id</th>\n                <th>x</th>\n                <th>y</th>\n                <th>vis</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr v-for=\"(lm, index) in videoPlayer.cPose\" :key=\"index\">\n                <td>{{index}}</td>\n                <td>{{lm.x}}</td>\n                <td>{{lm.y}}</td>\n                <td>{{lm.visibility}}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n      <div class=\"column is-one-third\">\n        <VideoPlayer\n        :videoBaseUrl=\"videoSrc\"\n        :height=\"'500px'\"\n        ref=\"videoPlayer\"\n        :drawPoseLandmarks=\"true\"\n        @progress=\"onProgress\"/>\n      </div>\n    </div>\n\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport DanceEntry from '@/model/DanceEntry';\nimport dances from '@/services/MotionDatabase';\nimport {\n  computed, defineComponent, ref,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'PoseDrawerTest',\n  components: { VideoPlayer },\n  data() {\n    return {\n      dances,\n    };\n  },\n  setup() {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n    const dropdownOpen = ref(false);\n    const clipName = ref('');\n    const videoSrc = computed(() => (clipName.value ? (`dances/${clipName.value}.mp4`) : ''));\n    const videoTime = ref(0);\n    const fps = ref(30);\n    const error = ref(null as string | null);\n\n    async function loadDance(dance: DanceEntry) {\n      error.value = null;\n      dropdownOpen.value = false;\n      clipName.value = dance.videoSrc.replace('dances/', '').replace('.mp4', '');\n      fps.value = dance.lessons[0]?.fps ?? 30;\n    }\n\n    function playVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.playVideo(0, 1000, 0.5);\n    }\n    function pauseVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.pauseVideo();\n    }\n\n    function onProgress(time: number) {\n      videoTime.value = time;\n    }\n\n    return {\n      videoPlayer,\n      error,\n      loadDance,\n      dropdownOpen,\n      clipName,\n      videoSrc,\n      playVideo,\n      pauseVideo,\n      onProgress,\n    };\n  },\n});\n</script>\n\n<style>\n\n.pose-drawer {\n  width: 1280px;\n  height: 720px;\n  position: relative;\n  background: white;\n  box-sizing: border-box;\n}\n</style>\n","\nimport DanceEntry from '@/model/DanceEntry';\nimport dances from '@/services/MotionDatabase';\nimport {\n  computed, defineComponent, ref,\n} from 'vue';\n\nimport VideoPlayer from '@/components/elements/VideoPlayer.vue';\n\nexport default defineComponent({\n  name: 'PoseDrawerTest',\n  components: { VideoPlayer },\n  data() {\n    return {\n      dances,\n    };\n  },\n  setup() {\n    const videoPlayer = ref(null as null | typeof VideoPlayer);\n    const dropdownOpen = ref(false);\n    const clipName = ref('');\n    const videoSrc = computed(() => (clipName.value ? (`dances/${clipName.value}.mp4`) : ''));\n    const videoTime = ref(0);\n    const fps = ref(30);\n    const error = ref(null as string | null);\n\n    async function loadDance(dance: DanceEntry) {\n      error.value = null;\n      dropdownOpen.value = false;\n      clipName.value = dance.videoSrc.replace('dances/', '').replace('.mp4', '');\n      fps.value = dance.lessons[0]?.fps ?? 30;\n    }\n\n    function playVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.playVideo(0, 1000, 0.5);\n    }\n    function pauseVideo() {\n      const vidPlayer = videoPlayer.value;\n      if (!vidPlayer) return;\n      vidPlayer.pauseVideo();\n    }\n\n    function onProgress(time: number) {\n      videoTime.value = time;\n    }\n\n    return {\n      videoPlayer,\n      error,\n      loadDance,\n      dropdownOpen,\n      clipName,\n      videoSrc,\n      playVideo,\n      pauseVideo,\n      onProgress,\n    };\n  },\n});\n","import { render } from \"./PoseDrawerTest.vue?vue&type=template&id=5ad1df51\"\nimport script from \"./PoseDrawerTest.vue?vue&type=script&lang=ts\"\nexport * from \"./PoseDrawerTest.vue?vue&type=script&lang=ts\"\n\nimport \"./PoseDrawerTest.vue?vue&type=style&index=0&id=5ad1df51&lang=css\"\nscript.render = render\n\nexport default script","\nimport { defineComponent, nextTick, ref } from 'vue';\nimport webcamProvider from '@/services/WebcamProvider';\nimport CameraSurface from './components/CameraSurface.vue';\nimport OnboardingUI from './components/OnboardingUI.vue';\nimport DanceMenu from './components/screens/DanceMenu.vue';\nimport LearningScreen from './components/screens/LearningScreen.vue';\nimport DanceEntry, { LessonSelection } from './model/DanceEntry';\nimport DanceLesson from './model/DanceLesson';\nimport WebcamPromptCard from './components/elements/WebcamPromptCard.vue';\n\nimport PoseDrawerTest from './components/screens/PoseDrawerTest.vue';\n\nconst State = {\n  DanceMenu: 'DanceMenu',\n  PromptStartWebcam: 'PromptStartWebcam',\n  StartingWebcam: 'StartingWebcam',\n  LoadingTracking: 'LoadingTracking',\n  Onboarding: 'Onboarding',\n  LessonActive: 'LessonActive',\n  PoseDrawingTester: 'PoseDrawingTester',\n};\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    CameraSurface,\n    OnboardingUI,\n    DanceMenu,\n    LearningScreen,\n    WebcamPromptCard,\n    PoseDrawerTest,\n  },\n  setup() {\n    const state = ref(State.DanceMenu);\n    const cameraSurface = ref(null as typeof CameraSurface | null);\n    const hasCompletedOnboarding = ref(false);\n\n    const currentDance = ref(null as DanceEntry | null);\n    const currentLesson = ref(null as DanceLesson | null);\n\n    function danceSelected(sel: LessonSelection) {\n      currentDance.value = sel.dance;\n      currentLesson.value = sel.lesson;\n\n      if (webcamProvider.webcamStatus.value === 'running') state.value = State.LessonActive;\n      else state.value = State.PromptStartWebcam;\n    }\n\n    function goHome() {\n      state.value = State.DanceMenu;\n      currentDance.value = null;\n      currentLesson.value = null;\n    }\n\n    async function startTracking() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      nextTick(() => {\n        const camSurface: any = cameraSurface.value;\n        state.value = State.LoadingTracking;\n        camSurface.startTracking();\n      });\n    }\n\n    async function startWebcam() {\n      console.log('Starting Webcam');\n\n      if (webcamProvider.webcamStatus.value !== 'running') {\n        state.value = State.StartingWebcam;\n\n        try {\n          await webcamProvider.startWebcam();\n        } catch (e) {\n          console.error('Error starting webcam: ', e);\n          // eslint-disable-next-line no-alert\n          alert('Failed to start the webcam\\n\\nPlease ensure this is the only app using the camera and that you\\'ve allowed camera access in your browser.');\n          state.value = State.DanceMenu;\n          return;\n        }\n      }\n\n      state.value = State.LoadingTracking;\n      try {\n        await startTracking();\n      } catch (e) {\n        console.error(\"Couldn't start tracking\", e);\n      }\n    }\n\n    function onTrackingAttained() {\n      console.log('Tracking attained');\n      if (hasCompletedOnboarding.value) {\n        state.value = State.LessonActive;\n      } else state.value = State.Onboarding;\n    }\n\n    return {\n      currentDance,\n      currentLesson,\n      danceSelected,\n      goHome,\n      startWebcam,\n      onTrackingAttained,\n      state,\n      cameraSurface,\n      State,\n    };\n  },\n  methods: {\n    poseDrawerSelected() {\n      this.state = State.PoseDrawingTester;\n    },\n  },\n});\n","import { render } from \"./App.vue?vue&type=template&id=72aa946d\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=72aa946d&lang=scss\"\nscript.render = render\n\nexport default script","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker';\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready() {\n      console.log(\n        'App is being served from cache by a service worker.\\n'\n        + 'For more details, visit https://goo.gl/AFskqB',\n      );\n    },\n    registered() {\n      console.log('Service worker has been registered.');\n    },\n    cached() {\n      console.log('Content has been cached for offline use.');\n    },\n    updatefound() {\n      console.log('New content is downloading.');\n    },\n    updated() {\n      console.log('New content is available; please refresh.');\n    },\n    offline() {\n      console.log('No internet connection found. App is running in offline mode.');\n    },\n    error(error) {\n      console.error('Error during service worker registration:', error);\n    },\n  });\n}\n","import { Landmark, MpHolisticResults, PoseLandmarks } from './MediaPipeTypes';\nimport eventHub, { EventNames, GestureNames } from './EventHub';\nimport {\n  HAND, usingHolistic,\n} from './MediaPipe';\n\nconst minDetectionVisibility = 0.85;\n\nfunction getAngle(lm0: Landmark, lm1: Landmark) {\n  return Math.atan2(lm1.y - lm0.y, lm1.x - lm0.x);\n}\nfunction dist(lm0: Landmark, lm1: Landmark) {\n  return Math.sqrt((lm1.x - lm0.x) ** 2 + (lm1.y - lm0.y) ** 2);\n}\nconst getSum = (input: Array<number>) => input.reduce((a, b) => a + b, 0);\n\nfunction midPoint(lm0: Landmark, lm1: Landmark): Landmark {\n  return {\n    x: (0.5) * (lm0.x + lm1.x),\n    y: (0.5) * (lm0.y + lm1.y),\n  };\n}\n\nfunction averageAngle(input: Array<Landmark>): number {\n  if (input.length < 2) return 0;\n\n  const angles = input.map(\n    (val, i, arr) => (arr[i + 1] === undefined ? 0 : getAngle(arr[i], arr[i + 1])),\n  );\n  angles.pop();\n\n  const y = getSum(angles.map(Math.sin));\n  const x = getSum(angles.map(Math.cos));\n\n  return Math.atan2(y, x);\n}\n\nfunction isLine(input: Array<Landmark>, angleTolerance?: number): boolean {\n  if (input.length < 2) { return false; } // Single point: not a line\n\n  // Default the tolerance to 15 deg (on either side)\n  const tolerance = angleTolerance ?? Math.PI / 12;\n  let lastAngle = getAngle(input[0], input[1]);\n\n  // Make sure the angle is about correct\n  for (let i = 1; i < input.length - 1; i += 1) {\n    const thisAngle = getAngle(input[i], input[i + 1]);\n    if (Math.abs(thisAngle - lastAngle) >= tolerance) { return false; }\n\n    lastAngle = thisAngle;\n  }\n  return true;\n}\n\nfunction detectHandPointingGestures(handLandmarks?: Landmark[]): string {\n  if (!handLandmarks) return GestureNames.none;\n\n  const FINGERS = [\n    HAND.INDEX_FINGER,\n    HAND.MIDDLE_FINGER,\n    HAND.RING_FINGER,\n    HAND.PINKY_FINGER,\n  ];\n\n  const FINGER_LANDMARKS = FINGERS.map((indices) => indices.map((lm) => handLandmarks[lm]));\n\n  let areLines = true;\n  FINGER_LANDMARKS.forEach((finger) => {\n    if (!isLine(finger)) areLines = false;\n  });\n\n  const avgAngle = averageAngle(FINGER_LANDMARKS[0]);\n  const avgAngleDeg = (avgAngle * 180) / Math.PI;\n\n  const tolerance = 30;\n  if (Math.abs(avgAngleDeg) < tolerance && areLines) return GestureNames.pointLeft;\n  if (Math.abs(avgAngleDeg) > 180 - tolerance && areLines) return GestureNames.pointRight;\n\n  return GestureNames.none;\n}\n\nfunction detectPosePointingGestures(poseLandmarks?: Landmark[]): string {\n  if (!poseLandmarks) return GestureNames.none;\n\n  const TOLERANCE = 20;\n  const TOLERANCE_RADS = TOLERANCE / (180 * Math.PI);\n\n  const left = [PoseLandmarks.leftElbow, PoseLandmarks.leftWrist].map((i) => poseLandmarks[i]);\n  const lelb = left[0];\n  const lwrist = left[1];\n  if (lelb.visibility && lelb.visibility > minDetectionVisibility && lwrist.visibility && lwrist.visibility > minDetectionVisibility) {\n    const ang = getAngle(lelb, lwrist);\n    if (Math.abs(ang) > Math.PI - TOLERANCE_RADS) return GestureNames.pointRight;\n  }\n\n  const right = [PoseLandmarks.rightElbow, PoseLandmarks.rightWrist].map((i) => poseLandmarks[i]);\n  const relb = right[0];\n  const rwrist = right[1];\n  if (relb.visibility && relb.visibility > minDetectionVisibility && rwrist.visibility && rwrist.visibility > minDetectionVisibility) {\n    const ang = getAngle(relb, rwrist);\n    if (Math.abs(ang) < TOLERANCE_RADS) return GestureNames.pointLeft;\n  }\n\n  return GestureNames.none;\n}\n\nfunction isNamasteGesture(results: MpHolisticResults): boolean {\n  /* eslint-disable operator-linebreak, no-multi-spaces */\n  const IDs = PoseLandmarks;\n  const poseLMs = results.poseLandmarks;\n  if (!poseLMs) return false;\n\n  const areArmLandmarksVisible =\n    (poseLMs[IDs.leftShoulder].visibility  ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.leftElbow].visibility     ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.leftWrist].visibility     ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightShoulder].visibility ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightElbow].visibility    ?? 0) > minDetectionVisibility &&\n    (poseLMs[IDs.rightWrist].visibility    ?? 0) > minDetectionVisibility;\n\n  // See if elbows are down, against the stomach\n  const downwards = -Math.PI / 2; // -90 deg\n  const leftForearmTargetAngle = downwards;\n  const rightForearmTargetAngle = downwards;\n  const elbowAngleTolerance = Math.PI / 9; // 20 deg\n\n  const leftForearmAngle = getAngle(poseLMs[IDs.leftShoulder], poseLMs[IDs.leftElbow]);\n  const rightForearmAngle = getAngle(poseLMs[IDs.rightShoulder], poseLMs[IDs.rightElbow]);\n\n  const areElbowsNearChest =\n    Math.abs(leftForearmAngle - leftForearmTargetAngle) < elbowAngleTolerance / 2 &&\n    Math.abs(rightForearmAngle - rightForearmTargetAngle) < elbowAngleTolerance / 2;\n\n  // See if hands are up and together, near base of neck\n  const handNeckMinRelativeDist = 0.8;\n  const shoulderDist = dist(poseLMs[IDs.leftShoulder], poseLMs[IDs.rightShoulder]);\n  const neckCenter = midPoint(poseLMs[IDs.leftShoulder], poseLMs[IDs.rightShoulder]);\n  const leftWristNeckDist = dist(neckCenter, poseLMs[IDs.leftWrist]) / shoulderDist;\n  const rightWristNeckDist = dist(neckCenter, poseLMs[IDs.rightWrist]) / shoulderDist;\n\n  const areHandsNearNeckBase =\n    leftWristNeckDist  < handNeckMinRelativeDist &&\n    rightWristNeckDist < handNeckMinRelativeDist;\n\n  console.log('areArmLandmarksVisible', areArmLandmarksVisible);\n  // console.log('areElbowsNearChest', areElbowsNearChest);\n  console.log('areHandsNearNeckBase', areHandsNearNeckBase);\n  console.log('  leftWristNeckDist', leftWristNeckDist);\n  console.log('  rightWristNeckDist', rightWristNeckDist);\n  return areArmLandmarksVisible &&\n        //  areElbowsNearChest &&\n         areHandsNearNeckBase;\n\n  /* eslint-enable operator-linebreak, no-multi-spaces */\n}\n\nexport default function detectGesture(mpResults?: MpHolisticResults): string {\n  if (!mpResults) return GestureNames.none;\n  let detectedGesture = GestureNames.none;\n\n  if (usingHolistic) {\n    if (detectedGesture === GestureNames.none) detectedGesture = detectHandPointingGestures(mpResults.rightHandLandmarks);\n    if (detectedGesture === GestureNames.none) detectedGesture = detectHandPointingGestures(mpResults.leftHandLandmarks);\n  } else detectedGesture = detectPosePointingGestures(mpResults.poseLandmarks);\n\n  if (detectedGesture === GestureNames.none && isNamasteGesture(mpResults)) {\n    detectedGesture = GestureNames.namaste;\n  }\n\n  return detectedGesture;\n}\n\nexport function startGestureDetection() {\n  eventHub.on(EventNames.trackingResults, (results: MpHolisticResults) => {\n    const detectedGesture = detectGesture(results);\n    eventHub.emit(EventNames.gesture, detectedGesture, results);\n  });\n}\n","import { createApp } from 'vue';\n\nimport App from './App.vue';\n\nimport './registerServiceWorker';\nimport { startGestureDetection } from './services/GestureDetection';\n\nrequire('@/assets/main.scss');\n\nconst app = createApp(App);\napp.mount('#app');\n\nstartGestureDetection();\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./InstructionCarousel.vue?vue&type=style&index=0&id=1819acf3&lang=scss\"","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&id=72aa946d&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./WebcamBox.vue?vue&type=style&index=0&id=a34b8f5c&lang=scss\""],"sourceRoot":""}